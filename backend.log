INFO:     Will watch for changes in these directories: ['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [11556] using StatReload
2025-08-17 11:42:40,467 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [11574]
INFO:     Waiting for application startup.
2025-08-17 11:42:48,962 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 11:42:48,962 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 11:42:49,163 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 11:42:49,251 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 11:42:49,251 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 11:42:49,251 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 11:42:49,977 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 11:42:49,977 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 11:42:50,121 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 11:42:50,143 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 4769.51it/s]
2025-08-17 11:42:54,456 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 11:42:54,485 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 11:42:54,485 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 4.34s
2025-08-17 11:42:54,496 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 11:42:54,497 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 11:42:54,639 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 11:42:54,692 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 11:42:54,693 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 11:42:54,693 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 11:42:55,252 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.77s
2025-08-17 11:42:55,283 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.03s
2025-08-17 11:42:55,284 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 11:42:55,284 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 11:42:55,284 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 11:42:55,284 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 11:42:55,284 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 11:42:55,381 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 11:42:55,381 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 11:42:55,381 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 11:42:55,381 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 11:42:55,381 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 11:42:55,381 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 11:42:55,381 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 11:42:55,405 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 11:43:07,893 - src.models.climate_pipeline - INFO - Prewarm encode took 12487ms
2025-08-17 11:43:08,034 - src.models.climate_pipeline - INFO - Second prewarm took 139ms
2025-08-17 11:43:08,034 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 11:43:08,034 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 11:43:08,034 - src.models.climate_pipeline - INFO - Prewarm complete in 12.65s
2025-08-17 11:43:08,035 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 11:43:18,607 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.013s id=req_1755445398593 ip=127.0.0.1
INFO:     127.0.0.1:57677 - "GET /health HTTP/1.1" 200 OK
2025-08-17 11:43:59,023 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.008s id=req_1755445439014 ip=127.0.0.1
INFO:     127.0.0.1:58055 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 11:43:59,138 - src.webui.api.routers.languages - INFO - Language validation: query_len=56 detected=en model=nova confidence=0.800
2025-08-17 11:43:59,142 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.109s id=req_1755445439034 ip=127.0.0.1
INFO:     127.0.0.1:58061 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 11:43:59,147 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.000s id=req_1755445439147 ip=127.0.0.1
INFO:     127.0.0.1:58061 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 11:43:59,171 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755445439150 query_len=56 lang=en
2025-08-17 11:43:59,174 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 11:44:00,396 - src.models.climate_pipeline - INFO - ‚úì Language map loaded from languages.json: 187 names ‚Üí 183 codes (e.g., belarusian‚Üíbe)
2025-08-17 11:44:00,396 - src.models.climate_pipeline - INFO - Processing query: 'What are the local impacts of climate change in Toronto?...' in english (code: en)
2025-08-17 11:44:00,396 - src.models.climate_pipeline - INFO - Raw query repr: 'What are the local impacts of climate change in Toronto?'
2025-08-17 11:44:00,396 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 11:44:00,396 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 11:44:00,397 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 11:44:00,398 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 11:44:00,398 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What are the local impacts of climate change in Toronto?'
2025-08-17 11:44:00,398 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What are the local impacts of climate change in Toronto?'
2025-08-17 11:44:00,398 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 11:44:00,398 - src.models.climate_pipeline - INFO - Timing: routing=1.6ms
2025-08-17 11:44:00,398 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=56, utf8_bytes=56
2025-08-17 11:44:00,399 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=56, utf8_bytes=56
2025-08-17 11:44:00,399 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 11:44:00,402 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 11:44:00,784 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 11:44:00,790 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 11:44:00,892 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 11:44:01,083 - src.models.climate_pipeline - INFO - Timing: cache=684.6ms
2025-08-17 11:44:01,083 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 11:44:01,084 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-17 11:44:01,084 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=0
2025-08-17 11:44:01,084 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='What are the local impacts of climate change in Toronto?'
2025-08-17 11:44:01,087 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='What are the local impacts of climate change in Toronto?', norm='What are the local impacts of climate change in Toronto?'
2025-08-17 11:44:03,093 - query_rewriter - WARNING - REWRITER_TIMEOUT_2S ‚Üí using original query fallback
2025-08-17 11:44:03,095 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 11:44:03,095 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='What are the local impacts of climate change in Toronto?'
2025-08-17 11:44:03,095 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 11:44:03,095 - src.models.climate_pipeline - INFO - Timing: rewrite=2011.3ms
2025-08-17 11:44:03,095 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 11:44:03,096 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 11:44:03,096 - src.models.climate_pipeline - INFO - Timing: guards=1.0ms
2025-08-17 11:44:03,096 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 11:44:03,096 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 11:44:03,096 - src.models.retrieval - INFO - Query embedding IN: query_len=56 chars, query_repr='What are the local impacts of climate change in Toronto?...'
2025-08-17 11:44:03,117 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2025 status=OK request_id=c40abb01-df48-4354-99e6-9de3334fda4d
2025-08-17 11:44:15,455 - src.models.retrieval - INFO - dep=query_embed op=encode ms=12357 dense_dim=1024 sparse_tokens=12
2025-08-17 11:44:16,016 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=546 status=OK
2025-08-17 11:44:16,016 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=547 total_ms=547
2025-08-17 11:44:16,186 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=169 status=OK
2025-08-17 11:44:16,187 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 11:44:16,187 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=169 total_ms=169
2025-08-17 11:44:16,206 - src.models.retrieval - INFO - dep=mmr_embed used_index=6 used_cache=0 embedded=0 ms=1 n_docs=6 valid_vecs=6 q_embed_ms=0
2025-08-17 11:44:16,209 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8375 n_docs=6
2025-08-17 11:44:16,550 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 11:44:16,558 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=348.8 status=OK
2025-08-17 11:44:16,569 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Guide And Workbook For Municipal Climate Adaptation', 'pinecone_score': 0.278877825, 'rerank_score': 0.9920002, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.302861631, 'rerank_score': 0.9899476, 'has_values': True}, {'title': 'Canada In A Changing Climate Synthesis Report', 'pinecone_score': 0.279870391, 'rerank_score': 0.9430336, 'has_values': True}, {'title': 'Toronto First Resilience Strategy', 'pinecone_score': 0.287962556, 'rerank_score': 0.7595823, 'has_values': True}, {'title': 'Transformto Net Zero Strategy A Climate Action Pathway To 2030 And Beyond', 'pinecone_score': 0.274986476, 'rerank_score': 0.29138398, 'has_values': True}]
2025-08-17 11:44:16,569 - src.models.retrieval - INFO - q='What are the local impacts of climate change in Toronto?', base=6, kept_pre=6, refill=0, final_before=4, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.303, p50_sim_pre=0.280, p95_sim_pre=0.303, blocked_base=0, dropped_top2=[{'segment_id': '19', 'title': 'Transformto Net Zero Strategy A Climate Action Pathway To 2030 And Beyond', 'score': 0.29138398}, {'segment_id': '8', 'title': 'Developing Community Resilience For Climate Adaptation In Toronto Ontario', 'score': 0.02120612}]
2025-08-17 11:44:16,569 - src.models.climate_pipeline - INFO - ‚úì Retrieved 5 documents
2025-08-17 11:44:16,570 - src.models.climate_pipeline - INFO - Timing: retrieval=13473.8ms
2025-08-17 11:44:16,570 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 11:44:16,571 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 11:44:16,571 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 11:44:16,584 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 11:44:16,584 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 11:44:16,592 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 11:44:16,592 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 11:44:21,036 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4442 status=OK request_id=ea713a1c-d151-43d7-b5ca-503d06104585
2025-08-17 11:44:21,051 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 11:44:21,051 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 11:44:21,054 - src.models.climate_pipeline - INFO - ‚úì Response generated successfully in English
2025-08-17 11:44:21,054 - src.models.climate_pipeline - INFO - Timing: generation=4484.6ms
2025-08-17 11:44:21,055 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 11:44:22,867 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1809 status=OK request_id=3b14a891-d33d-4916-bc83-2c9bb6e34f0e
2025-08-17 11:44:22,870 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-17 11:44:22,875 - src.models.climate_pipeline - INFO - ‚úì Faithfulness score: 0.950
2025-08-17 11:44:22,875 - src.models.climate_pipeline - INFO - ‚úì Assessment: Highly Faithful
2025-08-17 11:44:22,875 - src.models.climate_pipeline - INFO - Timing: faithfulness=1820.8ms
2025-08-17 11:44:22,876 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 11:44:22,893 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 11:44:22,893 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 11:44:22,918 - src.models.climate_pipeline - INFO - ‚úì Response cached in english
2025-08-17 11:44:22,992 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=1.6 rewrite=2011.3 guards=1.0 retrieval=13473.8 generation=4484.6 faithfulness=1820.8 translation=0.0 total=22480.4
2025-08-17 11:44:22,992 - src.models.climate_pipeline - INFO - ‚úì Query processed successfully in 22.48s
2025-08-17 11:44:23,082 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755445439150 time=23.909s model=nova faithfulness=0.950
2025-08-17 11:44:23,088 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=23.938s id=req_1755445439150 ip=127.0.0.1
INFO:     127.0.0.1:58061 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 11:57:06,498 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.045s id=req_1755446226453 ip=127.0.0.1
INFO:     127.0.0.1:49157 - "GET /health HTTP/1.1" 200 OK
2025-08-17 11:59:26,863 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.007s id=req_1755446366855 ip=127.0.0.1
INFO:     127.0.0.1:50434 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 11:59:26,934 - src.webui.api.routers.languages - INFO - Language validation: query_len=56 detected=en model=nova confidence=0.800
2025-08-17 11:59:26,940 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.067s id=req_1755446366873 ip=127.0.0.1
INFO:     127.0.0.1:50434 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 11:59:26,946 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.002s id=req_1755446366944 ip=127.0.0.1
INFO:     127.0.0.1:50434 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 11:59:26,955 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755446366948 query_len=56 lang=en
2025-08-17 11:59:26,955 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 11:59:26,970 - src.models.climate_pipeline - INFO - Processing query: 'What are the local impacts of climate change in Toronto?...' in english (code: en)
2025-08-17 11:59:26,970 - src.models.climate_pipeline - INFO - Raw query repr: 'What are the local impacts of climate change in Toronto?'
2025-08-17 11:59:26,971 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 11:59:26,971 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 11:59:26,973 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What are the local impacts of climate change in Toronto?'
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What are the local impacts of climate change in Toronto?'
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - Timing: routing=2.4ms
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=56, utf8_bytes=56
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=56, utf8_bytes=56
2025-08-17 11:59:26,974 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 11:59:26,978 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 11:59:27,017 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 11:59:27,017 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 11:59:27,062 - src.models.climate_pipeline - INFO - ‚úì Cache hit for english - returning cached response
2025-08-17 11:59:27,067 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755446366948 time=0.113s model=nova faithfulness=0.950
2025-08-17 11:59:27,069 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.121s id=req_1755446366948 ip=127.0.0.1
INFO:     127.0.0.1:50434 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:00:10,457 - src.webui.api.routers.languages - INFO - Language validation: query_len=45 detected=en model=nova confidence=0.800
2025-08-17 12:00:10,461 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.025s id=req_1755446410436 ip=127.0.0.1
INFO:     127.0.0.1:50823 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:00:10,479 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755446410474 query_len=45 lang=en
2025-08-17 12:00:10,489 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:00:10,489 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-17 12:00:10,490 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:00:10,499 - src.models.climate_pipeline - INFO - Processing query: 'What is Rexale doing to fight climate change?...' in english (code: en)
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Raw query repr: 'What is Rexale doing to fight climate change?'
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:00:10,500 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What is Rexale doing to fight climate change?'
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What is Rexale doing to fight climate change?'
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-17 12:00:10,500 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=45, utf8_bytes=45
2025-08-17 12:00:10,501 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=45, utf8_bytes=45
2025-08-17 12:00:10,501 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:00:10,501 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:00:10,511 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:00:10,512 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:00:10,517 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:00:10,531 - src.models.climate_pipeline - INFO - Timing: cache=30.0ms
2025-08-17 12:00:10,531 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:00:10,531 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:00:10,531 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 12:00:10,531 - src.models.conversation_parser - INFO -   Message 1 (user): What are the local impacts of climate change in Toronto?...
2025-08-17 12:00:10,531 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Local Impacts of Climate Change in Toronto

Climate change is affecting Toronto in many ways, maki...
2025-08-17 12:00:10,531 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=2
2025-08-17 12:00:10,531 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='What is Rexale doing to fight climate change?'
2025-08-17 12:00:10,533 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='What is Rexale doing to fight climate change?', norm='What is Rexale doing to fight climate change?'
2025-08-17 12:00:11,236 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=701 status=OK request_id=51c822a0-7043-4a29-8aba-cc72c3391d0c
2025-08-17 12:00:11,236 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about climate change efforts by a specific entity.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What is Rexale doing to combat climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-17 12:00:11,237 - query_rewriter - INFO - Rewriter NET OUT ‚Üí json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 12:00:11,238 - query_rewriter - INFO - üîç CLASSIFICATION_DEBUG: query='What is Rexale doing to fight climate change?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about climate change efforts by a specific entity....'
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='What is Rexale doing to combat climate change?'
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - Timing: rewrite=707.4ms
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-17 12:00:11,238 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 12:00:11,239 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 12:00:11,239 - src.models.retrieval - INFO - Query embedding IN: query_len=46 chars, query_repr='What is Rexale doing to combat climate change?...'
2025-08-17 12:00:19,792 - src.models.retrieval - INFO - dep=query_embed op=encode ms=8550 dense_dim=1024 sparse_tokens=10
2025-08-17 12:00:20,328 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=527 status=OK
2025-08-17 12:00:20,328 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=528 total_ms=528
2025-08-17 12:00:20,497 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=168 status=OK
2025-08-17 12:00:20,502 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:00:20,503 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=175 total_ms=175
2025-08-17 12:00:20,516 - src.models.retrieval - INFO - dep=mmr_embed used_index=2 used_cache=0 embedded=0 ms=0 n_docs=2 valid_vecs=2 q_embed_ms=0
2025-08-17 12:00:20,519 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=1784 n_docs=2
2025-08-17 12:00:20,803 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:00:20,812 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=293.4 status=OK
2025-08-17 12:00:20,829 - src.models.retrieval - INFO - Query embedding IN: query_len=46 chars, query_repr='What is Rexale doing to combat climate change?...'
2025-08-17 12:00:20,920 - src.models.retrieval - INFO - dep=query_embed op=encode ms=90 dense_dim=1024 sparse_tokens=10
2025-08-17 12:00:21,590 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=144 status=OK
2025-08-17 12:00:21,590 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:00:21,590 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=145 total_ms=145
2025-08-17 12:00:21,623 - src.models.retrieval - ERROR - Error in get_documents: list index out of range
2025-08-17 12:00:21,623 - src.models.climate_pipeline - ERROR - Document retrieval failed: list index out of range
2025-08-17 12:00:21,628 - src.models.climate_pipeline - INFO - Timing: retrieval=10390.3ms
2025-08-17 12:00:22,281 - src.models.climate_pipeline - INFO - Attempting Tavily fallback search (pipeline)
2025-08-17 12:00:25,614 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:00:25,615 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:00:25,619 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:00:25,619 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:00:25,623 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:00:25,623 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:00:28,757 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3133 status=OK request_id=1a2baf3f-4a08-465b-8c91-bcfd850de2da
2025-08-17 12:00:28,768 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:00:28,768 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:00:28,875 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:00:31,393 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2517 status=OK request_id=5b23b139-7fb8-45d4-bd50-a44fadbc2754
2025-08-17 12:00:31,396 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 12:00:31,399 - src.models.climate_pipeline - INFO - Fallback faithfulness (pipeline): 0.900
2025-08-17 12:00:31,401 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755446410474 time=20.922s model=nova faithfulness=0.900
2025-08-17 12:00:31,402 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=20.928s id=req_1755446410474 ip=127.0.0.1
INFO:     127.0.0.1:50823 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/data/config/config.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 12:05:10,585 - src.webui.api.main - INFO - üßπ Cleaning up pipeline...
2025-08-17 12:05:10,591 - src.models.climate_pipeline - INFO - ‚úì Nova model client closed
2025-08-17 12:05:10,595 - src.models.climate_pipeline - INFO - ‚úì Cohere client closed
2025-08-17 12:05:10,599 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:05:10,689 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:05:10,689 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:05:10,692 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 12:05:10,692 - src.models.climate_pipeline - INFO - ‚úì Redis client closed
2025-08-17 12:05:10,692 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 12:05:10,692 - src.webui.api.main - INFO - ‚úÖ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [11574]
2025-08-17 12:05:18,093 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [21145]
INFO:     Waiting for application startup.
2025-08-17 12:05:28,438 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:05:28,438 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:05:28,719 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:05:28,757 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:05:28,757 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:05:28,757 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:05:28,763 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:05:28,763 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:05:28,993 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:05:29,015 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 11359.49it/s]
2025-08-17 12:05:31,439 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:05:31,445 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:05:31,445 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 2.43s
2025-08-17 12:05:31,452 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:05:31,452 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:05:32,067 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:05:32,087 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:05:32,088 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:05:32,088 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:05:32,587 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 1.14s
2025-08-17 12:05:32,609 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 12:05:32,609 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:05:32,609 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:05:32,609 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:05:32,609 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:05:32,610 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:05:32,631 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:05:32,631 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:05:32,631 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:05:32,631 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:05:32,631 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:05:32,631 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:05:32,631 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:05:32,631 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
WARNING:  StatReload detected changes in 'src/models/retrieval.py'. Reloading...
2025-08-17 12:05:40,692 - src.models.climate_pipeline - INFO - Prewarm encode took 8058ms
2025-08-17 12:05:40,831 - src.models.climate_pipeline - INFO - Second prewarm took 135ms
2025-08-17 12:05:40,831 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:05:40,831 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:05:40,831 - src.models.climate_pipeline - INFO - Prewarm complete in 8.20s
2025-08-17 12:05:40,831 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:05:53,372 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [21371]
INFO:     Waiting for application startup.
2025-08-17 12:05:58,556 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:05:58,556 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:05:58,814 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:05:58,873 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:05:58,873 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:05:58,873 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:05:58,941 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:05:58,941 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:05:59,081 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:05:59,117 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
WARNING:  StatReload detected changes in 'src/models/retrieval.py'. Reloading...
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 7892.93it/s]
2025-08-17 12:06:03,024 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:06:03,037 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:06:03,037 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 3.92s
2025-08-17 12:06:03,049 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:06:03,050 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:06:03,765 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:06:03,786 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:06:03,788 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:06:03,788 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:06:04,046 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 1.01s
2025-08-17 12:06:04,113 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 12:06:04,113 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:06:04,113 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:06:04,113 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:06:04,113 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:06:04,113 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:06:04,142 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:06:04,143 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:06:04,143 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:06:04,143 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:06:04,143 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:06:04,143 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:06:04,143 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:06:04,143 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:06:30,067 - src.models.climate_pipeline - INFO - Prewarm encode took 25923ms
2025-08-17 12:06:30,135 - src.models.climate_pipeline - INFO - Second prewarm took 67ms
2025-08-17 12:06:30,135 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:06:30,135 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:06:30,135 - src.models.climate_pipeline - INFO - Prewarm complete in 25.99s
2025-08-17 12:06:30,136 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:06:36,164 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [21763]
INFO:     Waiting for application startup.
2025-08-17 12:06:39,824 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:06:39,824 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:06:39,952 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:06:40,013 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:06:40,013 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:06:40,013 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:06:40,108 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:06:40,109 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:06:40,195 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:06:40,220 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 10308.79it/s]
2025-08-17 12:06:41,566 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:06:41,569 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:06:41,569 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 1.35s
2025-08-17 12:06:41,572 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:06:41,572 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:06:41,865 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:06:41,889 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:06:41,890 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:06:41,890 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:06:42,230 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.66s
2025-08-17 12:06:42,246 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 12:06:42,246 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:06:42,246 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:06:42,246 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:06:42,246 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:06:42,246 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:06:42,278 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:06:42,278 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:06:42,279 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:06:42,279 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:06:42,279 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:06:42,279 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:06:42,279 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:06:42,279 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:06:57,351 - src.models.climate_pipeline - INFO - Prewarm encode took 15072ms
2025-08-17 12:06:57,447 - src.models.climate_pipeline - INFO - Second prewarm took 95ms
2025-08-17 12:06:57,447 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:06:57,447 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:06:57,447 - src.models.climate_pipeline - INFO - Prewarm complete in 15.17s
2025-08-17 12:06:57,447 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:07:18,976 - src.webui.api.routers.languages - INFO - Language validation: query_len=56 detected=en model=nova confidence=0.800
2025-08-17 12:07:18,978 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.083s id=req_1755446838894 ip=127.0.0.1
INFO:     127.0.0.1:55225 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:07:18,993 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755446838984 query_len=56 lang=en
2025-08-17 12:07:18,994 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:07:19,690 - src.models.climate_pipeline - INFO - ‚úì Language map loaded from languages.json: 187 names ‚Üí 183 codes (e.g., belarusian‚Üíbe)
2025-08-17 12:07:19,690 - src.models.climate_pipeline - INFO - Processing query: 'What are the local impacts of climate change in Toronto?...' in english (code: en)
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - Raw query repr: 'What are the local impacts of climate change in Toronto?'
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:07:19,691 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What are the local impacts of climate change in Toronto?'
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What are the local impacts of climate change in Toronto?'
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:07:19,691 - src.models.climate_pipeline - INFO - Timing: routing=0.9ms
2025-08-17 12:07:19,692 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=56, utf8_bytes=56
2025-08-17 12:07:19,692 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=56, utf8_bytes=56
2025-08-17 12:07:19,692 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:07:19,696 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:07:19,898 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:07:19,898 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:07:19,968 - src.models.climate_pipeline - INFO - ‚úì Cache hit for english - returning cached response
2025-08-17 12:07:19,969 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755446838984 time=0.976s model=nova faithfulness=0.950
2025-08-17 12:07:19,970 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.986s id=req_1755446838984 ip=127.0.0.1
INFO:     127.0.0.1:55225 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:07:41,692 - src.webui.api.routers.languages - INFO - Language validation: query_len=41 detected=en model=nova confidence=0.800
2025-08-17 12:07:41,693 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.011s id=req_1755446861682 ip=127.0.0.1
INFO:     127.0.0.1:55425 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:07:41,717 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755446861714 query_len=41 lang=en
2025-08-17 12:07:41,718 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:07:41,718 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-17 12:07:41,718 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:07:41,746 - src.models.climate_pipeline - INFO - Processing query: 'What is rexdale doing for climate change?...' in english (code: en)
2025-08-17 12:07:41,749 - src.models.climate_pipeline - INFO - Raw query repr: 'What is rexdale doing for climate change?'
2025-08-17 12:07:41,750 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:07:41,750 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:07:41,750 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:07:41,750 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:07:41,750 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What is rexdale doing for climate change?'
2025-08-17 12:07:41,751 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What is rexdale doing for climate change?'
2025-08-17 12:07:41,751 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:07:41,751 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-17 12:07:41,751 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=41, utf8_bytes=41
2025-08-17 12:07:41,751 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=41, utf8_bytes=41
2025-08-17 12:07:41,751 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:07:41,751 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:07:41,765 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:07:41,765 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:07:41,768 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:07:41,786 - src.models.climate_pipeline - INFO - Timing: cache=35.3ms
2025-08-17 12:07:41,786 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:07:41,786 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:07:41,786 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 12:07:41,786 - src.models.conversation_parser - INFO -   Message 1 (user): What are the local impacts of climate change in Toronto?...
2025-08-17 12:07:41,786 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Local Impacts of Climate Change in Toronto

Climate change is affecting Toronto in many ways, maki...
2025-08-17 12:07:41,786 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=2
2025-08-17 12:07:41,786 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='What is rexdale doing for climate change?'
2025-08-17 12:07:41,788 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='What is rexdale doing for climate change?', norm='What is rexdale doing for climate change?'
2025-08-17 12:07:42,901 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1112 status=OK request_id=40fd8dbe-815a-4a4b-9b3f-2579d634675f
2025-08-17 12:07:42,903 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about local climate action, consistent with previous conversation on climate impacts in Toronto.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What is Rexdale doing to address climate change?","ask_how_to_use":false
2025-08-17 12:07:42,903 - query_rewriter - INFO - Rewriter NET OUT ‚Üí json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 12:07:42,904 - query_rewriter - INFO - üîç CLASSIFICATION_DEBUG: query='What is rexdale doing for climate change?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about local climate action, consistent with previous conversation on climate impacts i...'
2025-08-17 12:07:42,905 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 12:07:42,905 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='What is Rexdale doing to address climate change?'
2025-08-17 12:07:42,905 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 12:07:42,905 - src.models.climate_pipeline - INFO - Timing: rewrite=1119.1ms
2025-08-17 12:07:42,905 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 12:07:42,906 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 12:07:42,906 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-17 12:07:42,906 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 12:07:42,906 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 12:07:42,906 - src.models.retrieval - INFO - Query embedding IN: query_len=48 chars, query_repr='What is Rexdale doing to address climate change?...'
2025-08-17 12:07:46,565 - src.models.retrieval - INFO - dep=query_embed op=encode ms=3659 dense_dim=1024 sparse_tokens=10
2025-08-17 12:07:47,452 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=877 status=OK
2025-08-17 12:07:47,452 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=878 total_ms=878
2025-08-17 12:07:47,607 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=154 status=OK
2025-08-17 12:07:47,607 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:07:47,607 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=154 total_ms=154
2025-08-17 12:07:47,612 - src.models.retrieval - INFO - dep=mmr_embed used_index=2 used_cache=0 embedded=0 ms=0 n_docs=2 valid_vecs=2 q_embed_ms=0
2025-08-17 12:07:47,617 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=1784 n_docs=2
2025-08-17 12:07:47,907 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:07:47,912 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=294.9 status=OK
2025-08-17 12:07:47,918 - src.models.retrieval - INFO - Query embedding IN: query_len=48 chars, query_repr='What is Rexdale doing to address climate change?...'
2025-08-17 12:07:48,051 - src.models.retrieval - INFO - dep=query_embed op=encode ms=133 dense_dim=1024 sparse_tokens=10
2025-08-17 12:07:48,657 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=176 status=OK
2025-08-17 12:07:48,657 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:07:48,657 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=176 total_ms=176
2025-08-17 12:07:48,661 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=12284 n_docs=9
2025-08-17 12:07:48,769 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:07:48,772 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=111.1 status=OK
2025-08-17 12:07:48,773 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Rexdale Snap Action Plan Executive Summary Final 2', 'pinecone_score': 0.367172122, 'rerank_score': 0.98421544, 'has_values': True}, {'title': 'Rexdale Snap Action Plan Report 11 20 23 Fa 2 2', 'pinecone_score': 0.348614514, 'rerank_score': 0.9769348, 'has_values': True}, {'title': 'Sowing The Seeds For Local Climate Leadership A Learning Guide For Resident Enga', 'pinecone_score': 0.191409618, 'rerank_score': 0.28189954, 'has_values': True}, {'title': 'Climate Change And Water Quality In The Great Lakes Basin', 'pinecone_score': 0.158679739, 'rerank_score': 0.04922211, 'has_values': True}, {'title': 'Canada In A Changing Climate National Issues Report', 'pinecone_score': 0.177808806, 'rerank_score': 0.03527755, 'has_values': True}]
2025-08-17 12:07:48,773 - src.models.retrieval - INFO - q='What is Rexdale doing to address climate change?', base=2, kept_pre=2, refill=0, final_before=2, final_after=5, hybrid_refill=3, floor=0.95, delta=0.100, max_sim_pre=0.367, p50_sim_pre=0.349, p95_sim_pre=0.367, blocked_base=0, dropped_top2=[]
2025-08-17 12:07:48,775 - src.models.climate_pipeline - INFO - ‚úì Retrieved 5 documents
2025-08-17 12:07:48,775 - src.models.climate_pipeline - INFO - Timing: retrieval=5869.0ms
2025-08-17 12:07:48,775 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 12:07:48,775 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:07:48,775 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:07:48,780 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:07:48,781 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:07:48,782 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:07:48,782 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:07:53,137 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4353 status=OK request_id=86c97e73-1786-4dfb-8ada-7c1883c8db2d
2025-08-17 12:07:53,147 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:07:53,147 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:07:53,148 - src.models.climate_pipeline - INFO - ‚úì Response generated successfully in English
2025-08-17 12:07:53,148 - src.models.climate_pipeline - INFO - Timing: generation=4373.8ms
2025-08-17 12:07:53,149 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 12:07:54,775 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1625 status=OK request_id=bdc36062-5047-4c18-aab3-7caf90872327
2025-08-17 12:07:54,786 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 12:07:54,787 - src.models.climate_pipeline - INFO - ‚úì Faithfulness score: 0.900
2025-08-17 12:07:54,788 - src.models.climate_pipeline - INFO - ‚úì Assessment: Highly Faithful
2025-08-17 12:07:54,788 - src.models.climate_pipeline - INFO - Timing: faithfulness=1639.2ms
2025-08-17 12:07:54,790 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:07:54,802 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:07:54,803 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:07:54,871 - src.models.climate_pipeline - INFO - ‚úì Response cached in english
2025-08-17 12:07:54,969 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.4 rewrite=1119.1 guards=0.0 retrieval=5869.0 generation=4373.8 faithfulness=1639.2 translation=0.0 total=13046.2
2025-08-17 12:07:54,969 - src.models.climate_pipeline - INFO - ‚úì Query processed successfully in 13.05s
2025-08-17 12:07:54,970 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755446861714 time=13.253s model=nova faithfulness=0.900
2025-08-17 12:07:54,972 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=13.257s id=req_1755446861714 ip=127.0.0.1
INFO:     127.0.0.1:55425 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:08:49,773 - src.webui.api.routers.languages - INFO - Language validation: query_len=63 detected=en model=nova confidence=0.800
2025-08-17 12:08:49,774 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.012s id=req_1755446929762 ip=127.0.0.1
INFO:     127.0.0.1:56038 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:08:49,812 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755446929807 query_len=63 lang=en
2025-08-17 12:08:49,822 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-17 12:08:49,822 - src.webui.api.routers.chat - INFO - Parsed conversation history: 4 messages
2025-08-17 12:08:49,822 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:08:49,836 - src.models.climate_pipeline - INFO - Processing query: 'How is the US helping canadians in the fight for climate change...' in english (code: en)
2025-08-17 12:08:49,836 - src.models.climate_pipeline - INFO - Raw query repr: 'How is the US helping canadians in the fight for climate change'
2025-08-17 12:08:49,836 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:08:49,836 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:08:49,836 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='How is the US helping canadians in the fight for climate change'
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='How is the US helping canadians in the fight for climate change'
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=63, utf8_bytes=63
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=63, utf8_bytes=63
2025-08-17 12:08:49,837 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:08:49,838 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:08:49,862 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:08:49,862 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:08:49,863 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:08:49,873 - src.models.climate_pipeline - INFO - Timing: cache=35.9ms
2025-08-17 12:08:49,873 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:08:49,873 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-17 12:08:49,873 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 12:08:49,873 - src.models.conversation_parser - INFO -   Message 1 (user): What are the local impacts of climate change in Toronto?...
2025-08-17 12:08:49,873 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Local Impacts of Climate Change in Toronto

Climate change is affecting Toronto in many ways, maki...
2025-08-17 12:08:49,873 - src.models.conversation_parser - INFO -   Message 3 (user): What is rexdale doing for climate change?...
2025-08-17 12:08:49,873 - src.models.conversation_parser - INFO -   Message 4 (assistant): # Rexdale's Efforts to Address Climate Change

Rexdale, a community in Toronto, is taking several st...
2025-08-17 12:08:49,873 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=4
2025-08-17 12:08:49,873 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='How is the US helping canadians in the fight for climate change'
2025-08-17 12:08:49,874 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='How is the US helping canadians in the fight for climate change', norm='How is the US helping canadians in the fight for climate change'
2025-08-17 12:08:50,580 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=705 status=OK request_id=9a5ce5be-33ee-405f-a659-f1c037472b10
2025-08-17 12:08:50,582 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about climate change efforts between the US and Canada.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"How is the US helping Canadians in the fight against climate change?","ask_how_to_use":false,"how_it_works":null,
2025-08-17 12:08:50,582 - query_rewriter - INFO - Rewriter NET OUT ‚Üí json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 12:08:50,583 - query_rewriter - INFO - üîç CLASSIFICATION_DEBUG: query='How is the US helping canadians in the fight for c...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about climate change efforts between the US and Canada....'
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='How is the US helping Canadians in the fight against climate change?'
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - Timing: rewrite=711.0ms
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-17 12:08:50,584 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 12:08:50,584 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 12:08:50,585 - src.models.retrieval - INFO - Query embedding IN: query_len=68 chars, query_repr='How is the US helping Canadians in the fight against climate change?...'
2025-08-17 12:08:53,089 - src.models.retrieval - INFO - dep=query_embed op=encode ms=2504 dense_dim=1024 sparse_tokens=13
2025-08-17 12:08:53,298 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=206 status=OK
2025-08-17 12:08:53,298 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=206 total_ms=206
2025-08-17 12:08:53,468 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=169 status=OK
2025-08-17 12:08:53,468 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:08:53,468 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=169 total_ms=169
2025-08-17 12:08:53,470 - src.models.retrieval - INFO - dep=mmr_embed used_index=4 used_cache=0 embedded=0 ms=0 n_docs=4 valid_vecs=4 q_embed_ms=0
2025-08-17 12:08:53,471 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=4588 n_docs=4
2025-08-17 12:08:53,594 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:08:53,608 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=136.7 status=OK
2025-08-17 12:08:53,615 - src.models.retrieval - INFO - Query embedding IN: query_len=68 chars, query_repr='How is the US helping Canadians in the fight against climate change?...'
2025-08-17 12:08:53,733 - src.models.retrieval - INFO - dep=query_embed op=encode ms=117 dense_dim=1024 sparse_tokens=13
2025-08-17 12:08:54,627 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=475 status=OK
2025-08-17 12:08:54,628 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:08:54,628 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=478 total_ms=478
2025-08-17 12:08:54,637 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=30870 n_docs=23
2025-08-17 12:08:54,771 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:08:54,779 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=141.5 status=OK
2025-08-17 12:08:54,783 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Climate Change Factsheet', 'pinecone_score': 0.266945481, 'rerank_score': 0.010986943, 'has_values': True}, {'title': 'Climate Accountability Toolkit A Roadmap For Municipalities', 'pinecone_score': 0.219989821, 'rerank_score': 0.2165081, 'has_values': True}, {'title': 'Government Of Canada Adaptation Action Plan Canada.ca', 'pinecone_score': 0.272696316, 'rerank_score': 0.07613248, 'has_values': True}, {'title': 'Guide For Integrating Climate Change Considerations Into Municipal Asset Managem', 'pinecone_score': 0.250206828, 'rerank_score': 0.07558479, 'has_values': True}, {'title': 'Adapting To Climate Change A Risk Based Guide For Local Governments', 'pinecone_score': 0.224742606, 'rerank_score': 0.039268754, 'has_values': True}]
2025-08-17 12:08:54,784 - src.models.retrieval - INFO - q='How is the US helping Canadians in the fight against climate', base=4, kept_pre=4, refill=0, final_before=0, final_after=5, hybrid_refill=5, floor=0.60, delta=0.100, max_sim_pre=0.273, p50_sim_pre=0.267, p95_sim_pre=0.273, blocked_base=0, dropped_top2=[{'segment_id': '8', 'title': 'Government Of Canada Adaptation Action Plan Canada.ca', 'score': 0.075858176}, {'segment_id': '10', 'title': 'Climate Change Factsheet', 'score': 0.010986943}]
2025-08-17 12:08:54,787 - src.models.climate_pipeline - INFO - ‚úì Retrieved 5 documents
2025-08-17 12:08:54,787 - src.models.climate_pipeline - INFO - Timing: retrieval=4203.6ms
2025-08-17 12:08:54,787 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 12:08:54,789 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:08:54,789 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:08:54,795 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:08:54,795 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:08:54,797 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:08:54,797 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:08:55,084 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=286 status=OK request_id=f23f78bd-e561-48a5-9ef5-8eecfdcb40e5
2025-08-17 12:08:55,084 - src.models.gen_response_unified - INFO - Optimized conversation history for nova
2025-08-17 12:08:59,887 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4802 status=OK request_id=9f48f20e-bb40-4699-86de-36b09902d369
2025-08-17 12:08:59,893 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:08:59,894 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:08:59,895 - src.models.climate_pipeline - INFO - ‚úì Response generated successfully in English
2025-08-17 12:08:59,895 - src.models.climate_pipeline - INFO - Timing: generation=5107.4ms
2025-08-17 12:08:59,895 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 12:09:01,026 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1128 status=OK request_id=9e8ac243-0055-4f69-86e5-a3f17248983a
2025-08-17 12:09:01,028 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 12:09:01,028 - src.models.climate_pipeline - INFO - ‚úì Faithfulness score: 0.900
2025-08-17 12:09:01,028 - src.models.climate_pipeline - INFO - ‚úì Assessment: Highly Faithful
2025-08-17 12:09:01,028 - src.models.climate_pipeline - INFO - Timing: faithfulness=1133.3ms
2025-08-17 12:09:01,029 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:09:01,035 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:09:01,035 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:09:01,036 - src.models.climate_pipeline - INFO - ‚úì Response cached in english
2025-08-17 12:09:01,039 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.7 rewrite=711.0 guards=0.0 retrieval=4203.6 generation=5107.4 faithfulness=1133.3 translation=0.0 total=11193.3
2025-08-17 12:09:01,039 - src.models.climate_pipeline - INFO - ‚úì Query processed successfully in 11.19s
2025-08-17 12:09:01,039 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755446929807 time=11.229s model=nova faithfulness=0.900
2025-08-17 12:09:01,043 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=11.236s id=req_1755446929807 ip=127.0.0.1
INFO:     127.0.0.1:56038 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/webui/api/routers/chat.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 12:11:45,722 - src.webui.api.main - INFO - üßπ Cleaning up pipeline...
2025-08-17 12:11:45,810 - src.models.climate_pipeline - INFO - ‚úì Nova model client closed
2025-08-17 12:11:45,849 - src.models.climate_pipeline - INFO - ‚úì Cohere client closed
2025-08-17 12:11:45,883 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:11:46,249 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:11:46,365 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:11:46,426 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 12:11:46,428 - src.models.climate_pipeline - INFO - ‚úì Redis client closed
2025-08-17 12:11:46,429 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 12:11:46,429 - src.webui.api.main - INFO - ‚úÖ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [21763]
2025-08-17 12:12:01,160 - datasets - INFO - PyTorch version 2.6.0 available.
WARNING:  StatReload detected changes in 'src/webui/api/routers/chat.py'. Reloading...
INFO:     Started server process [23656]
INFO:     Waiting for application startup.
2025-08-17 12:12:04,802 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:12:04,802 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:12:04,885 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:12:04,940 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:12:04,940 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:12:04,940 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:12:04,988 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:12:04,988 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:12:05,089 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:12:05,127 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 74853.73it/s]
2025-08-17 12:12:07,565 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:12:07,573 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:12:07,573 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 2.45s
2025-08-17 12:12:07,576 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:12:07,577 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:12:07,643 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:12:07,665 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:12:07,666 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:12:07,666 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:12:08,136 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.56s
2025-08-17 12:12:08,182 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.05s
2025-08-17 12:12:08,182 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:12:08,182 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:12:08,183 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:12:08,183 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:12:08,183 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:12:08,217 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:12:08,217 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:12:08,217 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:12:08,217 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:12:08,217 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:12:08,217 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:12:08,217 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:12:08,217 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:12:19,275 - src.models.climate_pipeline - INFO - Prewarm encode took 11058ms
2025-08-17 12:12:19,343 - src.models.climate_pipeline - INFO - Second prewarm took 67ms
2025-08-17 12:12:19,343 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:12:19,343 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:12:19,343 - src.models.climate_pipeline - INFO - Prewarm complete in 11.13s
2025-08-17 12:12:19,344 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:12:24,079 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [23959]
INFO:     Waiting for application startup.
2025-08-17 12:12:26,201 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:12:26,201 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:12:26,264 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:12:26,294 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:12:26,294 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:12:26,294 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:12:26,297 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:12:26,297 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:12:26,362 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:12:26,383 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 18047.78it/s]
2025-08-17 12:12:27,726 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:12:27,729 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:12:27,729 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 1.35s
2025-08-17 12:12:27,731 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:12:27,731 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:12:27,774 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:12:27,785 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:12:27,786 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:12:27,786 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:12:28,052 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.32s
2025-08-17 12:12:28,076 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 12:12:28,076 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:12:28,076 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:12:28,076 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:12:28,076 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:12:28,076 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:12:28,078 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:12:28,078 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:12:28,078 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:12:28,078 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:12:28,078 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:12:28,078 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:12:28,078 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:12:28,078 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:12:53,305 - src.models.climate_pipeline - INFO - Prewarm encode took 25224ms
2025-08-17 12:12:53,448 - src.models.climate_pipeline - INFO - Second prewarm took 139ms
2025-08-17 12:12:53,448 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:12:53,448 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:12:53,448 - src.models.climate_pipeline - INFO - Prewarm complete in 25.37s
2025-08-17 12:12:53,448 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:15:58,168 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.018s id=req_1755447358149 ip=127.0.0.1
INFO:     127.0.0.1:60114 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:15:58,228 - src.webui.api.routers.languages - INFO - Language validation: query_len=34 detected=en model=nova confidence=0.500
2025-08-17 12:15:58,230 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.053s id=req_1755447358177 ip=127.0.0.1
INFO:     127.0.0.1:60116 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:15:58,236 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.000s id=req_1755447358236 ip=127.0.0.1
INFO:     127.0.0.1:60116 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:15:58,257 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447358237 query_len=34 lang=en
2025-08-17 12:15:58,257 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - ‚úì Language map loaded from languages.json: 187 names ‚Üí 183 codes (e.g., belarusian‚Üíbe)
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Processing query: 'How to reduce my carbon footprint?...' in english (code: en)
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Raw query repr: 'How to reduce my carbon footprint?'
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:15:59,218 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='How to reduce my carbon footprint?'
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='How to reduce my carbon footprint?'
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-17 12:15:59,218 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=34, utf8_bytes=34
2025-08-17 12:15:59,219 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=34, utf8_bytes=34
2025-08-17 12:15:59,219 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:15:59,223 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:15:59,280 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:15:59,281 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:15:59,288 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:15:59,299 - src.models.climate_pipeline - INFO - Timing: cache=80.0ms
2025-08-17 12:15:59,299 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:15:59,299 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-17 12:15:59,299 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=0
2025-08-17 12:15:59,299 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='How to reduce my carbon footprint?'
2025-08-17 12:15:59,300 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='How to reduce my carbon footprint?', norm='How to reduce my carbon footprint?'
2025-08-17 12:16:00,294 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=993 status=OK request_id=d2ea7177-4b79-4269-a7aa-4146aa48e0bc
2025-08-17 12:16:00,295 - query_rewriter - INFO - Model raw (first 300): {"reason":"User asked about reducing carbon footprint, a climate-related topic.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"How can I reduce my carbon footprint?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-17 12:16:00,295 - query_rewriter - INFO - Rewriter NET OUT ‚Üí json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 12:16:00,295 - query_rewriter - INFO - üîç CLASSIFICATION_DEBUG: query='How to reduce my carbon footprint?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User asked about reducing carbon footprint, a climate-related topic....'
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='How can I reduce my carbon footprint?'
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - Timing: rewrite=996.6ms
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-17 12:16:00,295 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 12:16:00,295 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 12:16:00,296 - src.models.retrieval - INFO - Query embedding IN: query_len=37 chars, query_repr='How can I reduce my carbon footprint?...'
2025-08-17 12:16:06,049 - src.models.retrieval - INFO - dep=query_embed op=encode ms=5753 dense_dim=1024 sparse_tokens=9
2025-08-17 12:16:06,645 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=583 status=OK
2025-08-17 12:16:06,645 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=585 total_ms=585
2025-08-17 12:16:06,806 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=160 status=OK
2025-08-17 12:16:06,806 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:16:06,806 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=160 total_ms=160
2025-08-17 12:16:06,822 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=1 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-17 12:16:06,823 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=7042 n_docs=7
2025-08-17 12:16:07,100 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:16:07,112 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=288.9 status=OK
2025-08-17 12:16:07,122 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Canada In A Changing Climate Synthesis Report', 'pinecone_score': 0.239322394, 'rerank_score': 0.55096984, 'has_values': True}, {'title': 'Resilient Neighbourhoods Toolkit City Of Vancouver', 'pinecone_score': 0.263190866, 'rerank_score': 0.36082682, 'has_values': True}, {'title': '1 S2.0 S0362028x22057118 Main', 'pinecone_score': 0.241957992, 'rerank_score': 0.3310116, 'has_values': True}, {'title': 'Report For Action Transformto Critical Steps For Net Zero By 2040', 'pinecone_score': 0.226399302, 'rerank_score': 0.1284158, 'has_values': True}, {'title': 'Climate Change Factsheet', 'pinecone_score': 0.304180861, 'rerank_score': 0.06290424, 'has_values': True}]
2025-08-17 12:16:07,122 - src.models.retrieval - INFO - q='How can I reduce my carbon footprint?', base=7, kept_pre=7, refill=0, final_before=0, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.304, p50_sim_pre=0.240, p95_sim_pre=0.304, blocked_base=0, dropped_top2=[{'segment_id': '73', 'title': 'Canada In A Changing Climate Synthesis Report', 'score': 0.55096984}, {'segment_id': '105', 'title': 'Resilient Neighbourhoods Toolkit City Of Vancouver', 'score': 0.36082682}]
2025-08-17 12:16:07,123 - src.models.climate_pipeline - INFO - ‚úì Retrieved 5 documents
2025-08-17 12:16:07,123 - src.models.climate_pipeline - INFO - Timing: retrieval=6827.6ms
2025-08-17 12:16:07,123 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 12:16:07,124 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:16:07,124 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:16:07,130 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:16:07,130 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:16:07,131 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:16:07,131 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:16:10,672 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3540 status=OK request_id=6ba9e57d-f09e-4b5e-b15a-5916bfa9e186
2025-08-17 12:16:10,680 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:16:10,680 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:16:10,681 - src.models.climate_pipeline - INFO - ‚úì Response generated successfully in English
2025-08-17 12:16:10,681 - src.models.climate_pipeline - INFO - Timing: generation=3557.6ms
2025-08-17 12:16:10,681 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 12:16:11,998 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1316 status=OK request_id=cbfb10dc-b609-4d6e-9ed7-fc548f98f8fc
2025-08-17 12:16:11,999 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 12:16:11,999 - src.models.climate_pipeline - INFO - ‚úì Faithfulness score: 0.900
2025-08-17 12:16:11,999 - src.models.climate_pipeline - INFO - ‚úì Assessment: Highly Faithful
2025-08-17 12:16:11,999 - src.models.climate_pipeline - INFO - Timing: faithfulness=1318.2ms
2025-08-17 12:16:11,999 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:16:12,002 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:16:12,003 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:16:12,004 - src.models.climate_pipeline - INFO - ‚úì Response cached in english
2025-08-17 12:16:12,004 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.4 rewrite=996.6 guards=0.0 retrieval=6827.6 generation=3557.6 faithfulness=1318.2 translation=0.0 total=12781.8
2025-08-17 12:16:12,004 - src.models.climate_pipeline - INFO - ‚úì Query processed successfully in 12.78s
2025-08-17 12:16:12,006 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755447358237 time=13.749s model=nova faithfulness=0.900
2025-08-17 12:16:12,007 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=13.769s id=req_1755447358237 ip=127.0.0.1
INFO:     127.0.0.1:60116 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:17:15,197 - src.webui.api.routers.languages - INFO - Language validation: query_len=68 detected=en model=nova confidence=0.800
2025-08-17 12:17:15,200 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.020s id=req_1755447435180 ip=127.0.0.1
INFO:     127.0.0.1:60787 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:17:15,209 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447435205 query_len=68 lang=en
2025-08-17 12:17:15,212 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:17:15,212 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-17 12:17:15,212 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:17:15,213 - src.models.climate_pipeline - INFO - Processing query: 'Can you tell me what Blackcreek is doing to inform citizens on this?...' in english (code: en)
2025-08-17 12:17:15,213 - src.models.climate_pipeline - INFO - Raw query repr: 'Can you tell me what Blackcreek is doing to inform citizens on this?'
2025-08-17 12:17:15,213 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:17:15,213 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:17:15,214 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='Can you tell me what Blackcreek is doing to inform citizens on this?'
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='Can you tell me what Blackcreek is doing to inform citizens on this?'
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=68, utf8_bytes=68
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=68, utf8_bytes=68
2025-08-17 12:17:15,214 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:17:15,215 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:17:15,221 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:17:15,221 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:17:15,222 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:17:15,227 - src.models.climate_pipeline - INFO - Timing: cache=12.2ms
2025-08-17 12:17:15,227 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:17:15,227 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:17:15,227 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 12:17:15,227 - src.models.conversation_parser - INFO -   Message 1 (user): How to reduce my carbon footprint?...
2025-08-17 12:17:15,227 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Reducing Your Carbon Footprint

Reducing your carbon footprint is a crucial step in helping to pro...
2025-08-17 12:17:15,227 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=2
2025-08-17 12:17:15,227 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='Can you tell me what Blackcreek is doing to inform citizens on this?'
2025-08-17 12:17:15,228 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='Can you tell me what Blackcreek is doing to inform citizens on this?', norm='Can you tell me what Blackcreek is doing to inform citizens on this?'
2025-08-17 12:17:16,057 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=828 status=OK request_id=732960d0-e420-4f62-bb6d-6b1d623c4293
2025-08-17 12:17:16,057 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about a specific location's climate action, inferred from the previous conversation about reducing carbon footprint.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What actions is Blackcreek taking to inform citizens
2025-08-17 12:17:16,057 - query_rewriter - INFO - Rewriter NET OUT ‚Üí json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 12:17:16,058 - query_rewriter - INFO - üîç CLASSIFICATION_DEBUG: query='Can you tell me what Blackcreek is doing to inform...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about a specific location's climate action, inferred from the previous conversation ab...'
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='What actions is Blackcreek taking to inform citizens about reducing carbon footprint?'
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - Timing: rewrite=831.1ms
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-17 12:17:16,058 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 12:17:16,058 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 12:17:16,058 - src.models.retrieval - INFO - Query embedding IN: query_len=85 chars, query_repr='What actions is Blackcreek taking to inform citizens about reducing carbon footprint?...'
2025-08-17 12:17:18,097 - src.models.retrieval - INFO - dep=query_embed op=encode ms=2038 dense_dim=1024 sparse_tokens=13
2025-08-17 12:17:18,297 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=198 status=OK
2025-08-17 12:17:18,297 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=198 total_ms=198
2025-08-17 12:17:18,466 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=168 status=OK
2025-08-17 12:17:18,466 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:17:18,466 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=168 total_ms=168
2025-08-17 12:17:18,469 - src.models.retrieval - INFO - dep=mmr_embed used_index=6 used_cache=0 embedded=0 ms=0 n_docs=6 valid_vecs=6 q_embed_ms=0
2025-08-17 12:17:18,469 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=6943 n_docs=6
2025-08-17 12:17:18,593 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:17:18,609 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=139.2 status=OK
2025-08-17 12:17:18,610 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Resilient Neighbourhoods Toolkit City Of Vancouver', 'pinecone_score': 0.178241387, 'rerank_score': 0.0024630069, 'has_values': True}, {'title': 'Transformto Net Zero Strategy A Climate Action Pathway To 2030 And Beyond', 'pinecone_score': 0.146184906, 'rerank_score': 0.00109019, 'has_values': True}, {'title': '50 Great Ideas For Inspiring Community Resilience To Climate Change', 'pinecone_score': 0.14760384, 'rerank_score': 5.7387595e-05, 'has_values': True}, {'title': '1 S2.0 S2667278221000274 Main', 'pinecone_score': 0.142205924, 'rerank_score': 3.120191e-05, 'has_values': True}, {'title': 'Climate Change Factsheet', 'pinecone_score': 0.140897125, 'rerank_score': 2.4682904e-05, 'has_values': True}]
2025-08-17 12:17:18,610 - src.models.retrieval - INFO - q='What actions is Blackcreek taking to inform citizens about r', base=6, kept_pre=6, refill=0, final_before=0, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.178, p50_sim_pre=0.142, p95_sim_pre=0.178, blocked_base=1, dropped_top2=[{'segment_id': '105', 'title': 'Resilient Neighbourhoods Toolkit City Of Vancouver', 'score': 0.0024630069}, {'segment_id': '10', 'title': 'Transformto Net Zero Strategy A Climate Action Pathway To 2030 And Beyond', 'score': 0.00109019}]
2025-08-17 12:17:18,611 - src.models.climate_pipeline - INFO - ‚úì Retrieved 5 documents
2025-08-17 12:17:18,611 - src.models.climate_pipeline - INFO - Timing: retrieval=2553.1ms
2025-08-17 12:17:18,611 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 12:17:18,611 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:17:18,612 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:17:18,614 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:17:18,614 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:17:18,615 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:17:18,615 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:17:22,276 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3660 status=OK request_id=0cc9c3e3-1908-4f48-a0c5-cdc193a69084
2025-08-17 12:17:22,286 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:17:22,287 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:17:22,287 - src.models.climate_pipeline - INFO - ‚úì Response generated successfully in English
2025-08-17 12:17:22,288 - src.models.climate_pipeline - INFO - Timing: generation=3676.8ms
2025-08-17 12:17:22,288 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 12:17:23,578 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1287 status=OK request_id=a2a77011-4451-4d25-9e25-c9ccf70ef4da
2025-08-17 12:17:23,580 - src.models.hallucination_guard - INFO - Faithfulness score: 0.0
2025-08-17 12:17:23,580 - src.models.climate_pipeline - INFO - ‚úì Faithfulness score: 0.000
2025-08-17 12:17:23,580 - src.models.climate_pipeline - INFO - ‚úì Assessment: Likely Unfaithful
2025-08-17 12:17:23,580 - src.models.climate_pipeline - WARNING - Response faithfulness below threshold: 0.000 < 0.7
2025-08-17 12:17:23,580 - src.models.climate_pipeline - INFO - Timing: faithfulness=1291.9ms
2025-08-17 12:17:24,054 - src.models.climate_pipeline - INFO - Attempting Tavily fallback search (pipeline)
2025-08-17 12:17:28,056 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:17:28,056 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:17:28,061 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:17:28,061 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:17:28,062 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:17:28,062 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:17:30,854 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2790 status=OK request_id=490c1606-e4a2-471f-be58-48ce10490e4d
2025-08-17 12:17:30,862 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:17:30,863 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:17:30,976 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:17:32,344 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1367 status=OK request_id=95fad723-b1d4-4a08-8699-22aaaba075bd
2025-08-17 12:17:32,349 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 12:17:32,351 - src.models.climate_pipeline - INFO - Fallback faithfulness (pipeline): 0.900
2025-08-17 12:17:32,352 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:17:32,356 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:17:32,356 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:17:32,357 - src.models.climate_pipeline - INFO - ‚úì Response cached in english
2025-08-17 12:17:32,359 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.7 rewrite=831.1 guards=0.0 retrieval=2553.1 generation=3676.8 faithfulness=1291.9 translation=0.0 total=17138.4
2025-08-17 12:17:32,359 - src.models.climate_pipeline - INFO - ‚úì Query processed successfully in 17.14s
2025-08-17 12:17:32,359 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 12:17:32,894 - src.webui.api.utils.link_validator - WARNING - Replaced broken inline link: http://justiceforblackcreeks.com
2025-08-17 12:17:32,894 - src.webui.api.utils.link_validator - INFO - Fixed 1 broken inline links in response
2025-08-17 12:17:32,894 - src.webui.api.routers.chat - INFO - Fixed 1 broken inline links in response
2025-08-17 12:17:32,894 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755447435205 time=17.151s model=nova faithfulness=0.900
2025-08-17 12:17:32,895 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=17.690s id=req_1755447435205 ip=127.0.0.1
INFO:     127.0.0.1:60787 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/webui/api/utils/link_validator.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 12:21:52,993 - src.webui.api.main - INFO - üßπ Cleaning up pipeline...
2025-08-17 12:21:52,998 - src.models.climate_pipeline - INFO - ‚úì Nova model client closed
2025-08-17 12:21:53,004 - src.models.climate_pipeline - INFO - ‚úì Cohere client closed
2025-08-17 12:21:53,008 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:21:53,104 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:21:53,104 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:21:53,109 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 12:21:53,109 - src.models.climate_pipeline - INFO - ‚úì Redis client closed
2025-08-17 12:21:53,109 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 12:21:53,109 - src.webui.api.main - INFO - ‚úÖ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [23959]
2025-08-17 12:22:07,308 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [27184]
INFO:     Waiting for application startup.
2025-08-17 12:22:14,453 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:22:14,453 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:22:14,681 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:22:14,734 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:22:14,735 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:22:14,735 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:22:14,762 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:22:14,763 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:22:14,874 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:22:14,894 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 4841.63it/s]
2025-08-17 12:22:16,671 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:22:16,676 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:22:16,676 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 1.78s
2025-08-17 12:22:16,680 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:22:16,681 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:22:17,154 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:22:17,180 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:22:17,181 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:22:17,181 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:22:17,644 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.97s
2025-08-17 12:22:17,661 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 12:22:17,661 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:22:17,661 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:22:17,661 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:22:17,661 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:22:17,661 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:22:17,663 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:22:17,663 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:22:17,663 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:22:17,663 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:22:17,663 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:22:17,663 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:22:17,663 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:22:17,663 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:22:36,508 - src.models.climate_pipeline - INFO - Prewarm encode took 18845ms
2025-08-17 12:22:36,588 - src.models.climate_pipeline - INFO - Second prewarm took 79ms
2025-08-17 12:22:36,588 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:22:36,588 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:22:36,588 - src.models.climate_pipeline - INFO - Prewarm complete in 18.93s
2025-08-17 12:22:36,588 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:22:36,668 - src.webui.api.routers.languages - INFO - Language validation: query_len=36 detected=en model=nova confidence=0.800
2025-08-17 12:22:36,670 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.020s id=req_1755447756650 ip=127.0.0.1
INFO:     127.0.0.1:63652 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:22:36,684 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447756680 query_len=36 lang=en
2025-08-17 12:22:36,684 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:22:37,019 - src.models.climate_pipeline - INFO - ‚úì Language map loaded from languages.json: 187 names ‚Üí 183 codes (e.g., belarusian‚Üíbe)
2025-08-17 12:22:37,019 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-17 12:22:37,019 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-17 12:22:37,019 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:22:37,019 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:22:37,019 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='Why is summer so hot now in Toronto?'
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='Why is summer so hot now in Toronto?'
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - Timing: routing=0.5ms
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=36, utf8_bytes=36
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=36, utf8_bytes=36
2025-08-17 12:22:37,020 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:22:37,022 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:22:37,321 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:22:37,321 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:22:37,380 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:22:37,422 - src.models.climate_pipeline - INFO - Timing: cache=401.8ms
2025-08-17 12:22:37,422 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:22:37,422 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-17 12:22:37,422 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=0
2025-08-17 12:22:37,422 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='Why is summer so hot now in Toronto?'
2025-08-17 12:22:37,423 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='Why is summer so hot now in Toronto?', norm='Why is summer so hot now in Toronto?'
2025-08-17 12:22:39,424 - query_rewriter - WARNING - REWRITER_TIMEOUT_2S ‚Üí using original query fallback
2025-08-17 12:22:39,426 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-17 12:22:39,426 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='None'
2025-08-17 12:22:39,427 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755447756680 error=I'm a climate change assistant and can only help with questions about climate, environment, and sustainability. Please ask me about topics like climate change causes, effects, or solutions.
2025-08-17 12:22:39,428 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755447756680 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': "I'm a climate change assistant and can only help with questions about climate, environment, and sustainability. Please ask me about topics like climate change causes, effects, or solutions.", 'retryable': True, 'request_id': 'req_1755447756680'}}
2025-08-17 12:22:39,431 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=2.751s id=req_1755447756680 ip=127.0.0.1
INFO:     127.0.0.1:63652 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-17 12:22:40,430 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3007 status=OK request_id=2d8921e9-15ea-4613-bba7-265ff61f9e95
WARNING:  StatReload detected changes in 'src/webui/app_nova.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 12:23:25,468 - src.webui.api.main - INFO - üßπ Cleaning up pipeline...
2025-08-17 12:23:25,469 - src.models.climate_pipeline - INFO - ‚úì Nova model client closed
2025-08-17 12:23:25,474 - src.models.climate_pipeline - INFO - ‚úì Cohere client closed
2025-08-17 12:23:25,475 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:23:25,544 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:23:25,546 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:23:25,549 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 12:23:25,549 - src.models.climate_pipeline - INFO - ‚úì Redis client closed
2025-08-17 12:23:25,550 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 12:23:25,550 - src.webui.api.main - INFO - ‚úÖ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [27184]
2025-08-17 12:23:35,329 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [27870]
INFO:     Waiting for application startup.
2025-08-17 12:23:39,030 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:23:39,030 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:23:39,097 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:23:39,133 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:23:39,133 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:23:39,133 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:23:39,140 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:23:39,140 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:23:39,200 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:23:39,219 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 10526.11it/s]
2025-08-17 12:23:40,790 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:23:40,794 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:23:40,794 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 1.57s
2025-08-17 12:23:40,796 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:23:40,796 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:23:40,834 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:23:40,846 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:23:40,846 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:23:40,846 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:23:41,053 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.26s
2025-08-17 12:23:41,070 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 12:23:41,070 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:23:41,070 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:23:41,070 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:23:41,070 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:23:41,070 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:23:41,072 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:23:41,072 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:23:41,072 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:23:41,072 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:23:41,072 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:23:41,072 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:23:41,072 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:23:41,072 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:23:54,470 - src.models.climate_pipeline - INFO - Prewarm encode took 13397ms
2025-08-17 12:23:54,557 - src.models.climate_pipeline - INFO - Second prewarm took 86ms
2025-08-17 12:23:54,557 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:23:54,557 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:23:54,557 - src.models.climate_pipeline - INFO - Prewarm complete in 13.48s
2025-08-17 12:23:54,557 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:23:54,618 - src.webui.api.routers.languages - INFO - Language validation: query_len=36 detected=en model=nova confidence=0.800
2025-08-17 12:23:54,619 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.021s id=req_1755447834598 ip=127.0.0.1
INFO:     127.0.0.1:64507 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:23:54,635 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447834627 query_len=36 lang=en
2025-08-17 12:23:54,635 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:23:54,898 - src.models.climate_pipeline - INFO - ‚úì Language map loaded from languages.json: 187 names ‚Üí 183 codes (e.g., belarusian‚Üíbe)
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:23:54,899 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='Why is summer so hot now in Toronto?'
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='Why is summer so hot now in Toronto?'
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=36, utf8_bytes=36
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=36, utf8_bytes=36
2025-08-17 12:23:54,899 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:23:54,902 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:23:55,054 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:23:55,054 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:23:55,056 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:23:55,066 - src.models.climate_pipeline - INFO - Timing: cache=166.7ms
2025-08-17 12:23:55,066 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:23:55,066 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-17 12:23:55,066 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=0
2025-08-17 12:23:55,066 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='Why is summer so hot now in Toronto?'
2025-08-17 12:23:55,068 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='Why is summer so hot now in Toronto?', norm='Why is summer so hot now in Toronto?'
2025-08-17 12:23:55,731 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=663 status=OK request_id=2ef7beb5-a57a-41e2-9435-3307a8203dd3
2025-08-17 12:23:55,732 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about climate impacts in a specific location.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Why is summer so hot now in Toronto?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-17 12:23:55,732 - query_rewriter - INFO - Rewriter NET OUT ‚Üí json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 12:23:55,732 - query_rewriter - INFO - üîç CLASSIFICATION_DEBUG: query='Why is summer so hot now in Toronto?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about climate impacts in a specific location....'
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='Why is summer so hot now in Toronto?'
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - Timing: rewrite=666.5ms
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-17 12:23:55,732 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 12:23:55,732 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 12:23:55,732 - src.models.retrieval - INFO - Query embedding IN: query_len=36 chars, query_repr='Why is summer so hot now in Toronto?...'
2025-08-17 12:23:55,942 - src.models.retrieval - INFO - dep=query_embed op=encode ms=209 dense_dim=1024 sparse_tokens=9
2025-08-17 12:23:56,290 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=346 status=OK
2025-08-17 12:23:56,290 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=346 total_ms=346
2025-08-17 12:23:56,442 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=152 status=OK
2025-08-17 12:23:56,442 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:23:56,442 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=152 total_ms=152
2025-08-17 12:23:56,448 - src.models.retrieval - INFO - dep=mmr_embed used_index=6 used_cache=0 embedded=0 ms=0 n_docs=6 valid_vecs=6 q_embed_ms=0
2025-08-17 12:23:56,450 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=7335 n_docs=6
2025-08-17 12:23:56,897 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:23:56,900 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=450.0 status=OK
2025-08-17 12:23:56,905 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Guide And Workbook For Municipal Climate Adaptation', 'pinecone_score': 0.345578611, 'rerank_score': 0.93379396, 'has_values': True}, {'title': 'Toronto First Resilience Strategy', 'pinecone_score': 0.34152326, 'rerank_score': 0.8576489, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.297280401, 'rerank_score': 0.661595, 'has_values': True}, {'title': 'The Climate Atlas And Health ‚Äì Using Climate Maps To Understand The Future Of He', 'pinecone_score': 0.296605885, 'rerank_score': 0.22798456, 'has_values': True}, {'title': 'Heatwaves And Our Health ‚Äì A Special Report On Climate Change In Canada', 'pinecone_score': 0.299585462, 'rerank_score': 0.19884087, 'has_values': True}]
2025-08-17 12:23:56,905 - src.models.retrieval - INFO - q='Why is summer so hot now in Toronto?', base=6, kept_pre=6, refill=0, final_before=3, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.346, p50_sim_pre=0.300, p95_sim_pre=0.346, blocked_base=0, dropped_top2=[{'segment_id': '33', 'title': 'The Climate Atlas And Health ‚Äì Using Climate Maps To Understand The Future Of He', 'score': 0.22798456}, {'segment_id': '24', 'title': 'Heatwaves And Our Health ‚Äì A Special Report On Climate Change In Canada', 'score': 0.19884087}]
2025-08-17 12:23:56,905 - src.models.climate_pipeline - INFO - ‚úì Retrieved 5 documents
2025-08-17 12:23:56,905 - src.models.climate_pipeline - INFO - Timing: retrieval=1172.9ms
2025-08-17 12:23:56,905 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 12:23:56,906 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:23:56,906 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:23:56,908 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:23:56,908 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:23:56,909 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:23:56,909 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:24:00,372 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3462 status=OK request_id=c8b798b6-df0c-456a-a1a5-029f352352e1
2025-08-17 12:24:00,379 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:24:00,379 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:24:00,380 - src.models.climate_pipeline - INFO - ‚úì Response generated successfully in English
2025-08-17 12:24:00,380 - src.models.climate_pipeline - INFO - Timing: generation=3474.3ms
2025-08-17 12:24:00,380 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 12:24:01,775 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1394 status=OK request_id=e424482c-2e3f-4062-8561-60882f5a472d
2025-08-17 12:24:01,776 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-17 12:24:01,776 - src.models.climate_pipeline - INFO - ‚úì Faithfulness score: 0.950
2025-08-17 12:24:01,776 - src.models.climate_pipeline - INFO - ‚úì Assessment: Highly Faithful
2025-08-17 12:24:01,776 - src.models.climate_pipeline - INFO - Timing: faithfulness=1396.5ms
2025-08-17 12:24:01,776 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:24:01,782 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:24:01,783 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:24:01,792 - src.models.climate_pipeline - INFO - ‚úì Response cached in english
2025-08-17 12:24:01,794 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=666.5 guards=0.0 retrieval=1172.9 generation=3474.3 faithfulness=1396.5 translation=0.0 total=6878.4
2025-08-17 12:24:01,794 - src.models.climate_pipeline - INFO - ‚úì Query processed successfully in 6.88s
2025-08-17 12:24:01,794 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755447834627 time=7.160s model=nova faithfulness=0.950
2025-08-17 12:24:01,796 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=7.169s id=req_1755447834627 ip=127.0.0.1
INFO:     127.0.0.1:64507 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:24:22,235 - src.webui.api.routers.languages - INFO - Language validation: query_len=36 detected=en model=nova confidence=0.800
2025-08-17 12:24:22,238 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.023s id=req_1755447862215 ip=127.0.0.1
INFO:     127.0.0.1:64781 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:24:22,265 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447862242 query_len=36 lang=en
2025-08-17 12:24:22,267 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:24:22,268 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-17 12:24:22,268 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:24:22,274 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:24:22,275 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='Why is summer so hot now in Toronto?'
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='Why is summer so hot now in Toronto?'
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=36, utf8_bytes=36
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=36, utf8_bytes=36
2025-08-17 12:24:22,275 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:24:22,275 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:24:22,280 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:24:22,280 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:24:22,282 - src.models.climate_pipeline - INFO - ‚úì Cache hit for english - returning cached response
2025-08-17 12:24:22,283 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755447862242 time=0.019s model=nova faithfulness=0.950
2025-08-17 12:24:22,284 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.042s id=req_1755447862242 ip=127.0.0.1
INFO:     127.0.0.1:64781 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:24:31,262 - src.webui.api.routers.languages - INFO - Language validation: query_len=36 detected=en model=nova confidence=0.800
2025-08-17 12:24:31,263 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.006s id=req_1755447871257 ip=127.0.0.1
INFO:     127.0.0.1:64864 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:24:31,286 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447871281 query_len=36 lang=en
2025-08-17 12:24:31,289 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:24:31,289 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-17 12:24:31,289 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:24:31,290 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-17 12:24:31,290 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-17 12:24:31,290 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:24:31,290 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:24:31,290 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='Why is summer so hot now in Toronto?'
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='Why is summer so hot now in Toronto?'
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=36, utf8_bytes=36
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=36, utf8_bytes=36
2025-08-17 12:24:31,291 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:24:31,291 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:24:31,293 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:24:31,293 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:24:31,293 - src.models.climate_pipeline - INFO - ‚úì Cache hit for english - returning cached response
2025-08-17 12:24:31,294 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755447871281 time=0.008s model=nova faithfulness=0.950
2025-08-17 12:24:31,294 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.013s id=req_1755447871281 ip=127.0.0.1
INFO:     127.0.0.1:64864 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:24:39,814 - src.webui.api.routers.languages - INFO - Language validation: query_len=36 detected=en model=nova confidence=0.800
2025-08-17 12:24:39,817 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.009s id=req_1755447879807 ip=127.0.0.1
INFO:     127.0.0.1:64939 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:24:39,837 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447879830 query_len=36 lang=en
2025-08-17 12:24:39,839 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 12:24:39,839 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-17 12:24:39,839 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:24:39,842 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='Why is summer so hot now in Toronto?'
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='Why is summer so hot now in Toronto?'
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=36, utf8_bytes=36
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=36, utf8_bytes=36
2025-08-17 12:24:39,842 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:24:39,842 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:24:39,849 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:24:39,849 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:24:39,851 - src.models.climate_pipeline - INFO - ‚úì Cache hit for english - returning cached response
2025-08-17 12:24:39,852 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755447879830 time=0.015s model=nova faithfulness=0.950
2025-08-17 12:24:39,854 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.024s id=req_1755447879830 ip=127.0.0.1
INFO:     127.0.0.1:64939 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:25:05,164 - src.webui.api.routers.languages - INFO - Language validation: query_len=40 detected=en model=nova confidence=0.800
2025-08-17 12:25:05,171 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.028s id=req_1755447905143 ip=127.0.0.1
INFO:     127.0.0.1:65163 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:25:05,275 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755447905191 query_len=40 lang=en
2025-08-17 12:25:05,275 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:25:05,289 - src.models.climate_pipeline - INFO - Processing query: 'What can I do about flooding in Toronto?...' in english (code: en)
2025-08-17 12:25:05,290 - src.models.climate_pipeline - INFO - Raw query repr: 'What can I do about flooding in Toronto?'
2025-08-17 12:25:05,290 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:25:05,290 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:25:05,293 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What can I do about flooding in Toronto?'
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What can I do about flooding in Toronto?'
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - Timing: routing=4.0ms
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=40, utf8_bytes=40
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=40, utf8_bytes=40
2025-08-17 12:25:05,295 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:25:05,295 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:25:05,335 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:25:05,335 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:25:05,343 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 12:25:05,453 - src.models.climate_pipeline - INFO - Timing: cache=158.2ms
2025-08-17 12:25:05,453 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 12:25:05,458 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-17 12:25:05,458 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí expected_lang=en, history_len=0
2025-08-17 12:25:05,458 - src.models.climate_pipeline - INFO - Rewriter IN ‚Üí original_query='What can I do about flooding in Toronto?'
2025-08-17 12:25:05,469 - query_rewriter - INFO - Rewriter NET IN ‚Üí expected_lang=en, user_query repr='What can I do about flooding in Toronto?', norm='What can I do about flooding in Toronto?'
2025-08-17 12:25:06,158 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=681 status=OK request_id=4ef44ba3-86f7-48bb-b539-dbb785e3fb6f
2025-08-17 12:25:06,161 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is directly about climate-related impacts in a specific location.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What can I do about flooding in Toronto?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-17 12:25:06,162 - query_rewriter - INFO - Rewriter NET OUT ‚Üí json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 12:25:06,163 - query_rewriter - INFO - üîç CLASSIFICATION_DEBUG: query='What can I do about flooding in Toronto?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is directly about climate-related impacts in a specific location....'
2025-08-17 12:25:06,165 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 12:25:06,165 - src.models.climate_pipeline - INFO - Rewriter OUT ‚Üí rewrite_en='What can I do about flooding in Toronto?'
2025-08-17 12:25:06,165 - src.models.climate_pipeline - INFO - ‚úì Query rewritten (JSON) for better retrieval
2025-08-17 12:25:06,165 - src.models.climate_pipeline - INFO - Timing: rewrite=711.9ms
2025-08-17 12:25:06,165 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 12:25:06,166 - src.models.climate_pipeline - INFO - ‚úì Input guards passed
2025-08-17 12:25:06,166 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-17 12:25:06,166 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 12:25:06,167 - src.models.retrieval - INFO - üîÑ Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 12:25:06,167 - src.models.retrieval - INFO - Query embedding IN: query_len=40 chars, query_repr='What can I do about flooding in Toronto?...'
2025-08-17 12:25:14,905 - src.models.retrieval - INFO - dep=query_embed op=encode ms=8735 dense_dim=1024 sparse_tokens=10
2025-08-17 12:25:15,413 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=496 status=OK
2025-08-17 12:25:15,413 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=497 total_ms=497
2025-08-17 12:25:15,574 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=161 status=OK
2025-08-17 12:25:15,574 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:25:15,574 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=161 total_ms=161
2025-08-17 12:25:15,579 - src.models.retrieval - INFO - dep=mmr_embed used_index=4 used_cache=0 embedded=0 ms=0 n_docs=4 valid_vecs=4 q_embed_ms=0
2025-08-17 12:25:15,581 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=6000 n_docs=4
2025-08-17 12:25:15,733 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:25:15,739 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=157.8 status=OK
2025-08-17 12:25:15,748 - src.models.retrieval - INFO - Query embedding IN: query_len=40 chars, query_repr='What can I do about flooding in Toronto?...'
2025-08-17 12:25:15,872 - src.models.retrieval - INFO - dep=query_embed op=encode ms=124 dense_dim=1024 sparse_tokens=10
2025-08-17 12:25:16,485 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=151 status=OK
2025-08-17 12:25:16,486 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 12:25:16,486 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=152 total_ms=152
2025-08-17 12:25:16,492 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=39239 n_docs=30
2025-08-17 12:25:16,653 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 12:25:16,662 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=170.0 status=OK
2025-08-17 12:25:16,670 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Toronto First Resilience Strategy', 'pinecone_score': 0.310262442, 'rerank_score': 0.9533619, 'has_values': True}, {'title': 'Home Flood Protection Program Report 1', 'pinecone_score': 0.277304173, 'rerank_score': 0.61912596, 'has_values': True}, {'title': 'Uow Icca Under One Umbrella Report', 'pinecone_score': 0.177541256, 'rerank_score': 0.4830235, 'has_values': True}, {'title': 'Protect Your Home From Basement Flooding', 'pinecone_score': 0.258318692, 'rerank_score': 0.36466444, 'has_values': True}, {'title': 'Mecp Ontario Provincial Climate Change Impact Assessment En 2023 08 17', 'pinecone_score': 0.157108054, 'rerank_score': 0.33960858, 'has_values': True}]
2025-08-17 12:25:16,670 - src.models.retrieval - INFO - q='What can I do about flooding in Toronto?', base=4, kept_pre=4, refill=0, final_before=2, final_after=5, hybrid_refill=3, floor=0.60, delta=0.100, max_sim_pre=0.310, p50_sim_pre=0.301, p95_sim_pre=0.310, blocked_base=0, dropped_top2=[{'segment_id': '42', 'title': 'Costing Climate Change Impacts To Public Infrastructure Linear Storm And Wastewa', 'score': 0.0992954}, {'segment_id': '42', 'title': 'Tip Of The Iceberg ‚Äì Navigating The Known And Unknown Costs Of Climate Change Fo', 'score': 0.027117657}]
2025-08-17 12:25:16,672 - src.models.climate_pipeline - INFO - ‚úì Retrieved 5 documents
2025-08-17 12:25:16,672 - src.models.climate_pipeline - INFO - Timing: retrieval=10505.9ms
2025-08-17 12:25:16,672 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 12:25:16,673 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 12:25:16,673 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:25:16,704 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:25:16,705 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:25:16,714 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 12:25:16,718 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 12:25:21,355 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4636 status=OK request_id=d3047bdc-937e-4768-bbb5-82734e99e5bc
2025-08-17 12:25:21,565 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 12:25:21,565 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 12:25:21,567 - src.models.climate_pipeline - INFO - ‚úì Response generated successfully in English
2025-08-17 12:25:21,568 - src.models.climate_pipeline - INFO - Timing: generation=4896.0ms
2025-08-17 12:25:21,569 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 12:25:23,404 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1828 status=OK request_id=1047f62a-08fa-4182-b513-c4efa10c045d
2025-08-17 12:25:23,414 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 12:25:23,420 - src.models.climate_pipeline - INFO - ‚úì Faithfulness score: 0.900
2025-08-17 12:25:23,420 - src.models.climate_pipeline - INFO - ‚úì Assessment: Highly Faithful
2025-08-17 12:25:23,421 - src.models.climate_pipeline - INFO - Timing: faithfulness=1851.1ms
2025-08-17 12:25:23,423 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:25:23,429 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:25:23,429 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:25:23,621 - src.models.climate_pipeline - INFO - ‚úì Response cached in english
2025-08-17 12:25:23,648 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=4.0 rewrite=711.9 guards=0.1 retrieval=10505.9 generation=4896.0 faithfulness=1851.1 translation=0.0 total=18137.4
2025-08-17 12:25:23,648 - src.models.climate_pipeline - INFO - ‚úì Query processed successfully in 18.14s
2025-08-17 12:25:23,652 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 12:25:24,369 - src.webui.api.utils.link_validator - WARNING - Replaced broken inline link: https://www.toronto.ca/services-payments/streets-parking-transportation/flooding-and-drainage/flood-resilience/
2025-08-17 12:25:24,370 - src.webui.api.utils.link_validator - INFO - Fixed 1 inline links: 0 Google Drive, 1 broken
2025-08-17 12:25:24,370 - src.webui.api.routers.chat - INFO - Fixed 1 broken inline links in response
2025-08-17 12:25:24,370 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755447905191 time=18.375s model=nova faithfulness=0.900
2025-08-17 12:25:24,377 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=19.185s id=req_1755447905191 ip=127.0.0.1
INFO:     127.0.0.1:65163 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/webui/api/utils/link_validator.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 12:27:59,990 - src.webui.api.main - INFO - üßπ Cleaning up pipeline...
2025-08-17 12:27:59,995 - src.models.climate_pipeline - INFO - ‚úì Nova model client closed
2025-08-17 12:27:59,998 - src.models.climate_pipeline - INFO - ‚úì Cohere client closed
2025-08-17 12:28:00,001 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:28:00,027 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:28:00,027 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:28:00,031 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 12:28:00,032 - src.models.climate_pipeline - INFO - ‚úì Redis client closed
2025-08-17 12:28:00,032 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 12:28:00,033 - src.webui.api.main - INFO - ‚úÖ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [27870]
2025-08-17 12:28:09,891 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [29494]
INFO:     Waiting for application startup.
2025-08-17 12:28:26,636 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:28:26,636 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:28:26,801 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:28:26,863 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:28:26,863 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:28:26,863 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:28:26,867 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:28:26,868 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:28:26,950 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:28:26,970 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 7001.40it/s]
2025-08-17 12:28:29,124 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:28:29,128 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:28:29,128 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 2.16s
2025-08-17 12:28:29,131 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:28:29,131 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:28:29,170 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:28:29,182 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:28:29,183 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:28:29,183 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:28:29,353 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.22s
2025-08-17 12:28:29,372 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 12:28:29,372 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:28:29,372 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:28:29,372 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:28:29,372 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:28:29,372 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:28:29,374 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:28:29,374 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:28:29,374 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:28:29,374 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:28:29,374 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:28:29,374 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:28:29,374 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:28:29,374 - src.models.climate_pipeline - INFO - Prewarming embed model...
WARNING:  StatReload detected changes in 'src/webui/api/utils/link_validator.py'. Reloading...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:28:39,262 - src.models.climate_pipeline - INFO - Prewarm encode took 9887ms
2025-08-17 12:28:39,575 - src.models.climate_pipeline - INFO - Second prewarm took 312ms
2025-08-17 12:28:39,576 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:28:39,576 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:28:39,576 - src.models.climate_pipeline - INFO - Prewarm complete in 10.20s
2025-08-17 12:28:39,576 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:28:50,191 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [29721]
INFO:     Waiting for application startup.
2025-08-17 12:28:53,238 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:28:53,238 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:28:53,327 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:28:53,401 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:28:53,401 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:28:53,401 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:28:53,424 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:28:53,424 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:28:53,509 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:28:53,531 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 8452.85it/s]
2025-08-17 12:28:55,462 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:28:55,467 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:28:55,467 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 1.94s
2025-08-17 12:28:55,470 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:28:55,470 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:28:55,593 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:28:55,680 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:28:55,683 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:28:55,683 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:28:55,879 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.41s
2025-08-17 12:28:55,906 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.03s
2025-08-17 12:28:55,907 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:28:55,907 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:28:55,908 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:28:55,908 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:28:55,908 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:28:55,913 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:28:55,913 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:28:55,913 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:28:55,913 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:28:55,913 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:28:55,913 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:28:55,913 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:28:55,913 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:29:13,885 - src.models.climate_pipeline - INFO - Prewarm encode took 17972ms
2025-08-17 12:29:13,959 - src.models.climate_pipeline - INFO - Second prewarm took 73ms
2025-08-17 12:29:13,960 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:29:13,960 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:29:13,960 - src.models.climate_pipeline - INFO - Prewarm complete in 18.05s
2025-08-17 12:29:13,962 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
2025-08-17 12:29:14,004 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.003s id=req_1755448154000 ip=127.0.0.1
INFO:     127.0.0.1:51036 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:29:14,025 - src.webui.api.routers.languages - INFO - Language validation: query_len=40 detected=en model=nova confidence=0.800
2025-08-17 12:29:14,027 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.017s id=req_1755448154010 ip=127.0.0.1
INFO:     127.0.0.1:51036 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:29:14,033 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.000s id=req_1755448154032 ip=127.0.0.1
INFO:     127.0.0.1:51036 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:29:14,042 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755448154034 query_len=40 lang=en
2025-08-17 12:29:14,042 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - ‚úì Language map loaded from languages.json: 187 names ‚Üí 183 codes (e.g., belarusian‚Üíbe)
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Processing query: 'What can I do about flooding in Toronto?...' in english (code: en)
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Raw query repr: 'What can I do about flooding in Toronto?'
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:29:14,305 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What can I do about flooding in Toronto?'
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What can I do about flooding in Toronto?'
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=40, utf8_bytes=40
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=40, utf8_bytes=40
2025-08-17 12:29:14,305 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:29:14,306 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:29:14,310 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:29:14,310 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:29:14,340 - src.models.climate_pipeline - INFO - ‚úì Cache hit for english - returning cached response
2025-08-17 12:29:14,341 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 12:29:15,358 - src.webui.api.utils.link_validator - INFO - Replaced broken link with root domain: https://www.toronto.ca/services-payments/streets-parking-transportation/flooding-and-drainage/flood-resilience/ -> https://www.toronto.ca
2025-08-17 12:29:15,358 - src.webui.api.utils.link_validator - INFO - Fixed 1 inline links: 0 Google Drive, 1 broken
2025-08-17 12:29:15,358 - src.webui.api.routers.chat - INFO - Fixed 1 broken inline links in response
2025-08-17 12:29:15,358 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755448154034 time=0.299s model=nova faithfulness=0.900
2025-08-17 12:29:15,360 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.326s id=req_1755448154034 ip=127.0.0.1
INFO:     127.0.0.1:51036 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 12:31:22,755 - src.webui.api.routers.languages - INFO - Language validation: query_len=40 detected=en model=nova confidence=0.800
2025-08-17 12:31:22,768 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.519s id=req_1755448282249 ip=127.0.0.1
INFO:     127.0.0.1:52201 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 12:31:22,869 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755448282820 query_len=40 lang=en
2025-08-17 12:31:22,869 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 12:31:22,912 - src.models.climate_pipeline - INFO - Processing query: 'What can I do about flooding in Toronto?...' in english (code: en)
2025-08-17 12:31:22,912 - src.models.climate_pipeline - INFO - Raw query repr: 'What can I do about flooding in Toronto?'
2025-08-17 12:31:22,912 - src.models.climate_pipeline - INFO - Router IN ‚Üí language_name=english, language_code=en
2025-08-17 12:31:22,912 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 12:31:22,919 - src.models.query_routing - INFO - Language: english (en) ‚Üí Model: Nova
2025-08-17 12:31:22,922 - src.models.climate_pipeline - INFO - Router OUT ‚Üí model=Nova, support=nova, needs_translation=False
2025-08-17 12:31:22,923 - src.models.climate_pipeline - INFO - Router OUT ‚Üí english_query='What can I do about flooding in Toronto?'
2025-08-17 12:31:22,923 - src.models.climate_pipeline - INFO - Router OUT ‚Üí processed_query='What can I do about flooding in Toronto?'
2025-08-17 12:31:22,923 - src.models.climate_pipeline - INFO - ‚úì Routed to Nova model
2025-08-17 12:31:22,923 - src.models.climate_pipeline - INFO - Timing: routing=10.1ms
2025-08-17 12:31:22,925 - src.models.climate_pipeline - INFO - Net debug ‚Üí original_query len=40, utf8_bytes=40
2025-08-17 12:31:22,926 - src.models.climate_pipeline - INFO - Net debug ‚Üí english_query len=40, utf8_bytes=40
2025-08-17 12:31:22,926 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 12:31:22,936 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:31:23,096 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:31:23,096 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:31:23,111 - src.models.climate_pipeline - INFO - ‚úì Cache hit for english - returning cached response
2025-08-17 12:31:23,116 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 12:31:23,119 - src.webui.api.utils.link_validator - INFO - Replaced broken link with root domain: https://www.toronto.ca/services-payments/streets-parking-transportation/flooding-and-drainage/flood-resilience/ -> https://www.toronto.ca
2025-08-17 12:31:23,119 - src.webui.api.utils.link_validator - INFO - Fixed 1 inline links: 0 Google Drive, 1 broken
2025-08-17 12:31:23,119 - src.webui.api.routers.chat - INFO - Fixed 1 broken inline links in response
2025-08-17 12:31:23,119 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755448282820 time=0.249s model=nova faithfulness=0.900
2025-08-17 12:31:23,121 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.301s id=req_1755448282820 ip=127.0.0.1
INFO:     127.0.0.1:52201 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'src/webui/api/routers/chat.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 12:42:04,099 - src.webui.api.main - INFO - üßπ Cleaning up pipeline...
2025-08-17 12:42:04,107 - src.models.climate_pipeline - INFO - ‚úì Nova model client closed
2025-08-17 12:42:04,109 - src.models.climate_pipeline - INFO - ‚úì Cohere client closed
2025-08-17 12:42:04,114 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:42:04,169 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:42:04,169 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:42:04,175 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 12:42:04,175 - src.models.climate_pipeline - INFO - ‚úì Redis client closed
2025-08-17 12:42:04,175 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 12:42:04,175 - src.webui.api.main - INFO - ‚úÖ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [29721]
2025-08-17 12:42:20,529 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [31940]
INFO:     Waiting for application startup.
2025-08-17 12:42:24,291 - src.webui.api.main - INFO - üöÄ Starting Climate Chatbot API...
2025-08-17 12:42:24,291 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 12:42:24,437 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:42:24,502 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
2025-08-17 12:42:24,502 - src.models.gen_response_unified - INFO - ‚úì Unified Response Generator initialized
2025-08-17 12:42:24,502 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:42:24,507 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:42:24,507 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:42:24,667 - src.models.nova_flow - INFO - ‚úì Bedrock client initialized
2025-08-17 12:42:24,720 - src.models.cohere_flow - INFO - ‚úì Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 30/30 [00:00<00:00, 482.97it/s]
2025-08-17 12:42:42,125 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 12:42:42,135 - src.models.climate_pipeline - INFO - ‚úì Embedding model initialized with fast tokenizer
2025-08-17 12:42:42,135 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 17.42s
2025-08-17 12:42:42,139 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 12:42:42,143 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 12:42:42,946 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 12:42:43,003 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 12:42:43,007 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 12:42:43,007 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 12:42:46,718 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 4.58s
2025-08-17 12:42:46,773 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.05s
2025-08-17 12:42:46,773 - src.models.climate_pipeline - INFO - ‚úì Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 12:42:46,773 - src.webui.api.main - INFO - ‚úÖ Climate pipeline initialized (prewarming in background)
2025-08-17 12:42:46,773 - src.webui.api.main - INFO - ‚úÖ Conversation parser initialized
2025-08-17 12:42:46,773 - src.webui.api.main - INFO - ‚úÖ Language router initialized
2025-08-17 12:42:46,773 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:42:46,775 - src.models.redis_cache - INFO - ‚úì Redis connection test successful to localhost
2025-08-17 12:42:46,775 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:42:46,775 - src.webui.api.main - INFO - ‚úÖ Redis cache initialized
2025-08-17 12:42:46,775 - src.webui.api.main - INFO - üéâ All components initialized successfully!
2025-08-17 12:42:46,776 - src.webui.api.main - INFO - üî• Starting background pipeline prewarming...
2025-08-17 12:42:46,776 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 12:42:46,776 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 12:42:46,776 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 12:42:53,595 - src.models.climate_pipeline - INFO - Prewarm encode took 6819ms
2025-08-17 12:42:53,808 - src.models.climate_pipeline - INFO - Second prewarm took 214ms
2025-08-17 12:42:53,809 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 12:42:53,809 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 12:42:53,809 - src.models.climate_pipeline - INFO - Prewarm complete in 7.03s
2025-08-17 12:42:53,809 - src.webui.api.main - INFO - ‚úÖ Background prewarming completed
INFO:     Application startup complete.
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 12:46:43,273 - src.webui.api.main - INFO - üßπ Cleaning up pipeline...
2025-08-17 12:46:43,285 - src.models.climate_pipeline - INFO - ‚úì Nova model client closed
2025-08-17 12:46:43,288 - src.models.climate_pipeline - INFO - ‚úì Cohere client closed
2025-08-17 12:46:43,291 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 12:46:43,300 - src.models.redis_cache - WARNING - Redis ping failed but continuing: Error 61 connecting to localhost:6379. Connection refused.
2025-08-17 12:46:43,302 - src.models.redis_cache - INFO - ‚úì Redis cache initialized for localhost
2025-08-17 12:46:43,307 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 12:46:43,309 - src.models.climate_pipeline - INFO - ‚úì Redis client closed
2025-08-17 12:46:43,311 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 12:46:43,313 - src.webui.api.main - INFO - ‚úÖ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [31940]
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/multiprocessing/resource_tracker.py:254: UserWarning: resource_tracker: There appear to be 11 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
