2025-08-16 17:48:07,071 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [60108]
INFO:     Waiting for application startup.
2025-08-16 17:48:09,483 - src.webui.api.main - INFO - 🚀 Starting Climate Chatbot API...
2025-08-16 17:48:09,483 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-16 17:48:09,613 - src.models.nova_flow - INFO - ✓ Bedrock client initialized
2025-08-16 17:48:09,655 - src.models.cohere_flow - INFO - ✓ Cohere client initialized
2025-08-16 17:48:09,655 - src.models.gen_response_unified - INFO - ✓ Unified Response Generator initialized
2025-08-16 17:48:09,655 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:09,660 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:09,661 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:09,752 - src.models.nova_flow - INFO - ✓ Bedrock client initialized
2025-08-16 17:48:09,779 - src.models.cohere_flow - INFO - ✓ Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|██████████| 30/30 [00:00<00:00, 9782.25it/s]
2025-08-16 17:48:11,465 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-16 17:48:11,470 - src.models.climate_pipeline - INFO - ✓ Embedding model initialized with fast tokenizer
2025-08-16 17:48:11,470 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 1.69s
2025-08-16 17:48:11,473 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-16 17:48:11,474 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-16 17:48:11,514 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-16 17:48:11,527 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-16 17:48:11,528 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-16 17:48:11,528 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-16 17:48:11,830 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.36s
2025-08-16 17:48:11,853 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-16 17:48:11,853 - src.models.climate_pipeline - INFO - ✓ Climate Query Pipeline initialized (eager heavy-init)
2025-08-16 17:48:11,853 - src.webui.api.main - INFO - ✅ Climate pipeline initialized (prewarming in background)
2025-08-16 17:48:11,853 - src.webui.api.main - INFO - ✅ Conversation parser initialized
2025-08-16 17:48:11,853 - src.webui.api.main - INFO - ✅ Language router initialized
2025-08-16 17:48:11,853 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:11,855 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:11,855 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:11,855 - src.webui.api.main - INFO - ✅ Redis cache initialized
2025-08-16 17:48:11,855 - src.webui.api.main - INFO - 🎉 All components initialized successfully!
2025-08-16 17:48:11,855 - src.webui.api.main - INFO - 🔥 Starting background pipeline prewarming...
2025-08-16 17:48:11,855 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-16 17:48:11,855 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-16 17:48:11,855 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-16 17:48:18,014 - src.models.climate_pipeline - INFO - Prewarm encode took 6159ms
2025-08-16 17:48:18,099 - src.models.climate_pipeline - INFO - Second prewarm took 85ms
2025-08-16 17:48:18,099 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-16 17:48:18,099 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-16 17:48:18,099 - src.models.climate_pipeline - INFO - Prewarm complete in 6.24s
2025-08-16 17:48:18,099 - src.webui.api.main - INFO - ✅ Background prewarming completed
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-08-16 17:48:41,886 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.001s id=req_1755380921884 ip=127.0.0.1
INFO:     127.0.0.1:62958 - "GET /health HTTP/1.1" 200 OK
2025-08-16 17:48:49,077 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380929064 query_len=23 lang=en
2025-08-16 17:48:49,077 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 17:48:49,258 - src.models.climate_pipeline - INFO - ✓ Language map loaded from languages.json: 187 names → 183 codes (e.g., belarusian→be)
2025-08-16 17:48:49,258 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 17:48:49,258 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 17:48:49,259 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 17:48:49,259 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:48:49,259 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - Timing: routing=2.7ms
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:48:49,262 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:48:49,262 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:49,265 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:49,265 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:49,268 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 17:48:49,268 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380929064 time=0.191s model=nova faithfulness=0.950
2025-08-16 17:48:49,269 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.205s id=req_1755380929064 ip=127.0.0.1
INFO:     127.0.0.1:63040 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:48:50,479 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380930478 query_len=28 lang=es
2025-08-16 17:48:50,479 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:48:50,479 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:48:50,479 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:48:50,479 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 17:48:50,479 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 17:48:50,479 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 17:48:51,951 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1471 status=OK request_id=5bc6c977-3c9a-401c-b2dc-a07bd2bf2b97
2025-08-16 17:48:51,952 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:48:51,952 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 17:48:51,952 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 17:48:51,952 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 17:48:51,952 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 17:48:51,952 - src.models.climate_pipeline - INFO - Net debug → english_query len=1004, utf8_bytes=1010
2025-08-16 17:48:51,952 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:48:51,952 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:51,976 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:51,976 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:51,979 - src.models.climate_pipeline - INFO - ✓ Cache hit for spanish - returning cached response
2025-08-16 17:48:51,979 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380930478 time=1.500s model=nova faithfulness=0.900
2025-08-16 17:48:51,980 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.502s id=req_1755380930478 ip=127.0.0.1
INFO:     127.0.0.1:63051 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:48:53,187 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380933185 query_len=11 lang=ja
2025-08-16 17:48:53,187 - src.webui.api.routers.chat - INFO - Language routing: detected=ja model=nova
2025-08-16 17:48:53,187 - src.models.climate_pipeline - INFO - Processing query: '気候変動とは何ですか？...' in japanese (code: ja)
2025-08-16 17:48:53,187 - src.models.climate_pipeline - INFO - Raw query repr: '気候変動とは何ですか？'
2025-08-16 17:48:53,187 - src.models.climate_pipeline - INFO - Router IN → language_name=japanese, language_code=ja
2025-08-16 17:48:53,187 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:48:53,187 - src.models.query_routing - INFO - Language: japanese (ja) → Model: Nova
2025-08-16 17:48:53,187 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:48:53,187 - src.models.climate_pipeline - INFO - Router OUT → english_query='気候変動とは何ですか？'
2025-08-16 17:48:53,187 - src.models.climate_pipeline - INFO - Router OUT → processed_query='気候変動とは何ですか？'
2025-08-16 17:48:53,187 - src.models.climate_pipeline - WARNING - Router language mismatch: query is in Chinese but Japanese was selected
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Proceeding despite router mismatch (soft warning only)
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:48:53,188 - src.models.query_routing - INFO - Language: japanese (ja) → Model: Nova
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='気候変動とは何ですか？'
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='気候変動とは何ですか？'
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Net debug → original_query len=11, utf8_bytes=33
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Net debug → english_query len=11, utf8_bytes=33
2025-08-16 17:48:53,188 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:48:53,188 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:53,189 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:53,189 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:53,190 - src.models.climate_pipeline - INFO - ✓ Cache hit for japanese - returning cached response
2025-08-16 17:48:53,190 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380933185 time=0.003s model=nova faithfulness=0.950
2025-08-16 17:48:53,191 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.006s id=req_1755380933185 ip=127.0.0.1
INFO:     127.0.0.1:63080 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:48:54,403 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380934402 query_len=24 lang=de
2025-08-16 17:48:54,403 - src.webui.api.routers.chat - INFO - Language routing: detected=de model=nova
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Processing query: 'Was ist der Klimawandel?...' in german (code: de)
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Raw query repr: 'Was ist der Klimawandel?'
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Router IN → language_name=german, language_code=de
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:48:54,403 - src.models.query_routing - INFO - Language: german (de) → Model: Nova
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Router OUT → english_query='Was ist der Klimawandel?'
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Was ist der Klimawandel?'
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:48:54,403 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:48:54,403 - src.models.query_routing - INFO - Language: german (de) → Model: Nova
2025-08-16 17:48:54,403 - src.models.query_routing - INFO - Translating query from german to English
2025-08-16 17:48:54,403 - src.models.query_routing - INFO - Router NET IN → query repr='Was ist der Klimawandel?'
2025-08-16 17:48:55,347 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=943 status=OK request_id=82c0a92c-bc83-4b64-ae81-600b2faef9e5
2025-08-16 17:48:55,351 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:48:55,356 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is Climate Change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:48:55,356 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is Climate Change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:48:55,356 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is Climate Change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:48:55,356 - src.models.climate_pipeline - INFO - Net debug → original_query len=24, utf8_bytes=24
2025-08-16 17:48:55,358 - src.models.climate_pipeline - INFO - Net debug → english_query len=896, utf8_bytes=902
2025-08-16 17:48:55,358 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:48:55,358 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:55,376 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:55,376 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:55,387 - src.models.climate_pipeline - INFO - ✓ Cache hit for german - returning cached response
2025-08-16 17:48:55,387 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380934402 time=0.985s model=nova faithfulness=0.950
2025-08-16 17:48:55,395 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.993s id=req_1755380934402 ip=127.0.0.1
INFO:     127.0.0.1:63091 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:48:56,630 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380936628 query_len=26 lang=sv
2025-08-16 17:48:56,630 - src.webui.api.routers.chat - INFO - Language routing: detected=sv model=nova
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Processing query: 'Vad är klimatförändringar?...' in swedish (code: sv)
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Raw query repr: 'Vad är klimatförändringar?'
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Router IN → language_name=swedish, language_code=sv
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:48:56,630 - src.models.query_routing - INFO - Language: swedish (sv) → Model: Nova
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Router OUT → english_query='Vad är klimatförändringar?'
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Vad är klimatförändringar?'
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:48:56,630 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:48:56,630 - src.models.query_routing - INFO - Language: swedish (sv) → Model: Nova
2025-08-16 17:48:56,630 - src.models.query_routing - INFO - Translating query from swedish to English
2025-08-16 17:48:56,630 - src.models.query_routing - INFO - Router NET IN → query repr='Vad är klimatförändringar?'
2025-08-16 17:48:57,581 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=950 status=OK request_id=01eb8858-4208-48cd-acf2-28fd154e89cb
2025-08-16 17:48:57,583 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:48:57,583 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What are climate changes?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate change exists naturally, the term is most often used today '
2025-08-16 17:48:57,583 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change exists naturally, the term is most often used today '
2025-08-16 17:48:57,583 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change exists naturally, the term is most often used today '
2025-08-16 17:48:57,583 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=29
2025-08-16 17:48:57,583 - src.models.climate_pipeline - INFO - Net debug → english_query len=779, utf8_bytes=779
2025-08-16 17:48:57,584 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:48:57,584 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:57,592 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:57,592 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:57,593 - src.models.climate_pipeline - INFO - ✓ Cache hit for swedish - returning cached response
2025-08-16 17:48:57,594 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380936628 time=0.964s model=nova faithfulness=0.950
2025-08-16 17:48:57,595 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.966s id=req_1755380936628 ip=127.0.0.1
INFO:     127.0.0.1:63114 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:48:58,804 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380938803 query_len=23 lang=da
2025-08-16 17:48:58,804 - src.webui.api.routers.chat - INFO - Language routing: detected=da model=nova
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Processing query: 'Hvad er klimaændringer?...' in danish (code: da)
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Raw query repr: 'Hvad er klimaændringer?'
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Router IN → language_name=danish, language_code=da
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:48:58,804 - src.models.query_routing - INFO - Language: danish (da) → Model: Nova
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hvad er klimaændringer?'
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hvad er klimaændringer?'
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:48:58,804 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:48:58,804 - src.models.query_routing - INFO - Language: danish (da) → Model: Nova
2025-08-16 17:48:58,804 - src.models.query_routing - INFO - Translating query from danish to English
2025-08-16 17:48:58,804 - src.models.query_routing - INFO - Router NET IN → query repr='Hvad er klimaændringer?'
2025-08-16 17:48:59,542 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=737 status=OK request_id=fec374aa-f98d-41b3-b30b-f22e0119fb17
2025-08-16 17:48:59,542 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:48:59,542 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What are climate changes?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's histo"
2025-08-16 17:48:59,542 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's histo'
2025-08-16 17:48:59,542 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's histo'
2025-08-16 17:48:59,542 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=24
2025-08-16 17:48:59,542 - src.models.climate_pipeline - INFO - Net debug → english_query len=538, utf8_bytes=538
2025-08-16 17:48:59,542 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:48:59,542 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:48:59,546 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:48:59,546 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:48:59,547 - src.models.climate_pipeline - INFO - ✓ Cache hit for danish - returning cached response
2025-08-16 17:48:59,547 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380938803 time=0.744s model=nova faithfulness=0.950
2025-08-16 17:48:59,548 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.745s id=req_1755380938803 ip=127.0.0.1
INFO:     127.0.0.1:63134 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:00,757 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380940756 query_len=22 lang=no
2025-08-16 17:49:00,758 - src.webui.api.routers.chat - INFO - Language routing: detected=no model=nova
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Processing query: 'Hva er klimaendringer?...' in norwegian (code: no)
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Raw query repr: 'Hva er klimaendringer?'
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Router IN → language_name=norwegian, language_code=no
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:00,758 - src.models.query_routing - INFO - Language: norwegian (no) → Model: Nova
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hva er klimaendringer?'
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hva er klimaendringer?'
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:49:00,758 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:00,758 - src.models.query_routing - INFO - Language: norwegian (no) → Model: Nova
2025-08-16 17:49:00,758 - src.models.query_routing - INFO - Translating query from norwegian to English
2025-08-16 17:49:00,758 - src.models.query_routing - INFO - Router NET IN → query repr='Hva er klimaendringer?'
2025-08-16 17:49:01,752 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=993 status=OK request_id=7e114e89-aab2-467c-83d3-9c45ed8fe781
2025-08-16 17:49:01,753 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:01,753 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What are climate changes?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate chan'
2025-08-16 17:49:01,753 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate chan'
2025-08-16 17:49:01,753 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate chan'
2025-08-16 17:49:01,753 - src.models.climate_pipeline - INFO - Net debug → original_query len=22, utf8_bytes=22
2025-08-16 17:49:01,753 - src.models.climate_pipeline - INFO - Net debug → english_query len=644, utf8_bytes=644
2025-08-16 17:49:01,753 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:01,753 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:01,760 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:01,760 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:01,828 - src.models.climate_pipeline - INFO - ✓ Cache hit for norwegian - returning cached response
2025-08-16 17:49:01,829 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380940756 time=1.071s model=nova faithfulness=0.950
2025-08-16 17:49:01,829 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.073s id=req_1755380940756 ip=127.0.0.1
INFO:     127.0.0.1:63155 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:03,036 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380943035 query_len=23 lang=fi
2025-08-16 17:49:03,036 - src.webui.api.routers.chat - INFO - Language routing: detected=fi model=nova
2025-08-16 17:49:03,036 - src.models.climate_pipeline - INFO - Processing query: 'Mitä on ilmastonmuutos?...' in finnish (code: fi)
2025-08-16 17:49:03,036 - src.models.climate_pipeline - INFO - Raw query repr: 'Mitä on ilmastonmuutos?'
2025-08-16 17:49:03,036 - src.models.climate_pipeline - INFO - Router IN → language_name=finnish, language_code=fi
2025-08-16 17:49:03,036 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:03,036 - src.models.query_routing - INFO - Language: finnish (fi) → Model: Nova
2025-08-16 17:49:03,036 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:03,037 - src.models.climate_pipeline - INFO - Router OUT → english_query='Mitä on ilmastonmuutos?'
2025-08-16 17:49:03,037 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Mitä on ilmastonmuutos?'
2025-08-16 17:49:03,037 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:03,037 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:49:03,037 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:03,037 - src.models.query_routing - INFO - Language: finnish (fi) → Model: Nova
2025-08-16 17:49:03,037 - src.models.query_routing - INFO - Translating query from finnish to English
2025-08-16 17:49:03,037 - src.models.query_routing - INFO - Router NET IN → query repr='Mitä on ilmastonmuutos?'
2025-08-16 17:49:03,934 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=897 status=OK request_id=07af4bc6-57c8-46dd-9744-1a41d199da5a
2025-08-16 17:49:03,935 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:03,935 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has existed throughout Earth's history, the term "
2025-08-16 17:49:03,935 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has existed throughout Earth's history, the term '
2025-08-16 17:49:03,935 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has existed throughout Earth's history, the term '
2025-08-16 17:49:03,935 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=24
2025-08-16 17:49:03,935 - src.models.climate_pipeline - INFO - Net debug → english_query len=681, utf8_bytes=681
2025-08-16 17:49:03,935 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:03,935 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:03,937 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:03,937 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:03,938 - src.models.climate_pipeline - INFO - Cache miss for finnish query
2025-08-16 17:49:03,943 - src.models.climate_pipeline - INFO - Timing: cache=7.7ms
2025-08-16 17:49:03,943 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 17:49:03,943 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 17:49:03,943 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=fi, history_len=0
2025-08-16 17:49:03,943 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Mitä on ilmastonmuutos?'
2025-08-16 17:49:03,944 - query_rewriter - INFO - Rewriter NET IN → expected_lang=fi, user_query repr='Mitä on ilmastonmuutos?', norm='Mitä on ilmastonmuutos?'
2025-08-16 17:49:04,531 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=586 status=OK request_id=aeec6a35-a634-4429-89a7-c151cbfc84e4
2025-08-16 17:49:04,532 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Finnish and asks about climate change.","language":"fi","expected_language":"fi","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 17:49:04,532 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 17:49:04,532 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Mitä on ilmastonmuutos?...' expected_lang=fi detected_lang=fi classification=on-topic language_match=True reason='User query is in Finnish and asks about climate change....'
2025-08-16 17:49:04,532 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='fi', classification='on-topic', language_match='yes', canned=False
2025-08-16 17:49:04,533 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 17:49:04,533 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 17:49:04,533 - src.models.climate_pipeline - INFO - Timing: rewrite=590.4ms
2025-08-16 17:49:04,533 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 17:49:04,533 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 17:49:04,533 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 17:49:04,533 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 17:49:04,533 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 17:49:04,533 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 17:49:05,328 - src.models.retrieval - INFO - dep=query_embed op=encode ms=794 dense_dim=1024 sparse_tokens=5
2025-08-16 17:49:05,793 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=463 status=OK
2025-08-16 17:49:05,793 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=463 total_ms=463
2025-08-16 17:49:06,113 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=319 status=OK
2025-08-16 17:49:06,113 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 17:49:06,113 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=320 total_ms=320
2025-08-16 17:49:06,120 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 17:49:06,121 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 17:49:06,402 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 17:49:06,418 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=296.8 status=OK
2025-08-16 17:49:06,420 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 17:49:06,420 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 17:49:06,420 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 17:49:06,421 - src.models.climate_pipeline - INFO - Timing: retrieval=1887.2ms
2025-08-16 17:49:06,421 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 17:49:06,421 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 17:49:06,421 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:06,423 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:06,423 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:06,424 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 17:49:06,424 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 17:49:12,224 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=5799 status=OK request_id=b8e9b6d8-6b19-4a42-9551-816fedf1c337
2025-08-16 17:49:12,229 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 17:49:12,229 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 17:49:12,229 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 17:49:12,229 - src.models.climate_pipeline - INFO - Timing: generation=5808.9ms
2025-08-16 17:49:12,229 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 17:49:14,280 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2049 status=OK request_id=0d029c6b-959f-408f-aa3c-22366549dab3
2025-08-16 17:49:14,280 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 17:49:14,280 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 17:49:14,281 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 17:49:14,281 - src.models.climate_pipeline - INFO - Timing: faithfulness=2051.1ms
2025-08-16 17:49:14,281 - src.models.climate_pipeline - INFO - Step 8: Translating response to finnish (code=fi)
2025-08-16 17:49:27,528 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=13247 status=OK request_id=ec17b0fc-f1ef-4feb-a16a-b3b7f6b6cc18
2025-08-16 17:49:27,530 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to finnish
2025-08-16 17:49:27,530 - src.models.climate_pipeline - INFO - Timing: translation=13249.2ms
2025-08-16 17:49:27,530 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:27,538 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:27,538 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:27,540 - src.models.climate_pipeline - INFO - ✓ Response cached in finnish
2025-08-16 17:49:27,541 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 17:49:27,555 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=590.4 guards=0.0 retrieval=1887.2 generation=5808.9 faithfulness=2051.1 translation=13249.2 total=24493.6
2025-08-16 17:49:27,555 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 24.49s
2025-08-16 17:49:27,556 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380943035 time=24.520s model=nova faithfulness=0.900
2025-08-16 17:49:27,560 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=24.525s id=req_1755380943035 ip=127.0.0.1
INFO:     127.0.0.1:63185 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:28,775 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380968771 query_len=31 lang=it
2025-08-16 17:49:28,776 - src.webui.api.routers.chat - INFO - Language routing: detected=it model=nova
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Processing query: 'Cos'è il cambiamento climatico?...' in italian (code: it)
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Raw query repr: "Cos'è il cambiamento climatico?"
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Router IN → language_name=italian, language_code=it
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:28,777 - src.models.query_routing - INFO - Language: italian (it) → Model: Nova
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Router OUT → english_query='Cos'è il cambiamento climatico?'
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Cos'è il cambiamento climatico?'
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:28,777 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:49:28,778 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:28,778 - src.models.query_routing - INFO - Language: italian (it) → Model: Nova
2025-08-16 17:49:28,778 - src.models.query_routing - INFO - Translating query from italian to English
2025-08-16 17:49:28,778 - src.models.query_routing - INFO - Router NET IN → query repr="Cos'è il cambiamento climatico?"
2025-08-16 17:49:29,609 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=831 status=OK request_id=606413d3-7fff-4b6b-81c9-1822f78709b4
2025-08-16 17:49:29,610 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:29,610 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:49:29,610 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:49:29,610 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:49:29,610 - src.models.climate_pipeline - INFO - Net debug → original_query len=31, utf8_bytes=32
2025-08-16 17:49:29,610 - src.models.climate_pipeline - INFO - Net debug → english_query len=665, utf8_bytes=665
2025-08-16 17:49:29,610 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:29,610 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:29,612 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:29,612 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:29,613 - src.models.climate_pipeline - INFO - ✓ Cache hit for italian - returning cached response
2025-08-16 17:49:29,613 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380968771 time=0.838s model=nova faithfulness=0.950
2025-08-16 17:49:29,613 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.842s id=req_1755380968771 ip=127.0.0.1
INFO:     127.0.0.1:63445 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:30,822 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380970821 query_len=26 lang=pt
2025-08-16 17:49:30,822 - src.webui.api.routers.chat - INFO - Language routing: detected=pt model=nova
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Processing query: 'O que é mudança climática?...' in portuguese (code: pt)
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Raw query repr: 'O que é mudança climática?'
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Router IN → language_name=portuguese, language_code=pt
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:30,823 - src.models.query_routing - INFO - Language: portuguese (pt) → Model: Nova
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Router OUT → english_query='O que é mudança climática?'
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Router OUT → processed_query='O que é mudança climática?'
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:49:30,823 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:30,823 - src.models.query_routing - INFO - Language: portuguese (pt) → Model: Nova
2025-08-16 17:49:30,823 - src.models.query_routing - INFO - Translating query from portuguese to English
2025-08-16 17:49:30,823 - src.models.query_routing - INFO - Router NET IN → query repr='O que é mudança climática?'
2025-08-16 17:49:31,537 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=713 status=OK request_id=2db74c9a-0c61-4883-8a2e-68f12de4c9a6
2025-08-16 17:49:31,537 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:31,537 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. Long-term shifts in temperature and weather patterns are primarily driven b'
2025-08-16 17:49:31,537 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. Long-term shifts in temperature and weather patterns are primarily driven b'
2025-08-16 17:49:31,538 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. Long-term shifts in temperature and weather patterns are primarily driven b'
2025-08-16 17:49:31,538 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=29
2025-08-16 17:49:31,538 - src.models.climate_pipeline - INFO - Net debug → english_query len=688, utf8_bytes=692
2025-08-16 17:49:31,538 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:31,538 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:31,554 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:31,554 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:31,555 - src.models.climate_pipeline - INFO - Cache miss for portuguese query
2025-08-16 17:49:31,555 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:31,556 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:31,557 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:31,559 - src.models.climate_pipeline - INFO - ✓ Cache hit via fuzzy match (score=0.97)
2025-08-16 17:49:31,560 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380970821 time=0.738s model=nova faithfulness=0.950
2025-08-16 17:49:31,560 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.739s id=req_1755380970821 ip=127.0.0.1
INFO:     127.0.0.1:63466 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:32,846 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380972814 query_len=19 lang=hu
2025-08-16 17:49:32,869 - src.webui.api.routers.chat - INFO - Language routing: detected=hu model=nova
2025-08-16 17:49:32,904 - src.models.climate_pipeline - INFO - Processing query: 'Mi a klímaváltozás?...' in hungarian (code: hu)
2025-08-16 17:49:32,904 - src.models.climate_pipeline - INFO - Raw query repr: 'Mi a klímaváltozás?'
2025-08-16 17:49:32,904 - src.models.climate_pipeline - INFO - Router IN → language_name=hungarian, language_code=hu
2025-08-16 17:49:32,904 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:32,904 - src.models.query_routing - INFO - Language: hungarian (hu) → Model: Nova
2025-08-16 17:49:32,905 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:32,905 - src.models.climate_pipeline - INFO - Router OUT → english_query='Mi a klímaváltozás?'
2025-08-16 17:49:32,905 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Mi a klímaváltozás?'
2025-08-16 17:49:32,905 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:32,906 - src.models.climate_pipeline - INFO - Timing: routing=1.3ms
2025-08-16 17:49:32,906 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:32,906 - src.models.query_routing - INFO - Language: hungarian (hu) → Model: Nova
2025-08-16 17:49:32,906 - src.models.query_routing - INFO - Translating query from hungarian to English
2025-08-16 17:49:32,906 - src.models.query_routing - INFO - Router NET IN → query repr='Mi a klímaváltozás?'
2025-08-16 17:49:33,506 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=599 status=OK request_id=c7c5c1e3-45f8-4a69-9f7e-6d372a04762d
2025-08-16 17:49:33,509 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:33,510 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:49:33,510 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:49:33,510 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:49:33,510 - src.models.climate_pipeline - INFO - Net debug → original_query len=19, utf8_bytes=22
2025-08-16 17:49:33,510 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:49:33,510 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:33,510 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:33,660 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:33,660 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:33,752 - src.models.climate_pipeline - INFO - ✓ Cache hit for hungarian - returning cached response
2025-08-16 17:49:34,004 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380972814 time=1.039s model=nova faithfulness=0.950
2025-08-16 17:49:34,323 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.509s id=req_1755380972814 ip=127.0.0.1
INFO:     127.0.0.1:63487 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:36,302 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380976298 query_len=18 lang=sk
2025-08-16 17:49:36,302 - src.webui.api.routers.chat - INFO - Language routing: detected=sk model=nova
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Processing query: 'Čo je zmena klímy?...' in slovak (code: sk)
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Raw query repr: 'Čo je zmena klímy?'
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Router IN → language_name=slovak, language_code=sk
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:36,303 - src.models.query_routing - INFO - Language: slovak (sk) → Model: Nova
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Router OUT → english_query='Čo je zmena klímy?'
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Čo je zmena klímy?'
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:49:36,303 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:36,303 - src.models.query_routing - INFO - Language: slovak (sk) → Model: Nova
2025-08-16 17:49:36,303 - src.models.query_routing - INFO - Translating query from slovak to English
2025-08-16 17:49:36,303 - src.models.query_routing - INFO - Router NET IN → query repr='Čo je zmena klímy?'
2025-08-16 17:49:36,588 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=284 status=OK request_id=93da96f2-d186-4c76-8587-b5a4daaf2f72
2025-08-16 17:49:36,588 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:36,589 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:49:36,589 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:49:36,589 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:49:36,589 - src.models.climate_pipeline - INFO - Net debug → original_query len=18, utf8_bytes=20
2025-08-16 17:49:36,589 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:49:36,589 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:36,589 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:36,743 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:36,744 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:37,329 - src.models.climate_pipeline - INFO - ✓ Cache hit for slovak - returning cached response
2025-08-16 17:49:37,638 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380976298 time=1.336s model=nova faithfulness=0.950
2025-08-16 17:49:37,656 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.358s id=req_1755380976298 ip=127.0.0.1
INFO:     127.0.0.1:63518 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:38,899 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380978894 query_len=26 lang=sl
2025-08-16 17:49:38,899 - src.webui.api.routers.chat - INFO - Language routing: detected=sl model=nova
2025-08-16 17:49:38,900 - src.models.climate_pipeline - INFO - Processing query: 'Kaj je podnebna sprememba?...' in slovenian (code: sl)
2025-08-16 17:49:38,900 - src.models.climate_pipeline - INFO - Raw query repr: 'Kaj je podnebna sprememba?'
2025-08-16 17:49:38,900 - src.models.climate_pipeline - INFO - Router IN → language_name=slovenian, language_code=sl
2025-08-16 17:49:38,901 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:38,901 - src.models.query_routing - INFO - Language: slovenian (sl) → Model: Nova
2025-08-16 17:49:38,901 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:38,901 - src.models.climate_pipeline - INFO - Router OUT → english_query='Kaj je podnebna sprememba?'
2025-08-16 17:49:38,901 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Kaj je podnebna sprememba?'
2025-08-16 17:49:38,901 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:38,901 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-16 17:49:38,901 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:38,901 - src.models.query_routing - INFO - Language: slovenian (sl) → Model: Nova
2025-08-16 17:49:38,901 - src.models.query_routing - INFO - Translating query from slovenian to English
2025-08-16 17:49:38,901 - src.models.query_routing - INFO - Router NET IN → query repr='Kaj je podnebna sprememba?'
2025-08-16 17:49:39,582 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=680 status=OK request_id=8edeed22-e8d1-4d62-97f7-1005a563ad5d
2025-08-16 17:49:39,585 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:39,585 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate change'
2025-08-16 17:49:39,585 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate change'
2025-08-16 17:49:39,585 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate change'
2025-08-16 17:49:39,585 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=26
2025-08-16 17:49:39,585 - src.models.climate_pipeline - INFO - Net debug → english_query len=612, utf8_bytes=618
2025-08-16 17:49:39,585 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:39,586 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:39,597 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:39,598 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:39,600 - src.models.climate_pipeline - INFO - Cache miss for slovenian query
2025-08-16 17:49:39,601 - src.models.climate_pipeline - INFO - Timing: cache=15.7ms
2025-08-16 17:49:39,601 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 17:49:39,601 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 17:49:39,601 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=sl, history_len=0
2025-08-16 17:49:39,601 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Kaj je podnebna sprememba?'
2025-08-16 17:49:39,602 - query_rewriter - INFO - Rewriter NET IN → expected_lang=sl, user_query repr='Kaj je podnebna sprememba?', norm='Kaj je podnebna sprememba?'
2025-08-16 17:49:40,165 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=562 status=OK request_id=28f6cccd-236c-4385-8b13-948375ced18f
2025-08-16 17:49:40,166 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Slovenian and asks about climate change.","language":"sl","expected_language":"sl","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 17:49:40,166 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 17:49:40,166 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Kaj je podnebna sprememba?...' expected_lang=sl detected_lang=sl classification=on-topic language_match=True reason='User query is in Slovenian and asks about climate change....'
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='sl', classification='on-topic', language_match='yes', canned=False
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - Timing: rewrite=565.6ms
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-16 17:49:40,167 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 17:49:40,167 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 17:49:40,167 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 17:49:40,876 - src.models.retrieval - INFO - dep=query_embed op=encode ms=708 dense_dim=1024 sparse_tokens=5
2025-08-16 17:49:40,965 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=87 status=OK
2025-08-16 17:49:40,965 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=88 total_ms=88
2025-08-16 17:49:41,215 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=249 status=OK
2025-08-16 17:49:41,215 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 17:49:41,215 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=249 total_ms=249
2025-08-16 17:49:41,219 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 17:49:41,221 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 17:49:41,667 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 17:49:41,685 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=463.9 status=OK
2025-08-16 17:49:41,686 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 17:49:41,686 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 17:49:41,686 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 17:49:41,686 - src.models.climate_pipeline - INFO - Timing: retrieval=1518.8ms
2025-08-16 17:49:41,686 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 17:49:41,686 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 17:49:41,686 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:41,695 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:41,695 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:41,696 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 17:49:41,696 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 17:49:41,696 - src.models.climate_pipeline - INFO - Timing: generation=9.7ms
2025-08-16 17:49:41,696 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 17:49:43,435 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1738 status=OK request_id=913c1a71-9a64-43a8-918f-21e05cceefdc
2025-08-16 17:49:43,436 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 17:49:43,436 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 17:49:43,436 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 17:49:43,436 - src.models.climate_pipeline - INFO - Timing: faithfulness=1740.4ms
2025-08-16 17:49:43,437 - src.models.climate_pipeline - INFO - Step 8: Translating response to slovenian (code=sl)
2025-08-16 17:49:54,261 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=10823 status=OK request_id=612b1606-dabf-4059-8862-859f59525ce8
2025-08-16 17:49:54,264 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to slovenian
2025-08-16 17:49:54,264 - src.models.climate_pipeline - INFO - Timing: translation=10827.5ms
2025-08-16 17:49:54,265 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:54,281 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:54,281 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:54,285 - src.models.climate_pipeline - INFO - ✓ Response cached in slovenian
2025-08-16 17:49:54,286 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 17:49:54,287 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.4 rewrite=565.6 guards=0.1 retrieval=1518.8 generation=9.7 faithfulness=1740.4 translation=10827.5 total=15364.1
2025-08-16 17:49:54,287 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 15.36s
2025-08-16 17:49:54,288 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380978894 time=15.389s model=nova faithfulness=0.900
2025-08-16 17:49:54,290 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=15.396s id=req_1755380978894 ip=127.0.0.1
INFO:     127.0.0.1:63546 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:55,509 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380995505 query_len=31 lang=bg
2025-08-16 17:49:55,510 - src.webui.api.routers.chat - INFO - Language routing: detected=bg model=nova
2025-08-16 17:49:55,514 - src.models.climate_pipeline - INFO - Processing query: 'Какво е изменението на климата?...' in bulgarian (code: bg)
2025-08-16 17:49:55,514 - src.models.climate_pipeline - INFO - Raw query repr: 'Какво е изменението на климата?'
2025-08-16 17:49:55,514 - src.models.climate_pipeline - INFO - Router IN → language_name=bulgarian, language_code=bg
2025-08-16 17:49:55,514 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:55,514 - src.models.query_routing - INFO - Language: bulgarian (bg) → Model: Nova
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Router OUT → english_query='Какво е изменението на климата?'
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Какво е изменението на климата?'
2025-08-16 17:49:55,515 - src.models.climate_pipeline - WARNING - Router language mismatch: query is in Russian but Bulgarian was selected
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Proceeding despite router mismatch (soft warning only)
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:55,515 - src.models.query_routing - INFO - Language: bulgarian (bg) → Model: Nova
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Какво е изменението на климата?'
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Какво е изменението на климата?'
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Net debug → original_query len=31, utf8_bytes=57
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Net debug → english_query len=31, utf8_bytes=57
2025-08-16 17:49:55,515 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:55,515 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:55,516 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:55,516 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:55,517 - src.models.climate_pipeline - INFO - ✓ Cache hit for bulgarian - returning cached response
2025-08-16 17:49:55,517 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380995505 time=0.009s model=nova faithfulness=0.950
2025-08-16 17:49:55,518 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.013s id=req_1755380995505 ip=127.0.0.1
INFO:     127.0.0.1:63700 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:49:56,731 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755380996726 query_len=22 lang=hr
2025-08-16 17:49:56,731 - src.webui.api.routers.chat - INFO - Language routing: detected=hr model=nova
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Processing query: 'Što je promjena klime?...' in croatian (code: hr)
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Raw query repr: 'Što je promjena klime?'
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Router IN → language_name=croatian, language_code=hr
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:49:56,732 - src.models.query_routing - INFO - Language: croatian (hr) → Model: Nova
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Router OUT → english_query='Što je promjena klime?'
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Što je promjena klime?'
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:49:56,732 - src.models.climate_pipeline - INFO - Timing: routing=0.5ms
2025-08-16 17:49:56,733 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:49:56,733 - src.models.query_routing - INFO - Language: croatian (hr) → Model: Nova
2025-08-16 17:49:56,733 - src.models.query_routing - INFO - Translating query from croatian to English
2025-08-16 17:49:56,733 - src.models.query_routing - INFO - Router NET IN → query repr='Što je promjena klime?'
2025-08-16 17:49:57,414 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=680 status=OK request_id=299bba01-4374-4c30-aac6-ae071fb14d9e
2025-08-16 17:49:57,414 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:49:57,414 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:49:57,414 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:49:57,414 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:49:57,415 - src.models.climate_pipeline - INFO - Net debug → original_query len=22, utf8_bytes=23
2025-08-16 17:49:57,415 - src.models.climate_pipeline - INFO - Net debug → english_query len=559, utf8_bytes=559
2025-08-16 17:49:57,415 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:49:57,415 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:57,416 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:57,417 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:57,417 - src.models.climate_pipeline - INFO - Cache miss for croatian query
2025-08-16 17:49:57,418 - src.models.climate_pipeline - INFO - Timing: cache=2.9ms
2025-08-16 17:49:57,418 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 17:49:57,418 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 17:49:57,418 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=hr, history_len=0
2025-08-16 17:49:57,418 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Što je promjena klime?'
2025-08-16 17:49:57,418 - query_rewriter - INFO - Rewriter NET IN → expected_lang=hr, user_query repr='Što je promjena klime?', norm='Što je promjena klime?'
2025-08-16 17:49:58,072 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=654 status=OK request_id=0057b79d-f027-4fd6-a485-e9f575fba99a
2025-08-16 17:49:58,073 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Croatian and asks about climate change.","language":"hr","expected_language":"hr","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 17:49:58,074 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 17:49:58,074 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Što je promjena klime?...' expected_lang=hr detected_lang=hr classification=on-topic language_match=True reason='User query is in Croatian and asks about climate change....'
2025-08-16 17:49:58,074 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='hr', classification='on-topic', language_match='yes', canned=False
2025-08-16 17:49:58,074 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 17:49:58,074 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 17:49:58,075 - src.models.climate_pipeline - INFO - Timing: rewrite=656.8ms
2025-08-16 17:49:58,075 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 17:49:58,075 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 17:49:58,075 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-16 17:49:58,075 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 17:49:58,075 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 17:49:58,075 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 17:49:58,751 - src.models.retrieval - INFO - dep=query_embed op=encode ms=675 dense_dim=1024 sparse_tokens=5
2025-08-16 17:49:58,898 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=145 status=OK
2025-08-16 17:49:58,898 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=146 total_ms=146
2025-08-16 17:49:59,201 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=303 status=OK
2025-08-16 17:49:59,201 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 17:49:59,201 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=303 total_ms=303
2025-08-16 17:49:59,204 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 17:49:59,204 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 17:49:59,343 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 17:49:59,359 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=154.4 status=OK
2025-08-16 17:49:59,359 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 17:49:59,360 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 17:49:59,360 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 17:49:59,360 - src.models.climate_pipeline - INFO - Timing: retrieval=1284.7ms
2025-08-16 17:49:59,360 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 17:49:59,360 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 17:49:59,360 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:49:59,361 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:49:59,361 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:49:59,362 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 17:49:59,362 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 17:49:59,362 - src.models.climate_pipeline - INFO - Timing: generation=2.3ms
2025-08-16 17:49:59,362 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 17:50:00,427 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1064 status=OK request_id=475db9d1-ef6f-4cae-9549-5d31e38c0ff9
2025-08-16 17:50:00,427 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 17:50:00,427 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 17:50:00,427 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 17:50:00,427 - src.models.climate_pipeline - INFO - Timing: faithfulness=1065.1ms
2025-08-16 17:50:00,427 - src.models.climate_pipeline - INFO - Step 8: Translating response to croatian (code=hr)
2025-08-16 17:50:10,696 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=10268 status=OK request_id=4e93b296-0e7b-4b15-8663-29652f653ea2
2025-08-16 17:50:10,698 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to croatian
2025-08-16 17:50:10,698 - src.models.climate_pipeline - INFO - Timing: translation=10270.8ms
2025-08-16 17:50:10,699 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:50:10,702 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:50:10,702 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:50:10,703 - src.models.climate_pipeline - INFO - ✓ Response cached in croatian
2025-08-16 17:50:10,705 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 17:50:10,706 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.5 rewrite=656.8 guards=0.1 retrieval=1284.7 generation=2.3 faithfulness=1065.1 translation=10270.8 total=13966.4
2025-08-16 17:50:10,706 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 13.97s
2025-08-16 17:50:10,708 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755380996726 time=13.977s model=nova faithfulness=0.900
2025-08-16 17:50:10,711 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=13.984s id=req_1755380996726 ip=127.0.0.1
INFO:     127.0.0.1:63713 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:19,539 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381319527 query_len=18 lang=ar
2025-08-16 17:55:19,540 - src.webui.api.routers.chat - INFO - Language routing: detected=ar model=command_a
2025-08-16 17:55:19,541 - src.models.climate_pipeline - INFO - Processing query: 'ما هو تغير المناخ؟...' in arabic (code: ar)
2025-08-16 17:55:19,541 - src.models.climate_pipeline - INFO - Raw query repr: 'ما هو تغير المناخ؟'
2025-08-16 17:55:19,541 - src.models.climate_pipeline - INFO - Router IN → language_name=arabic, language_code=ar
2025-08-16 17:55:19,541 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:19,541 - src.models.query_routing - INFO - Language: arabic (ar) → Model: Command-A
2025-08-16 17:55:19,541 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:19,541 - src.models.climate_pipeline - INFO - Router OUT → english_query='ما هو تغير المناخ؟'
2025-08-16 17:55:19,542 - src.models.climate_pipeline - INFO - Router OUT → processed_query='ما هو تغير المناخ؟'
2025-08-16 17:55:19,542 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:19,542 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:55:19,542 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:19,542 - src.models.query_routing - INFO - Language: arabic (ar) → Model: Command-A
2025-08-16 17:55:19,542 - src.models.query_routing - INFO - Translating query from arabic to English
2025-08-16 17:55:19,542 - src.models.query_routing - INFO - Router NET IN → query repr='ما هو تغير المناخ؟'
2025-08-16 17:55:19,878 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:19,896 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:19,896 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:19,896 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:19,896 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:19,896 - src.models.climate_pipeline - INFO - Net debug → original_query len=18, utf8_bytes=33
2025-08-16 17:55:19,896 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:19,896 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:19,896 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:19,898 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:19,898 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:19,900 - src.models.climate_pipeline - INFO - ✓ Cache hit for arabic - returning cached response
2025-08-16 17:55:19,900 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381319527 time=0.362s model=command_a faithfulness=0.950
2025-08-16 17:55:19,901 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.374s id=req_1755381319527 ip=127.0.0.1
INFO:     127.0.0.1:50205 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:20,920 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381320918 query_len=20 lang=bn
2025-08-16 17:55:20,920 - src.webui.api.routers.chat - INFO - Language routing: detected=bn model=command_a
2025-08-16 17:55:20,920 - src.models.climate_pipeline - INFO - Processing query: 'জলবায়ু পরিবর্তন কি?...' in bengali (code: bn)
2025-08-16 17:55:20,920 - src.models.climate_pipeline - INFO - Raw query repr: 'জলবায়ু পরিবর্তন কি?'
2025-08-16 17:55:20,920 - src.models.climate_pipeline - INFO - Router IN → language_name=bengali, language_code=bn
2025-08-16 17:55:20,920 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:20,921 - src.models.query_routing - INFO - Language: bengali (bn) → Model: Command-A
2025-08-16 17:55:20,924 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:20,924 - src.models.climate_pipeline - INFO - Router OUT → english_query='জলবায়ু পরিবর্তন কি?'
2025-08-16 17:55:20,924 - src.models.climate_pipeline - INFO - Router OUT → processed_query='জলবায়ু পরিবর্তন কি?'
2025-08-16 17:55:20,924 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:20,924 - src.models.climate_pipeline - INFO - Timing: routing=3.3ms
2025-08-16 17:55:20,924 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:20,924 - src.models.query_routing - INFO - Language: bengali (bn) → Model: Command-A
2025-08-16 17:55:20,924 - src.models.query_routing - INFO - Translating query from bengali to English
2025-08-16 17:55:20,924 - src.models.query_routing - INFO - Router NET IN → query repr='জলবায়ু পরিবর্তন কি?'
2025-08-16 17:55:21,128 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:21,132 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:21,132 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:21,132 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:21,132 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:21,132 - src.models.climate_pipeline - INFO - Net debug → original_query len=20, utf8_bytes=54
2025-08-16 17:55:21,132 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:21,132 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:21,132 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:21,134 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:21,134 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:21,140 - src.models.climate_pipeline - INFO - ✓ Cache hit for bengali - returning cached response
2025-08-16 17:55:21,140 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381320918 time=0.221s model=command_a faithfulness=0.950
2025-08-16 17:55:21,141 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.223s id=req_1755381320918 ip=127.0.0.1
INFO:     127.0.0.1:50221 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:22,158 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381322155 query_len=8 lang=zh
2025-08-16 17:55:22,159 - src.webui.api.routers.chat - INFO - Language routing: detected=zh model=command_a
2025-08-16 17:55:22,159 - src.models.climate_pipeline - INFO - Processing query: '什么是气候变化？...' in chinese (code: zh)
2025-08-16 17:55:22,159 - src.models.climate_pipeline - INFO - Raw query repr: '什么是气候变化？'
2025-08-16 17:55:22,161 - src.models.climate_pipeline - INFO - Router IN → language_name=chinese, language_code=zh
2025-08-16 17:55:22,161 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:22,161 - src.models.query_routing - INFO - Language: chinese (zh) → Model: Command-A
2025-08-16 17:55:22,161 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:22,161 - src.models.climate_pipeline - INFO - Router OUT → english_query='什么是气候变化？'
2025-08-16 17:55:22,161 - src.models.climate_pipeline - INFO - Router OUT → processed_query='什么是气候变化？'
2025-08-16 17:55:22,162 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:22,162 - src.models.climate_pipeline - INFO - Timing: routing=0.5ms
2025-08-16 17:55:22,162 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:22,162 - src.models.query_routing - INFO - Language: chinese (zh) → Model: Command-A
2025-08-16 17:55:22,162 - src.models.query_routing - INFO - Translating query from chinese to English
2025-08-16 17:55:22,162 - src.models.query_routing - INFO - Router NET IN → query repr='什么是气候变化？'
2025-08-16 17:55:22,355 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:22,357 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:22,357 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:22,357 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:22,357 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:22,357 - src.models.climate_pipeline - INFO - Net debug → original_query len=8, utf8_bytes=24
2025-08-16 17:55:22,357 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:22,357 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:22,357 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:22,359 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:22,359 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:22,361 - src.models.climate_pipeline - INFO - ✓ Cache hit for chinese - returning cached response
2025-08-16 17:55:22,361 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381322155 time=0.203s model=command_a faithfulness=0.950
2025-08-16 17:55:22,363 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.207s id=req_1755381322155 ip=127.0.0.1
INFO:     127.0.0.1:50233 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:23,381 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381323380 query_len=23 lang=tl
2025-08-16 17:55:23,381 - src.webui.api.routers.chat - INFO - Language routing: detected=tl model=command_a
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Processing query: 'Ano ang climate change?...' in tagalog (code: tl)
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Raw query repr: 'Ano ang climate change?'
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Router IN → language_name=tagalog, language_code=tl
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:23,382 - src.models.query_routing - INFO - Language: tagalog (tl) → Model: Command-A
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Router OUT → english_query='Ano ang climate change?'
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Ano ang climate change?'
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:55:23,382 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:23,382 - src.models.query_routing - INFO - Language: tagalog (tl) → Model: Command-A
2025-08-16 17:55:23,382 - src.models.query_routing - INFO - Translating query from tagalog to English
2025-08-16 17:55:23,382 - src.models.query_routing - INFO - Router NET IN → query repr='Ano ang climate change?'
2025-08-16 17:55:23,601 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:23,603 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:23,603 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:23,603 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:23,603 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:23,603 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 17:55:23,604 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:23,604 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:23,604 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:23,606 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:23,606 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:23,608 - src.models.climate_pipeline - INFO - ✓ Cache hit for tagalog - returning cached response
2025-08-16 17:55:23,609 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381323380 time=0.227s model=command_a faithfulness=0.950
2025-08-16 17:55:23,610 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.230s id=req_1755381323380 ip=127.0.0.1
INFO:     127.0.0.1:50248 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:24,617 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381324616 query_len=39 lang=fr
2025-08-16 17:55:24,617 - src.webui.api.routers.chat - INFO - Language routing: detected=fr model=command_a
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Processing query: 'Qu'est-ce que le changement climatique?...' in french (code: fr)
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Raw query repr: "Qu'est-ce que le changement climatique?"
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Router IN → language_name=french, language_code=fr
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:24,617 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Router OUT → english_query='Qu'est-ce que le changement climatique?'
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Qu'est-ce que le changement climatique?'
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:24,617 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:24,617 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 17:55:24,617 - src.models.query_routing - INFO - Translating query from french to English
2025-08-16 17:55:24,617 - src.models.query_routing - INFO - Router NET IN → query repr="Qu'est-ce que le changement climatique?"
2025-08-16 17:55:24,824 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:24,825 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:24,825 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:24,825 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:24,825 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:24,825 - src.models.climate_pipeline - INFO - Net debug → original_query len=39, utf8_bytes=39
2025-08-16 17:55:24,825 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:24,825 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:24,825 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:24,827 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:24,827 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:24,828 - src.models.climate_pipeline - INFO - ✓ Cache hit for french - returning cached response
2025-08-16 17:55:24,828 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381324616 time=0.211s model=command_a faithfulness=0.950
2025-08-16 17:55:24,828 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.212s id=req_1755381324616 ip=127.0.0.1
INFO:     127.0.0.1:50259 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:25,840 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381325838 query_len=23 lang=gu
2025-08-16 17:55:25,840 - src.webui.api.routers.chat - INFO - Language routing: detected=gu model=command_a
2025-08-16 17:55:25,840 - src.models.climate_pipeline - INFO - Processing query: 'આબોહવા પરિવર્તન શું છે?...' in gujarati (code: gu)
2025-08-16 17:55:25,840 - src.models.climate_pipeline - INFO - Raw query repr: 'આબોહવા પરિવર્તન શું છે?'
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - Router IN → language_name=gujarati, language_code=gu
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:25,841 - src.models.query_routing - INFO - Language: gujarati (gu) → Model: Command-A
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - Router OUT → english_query='આબોહવા પરિવર્તન શું છે?'
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - Router OUT → processed_query='આબોહવા પરિવર્તન શું છે?'
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:55:25,841 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:25,841 - src.models.query_routing - INFO - Language: gujarati (gu) → Model: Command-A
2025-08-16 17:55:25,841 - src.models.query_routing - INFO - Translating query from gujarati to English
2025-08-16 17:55:25,841 - src.models.query_routing - INFO - Router NET IN → query repr='આબોહવા પરિવર્તન શું છે?'
2025-08-16 17:55:26,047 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:26,051 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:26,051 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:26,051 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:26,051 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:26,051 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=61
2025-08-16 17:55:26,051 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:26,051 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:26,052 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:26,054 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:26,054 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:26,055 - src.models.climate_pipeline - INFO - ✓ Cache hit for gujarati - returning cached response
2025-08-16 17:55:26,056 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381325838 time=0.216s model=command_a faithfulness=0.950
2025-08-16 17:55:26,057 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.219s id=req_1755381325838 ip=127.0.0.1
INFO:     127.0.0.1:50270 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:27,066 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381327065 query_len=13 lang=ko
2025-08-16 17:55:27,066 - src.webui.api.routers.chat - INFO - Language routing: detected=ko model=command_a
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Processing query: '기후 변화란 무엇인가요?...' in korean (code: ko)
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Raw query repr: '기후 변화란 무엇인가요?'
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Router IN → language_name=korean, language_code=ko
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:27,066 - src.models.query_routing - INFO - Language: korean (ko) → Model: Command-A
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Router OUT → english_query='기후 변화란 무엇인가요?'
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Router OUT → processed_query='기후 변화란 무엇인가요?'
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:27,066 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:27,066 - src.models.query_routing - INFO - Language: korean (ko) → Model: Command-A
2025-08-16 17:55:27,066 - src.models.query_routing - INFO - Translating query from korean to English
2025-08-16 17:55:27,066 - src.models.query_routing - INFO - Router NET IN → query repr='기후 변화란 무엇인가요?'
2025-08-16 17:55:27,260 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:27,261 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:27,261 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:27,261 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:27,261 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:27,261 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=33
2025-08-16 17:55:27,261 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:27,261 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:27,262 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:27,263 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:27,263 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:27,264 - src.models.climate_pipeline - INFO - ✓ Cache hit for korean - returning cached response
2025-08-16 17:55:27,265 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381327065 time=0.199s model=command_a faithfulness=0.950
2025-08-16 17:55:27,265 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.200s id=req_1755381327065 ip=127.0.0.1
INFO:     127.0.0.1:50285 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:28,274 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381328272 query_len=24 lang=fa
2025-08-16 17:55:28,274 - src.webui.api.routers.chat - INFO - Language routing: detected=fa model=command_a
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Processing query: 'تغییرات آب و هوایی چیست؟...' in persian (code: fa)
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Raw query repr: 'تغییرات آب و هوایی چیست؟'
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Router IN → language_name=persian, language_code=fa
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:28,274 - src.models.query_routing - INFO - Language: persian (fa) → Model: Command-A
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Router OUT → english_query='تغییرات آب و هوایی چیست؟'
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Router OUT → processed_query='تغییرات آب و هوایی چیست؟'
2025-08-16 17:55:28,274 - src.models.climate_pipeline - WARNING - Router language mismatch: query is in Arabic but Persian was selected
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Proceeding despite router mismatch (soft warning only)
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:28,274 - src.models.query_routing - INFO - Language: persian (fa) → Model: Command-A
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='تغییرات آب و هوایی چیست؟'
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='تغییرات آب و هوایی چیست؟'
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Net debug → original_query len=24, utf8_bytes=44
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Net debug → english_query len=24, utf8_bytes=44
2025-08-16 17:55:28,274 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:28,274 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:28,281 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:28,281 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:28,283 - src.models.climate_pipeline - INFO - ✓ Cache hit for persian - returning cached response
2025-08-16 17:55:28,284 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381328272 time=0.010s model=command_a faithfulness=0.900
2025-08-16 17:55:28,284 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.012s id=req_1755381328272 ip=127.0.0.1
INFO:     127.0.0.1:50296 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:29,296 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381329295 query_len=28 lang=ru
2025-08-16 17:55:29,296 - src.webui.api.routers.chat - INFO - Language routing: detected=ru model=command_a
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Processing query: 'Что такое изменение климата?...' in russian (code: ru)
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Raw query repr: 'Что такое изменение климата?'
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Router IN → language_name=russian, language_code=ru
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:29,296 - src.models.query_routing - INFO - Language: russian (ru) → Model: Command-A
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Router OUT → english_query='Что такое изменение климата?'
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Что такое изменение климата?'
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:29,296 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:29,296 - src.models.query_routing - INFO - Language: russian (ru) → Model: Command-A
2025-08-16 17:55:29,296 - src.models.query_routing - INFO - Translating query from russian to English
2025-08-16 17:55:29,296 - src.models.query_routing - INFO - Router NET IN → query repr='Что такое изменение климата?'
2025-08-16 17:55:29,505 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:29,508 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:29,508 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:29,508 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:29,508 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:29,508 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=52
2025-08-16 17:55:29,508 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:29,508 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:29,508 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:29,510 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:29,510 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:29,511 - src.models.climate_pipeline - INFO - ✓ Cache hit for russian - returning cached response
2025-08-16 17:55:29,511 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381329295 time=0.216s model=command_a faithfulness=0.950
2025-08-16 17:55:29,512 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.217s id=req_1755381329295 ip=127.0.0.1
INFO:     127.0.0.1:50307 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:30,540 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381330533 query_len=29 lang=ta
2025-08-16 17:55:30,540 - src.webui.api.routers.chat - INFO - Language routing: detected=ta model=command_a
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Processing query: 'காலநிலை மாற்றம் என்றால் என்ன?...' in tamil (code: ta)
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Raw query repr: 'காலநிலை மாற்றம் என்றால் என்ன?'
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Router IN → language_name=tamil, language_code=ta
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:30,541 - src.models.query_routing - INFO - Language: tamil (ta) → Model: Command-A
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Router OUT → english_query='காலநிலை மாற்றம் என்றால் என்ன?'
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Router OUT → processed_query='காலநிலை மாற்றம் என்றால் என்ன?'
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:55:30,541 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:30,541 - src.models.query_routing - INFO - Language: tamil (ta) → Model: Command-A
2025-08-16 17:55:30,542 - src.models.query_routing - INFO - Translating query from tamil to English
2025-08-16 17:55:30,542 - src.models.query_routing - INFO - Router NET IN → query repr='காலநிலை மாற்றம் என்றால் என்ன?'
2025-08-16 17:55:30,739 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:30,742 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:30,742 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:30,742 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:30,742 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:30,742 - src.models.climate_pipeline - INFO - Net debug → original_query len=29, utf8_bytes=79
2025-08-16 17:55:30,742 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:30,742 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:30,743 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:30,749 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:30,749 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:30,751 - src.models.climate_pipeline - INFO - ✓ Cache hit for tamil - returning cached response
2025-08-16 17:55:30,751 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381330533 time=0.211s model=command_a faithfulness=0.950
2025-08-16 17:55:30,753 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.219s id=req_1755381330533 ip=127.0.0.1
INFO:     127.0.0.1:50322 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:31,769 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381331767 query_len=23 lang=ur
2025-08-16 17:55:31,769 - src.webui.api.routers.chat - INFO - Language routing: detected=ur model=command_a
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Processing query: 'موسمیاتی تبدیلی کیا ہے؟...' in urdu (code: ur)
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Raw query repr: 'موسمیاتی تبدیلی کیا ہے؟'
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Router IN → language_name=urdu, language_code=ur
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:31,770 - src.models.query_routing - INFO - Language: urdu (ur) → Model: Command-A
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Router OUT → english_query='موسمیاتی تبدیلی کیا ہے؟'
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Router OUT → processed_query='موسمیاتی تبدیلی کیا ہے؟'
2025-08-16 17:55:31,770 - src.models.climate_pipeline - WARNING - Router language mismatch: query is in Arabic but Urdu was selected
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Proceeding despite router mismatch (soft warning only)
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:31,770 - src.models.query_routing - INFO - Language: urdu (ur) → Model: Command-A
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='موسمیاتی تبدیلی کیا ہے؟'
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='موسمیاتی تبدیلی کیا ہے؟'
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=43
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=43
2025-08-16 17:55:31,770 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:31,770 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:31,773 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:31,773 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:31,775 - src.models.climate_pipeline - INFO - ✓ Cache hit for urdu - returning cached response
2025-08-16 17:55:31,775 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381331767 time=0.006s model=command_a faithfulness=0.900
2025-08-16 17:55:31,776 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.009s id=req_1755381331767 ip=127.0.0.1
INFO:     127.0.0.1:50335 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:32,808 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381332806 query_len=23 lang=vi
2025-08-16 17:55:32,808 - src.webui.api.routers.chat - INFO - Language routing: detected=vi model=command_a
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Processing query: 'Biến đổi khí hậu là gì?...' in vietnamese (code: vi)
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Raw query repr: 'Biến đổi khí hậu là gì?'
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Router IN → language_name=vietnamese, language_code=vi
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:32,809 - src.models.query_routing - INFO - Language: vietnamese (vi) → Model: Command-A
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Router OUT → english_query='Biến đổi khí hậu là gì?'
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Biến đổi khí hậu là gì?'
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:32,809 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:32,809 - src.models.query_routing - INFO - Language: vietnamese (vi) → Model: Command-A
2025-08-16 17:55:32,809 - src.models.query_routing - INFO - Translating query from vietnamese to English
2025-08-16 17:55:32,809 - src.models.query_routing - INFO - Router NET IN → query repr='Biến đổi khí hậu là gì?'
2025-08-16 17:55:32,991 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:32,993 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:32,993 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:32,993 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:32,993 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:32,993 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=33
2025-08-16 17:55:32,993 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:32,993 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:32,993 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:32,996 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:32,996 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:32,996 - src.models.climate_pipeline - INFO - ✓ Cache hit for vietnamese - returning cached response
2025-08-16 17:55:32,997 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381332806 time=0.188s model=command_a faithfulness=0.950
2025-08-16 17:55:32,997 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.191s id=req_1755381332806 ip=127.0.0.1
INFO:     127.0.0.1:50346 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:34,005 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381334004 query_len=26 lang=pl
2025-08-16 17:55:34,005 - src.webui.api.routers.chat - INFO - Language routing: detected=pl model=command_a
2025-08-16 17:55:34,005 - src.models.climate_pipeline - INFO - Processing query: 'Co to jest zmiana klimatu?...' in polish (code: pl)
2025-08-16 17:55:34,005 - src.models.climate_pipeline - INFO - Raw query repr: 'Co to jest zmiana klimatu?'
2025-08-16 17:55:34,005 - src.models.climate_pipeline - INFO - Router IN → language_name=polish, language_code=pl
2025-08-16 17:55:34,005 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:34,005 - src.models.query_routing - INFO - Language: polish (pl) → Model: Command-A
2025-08-16 17:55:34,005 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:34,005 - src.models.climate_pipeline - INFO - Router OUT → english_query='Co to jest zmiana klimatu?'
2025-08-16 17:55:34,006 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Co to jest zmiana klimatu?'
2025-08-16 17:55:34,006 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:34,006 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:34,006 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:34,006 - src.models.query_routing - INFO - Language: polish (pl) → Model: Command-A
2025-08-16 17:55:34,006 - src.models.query_routing - INFO - Translating query from polish to English
2025-08-16 17:55:34,006 - src.models.query_routing - INFO - Router NET IN → query repr='Co to jest zmiana klimatu?'
2025-08-16 17:55:34,196 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:34,198 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:34,198 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:34,198 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:34,198 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:34,198 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=26
2025-08-16 17:55:34,198 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:34,198 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:34,198 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:34,200 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:34,200 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:34,201 - src.models.climate_pipeline - INFO - ✓ Cache hit for polish - returning cached response
2025-08-16 17:55:34,201 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381334004 time=0.196s model=command_a faithfulness=0.950
2025-08-16 17:55:34,204 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.200s id=req_1755381334004 ip=127.0.0.1
INFO:     127.0.0.1:50362 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:35,216 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381335215 query_len=24 lang=tr
2025-08-16 17:55:35,216 - src.webui.api.routers.chat - INFO - Language routing: detected=tr model=command_a
2025-08-16 17:55:35,216 - src.models.climate_pipeline - INFO - Processing query: 'İklim değişikliği nedir?...' in turkish (code: tr)
2025-08-16 17:55:35,216 - src.models.climate_pipeline - INFO - Raw query repr: 'İklim değişikliği nedir?'
2025-08-16 17:55:35,216 - src.models.climate_pipeline - INFO - Router IN → language_name=turkish, language_code=tr
2025-08-16 17:55:35,216 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:35,216 - src.models.query_routing - INFO - Language: turkish (tr) → Model: Command-A
2025-08-16 17:55:35,216 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:35,217 - src.models.climate_pipeline - INFO - Router OUT → english_query='İklim değişikliği nedir?'
2025-08-16 17:55:35,217 - src.models.climate_pipeline - INFO - Router OUT → processed_query='İklim değişikliği nedir?'
2025-08-16 17:55:35,217 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:35,217 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:35,217 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:35,217 - src.models.query_routing - INFO - Language: turkish (tr) → Model: Command-A
2025-08-16 17:55:35,217 - src.models.query_routing - INFO - Translating query from turkish to English
2025-08-16 17:55:35,217 - src.models.query_routing - INFO - Router NET IN → query repr='İklim değişikliği nedir?'
2025-08-16 17:55:35,423 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:35,425 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:35,425 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:35,425 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:35,425 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:35,425 - src.models.climate_pipeline - INFO - Net debug → original_query len=24, utf8_bytes=28
2025-08-16 17:55:35,425 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:35,425 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:35,425 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:35,430 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:35,430 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:35,431 - src.models.climate_pipeline - INFO - ✓ Cache hit for turkish - returning cached response
2025-08-16 17:55:35,431 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381335215 time=0.215s model=command_a faithfulness=0.950
2025-08-16 17:55:35,431 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.217s id=req_1755381335215 ip=127.0.0.1
INFO:     127.0.0.1:50373 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:36,442 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381336440 query_len=26 lang=nl
2025-08-16 17:55:36,442 - src.webui.api.routers.chat - INFO - Language routing: detected=nl model=command_a
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Processing query: 'Wat is klimaatverandering?...' in dutch (code: nl)
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Raw query repr: 'Wat is klimaatverandering?'
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Router IN → language_name=dutch, language_code=nl
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:36,443 - src.models.query_routing - INFO - Language: dutch (nl) → Model: Command-A
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Router OUT → english_query='Wat is klimaatverandering?'
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Wat is klimaatverandering?'
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:55:36,443 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:36,443 - src.models.query_routing - INFO - Language: dutch (nl) → Model: Command-A
2025-08-16 17:55:36,443 - src.models.query_routing - INFO - Translating query from dutch to English
2025-08-16 17:55:36,443 - src.models.query_routing - INFO - Router NET IN → query repr='Wat is klimaatverandering?'
2025-08-16 17:55:36,646 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:36,648 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:36,648 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:36,648 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:36,648 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:36,648 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=26
2025-08-16 17:55:36,648 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:36,648 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:36,648 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:36,657 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:36,657 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:36,658 - src.models.climate_pipeline - INFO - ✓ Cache hit for dutch - returning cached response
2025-08-16 17:55:36,659 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381336440 time=0.217s model=command_a faithfulness=0.950
2025-08-16 17:55:36,659 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.219s id=req_1755381336440 ip=127.0.0.1
INFO:     127.0.0.1:50388 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:37,668 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381337667 query_len=20 lang=cs
2025-08-16 17:55:37,668 - src.webui.api.routers.chat - INFO - Language routing: detected=cs model=command_a
2025-08-16 17:55:37,668 - src.models.climate_pipeline - INFO - Processing query: 'Co je změna klimatu?...' in czech (code: cs)
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Raw query repr: 'Co je změna klimatu?'
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Router IN → language_name=czech, language_code=cs
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:37,669 - src.models.query_routing - INFO - Language: czech (cs) → Model: Command-A
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Router OUT → english_query='Co je změna klimatu?'
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Co je změna klimatu?'
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-16 17:55:37,669 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:37,669 - src.models.query_routing - INFO - Language: czech (cs) → Model: Command-A
2025-08-16 17:55:37,669 - src.models.query_routing - INFO - Translating query from czech to English
2025-08-16 17:55:37,669 - src.models.query_routing - INFO - Router NET IN → query repr='Co je změna klimatu?'
2025-08-16 17:55:37,862 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:37,866 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:37,866 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:37,866 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:37,866 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:37,866 - src.models.climate_pipeline - INFO - Net debug → original_query len=20, utf8_bytes=21
2025-08-16 17:55:37,866 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:37,866 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:37,866 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:37,869 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:37,869 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:37,869 - src.models.climate_pipeline - INFO - ✓ Cache hit for czech - returning cached response
2025-08-16 17:55:37,870 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381337667 time=0.201s model=command_a faithfulness=0.950
2025-08-16 17:55:37,871 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.204s id=req_1755381337667 ip=127.0.0.1
INFO:     127.0.0.1:50399 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:38,878 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381338876 query_len=24 lang=id
2025-08-16 17:55:38,878 - src.webui.api.routers.chat - INFO - Language routing: detected=id model=command_a
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Processing query: 'Apa itu perubahan iklim?...' in indonesian (code: id)
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Raw query repr: 'Apa itu perubahan iklim?'
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Router IN → language_name=indonesian, language_code=id
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:38,879 - src.models.query_routing - INFO - Language: indonesian (id) → Model: Command-A
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Router OUT → english_query='Apa itu perubahan iklim?'
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Apa itu perubahan iklim?'
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:55:38,879 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:38,879 - src.models.query_routing - INFO - Language: indonesian (id) → Model: Command-A
2025-08-16 17:55:38,879 - src.models.query_routing - INFO - Translating query from indonesian to English
2025-08-16 17:55:38,879 - src.models.query_routing - INFO - Router NET IN → query repr='Apa itu perubahan iklim?'
2025-08-16 17:55:39,099 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:39,100 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:39,100 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:39,100 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:39,100 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:39,100 - src.models.climate_pipeline - INFO - Net debug → original_query len=24, utf8_bytes=24
2025-08-16 17:55:39,100 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:39,100 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:39,101 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:39,102 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:39,102 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:39,104 - src.models.climate_pipeline - INFO - ✓ Cache hit for indonesian - returning cached response
2025-08-16 17:55:39,104 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381338876 time=0.226s model=command_a faithfulness=0.950
2025-08-16 17:55:39,104 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.228s id=req_1755381338876 ip=127.0.0.1
INFO:     127.0.0.1:50410 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:40,117 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381340115 query_len=22 lang=uk
2025-08-16 17:55:40,117 - src.webui.api.routers.chat - INFO - Language routing: detected=uk model=command_a
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Processing query: 'Що таке зміна клімату?...' in ukrainian (code: uk)
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Raw query repr: 'Що таке зміна клімату?'
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Router IN → language_name=ukrainian, language_code=uk
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:40,118 - src.models.query_routing - INFO - Language: ukrainian (uk) → Model: Command-A
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Router OUT → english_query='Що таке зміна клімату?'
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Що таке зміна клімату?'
2025-08-16 17:55:40,118 - src.models.climate_pipeline - WARNING - Router language mismatch: query is in Russian but Ukrainian was selected
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - Proceeding despite router mismatch (soft warning only)
2025-08-16 17:55:40,118 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:40,119 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:55:40,119 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:40,119 - src.models.query_routing - INFO - Language: ukrainian (uk) → Model: Command-A
2025-08-16 17:55:40,119 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Що таке зміна клімату?'
2025-08-16 17:55:40,119 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Що таке зміна клімату?'
2025-08-16 17:55:40,119 - src.models.climate_pipeline - INFO - Net debug → original_query len=22, utf8_bytes=40
2025-08-16 17:55:40,119 - src.models.climate_pipeline - INFO - Net debug → english_query len=22, utf8_bytes=40
2025-08-16 17:55:40,119 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:40,119 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:40,126 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:40,126 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:40,127 - src.models.climate_pipeline - INFO - ✓ Cache hit for ukrainian - returning cached response
2025-08-16 17:55:40,127 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381340115 time=0.010s model=command_a faithfulness=0.950
2025-08-16 17:55:40,128 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.013s id=req_1755381340115 ip=127.0.0.1
INFO:     127.0.0.1:50425 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:41,142 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381341141 query_len=29 lang=ro
2025-08-16 17:55:41,142 - src.webui.api.routers.chat - INFO - Language routing: detected=ro model=command_a
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Processing query: 'Ce este schimbarea climatică?...' in romanian (code: ro)
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Raw query repr: 'Ce este schimbarea climatică?'
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Router IN → language_name=romanian, language_code=ro
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:41,143 - src.models.query_routing - INFO - Language: romanian (ro) → Model: Command-A
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Router OUT → english_query='Ce este schimbarea climatică?'
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Ce este schimbarea climatică?'
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:41,143 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:41,143 - src.models.query_routing - INFO - Language: romanian (ro) → Model: Command-A
2025-08-16 17:55:41,143 - src.models.query_routing - INFO - Translating query from romanian to English
2025-08-16 17:55:41,143 - src.models.query_routing - INFO - Router NET IN → query repr='Ce este schimbarea climatică?'
2025-08-16 17:55:41,368 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:41,371 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:41,371 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:41,371 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:41,371 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:41,371 - src.models.climate_pipeline - INFO - Net debug → original_query len=29, utf8_bytes=30
2025-08-16 17:55:41,371 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:41,371 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:41,371 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:41,373 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:41,373 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:41,374 - src.models.climate_pipeline - INFO - ✓ Cache hit for romanian - returning cached response
2025-08-16 17:55:41,375 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381341141 time=0.233s model=command_a faithfulness=0.950
2025-08-16 17:55:41,376 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.235s id=req_1755381341141 ip=127.0.0.1
INFO:     127.0.0.1:50436 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:42,389 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381342388 query_len=28 lang=el
2025-08-16 17:55:42,389 - src.webui.api.routers.chat - INFO - Language routing: detected=el model=command_a
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Processing query: 'Τι είναι η κλιματική αλλαγή;...' in greek (code: el)
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Raw query repr: 'Τι είναι η κλιματική αλλαγή;'
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Router IN → language_name=greek, language_code=el
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:42,390 - src.models.query_routing - INFO - Language: greek (el) → Model: Command-A
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Router OUT → english_query='Τι είναι η κλιματική αλλαγή;'
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Τι είναι η κλιματική αλλαγή;'
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:55:42,390 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:42,390 - src.models.query_routing - INFO - Language: greek (el) → Model: Command-A
2025-08-16 17:55:42,390 - src.models.query_routing - INFO - Translating query from greek to English
2025-08-16 17:55:42,390 - src.models.query_routing - INFO - Router NET IN → query repr='Τι είναι η κλιματική αλλαγή;'
2025-08-16 17:55:42,579 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:42,581 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:42,581 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:42,581 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:42,581 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:42,581 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=51
2025-08-16 17:55:42,581 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:42,581 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:42,581 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:42,590 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:42,590 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:42,591 - src.models.climate_pipeline - INFO - ✓ Cache hit for greek - returning cached response
2025-08-16 17:55:42,592 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381342388 time=0.202s model=command_a faithfulness=0.950
2025-08-16 17:55:42,592 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.205s id=req_1755381342388 ip=127.0.0.1
INFO:     127.0.0.1:50452 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:43,601 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381343601 query_len=24 lang=hi
2025-08-16 17:55:43,602 - src.webui.api.routers.chat - INFO - Language routing: detected=hi model=command_a
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Processing query: 'जलवायु परिवर्तन क्या है?...' in hindi (code: hi)
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Raw query repr: 'जलवायु परिवर्तन क्या है?'
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Router IN → language_name=hindi, language_code=hi
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:43,602 - src.models.query_routing - INFO - Language: hindi (hi) → Model: Command-A
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Router OUT → english_query='जलवायु परिवर्तन क्या है?'
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Router OUT → processed_query='जलवायु परिवर्तन क्या है?'
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:43,602 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:43,602 - src.models.query_routing - INFO - Language: hindi (hi) → Model: Command-A
2025-08-16 17:55:43,602 - src.models.query_routing - INFO - Translating query from hindi to English
2025-08-16 17:55:43,602 - src.models.query_routing - INFO - Router NET IN → query repr='जलवायु परिवर्तन क्या है?'
2025-08-16 17:55:43,805 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:43,808 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:43,808 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:43,808 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:43,808 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:43,808 - src.models.climate_pipeline - INFO - Net debug → original_query len=24, utf8_bytes=64
2025-08-16 17:55:43,808 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:43,808 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:43,808 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:43,811 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:43,811 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:43,811 - src.models.climate_pipeline - INFO - ✓ Cache hit for hindi - returning cached response
2025-08-16 17:55:43,811 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381343601 time=0.210s model=command_a faithfulness=0.950
2025-08-16 17:55:43,812 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.211s id=req_1755381343601 ip=127.0.0.1
INFO:     127.0.0.1:50463 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:44,822 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381344821 query_len=18 lang=he
2025-08-16 17:55:44,822 - src.webui.api.routers.chat - INFO - Language routing: detected=he model=command_a
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Processing query: 'מה זה שינוי אקלים?...' in hebrew (code: he)
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Raw query repr: 'מה זה שינוי אקלים?'
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Router IN → language_name=hebrew, language_code=he
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:44,822 - src.models.query_routing - INFO - Language: hebrew (he) → Model: Command-A
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Router OUT → english_query='מה זה שינוי אקלים?'
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Router OUT → processed_query='מה זה שינוי אקלים?'
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:44,822 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 17:55:44,823 - src.models.query_routing - INFO - Language: hebrew (he) → Model: Command-A
2025-08-16 17:55:44,823 - src.models.query_routing - INFO - Translating query from hebrew to English
2025-08-16 17:55:44,823 - src.models.query_routing - INFO - Router NET IN → query repr='מה זה שינוי אקלים?'
2025-08-16 17:55:45,019 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 17:55:45,021 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:45,021 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:55:45,022 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:55:45,022 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:55:45,022 - src.models.climate_pipeline - INFO - Net debug → original_query len=18, utf8_bytes=32
2025-08-16 17:55:45,022 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:45,022 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:45,022 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:45,023 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:45,024 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:45,025 - src.models.climate_pipeline - INFO - ✓ Cache hit for hebrew - returning cached response
2025-08-16 17:55:45,026 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381344821 time=0.204s model=command_a faithfulness=0.950
2025-08-16 17:55:45,026 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.205s id=req_1755381344821 ip=127.0.0.1
INFO:     127.0.0.1:50474 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:46,033 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381346032 query_len=23 lang=en
2025-08-16 17:55:46,034 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:46,034 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:55:46,034 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:46,034 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:46,036 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:46,036 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:46,036 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 17:55:46,036 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381346032 time=0.003s model=nova faithfulness=0.950
2025-08-16 17:55:46,037 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.005s id=req_1755381346032 ip=127.0.0.1
INFO:     127.0.0.1:50489 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:47,048 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381347046 query_len=28 lang=es
2025-08-16 17:55:47,048 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 17:55:47,048 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 17:55:47,048 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 17:55:47,048 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 17:55:47,048 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:47,048 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 17:55:47,048 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:55:47,048 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 17:55:47,049 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 17:55:47,049 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:55:47,049 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:55:47,049 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:55:47,049 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 17:55:47,049 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 17:55:47,049 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 17:55:47,782 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=731 status=OK request_id=206dbd9e-4b8e-4587-980c-184748f55415
2025-08-16 17:55:47,782 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:55:47,783 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history"
2025-08-16 17:55:47,783 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 17:55:47,783 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 17:55:47,783 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 17:55:47,783 - src.models.climate_pipeline - INFO - Net debug → english_query len=609, utf8_bytes=609
2025-08-16 17:55:47,783 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:47,783 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:47,786 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:47,786 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:47,787 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 17:55:47,788 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:47,789 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:47,789 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:47,789 - src.models.climate_pipeline - INFO - Timing: cache=6.6ms
2025-08-16 17:55:47,790 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 17:55:47,790 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 17:55:47,790 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 17:55:47,790 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='¿Qué es el cambio climático?'
2025-08-16 17:55:47,790 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='¿Qué es el cambio climático?', norm='¿Qué es el cambio climático?'
2025-08-16 17:55:48,425 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=634 status=OK request_id=b3f6673d-446c-4af2-97e6-7d27150bff16
2025-08-16 17:55:48,426 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and asks about climate change.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 17:55:48,426 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 17:55:48,426 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='¿Qué es el cambio climático?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and asks about climate change....'
2025-08-16 17:55:48,426 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 17:55:48,426 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 17:55:48,427 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 17:55:48,428 - src.models.climate_pipeline - INFO - Timing: rewrite=638.5ms
2025-08-16 17:55:48,428 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 17:55:48,428 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 17:55:48,428 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 17:55:48,428 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 17:55:48,428 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 17:55:48,428 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 17:55:50,857 - src.models.retrieval - INFO - dep=query_embed op=encode ms=2428 dense_dim=1024 sparse_tokens=5
2025-08-16 17:55:52,096 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=1236 status=OK
2025-08-16 17:55:52,096 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=1238 total_ms=1238
2025-08-16 17:55:52,581 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=484 status=OK
2025-08-16 17:55:52,582 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 17:55:52,582 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=485 total_ms=485
2025-08-16 17:55:52,586 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 17:55:52,587 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 17:55:52,856 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 17:55:52,859 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=271.6 status=OK
2025-08-16 17:55:52,862 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 17:55:52,862 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 17:55:52,862 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 17:55:52,862 - src.models.climate_pipeline - INFO - Timing: retrieval=4433.6ms
2025-08-16 17:55:52,862 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 17:55:52,862 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 17:55:52,862 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:52,873 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:52,873 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:52,874 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 17:55:52,874 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 17:55:52,874 - src.models.climate_pipeline - INFO - Timing: generation=12.1ms
2025-08-16 17:55:52,874 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 17:55:54,224 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1349 status=OK request_id=e3f40079-c597-40e9-a7c9-56755dcf1a19
2025-08-16 17:55:54,226 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 17:55:54,226 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 17:55:54,226 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 17:55:54,226 - src.models.climate_pipeline - INFO - Timing: faithfulness=1351.9ms
2025-08-16 17:55:54,226 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 17:55:58,563 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4336 status=OK request_id=8f7c3037-3436-4133-aee8-54dc56475424
2025-08-16 17:55:58,567 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 17:55:58,568 - src.models.climate_pipeline - INFO - Timing: translation=4341.5ms
2025-08-16 17:55:58,569 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:58,577 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:58,577 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:58,579 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 17:55:58,579 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 17:55:58,581 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=638.5 guards=0.0 retrieval=4433.6 generation=12.1 faithfulness=1351.9 translation=4341.5 total=11519.4
2025-08-16 17:55:58,581 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 11.52s
2025-08-16 17:55:58,582 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381347046 time=11.534s model=nova faithfulness=0.900
2025-08-16 17:55:58,584 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=11.537s id=req_1755381347046 ip=127.0.0.1
INFO:     127.0.0.1:50500 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:55:59,599 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381359596 query_len=11 lang=ja
2025-08-16 17:55:59,600 - src.webui.api.routers.chat - INFO - Language routing: detected=ja model=nova
2025-08-16 17:55:59,600 - src.models.climate_pipeline - INFO - Processing query: '気候変動とは何ですか？...' in japanese (code: ja)
2025-08-16 17:55:59,600 - src.models.climate_pipeline - INFO - Raw query repr: '気候変動とは何ですか？'
2025-08-16 17:55:59,600 - src.models.climate_pipeline - INFO - Router IN → language_name=japanese, language_code=ja
2025-08-16 17:55:59,600 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:55:59,601 - src.models.query_routing - INFO - Language: japanese (ja) → Model: Nova
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Router OUT → english_query='気候変動とは何ですか？'
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Router OUT → processed_query='気候変動とは何ですか？'
2025-08-16 17:55:59,601 - src.models.climate_pipeline - WARNING - Router language mismatch: query is in Chinese but Japanese was selected
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Proceeding despite router mismatch (soft warning only)
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:55:59,601 - src.models.query_routing - INFO - Language: japanese (ja) → Model: Nova
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='気候変動とは何ですか？'
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='気候変動とは何ですか？'
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Net debug → original_query len=11, utf8_bytes=33
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Net debug → english_query len=11, utf8_bytes=33
2025-08-16 17:55:59,601 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:55:59,601 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:55:59,603 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:55:59,603 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:55:59,604 - src.models.climate_pipeline - INFO - ✓ Cache hit for japanese - returning cached response
2025-08-16 17:55:59,605 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381359596 time=0.006s model=nova faithfulness=0.950
2025-08-16 17:55:59,606 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.010s id=req_1755381359596 ip=127.0.0.1
INFO:     127.0.0.1:50617 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:00,618 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381360616 query_len=24 lang=de
2025-08-16 17:56:00,618 - src.webui.api.routers.chat - INFO - Language routing: detected=de model=nova
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Processing query: 'Was ist der Klimawandel?...' in german (code: de)
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Raw query repr: 'Was ist der Klimawandel?'
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Router IN → language_name=german, language_code=de
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:00,618 - src.models.query_routing - INFO - Language: german (de) → Model: Nova
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Router OUT → english_query='Was ist der Klimawandel?'
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Was ist der Klimawandel?'
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:00,618 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:56:00,619 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:00,619 - src.models.query_routing - INFO - Language: german (de) → Model: Nova
2025-08-16 17:56:00,619 - src.models.query_routing - INFO - Translating query from german to English
2025-08-16 17:56:00,619 - src.models.query_routing - INFO - Router NET IN → query repr='Was ist der Klimawandel?'
2025-08-16 17:56:01,638 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1019 status=OK request_id=978b1473-5366-4e9c-ac34-ab0bbe1caaf1
2025-08-16 17:56:01,638 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:01,638 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is Climate Change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:01,638 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is Climate Change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:01,639 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is Climate Change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:01,639 - src.models.climate_pipeline - INFO - Net debug → original_query len=24, utf8_bytes=24
2025-08-16 17:56:01,639 - src.models.climate_pipeline - INFO - Net debug → english_query len=896, utf8_bytes=902
2025-08-16 17:56:01,639 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:01,639 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:01,640 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:01,640 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:01,641 - src.models.climate_pipeline - INFO - ✓ Cache hit for german - returning cached response
2025-08-16 17:56:01,641 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381360616 time=1.023s model=nova faithfulness=0.950
2025-08-16 17:56:01,642 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.026s id=req_1755381360616 ip=127.0.0.1
INFO:     127.0.0.1:50630 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:02,676 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381362669 query_len=26 lang=sv
2025-08-16 17:56:02,676 - src.webui.api.routers.chat - INFO - Language routing: detected=sv model=nova
2025-08-16 17:56:02,676 - src.models.climate_pipeline - INFO - Processing query: 'Vad är klimatförändringar?...' in swedish (code: sv)
2025-08-16 17:56:02,679 - src.models.climate_pipeline - INFO - Raw query repr: 'Vad är klimatförändringar?'
2025-08-16 17:56:02,697 - src.models.climate_pipeline - INFO - Router IN → language_name=swedish, language_code=sv
2025-08-16 17:56:02,697 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:02,697 - src.models.query_routing - INFO - Language: swedish (sv) → Model: Nova
2025-08-16 17:56:02,698 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:02,698 - src.models.climate_pipeline - INFO - Router OUT → english_query='Vad är klimatförändringar?'
2025-08-16 17:56:02,698 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Vad är klimatförändringar?'
2025-08-16 17:56:02,698 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:02,698 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:56:02,698 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:02,698 - src.models.query_routing - INFO - Language: swedish (sv) → Model: Nova
2025-08-16 17:56:02,698 - src.models.query_routing - INFO - Translating query from swedish to English
2025-08-16 17:56:02,698 - src.models.query_routing - INFO - Router NET IN → query repr='Vad är klimatförändringar?'
2025-08-16 17:56:03,680 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=978 status=OK request_id=0ac19a9a-e00f-45d4-804c-6adc6b1bdde5
2025-08-16 17:56:03,681 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:03,681 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What are climate changes?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate change exists naturally, the term is most often used today '
2025-08-16 17:56:03,681 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change exists naturally, the term is most often used today '
2025-08-16 17:56:03,681 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change exists naturally, the term is most often used today '
2025-08-16 17:56:03,681 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=29
2025-08-16 17:56:03,681 - src.models.climate_pipeline - INFO - Net debug → english_query len=779, utf8_bytes=779
2025-08-16 17:56:03,681 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:03,681 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:03,685 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:03,685 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:03,686 - src.models.climate_pipeline - INFO - ✓ Cache hit for swedish - returning cached response
2025-08-16 17:56:03,686 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381362669 time=1.010s model=nova faithfulness=0.950
2025-08-16 17:56:03,687 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.018s id=req_1755381362669 ip=127.0.0.1
INFO:     127.0.0.1:50650 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:04,696 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381364694 query_len=23 lang=da
2025-08-16 17:56:04,697 - src.webui.api.routers.chat - INFO - Language routing: detected=da model=nova
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Processing query: 'Hvad er klimaændringer?...' in danish (code: da)
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Raw query repr: 'Hvad er klimaændringer?'
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Router IN → language_name=danish, language_code=da
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:04,697 - src.models.query_routing - INFO - Language: danish (da) → Model: Nova
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hvad er klimaændringer?'
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hvad er klimaændringer?'
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:56:04,697 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:04,697 - src.models.query_routing - INFO - Language: danish (da) → Model: Nova
2025-08-16 17:56:04,697 - src.models.query_routing - INFO - Translating query from danish to English
2025-08-16 17:56:04,697 - src.models.query_routing - INFO - Router NET IN → query repr='Hvad er klimaændringer?'
2025-08-16 17:56:05,522 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=824 status=OK request_id=d9bb7a75-e1b6-4749-b6f9-0b579ce382eb
2025-08-16 17:56:05,522 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:05,522 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What are climate changes?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate change is a natural phenomenon, the term is often used to d'
2025-08-16 17:56:05,523 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change is a natural phenomenon, the term is often used to d'
2025-08-16 17:56:05,523 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change is a natural phenomenon, the term is often used to d'
2025-08-16 17:56:05,523 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=24
2025-08-16 17:56:05,523 - src.models.climate_pipeline - INFO - Net debug → english_query len=675, utf8_bytes=675
2025-08-16 17:56:05,523 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:05,523 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:05,525 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:05,525 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:05,526 - src.models.climate_pipeline - INFO - Cache miss for danish query
2025-08-16 17:56:05,535 - src.models.climate_pipeline - INFO - Timing: cache=12.6ms
2025-08-16 17:56:05,535 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 17:56:05,535 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 17:56:05,536 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=da, history_len=0
2025-08-16 17:56:05,536 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hvad er klimaændringer?'
2025-08-16 17:56:05,536 - query_rewriter - INFO - Rewriter NET IN → expected_lang=da, user_query repr='Hvad er klimaændringer?', norm='Hvad er klimaændringer?'
2025-08-16 17:56:06,134 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=598 status=OK request_id=c6faa13d-10a3-4b53-a7bb-ac0e53cea717
2025-08-16 17:56:06,138 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about climate change in Danish.","language":"da","expected_language":"da","language_match":true,"classification":"on-topic","rewrite_en":"What are climate changes?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 17:56:06,139 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 17:56:06,139 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hvad er klimaændringer?...' expected_lang=da detected_lang=da classification=on-topic language_match=True reason='User query is about climate change in Danish....'
2025-08-16 17:56:06,139 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='da', classification='on-topic', language_match='yes', canned=False
2025-08-16 17:56:06,139 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What are climate changes?'
2025-08-16 17:56:06,139 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 17:56:06,139 - src.models.climate_pipeline - INFO - Timing: rewrite=603.8ms
2025-08-16 17:56:06,139 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 17:56:06,139 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 17:56:06,140 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 17:56:06,140 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 17:56:06,140 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 17:56:06,140 - src.models.retrieval - INFO - Query embedding IN: query_len=25 chars, query_repr='What are climate changes?...'
2025-08-16 17:56:07,219 - src.models.retrieval - INFO - dep=query_embed op=encode ms=1079 dense_dim=1024 sparse_tokens=5
2025-08-16 17:56:07,260 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=39 status=OK
2025-08-16 17:56:07,260 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=40 total_ms=40
2025-08-16 17:56:07,420 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=159 status=OK
2025-08-16 17:56:07,420 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 17:56:07,420 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=159 total_ms=159
2025-08-16 17:56:07,422 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 17:56:07,423 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=9389 n_docs=7
2025-08-16 17:56:07,569 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 17:56:07,577 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=153.7 status=OK
2025-08-16 17:56:07,578 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.251038074, 'rerank_score': 0.9986904, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.228502974, 'rerank_score': 0.9981541, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.234236374, 'rerank_score': 0.99808073, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.234831899, 'rerank_score': 0.9956176, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.252884656, 'rerank_score': 0.99341017, 'has_values': True}]
2025-08-16 17:56:07,578 - src.models.retrieval - INFO - q='What are climate changes?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.253, p50_sim_pre=0.234, p95_sim_pre=0.253, blocked_base=0, dropped_top2=[{'segment_id': '18', 'title': 'Adapting To Climate Change A Risk Based Guide For Local Governments', 'score': 0.25423113}, {'segment_id': '386', 'title': "Canada's Changing Climate Report 2019", 'score': 0.25256836}]
2025-08-16 17:56:07,578 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 17:56:07,579 - src.models.climate_pipeline - INFO - Timing: retrieval=1439.0ms
2025-08-16 17:56:07,579 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 17:56:07,579 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 17:56:07,579 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:07,582 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:07,582 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:07,592 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 17:56:07,592 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 17:56:12,385 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4791 status=OK request_id=bdfafa67-5701-46ed-a7bc-3567569a1a8b
2025-08-16 17:56:12,393 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 17:56:12,393 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 17:56:12,394 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 17:56:12,394 - src.models.climate_pipeline - INFO - Timing: generation=4815.0ms
2025-08-16 17:56:12,394 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 17:56:14,711 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2316 status=OK request_id=562be18f-1ab3-47fe-80e2-444b927df84b
2025-08-16 17:56:14,712 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 17:56:14,712 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 17:56:14,712 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 17:56:14,712 - src.models.climate_pipeline - INFO - Timing: faithfulness=2318.8ms
2025-08-16 17:56:14,712 - src.models.climate_pipeline - INFO - Step 8: Translating response to danish (code=da)
2025-08-16 17:56:26,697 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=11984 status=OK request_id=95d80cb9-1d55-4455-beed-c8f8fdbc6353
2025-08-16 17:56:26,700 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to danish
2025-08-16 17:56:26,701 - src.models.climate_pipeline - INFO - Timing: translation=11988.1ms
2025-08-16 17:56:26,701 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:26,705 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:26,706 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:26,711 - src.models.climate_pipeline - INFO - ✓ Response cached in danish
2025-08-16 17:56:26,715 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 17:56:26,717 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=603.8 guards=0.0 retrieval=1439.0 generation=4815.0 faithfulness=2318.8 translation=11988.1 total=22003.7
2025-08-16 17:56:26,717 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 22.00s
2025-08-16 17:56:26,718 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381364694 time=22.022s model=nova faithfulness=0.950
2025-08-16 17:56:26,721 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=22.026s id=req_1755381364694 ip=127.0.0.1
INFO:     127.0.0.1:50672 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:27,756 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381387752 query_len=22 lang=no
2025-08-16 17:56:27,756 - src.webui.api.routers.chat - INFO - Language routing: detected=no model=nova
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Processing query: 'Hva er klimaendringer?...' in norwegian (code: no)
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Raw query repr: 'Hva er klimaendringer?'
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Router IN → language_name=norwegian, language_code=no
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:27,757 - src.models.query_routing - INFO - Language: norwegian (no) → Model: Nova
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hva er klimaendringer?'
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hva er klimaendringer?'
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 17:56:27,757 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:27,757 - src.models.query_routing - INFO - Language: norwegian (no) → Model: Nova
2025-08-16 17:56:27,757 - src.models.query_routing - INFO - Translating query from norwegian to English
2025-08-16 17:56:27,757 - src.models.query_routing - INFO - Router NET IN → query repr='Hva er klimaendringer?'
2025-08-16 17:56:28,772 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1014 status=OK request_id=99125aad-5343-4b13-819a-168f61086bc0
2025-08-16 17:56:28,772 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:28,773 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What are climate changes?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate chan'
2025-08-16 17:56:28,773 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate chan'
2025-08-16 17:56:28,773 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are climate changes?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability is a natural phenomenon, the term "climate chan'
2025-08-16 17:56:28,773 - src.models.climate_pipeline - INFO - Net debug → original_query len=22, utf8_bytes=22
2025-08-16 17:56:28,773 - src.models.climate_pipeline - INFO - Net debug → english_query len=644, utf8_bytes=644
2025-08-16 17:56:28,773 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:28,773 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:28,775 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:28,775 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:28,778 - src.models.climate_pipeline - INFO - ✓ Cache hit for norwegian - returning cached response
2025-08-16 17:56:28,778 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381387752 time=1.022s model=nova faithfulness=0.950
2025-08-16 17:56:28,778 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.026s id=req_1755381387752 ip=127.0.0.1
INFO:     127.0.0.1:50895 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:29,787 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381389786 query_len=23 lang=fi
2025-08-16 17:56:29,787 - src.webui.api.routers.chat - INFO - Language routing: detected=fi model=nova
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Processing query: 'Mitä on ilmastonmuutos?...' in finnish (code: fi)
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Raw query repr: 'Mitä on ilmastonmuutos?'
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Router IN → language_name=finnish, language_code=fi
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:29,787 - src.models.query_routing - INFO - Language: finnish (fi) → Model: Nova
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Router OUT → english_query='Mitä on ilmastonmuutos?'
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Mitä on ilmastonmuutos?'
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:56:29,787 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:29,787 - src.models.query_routing - INFO - Language: finnish (fi) → Model: Nova
2025-08-16 17:56:29,787 - src.models.query_routing - INFO - Translating query from finnish to English
2025-08-16 17:56:29,787 - src.models.query_routing - INFO - Router NET IN → query repr='Mitä on ilmastonmuutos?'
2025-08-16 17:56:30,568 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=781 status=OK request_id=2cef8d75-b556-45ac-b7ef-e4dcf9d6698f
2025-08-16 17:56:30,569 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:30,569 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has existed throughout Earth's history, the term "
2025-08-16 17:56:30,569 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has existed throughout Earth's history, the term '
2025-08-16 17:56:30,569 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has existed throughout Earth's history, the term '
2025-08-16 17:56:30,569 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=24
2025-08-16 17:56:30,569 - src.models.climate_pipeline - INFO - Net debug → english_query len=681, utf8_bytes=681
2025-08-16 17:56:30,569 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:30,569 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:30,571 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:30,572 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:30,574 - src.models.climate_pipeline - INFO - ✓ Cache hit for finnish - returning cached response
2025-08-16 17:56:30,574 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381389786 time=0.787s model=nova faithfulness=0.900
2025-08-16 17:56:30,575 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.789s id=req_1755381389786 ip=127.0.0.1
INFO:     127.0.0.1:50914 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:31,589 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381391587 query_len=31 lang=it
2025-08-16 17:56:31,590 - src.webui.api.routers.chat - INFO - Language routing: detected=it model=nova
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Processing query: 'Cos'è il cambiamento climatico?...' in italian (code: it)
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Raw query repr: "Cos'è il cambiamento climatico?"
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Router IN → language_name=italian, language_code=it
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:31,590 - src.models.query_routing - INFO - Language: italian (it) → Model: Nova
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Router OUT → english_query='Cos'è il cambiamento climatico?'
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Cos'è il cambiamento climatico?'
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:56:31,590 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:31,590 - src.models.query_routing - INFO - Language: italian (it) → Model: Nova
2025-08-16 17:56:31,590 - src.models.query_routing - INFO - Translating query from italian to English
2025-08-16 17:56:31,590 - src.models.query_routing - INFO - Router NET IN → query repr="Cos'è il cambiamento climatico?"
2025-08-16 17:56:32,341 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=750 status=OK request_id=8a14a93d-4a7a-41e6-a0d2-57c720768229
2025-08-16 17:56:32,341 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:32,341 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:32,342 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:32,342 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:32,342 - src.models.climate_pipeline - INFO - Net debug → original_query len=31, utf8_bytes=32
2025-08-16 17:56:32,342 - src.models.climate_pipeline - INFO - Net debug → english_query len=665, utf8_bytes=665
2025-08-16 17:56:32,342 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:32,342 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:32,344 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:32,344 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:32,346 - src.models.climate_pipeline - INFO - ✓ Cache hit for italian - returning cached response
2025-08-16 17:56:32,346 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381391587 time=0.757s model=nova faithfulness=0.950
2025-08-16 17:56:32,347 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.760s id=req_1755381391587 ip=127.0.0.1
INFO:     127.0.0.1:50933 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:33,356 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381393354 query_len=26 lang=pt
2025-08-16 17:56:33,356 - src.webui.api.routers.chat - INFO - Language routing: detected=pt model=nova
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - Processing query: 'O que é mudança climática?...' in portuguese (code: pt)
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - Raw query repr: 'O que é mudança climática?'
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - Router IN → language_name=portuguese, language_code=pt
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:33,356 - src.models.query_routing - INFO - Language: portuguese (pt) → Model: Nova
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - Router OUT → english_query='O que é mudança climática?'
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - Router OUT → processed_query='O que é mudança climática?'
2025-08-16 17:56:33,356 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:33,357 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:56:33,357 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:33,357 - src.models.query_routing - INFO - Language: portuguese (pt) → Model: Nova
2025-08-16 17:56:33,357 - src.models.query_routing - INFO - Translating query from portuguese to English
2025-08-16 17:56:33,357 - src.models.query_routing - INFO - Router NET IN → query repr='O que é mudança climática?'
2025-08-16 17:56:34,098 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=740 status=OK request_id=adacb29a-f8f1-4eed-ab02-506b837df066
2025-08-16 17:56:34,098 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:34,098 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. Long-term shifts in temperature and weather patterns are primarily driven b'
2025-08-16 17:56:34,098 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. Long-term shifts in temperature and weather patterns are primarily driven b'
2025-08-16 17:56:34,098 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. Long-term shifts in temperature and weather patterns are primarily driven b'
2025-08-16 17:56:34,098 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=29
2025-08-16 17:56:34,098 - src.models.climate_pipeline - INFO - Net debug → english_query len=688, utf8_bytes=692
2025-08-16 17:56:34,098 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:34,099 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:34,102 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:34,102 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:34,102 - src.models.climate_pipeline - INFO - Cache miss for portuguese query
2025-08-16 17:56:34,103 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:34,104 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:34,104 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:34,105 - src.models.climate_pipeline - INFO - ✓ Cache hit via fuzzy match (score=0.97)
2025-08-16 17:56:34,106 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381393354 time=0.750s model=nova faithfulness=0.950
2025-08-16 17:56:34,106 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.752s id=req_1755381393354 ip=127.0.0.1
INFO:     127.0.0.1:50952 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:35,125 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381395119 query_len=19 lang=hu
2025-08-16 17:56:35,125 - src.webui.api.routers.chat - INFO - Language routing: detected=hu model=nova
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Processing query: 'Mi a klímaváltozás?...' in hungarian (code: hu)
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Raw query repr: 'Mi a klímaváltozás?'
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Router IN → language_name=hungarian, language_code=hu
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:35,126 - src.models.query_routing - INFO - Language: hungarian (hu) → Model: Nova
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Router OUT → english_query='Mi a klímaváltozás?'
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Mi a klímaváltozás?'
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:56:35,126 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:35,126 - src.models.query_routing - INFO - Language: hungarian (hu) → Model: Nova
2025-08-16 17:56:35,126 - src.models.query_routing - INFO - Translating query from hungarian to English
2025-08-16 17:56:35,126 - src.models.query_routing - INFO - Router NET IN → query repr='Mi a klímaváltozás?'
2025-08-16 17:56:35,323 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=196 status=OK request_id=3a08ee34-a084-4162-8afb-1439bf6f4edc
2025-08-16 17:56:35,328 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:35,328 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:56:35,328 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:56:35,328 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:56:35,328 - src.models.climate_pipeline - INFO - Net debug → original_query len=19, utf8_bytes=22
2025-08-16 17:56:35,328 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:56:35,328 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:35,329 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:35,342 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:35,342 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:35,343 - src.models.climate_pipeline - INFO - ✓ Cache hit for hungarian - returning cached response
2025-08-16 17:56:35,344 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381395119 time=0.219s model=nova faithfulness=0.950
2025-08-16 17:56:35,344 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.225s id=req_1755381395119 ip=127.0.0.1
INFO:     127.0.0.1:50968 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:36,351 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381396350 query_len=18 lang=sk
2025-08-16 17:56:36,351 - src.webui.api.routers.chat - INFO - Language routing: detected=sk model=nova
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Processing query: 'Čo je zmena klímy?...' in slovak (code: sk)
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Raw query repr: 'Čo je zmena klímy?'
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Router IN → language_name=slovak, language_code=sk
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:36,351 - src.models.query_routing - INFO - Language: slovak (sk) → Model: Nova
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Router OUT → english_query='Čo je zmena klímy?'
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Čo je zmena klímy?'
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:56:36,351 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:36,351 - src.models.query_routing - INFO - Language: slovak (sk) → Model: Nova
2025-08-16 17:56:36,351 - src.models.query_routing - INFO - Translating query from slovak to English
2025-08-16 17:56:36,351 - src.models.query_routing - INFO - Router NET IN → query repr='Čo je zmena klímy?'
2025-08-16 17:56:36,547 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=195 status=OK request_id=1447b257-620e-4093-9757-e68e0b16b448
2025-08-16 17:56:36,547 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:36,547 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 17:56:36,547 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 17:56:36,547 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 17:56:36,547 - src.models.climate_pipeline - INFO - Net debug → original_query len=18, utf8_bytes=20
2025-08-16 17:56:36,547 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 17:56:36,547 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:36,547 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:36,550 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:36,550 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:36,553 - src.models.climate_pipeline - INFO - ✓ Cache hit for slovak - returning cached response
2025-08-16 17:56:36,553 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381396350 time=0.203s model=nova faithfulness=0.950
2025-08-16 17:56:36,554 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.204s id=req_1755381396350 ip=127.0.0.1
INFO:     127.0.0.1:50983 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:37,564 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381397562 query_len=26 lang=sl
2025-08-16 17:56:37,564 - src.webui.api.routers.chat - INFO - Language routing: detected=sl model=nova
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Processing query: 'Kaj je podnebna sprememba?...' in slovenian (code: sl)
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Raw query repr: 'Kaj je podnebna sprememba?'
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Router IN → language_name=slovenian, language_code=sl
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:37,564 - src.models.query_routing - INFO - Language: slovenian (sl) → Model: Nova
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Router OUT → english_query='Kaj je podnebna sprememba?'
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Kaj je podnebna sprememba?'
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 17:56:37,564 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:37,564 - src.models.query_routing - INFO - Language: slovenian (sl) → Model: Nova
2025-08-16 17:56:37,564 - src.models.query_routing - INFO - Translating query from slovenian to English
2025-08-16 17:56:37,564 - src.models.query_routing - INFO - Router NET IN → query repr='Kaj je podnebna sprememba?'
2025-08-16 17:56:38,390 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=825 status=OK request_id=88c5eb27-9845-44bb-8d01-3a3234f334a6
2025-08-16 17:56:38,391 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:38,391 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate change poses a natural phenomenon, the term is often used tod'
2025-08-16 17:56:38,391 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change poses a natural phenomenon, the term is often used tod'
2025-08-16 17:56:38,391 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate change poses a natural phenomenon, the term is often used tod'
2025-08-16 17:56:38,391 - src.models.climate_pipeline - INFO - Net debug → original_query len=26, utf8_bytes=26
2025-08-16 17:56:38,391 - src.models.climate_pipeline - INFO - Net debug → english_query len=494, utf8_bytes=494
2025-08-16 17:56:38,391 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:38,391 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:38,393 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:38,393 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:38,393 - src.models.climate_pipeline - INFO - Cache miss for slovenian query
2025-08-16 17:56:38,395 - src.models.climate_pipeline - INFO - Timing: cache=4.2ms
2025-08-16 17:56:38,395 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 17:56:38,395 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 17:56:38,396 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=sl, history_len=0
2025-08-16 17:56:38,396 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Kaj je podnebna sprememba?'
2025-08-16 17:56:38,396 - query_rewriter - INFO - Rewriter NET IN → expected_lang=sl, user_query repr='Kaj je podnebna sprememba?', norm='Kaj je podnebna sprememba?'
2025-08-16 17:56:39,212 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=815 status=OK request_id=7600dacc-271e-4a59-80b0-70e61a2c3760
2025-08-16 17:56:39,212 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Slovenian and asks about climate change.","language":"sl","expected_language":"sl","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 17:56:39,212 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 17:56:39,212 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Kaj je podnebna sprememba?...' expected_lang=sl detected_lang=sl classification=on-topic language_match=True reason='User query is in Slovenian and asks about climate change....'
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='sl', classification='on-topic', language_match='yes', canned=False
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - Timing: rewrite=816.9ms
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 17:56:39,212 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 17:56:39,213 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 17:56:39,213 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 17:56:39,858 - src.models.retrieval - INFO - dep=query_embed op=encode ms=645 dense_dim=1024 sparse_tokens=5
2025-08-16 17:56:39,902 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=43 status=OK
2025-08-16 17:56:39,902 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=43 total_ms=43
2025-08-16 17:56:40,020 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=117 status=OK
2025-08-16 17:56:40,020 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 17:56:40,020 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=118 total_ms=118
2025-08-16 17:56:40,022 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 17:56:40,023 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 17:56:40,163 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 17:56:40,168 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=144.5 status=OK
2025-08-16 17:56:40,170 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 17:56:40,171 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 17:56:40,171 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 17:56:40,171 - src.models.climate_pipeline - INFO - Timing: retrieval=958.4ms
2025-08-16 17:56:40,171 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 17:56:40,171 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 17:56:40,171 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:40,174 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:40,174 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:40,175 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 17:56:40,175 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 17:56:40,175 - src.models.climate_pipeline - INFO - Timing: generation=3.8ms
2025-08-16 17:56:40,175 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 17:56:41,261 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1085 status=OK request_id=e92ec0b5-71bf-4b56-ae0c-1539f837b00b
2025-08-16 17:56:41,261 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 17:56:41,262 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 17:56:41,262 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 17:56:41,262 - src.models.climate_pipeline - INFO - Timing: faithfulness=1087.0ms
2025-08-16 17:56:41,262 - src.models.climate_pipeline - INFO - Step 8: Translating response to slovenian (code=sl)
2025-08-16 17:56:52,076 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=10813 status=OK request_id=8f849b61-90a2-491a-be09-9c1c8d6bcb09
2025-08-16 17:56:52,092 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to slovenian
2025-08-16 17:56:52,092 - src.models.climate_pipeline - INFO - Timing: translation=10830.2ms
2025-08-16 17:56:52,095 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:52,107 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:52,107 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:52,109 - src.models.climate_pipeline - INFO - ✓ Response cached in slovenian
2025-08-16 17:56:52,110 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 17:56:52,111 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=816.9 guards=0.0 retrieval=958.4 generation=3.8 faithfulness=1087.0 translation=10830.2 total=14528.1
2025-08-16 17:56:52,111 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 14.53s
2025-08-16 17:56:52,115 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381397562 time=14.552s model=nova faithfulness=0.900
2025-08-16 17:56:52,117 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=14.555s id=req_1755381397562 ip=127.0.0.1
INFO:     127.0.0.1:50998 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:53,152 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381413148 query_len=31 lang=bg
2025-08-16 17:56:53,152 - src.webui.api.routers.chat - INFO - Language routing: detected=bg model=nova
2025-08-16 17:56:53,153 - src.models.climate_pipeline - INFO - Processing query: 'Какво е изменението на климата?...' in bulgarian (code: bg)
2025-08-16 17:56:53,153 - src.models.climate_pipeline - INFO - Raw query repr: 'Какво е изменението на климата?'
2025-08-16 17:56:53,153 - src.models.climate_pipeline - INFO - Router IN → language_name=bulgarian, language_code=bg
2025-08-16 17:56:53,153 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:53,153 - src.models.query_routing - INFO - Language: bulgarian (bg) → Model: Nova
2025-08-16 17:56:53,153 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:53,153 - src.models.climate_pipeline - INFO - Router OUT → english_query='Какво е изменението на климата?'
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Какво е изменението на климата?'
2025-08-16 17:56:53,154 - src.models.climate_pipeline - WARNING - Router language mismatch: query is in Russian but Bulgarian was selected
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Proceeding despite router mismatch (soft warning only)
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Timing: routing=0.8ms
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:53,154 - src.models.query_routing - INFO - Language: bulgarian (bg) → Model: Nova
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Какво е изменението на климата?'
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Какво е изменението на климата?'
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Net debug → original_query len=31, utf8_bytes=57
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Net debug → english_query len=31, utf8_bytes=57
2025-08-16 17:56:53,154 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:53,154 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:53,174 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:53,177 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:53,201 - src.models.climate_pipeline - INFO - ✓ Cache hit for bulgarian - returning cached response
2025-08-16 17:56:53,202 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381413148 time=0.051s model=nova faithfulness=0.950
2025-08-16 17:56:53,204 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.057s id=req_1755381413148 ip=127.0.0.1
INFO:     127.0.0.1:51134 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 17:56:54,214 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755381414212 query_len=22 lang=hr
2025-08-16 17:56:54,214 - src.webui.api.routers.chat - INFO - Language routing: detected=hr model=nova
2025-08-16 17:56:54,214 - src.models.climate_pipeline - INFO - Processing query: 'Što je promjena klime?...' in croatian (code: hr)
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Raw query repr: 'Što je promjena klime?'
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Router IN → language_name=croatian, language_code=hr
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 17:56:54,215 - src.models.query_routing - INFO - Language: croatian (hr) → Model: Nova
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Router OUT → english_query='Što je promjena klime?'
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Što je promjena klime?'
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 17:56:54,215 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 17:56:54,215 - src.models.query_routing - INFO - Language: croatian (hr) → Model: Nova
2025-08-16 17:56:54,215 - src.models.query_routing - INFO - Translating query from croatian to English
2025-08-16 17:56:54,215 - src.models.query_routing - INFO - Router NET IN → query repr='Što je promjena klime?'
2025-08-16 17:56:54,820 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=605 status=OK request_id=a712c34a-e638-4631-9ee9-58dcd5f1d24d
2025-08-16 17:56:54,827 - src.models.query_routing - INFO - Translation successful
2025-08-16 17:56:54,828 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:54,828 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:54,828 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. These changes can occur naturally, but the term is most often used to descr'
2025-08-16 17:56:54,828 - src.models.climate_pipeline - INFO - Net debug → original_query len=22, utf8_bytes=23
2025-08-16 17:56:54,828 - src.models.climate_pipeline - INFO - Net debug → english_query len=528, utf8_bytes=528
2025-08-16 17:56:54,828 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 17:56:54,828 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:54,875 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:54,875 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:54,876 - src.models.climate_pipeline - INFO - Cache miss for croatian query
2025-08-16 17:56:54,881 - src.models.climate_pipeline - INFO - Timing: cache=53.4ms
2025-08-16 17:56:54,881 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 17:56:54,881 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 17:56:54,881 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=hr, history_len=0
2025-08-16 17:56:54,881 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Što je promjena klime?'
2025-08-16 17:56:54,882 - query_rewriter - INFO - Rewriter NET IN → expected_lang=hr, user_query repr='Što je promjena klime?', norm='Što je promjena klime?'
2025-08-16 17:56:55,458 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=576 status=OK request_id=c458b038-ba71-4710-ad08-2b7cbd8ffa9e
2025-08-16 17:56:55,459 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Croatian and asks about climate change.","language":"hr","expected_language":"hr","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 17:56:55,459 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 17:56:55,459 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Što je promjena klime?...' expected_lang=hr detected_lang=hr classification=on-topic language_match=True reason='User query is in Croatian and asks about climate change....'
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='hr', classification='on-topic', language_match='yes', canned=False
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - Timing: rewrite=578.4ms
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 17:56:55,460 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 17:56:55,460 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 17:56:55,460 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 17:56:56,234 - src.models.retrieval - INFO - dep=query_embed op=encode ms=773 dense_dim=1024 sparse_tokens=5
2025-08-16 17:56:56,285 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=50 status=OK
2025-08-16 17:56:56,285 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=50 total_ms=50
2025-08-16 17:56:56,451 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=165 status=OK
2025-08-16 17:56:56,451 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 17:56:56,451 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=165 total_ms=165
2025-08-16 17:56:56,453 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 17:56:56,454 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 17:56:56,629 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 17:56:56,635 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=180.9 status=OK
2025-08-16 17:56:56,637 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 17:56:56,637 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 17:56:56,637 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 17:56:56,637 - src.models.climate_pipeline - INFO - Timing: retrieval=1177.1ms
2025-08-16 17:56:56,637 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 17:56:56,637 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 17:56:56,637 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:56:56,641 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:56:56,641 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:56:56,641 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 17:56:56,641 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 17:56:56,641 - src.models.climate_pipeline - INFO - Timing: generation=4.5ms
2025-08-16 17:56:56,642 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 17:56:57,792 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1148 status=OK request_id=4a0b89d9-32e2-44ac-83fb-08373650f70c
2025-08-16 17:56:57,825 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 17:56:57,836 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 17:56:57,836 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 17:56:57,836 - src.models.climate_pipeline - INFO - Timing: faithfulness=1194.1ms
2025-08-16 17:56:57,836 - src.models.climate_pipeline - INFO - Step 8: Translating response to croatian (code=hr)
2025-08-16 17:57:09,996 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=12157 status=OK request_id=ce3d3ad4-0d44-4739-b964-a6f1e72cee41
2025-08-16 17:57:09,999 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to croatian
2025-08-16 17:57:10,000 - src.models.climate_pipeline - INFO - Timing: translation=12163.7ms
2025-08-16 17:57:10,000 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 17:57:10,004 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 17:57:10,004 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 17:57:10,009 - src.models.climate_pipeline - INFO - ✓ Response cached in croatian
2025-08-16 17:57:10,021 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 17:57:10,023 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=578.4 guards=0.0 retrieval=1177.1 generation=4.5 faithfulness=1194.1 translation=12163.7 total=15785.3
2025-08-16 17:57:10,023 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 15.79s
2025-08-16 17:57:10,025 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755381414212 time=15.810s model=nova faithfulness=0.900
2025-08-16 17:57:10,026 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=15.814s id=req_1755381414212 ip=127.0.0.1
INFO:     127.0.0.1:51146 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:08:59,534 - src.webui.api.main - INFO - REQUEST GET /api/health status=404 time=0.012s id=req_1755382139521 ip=127.0.0.1
INFO:     127.0.0.1:57866 - "GET /api/health HTTP/1.1" 404 Not Found
2025-08-16 18:09:03,095 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.004s id=req_1755382143091 ip=127.0.0.1
INFO:     127.0.0.1:57919 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:09:06,926 - src.webui.api.main - INFO - REQUEST GET /api/v1/chat/test status=200 time=0.001s id=req_1755382146925 ip=127.0.0.1
INFO:     127.0.0.1:57956 - "GET /api/v1/chat/test HTTP/1.1" 200 OK
2025-08-16 18:10:16,696 - src.webui.api.routers.languages - INFO - Returning language support: command_a=22 nova=10
2025-08-16 18:10:16,704 - src.webui.api.main - INFO - REQUEST GET /api/v1/languages/supported status=200 time=0.029s id=req_1755382216675 ip=127.0.0.1
INFO:     127.0.0.1:58643 - "GET /api/v1/languages/supported HTTP/1.1" 200 OK
2025-08-16 18:10:16,710 - src.webui.api.main - INFO - REQUEST GET /api/v1/chat/test status=200 time=0.001s id=req_1755382216709 ip=127.0.0.1
INFO:     127.0.0.1:58645 - "GET /api/v1/chat/test HTTP/1.1" 200 OK
2025-08-16 18:10:17,731 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382217721 query_len=23 lang=en
2025-08-16 18:10:17,733 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:10:17,739 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:10:17,739 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:10:17,739 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:10:17,740 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:10:17,741 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - Timing: routing=2.5ms
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:10:17,742 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:10:17,743 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:17,764 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:17,764 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:17,768 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:10:17,769 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382217721 time=0.040s model=nova faithfulness=0.950
2025-08-16 18:10:17,771 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.050s id=req_1755382217721 ip=127.0.0.1
INFO:     127.0.0.1:58655 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:10:18,801 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382218798 query_len=23 lang=en
2025-08-16 18:10:18,801 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:10:18,802 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:10:18,803 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:10:18,803 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:10:18,803 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:10:18,803 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - Timing: routing=1.3ms
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:10:18,804 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:10:18,804 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:18,822 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:18,822 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:18,831 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:10:18,831 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382218798 time=0.031s model=nova faithfulness=0.950
2025-08-16 18:10:18,832 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.034s id=req_1755382218798 ip=127.0.0.1
INFO:     127.0.0.1:58670 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:10:19,806 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382219783 query_len=28 lang=es
2025-08-16 18:10:19,811 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 18:10:19,813 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 18:10:19,814 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 18:10:19,815 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 18:10:19,815 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:10:19,816 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:10:19,817 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 18:10:19,817 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 18:10:19,817 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 18:10:19,817 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:10:19,817 - src.models.climate_pipeline - INFO - Timing: routing=2.2ms
2025-08-16 18:10:19,817 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 18:10:19,817 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:10:19,818 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 18:10:19,818 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 18:10:20,727 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=908 status=OK request_id=262cc644-2819-4fb7-b149-0a82763bb7e4
2025-08-16 18:10:20,728 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:10:20,728 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history"
2025-08-16 18:10:20,728 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 18:10:20,728 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 18:10:20,728 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 18:10:20,728 - src.models.climate_pipeline - INFO - Net debug → english_query len=635, utf8_bytes=635
2025-08-16 18:10:20,728 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:10:20,730 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:20,732 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:20,732 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:20,732 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 18:10:20,735 - src.models.climate_pipeline - INFO - Timing: cache=6.9ms
2025-08-16 18:10:20,735 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:10:20,736 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:10:20,736 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 18:10:20,736 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='¿Qué es el cambio climático?'
2025-08-16 18:10:20,737 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='¿Qué es el cambio climático?', norm='¿Qué es el cambio climático?'
2025-08-16 18:10:21,501 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=763 status=OK request_id=baa09a7b-3472-460e-8f7f-c6da4c4578cd
2025-08-16 18:10:21,501 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and asks about climate change.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:10:21,501 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:10:21,501 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='¿Qué es el cambio climático?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and asks about climate change....'
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - Timing: rewrite=766.4ms
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:10:21,502 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:10:21,502 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:10:21,502 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 18:10:26,132 - src.models.retrieval - INFO - dep=query_embed op=encode ms=4629 dense_dim=1024 sparse_tokens=5
2025-08-16 18:10:26,609 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=473 status=OK
2025-08-16 18:10:26,609 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=474 total_ms=474
2025-08-16 18:10:26,898 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=287 status=OK
2025-08-16 18:10:26,898 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:10:26,898 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=288 total_ms=288
2025-08-16 18:10:26,901 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:10:26,902 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 18:10:27,193 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:10:27,199 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=296.5 status=OK
2025-08-16 18:10:27,205 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 18:10:27,205 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 18:10:27,205 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:10:27,205 - src.models.climate_pipeline - INFO - Timing: retrieval=5703.3ms
2025-08-16 18:10:27,206 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:10:27,206 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:10:27,206 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:27,208 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:27,208 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:27,213 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 18:10:27,213 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:10:27,213 - src.models.climate_pipeline - INFO - Timing: generation=7.7ms
2025-08-16 18:10:27,213 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:10:28,275 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1060 status=OK request_id=4ff1a6ad-4dd1-41df-a99f-6ae2ef0763f5
2025-08-16 18:10:28,276 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 18:10:28,276 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 18:10:28,276 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:10:28,276 - src.models.climate_pipeline - INFO - Timing: faithfulness=1062.8ms
2025-08-16 18:10:28,276 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 18:10:32,504 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4227 status=OK request_id=010728b4-e1ac-4f91-ae17-9b25e8742fcc
2025-08-16 18:10:32,504 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 18:10:32,504 - src.models.climate_pipeline - INFO - Timing: translation=4228.1ms
2025-08-16 18:10:32,505 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:32,508 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:32,508 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:32,510 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 18:10:32,511 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 18:10:32,513 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=2.2 rewrite=766.4 guards=0.0 retrieval=5703.3 generation=7.7 faithfulness=1062.8 translation=4228.1 total=12691.0
2025-08-16 18:10:32,513 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 12.69s
2025-08-16 18:10:32,514 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382219783 time=12.708s model=nova faithfulness=0.900
2025-08-16 18:10:32,515 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=12.732s id=req_1755382219783 ip=127.0.0.1
INFO:     127.0.0.1:58677 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:10:33,023 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382233022 query_len=39 lang=fr
2025-08-16 18:10:33,023 - src.webui.api.routers.chat - INFO - Language routing: detected=fr model=command_a
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Processing query: 'Qu'est-ce que le changement climatique?...' in french (code: fr)
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Raw query repr: "Qu'est-ce que le changement climatique?"
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Router IN → language_name=french, language_code=fr
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:10:33,024 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Router OUT → english_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:10:33,024 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 18:10:33,024 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:10:33,024 - src.models.query_routing - INFO - Translating query from french to English
2025-08-16 18:10:33,024 - src.models.query_routing - INFO - Router NET IN → query repr="Qu'est-ce que le changement climatique?"
2025-08-16 18:10:33,339 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 18:10:33,345 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:10:33,345 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 18:10:33,345 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 18:10:33,345 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 18:10:33,345 - src.models.climate_pipeline - INFO - Net debug → original_query len=39, utf8_bytes=39
2025-08-16 18:10:33,345 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:10:33,345 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:10:33,345 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:33,347 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:33,347 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:33,347 - src.models.climate_pipeline - INFO - Cache miss for french query
2025-08-16 18:10:33,347 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:33,349 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:33,349 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:33,349 - src.models.climate_pipeline - INFO - Timing: cache=3.9ms
2025-08-16 18:10:33,349 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:10:33,349 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:10:33,349 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=fr, history_len=0
2025-08-16 18:10:33,349 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:10:33,349 - query_rewriter - INFO - Rewriter NET IN → expected_lang=fr, user_query repr="Qu'est-ce que le changement climatique?", norm="Qu'est-ce que le changement climatique?"
2025-08-16 18:10:33,940 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=590 status=OK request_id=1c502f9c-89e1-4f4c-b418-13bf5c80320e
2025-08-16 18:10:33,940 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in French and asks about climate change.","language":"fr","expected_language":"fr","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:10:33,940 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:10:33,940 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Qu'est-ce que le changement climatique?...' expected_lang=fr detected_lang=fr classification=on-topic language_match=True reason='User query is in French and asks about climate change....'
2025-08-16 18:10:33,940 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='fr', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:10:33,940 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 18:10:33,940 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:10:33,940 - src.models.climate_pipeline - INFO - Timing: rewrite=591.5ms
2025-08-16 18:10:33,940 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:10:33,940 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:10:33,941 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:10:33,941 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:10:33,941 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:10:33,941 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 18:10:34,645 - src.models.retrieval - INFO - dep=query_embed op=encode ms=704 dense_dim=1024 sparse_tokens=5
2025-08-16 18:10:34,720 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=74 status=OK
2025-08-16 18:10:34,720 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=74 total_ms=74
2025-08-16 18:10:34,908 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=187 status=OK
2025-08-16 18:10:34,908 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:10:34,908 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=187 total_ms=187
2025-08-16 18:10:34,910 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:10:34,911 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 18:10:35,117 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:10:35,121 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=210.1 status=OK
2025-08-16 18:10:35,122 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 18:10:35,122 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 18:10:35,122 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:10:35,122 - src.models.climate_pipeline - INFO - Timing: retrieval=1181.6ms
2025-08-16 18:10:35,122 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Command-A)
2025-08-16 18:10:35,122 - src.models.gen_response_unified - INFO - Starting cohere response generation
2025-08-16 18:10:35,123 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:35,141 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:35,141 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:35,153 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:10:35,153 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for cohere
2025-08-16 18:10:40,266 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 18:10:40,291 - src.models.gen_response_unified - INFO - cohere response cached successfully
2025-08-16 18:10:40,292 - src.models.gen_response_unified - INFO - cohere response generation complete
2025-08-16 18:10:40,292 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:10:40,292 - src.models.climate_pipeline - INFO - Timing: generation=5169.7ms
2025-08-16 18:10:40,292 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:10:42,031 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1737 status=OK request_id=968917ee-ac0f-48df-a53c-6a73de88b78a
2025-08-16 18:10:42,032 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:10:42,032 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:10:42,032 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:10:42,032 - src.models.climate_pipeline - INFO - Timing: faithfulness=1740.2ms
2025-08-16 18:10:42,032 - src.models.climate_pipeline - INFO - Step 8: Translating response to french (code=fr)
2025-08-16 18:10:46,183 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4150 status=OK request_id=6f6bf50d-3171-450b-a4a9-1426dc614b02
2025-08-16 18:10:46,184 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to french
2025-08-16 18:10:46,184 - src.models.climate_pipeline - INFO - Timing: translation=4152.0ms
2025-08-16 18:10:46,184 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:46,191 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:46,191 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:46,193 - src.models.climate_pipeline - INFO - ✓ Response cached in french
2025-08-16 18:10:46,195 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 18:10:46,196 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=591.5 guards=0.0 retrieval=1181.6 generation=5169.7 faithfulness=1740.2 translation=4152.0 total=13160.7
2025-08-16 18:10:46,196 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 13.16s
2025-08-16 18:10:46,196 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382233022 time=13.173s model=command_a faithfulness=0.950
2025-08-16 18:10:46,197 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=13.175s id=req_1755382233022 ip=127.0.0.1
INFO:     127.0.0.1:58798 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:10:47,722 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.005s id=req_1755382247717 ip=127.0.0.1
INFO:     127.0.0.1:58933 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:10:47,726 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382247725 query_len=4 lang=invalid
2025-08-16 18:10:47,727 - src.webui.api.routers.chat - INFO - Language routing: detected=invalid model=nova
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Processing query: 'Test...' in english (code: en)
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Raw query repr: 'Test'
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:10:47,727 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test'
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test'
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Net debug → original_query len=4, utf8_bytes=4
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Net debug → english_query len=4, utf8_bytes=4
2025-08-16 18:10:47,727 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:10:47,728 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:10:47,729 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:10:47,729 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:10:47,729 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:10:47,730 - src.models.climate_pipeline - INFO - Timing: cache=2.5ms
2025-08-16 18:10:47,730 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:10:47,730 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:10:47,730 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:10:47,730 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test'
2025-08-16 18:10:47,730 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test', norm='Test'
2025-08-16 18:10:48,340 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=609 status=OK request_id=01202690-97bc-457f-9a96-da77816b2da7
2025-08-16 18:10:48,340 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a single word and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:10:48,340 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:10:48,341 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a single word and matches the expected language....'
2025-08-16 18:10:48,341 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:10:48,341 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:10:48,342 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382247725 error=Pipeline processing failed
2025-08-16 18:10:48,342 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382247725 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382247725'}}
2025-08-16 18:10:48,342 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.617s id=req_1755382247725 ip=127.0.0.1
INFO:     127.0.0.1:58935 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:10:48,345 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.000s id=req_1755382248345 ip=127.0.0.1
INFO:     127.0.0.1:58942 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:11:23,987 - src.webui.api.routers.languages - INFO - Returning language support: command_a=22 nova=10
2025-08-16 18:11:23,989 - src.webui.api.main - INFO - REQUEST GET /api/v1/languages/supported status=200 time=0.007s id=req_1755382283982 ip=127.0.0.1
INFO:     127.0.0.1:59343 - "GET /api/v1/languages/supported HTTP/1.1" 200 OK
2025-08-16 18:11:23,992 - src.webui.api.main - INFO - REQUEST GET /api/v1/chat/test status=200 time=0.000s id=req_1755382283992 ip=127.0.0.1
INFO:     127.0.0.1:59345 - "GET /api/v1/chat/test HTTP/1.1" 200 OK
2025-08-16 18:11:25,001 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382285000 query_len=23 lang=en
2025-08-16 18:11:25,002 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:11:25,003 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:11:25,003 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:11:25,003 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:11:25,005 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:11:25,005 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:11:25,006 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:11:25,006 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382285000 time=0.005s model=nova faithfulness=0.950
2025-08-16 18:11:25,007 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.007s id=req_1755382285000 ip=127.0.0.1
INFO:     127.0.0.1:59356 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:11:26,019 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382286017 query_len=23 lang=en
2025-08-16 18:11:26,019 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:11:26,020 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:11:26,020 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:11:26,020 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:11:26,037 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:11:26,037 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:11:26,038 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:11:26,038 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382286017 time=0.020s model=nova faithfulness=0.950
2025-08-16 18:11:26,039 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.021s id=req_1755382286017 ip=127.0.0.1
INFO:     127.0.0.1:59367 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:11:26,548 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382286547 query_len=28 lang=es
2025-08-16 18:11:26,548 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:11:26,549 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:11:26,549 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 18:11:26,549 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:11:26,549 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 18:11:26,549 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 18:11:27,553 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1003 status=OK request_id=0b1c6edf-9d88-4037-90ed-90d64af65fa9
2025-08-16 18:11:27,555 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:11:27,555 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 18:11:27,555 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 18:11:27,555 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 18:11:27,555 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 18:11:27,555 - src.models.climate_pipeline - INFO - Net debug → english_query len=798, utf8_bytes=804
2025-08-16 18:11:27,555 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:11:27,556 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:11:27,566 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:11:27,566 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:11:27,566 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 18:11:27,567 - src.models.climate_pipeline - INFO - Timing: cache=12.0ms
2025-08-16 18:11:27,568 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:11:27,568 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:11:27,568 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 18:11:27,568 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='¿Qué es el cambio climático?'
2025-08-16 18:11:27,568 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='¿Qué es el cambio climático?', norm='¿Qué es el cambio climático?'
2025-08-16 18:11:28,185 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=617 status=OK request_id=925732fd-135c-4955-84aa-23354d5d6a9f
2025-08-16 18:11:28,186 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and asks about climate change.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:11:28,186 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:11:28,186 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='¿Qué es el cambio climático?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and asks about climate change....'
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - Timing: rewrite=619.2ms
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-16 18:11:28,187 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:11:28,187 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:11:28,187 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 18:11:29,144 - src.models.retrieval - INFO - dep=query_embed op=encode ms=956 dense_dim=1024 sparse_tokens=5
2025-08-16 18:11:29,182 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=37 status=OK
2025-08-16 18:11:29,182 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=37 total_ms=37
2025-08-16 18:11:29,313 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=131 status=OK
2025-08-16 18:11:29,313 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:11:29,313 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=131 total_ms=131
2025-08-16 18:11:29,315 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:11:29,316 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 18:11:29,454 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:11:29,463 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=146.8 status=OK
2025-08-16 18:11:29,464 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 18:11:29,464 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 18:11:29,464 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:11:29,464 - src.models.climate_pipeline - INFO - Timing: retrieval=1276.9ms
2025-08-16 18:11:29,464 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:11:29,464 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:11:29,464 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:11:29,467 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:11:29,467 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:11:29,468 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 18:11:29,468 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:11:29,468 - src.models.climate_pipeline - INFO - Timing: generation=3.6ms
2025-08-16 18:11:29,468 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:11:31,204 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1735 status=OK request_id=5d685d13-f493-46fd-975f-982ead56aa82
2025-08-16 18:11:31,206 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:11:31,206 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:11:31,206 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:11:31,206 - src.models.climate_pipeline - INFO - Timing: faithfulness=1738.2ms
2025-08-16 18:11:31,206 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 18:11:35,575 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4369 status=OK request_id=841b1142-eed4-4177-92bb-90555b05ded2
2025-08-16 18:11:35,576 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 18:11:35,577 - src.models.climate_pipeline - INFO - Timing: translation=4370.7ms
2025-08-16 18:11:35,577 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:11:35,579 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:11:35,579 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:11:35,586 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 18:11:35,588 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 18:11:35,590 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=619.2 guards=0.1 retrieval=1276.9 generation=3.6 faithfulness=1738.2 translation=4370.7 total=9028.0
2025-08-16 18:11:35,590 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 9.03s
2025-08-16 18:11:35,590 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382286547 time=9.042s model=nova faithfulness=0.950
2025-08-16 18:11:35,591 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=9.044s id=req_1755382286547 ip=127.0.0.1
INFO:     127.0.0.1:59374 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:11:36,098 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382296097 query_len=39 lang=fr
2025-08-16 18:11:36,098 - src.webui.api.routers.chat - INFO - Language routing: detected=fr model=command_a
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Processing query: 'Qu'est-ce que le changement climatique?...' in french (code: fr)
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Raw query repr: "Qu'est-ce que le changement climatique?"
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Router IN → language_name=french, language_code=fr
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:11:36,099 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Router OUT → english_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:11:36,099 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 18:11:36,099 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:11:36,099 - src.models.query_routing - INFO - Translating query from french to English
2025-08-16 18:11:36,099 - src.models.query_routing - INFO - Router NET IN → query repr="Qu'est-ce que le changement climatique?"
2025-08-16 18:11:36,351 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 18:11:36,353 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:11:36,353 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 18:11:36,353 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 18:11:36,353 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 18:11:36,353 - src.models.climate_pipeline - INFO - Net debug → original_query len=39, utf8_bytes=39
2025-08-16 18:11:36,353 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:11:36,353 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:11:36,353 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:11:36,354 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:11:36,354 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:11:36,355 - src.models.climate_pipeline - INFO - ✓ Cache hit for french - returning cached response
2025-08-16 18:11:36,355 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382296097 time=0.257s model=command_a faithfulness=0.950
2025-08-16 18:11:36,356 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.259s id=req_1755382296097 ip=127.0.0.1
INFO:     127.0.0.1:59461 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:11:37,868 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382297866 ip=127.0.0.1
INFO:     127.0.0.1:59482 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:11:37,871 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382297870 query_len=4 lang=invalid
2025-08-16 18:11:37,871 - src.webui.api.routers.chat - INFO - Language routing: detected=invalid model=nova
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Processing query: 'Test...' in english (code: en)
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Raw query repr: 'Test'
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:11:37,871 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test'
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test'
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:11:37,871 - src.models.climate_pipeline - INFO - Net debug → original_query len=4, utf8_bytes=4
2025-08-16 18:11:37,872 - src.models.climate_pipeline - INFO - Net debug → english_query len=4, utf8_bytes=4
2025-08-16 18:11:37,872 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:11:37,872 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:11:37,873 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:11:37,873 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:11:37,874 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:11:37,876 - src.models.climate_pipeline - INFO - Timing: cache=4.1ms
2025-08-16 18:11:37,876 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:11:37,876 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:11:37,876 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:11:37,876 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test'
2025-08-16 18:11:37,876 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test', norm='Test'
2025-08-16 18:11:38,596 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=720 status=OK request_id=0883beef-1ede-426c-9fd9-fa9a0f3f0447
2025-08-16 18:11:38,597 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a single word and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:11:38,597 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:11:38,597 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a single word and matches the expected language....'
2025-08-16 18:11:38,597 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:11:38,597 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:11:38,597 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382297870 error=Pipeline processing failed
2025-08-16 18:11:38,597 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382297870 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382297870'}}
2025-08-16 18:11:38,597 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.727s id=req_1755382297870 ip=127.0.0.1
INFO:     127.0.0.1:59484 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:11:38,601 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382298601 ip=127.0.0.1
INFO:     127.0.0.1:59491 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:11:44,227 - src.webui.api.routers.languages - INFO - Returning language support: command_a=22 nova=10
2025-08-16 18:11:44,227 - src.webui.api.main - INFO - REQUEST GET /api/v1/languages/supported status=200 time=0.001s id=req_1755382304225 ip=127.0.0.1
INFO:     127.0.0.1:59562 - "GET /api/v1/languages/supported HTTP/1.1" 200 OK
2025-08-16 18:12:02,392 - src.webui.api.routers.languages - INFO - Returning language support: command_a=22 nova=10
2025-08-16 18:12:02,393 - src.webui.api.main - INFO - REQUEST GET /api/v1/languages/supported status=200 time=0.002s id=req_1755382322390 ip=127.0.0.1
INFO:     127.0.0.1:59778 - "GET /api/v1/languages/supported HTTP/1.1" 200 OK
2025-08-16 18:12:02,395 - src.webui.api.main - INFO - REQUEST GET /api/v1/chat/test status=200 time=0.000s id=req_1755382322395 ip=127.0.0.1
INFO:     127.0.0.1:59780 - "GET /api/v1/chat/test HTTP/1.1" 200 OK
2025-08-16 18:12:03,402 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382323400 query_len=23 lang=en
2025-08-16 18:12:03,402 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:03,403 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:12:03,403 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:03,403 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:03,405 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:03,405 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:03,405 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:12:03,406 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382323400 time=0.004s model=nova faithfulness=0.950
2025-08-16 18:12:03,406 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.006s id=req_1755382323400 ip=127.0.0.1
INFO:     127.0.0.1:59802 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:04,415 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382324414 query_len=23 lang=en
2025-08-16 18:12:04,415 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:04,415 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:12:04,415 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:04,415 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:04,420 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:04,420 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:04,421 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:12:04,421 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382324414 time=0.006s model=nova faithfulness=0.950
2025-08-16 18:12:04,421 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.007s id=req_1755382324414 ip=127.0.0.1
INFO:     127.0.0.1:59813 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:04,931 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382324930 query_len=28 lang=es
2025-08-16 18:12:04,931 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:04,931 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 18:12:04,931 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:04,932 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:12:04,932 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 18:12:04,932 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:12:04,932 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 18:12:04,932 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 18:12:05,656 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=724 status=OK request_id=2665d278-0974-4a7b-b4cd-11d799b3faf7
2025-08-16 18:12:05,657 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:12:05,657 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history"
2025-08-16 18:12:05,657 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 18:12:05,657 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 18:12:05,657 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 18:12:05,657 - src.models.climate_pipeline - INFO - Net debug → english_query len=649, utf8_bytes=649
2025-08-16 18:12:05,657 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:05,657 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:05,660 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:05,660 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:05,661 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 18:12:05,663 - src.models.climate_pipeline - INFO - Timing: cache=6.3ms
2025-08-16 18:12:05,664 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:12:05,664 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:12:05,664 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 18:12:05,664 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='¿Qué es el cambio climático?'
2025-08-16 18:12:05,664 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='¿Qué es el cambio climático?', norm='¿Qué es el cambio climático?'
2025-08-16 18:12:06,560 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=895 status=OK request_id=b381eb86-638d-471d-b521-8f212806b82f
2025-08-16 18:12:06,560 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and asks about climate change.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:12:06,560 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:12:06,560 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='¿Qué es el cambio climático?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and asks about climate change....'
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - Timing: rewrite=896.8ms
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:12:06,560 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:12:06,560 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:12:06,560 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 18:12:07,140 - src.models.retrieval - INFO - dep=query_embed op=encode ms=579 dense_dim=1024 sparse_tokens=5
2025-08-16 18:12:07,190 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=49 status=OK
2025-08-16 18:12:07,191 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=49 total_ms=49
2025-08-16 18:12:07,313 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=122 status=OK
2025-08-16 18:12:07,313 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:12:07,313 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=122 total_ms=122
2025-08-16 18:12:07,315 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:12:07,316 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 18:12:07,450 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:12:07,455 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=139.3 status=OK
2025-08-16 18:12:07,456 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 18:12:07,457 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 18:12:07,457 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:12:07,457 - src.models.climate_pipeline - INFO - Timing: retrieval=896.3ms
2025-08-16 18:12:07,457 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:12:07,457 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:12:07,457 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:07,464 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:07,464 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:07,465 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 18:12:07,465 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:12:07,465 - src.models.climate_pipeline - INFO - Timing: generation=8.4ms
2025-08-16 18:12:07,465 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:12:08,722 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1255 status=OK request_id=9f8a6708-ac66-495e-b27d-c33ea311398d
2025-08-16 18:12:08,722 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 18:12:08,722 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 18:12:08,722 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:12:08,722 - src.models.climate_pipeline - INFO - Timing: faithfulness=1257.0ms
2025-08-16 18:12:08,722 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 18:12:12,960 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4237 status=OK request_id=02f4688b-535b-4bdc-a379-5b07c6028c23
2025-08-16 18:12:12,962 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 18:12:12,962 - src.models.climate_pipeline - INFO - Timing: translation=4239.5ms
2025-08-16 18:12:12,962 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:12,964 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:12,964 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:12,966 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 18:12:12,967 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 18:12:12,967 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=896.8 guards=0.0 retrieval=896.3 generation=8.4 faithfulness=1257.0 translation=4239.5 total=8030.8
2025-08-16 18:12:12,967 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 8.03s
2025-08-16 18:12:12,968 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382324930 time=8.037s model=nova faithfulness=0.900
2025-08-16 18:12:12,970 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=8.040s id=req_1755382324930 ip=127.0.0.1
INFO:     127.0.0.1:59820 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:13,491 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382333488 query_len=39 lang=fr
2025-08-16 18:12:13,491 - src.webui.api.routers.chat - INFO - Language routing: detected=fr model=command_a
2025-08-16 18:12:13,491 - src.models.climate_pipeline - INFO - Processing query: 'Qu'est-ce que le changement climatique?...' in french (code: fr)
2025-08-16 18:12:13,491 - src.models.climate_pipeline - INFO - Raw query repr: "Qu'est-ce que le changement climatique?"
2025-08-16 18:12:13,491 - src.models.climate_pipeline - INFO - Router IN → language_name=french, language_code=fr
2025-08-16 18:12:13,491 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:13,492 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:12:13,492 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 18:12:13,492 - src.models.climate_pipeline - INFO - Router OUT → english_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:12:13,492 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:12:13,492 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 18:12:13,492 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 18:12:13,492 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 18:12:13,492 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:12:13,492 - src.models.query_routing - INFO - Translating query from french to English
2025-08-16 18:12:13,492 - src.models.query_routing - INFO - Router NET IN → query repr="Qu'est-ce que le changement climatique?"
2025-08-16 18:12:13,719 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 18:12:13,730 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:12:13,731 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 18:12:13,731 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 18:12:13,731 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 18:12:13,731 - src.models.climate_pipeline - INFO - Net debug → original_query len=39, utf8_bytes=39
2025-08-16 18:12:13,731 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:12:13,731 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:13,731 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:13,738 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:13,738 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:13,740 - src.models.climate_pipeline - INFO - ✓ Cache hit for french - returning cached response
2025-08-16 18:12:13,742 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382333488 time=0.252s model=command_a faithfulness=0.950
2025-08-16 18:12:13,743 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.255s id=req_1755382333488 ip=127.0.0.1
INFO:     127.0.0.1:59898 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:15,265 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.003s id=req_1755382335261 ip=127.0.0.1
INFO:     127.0.0.1:59918 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:12:15,274 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382335272 query_len=4 lang=invalid
2025-08-16 18:12:15,274 - src.webui.api.routers.chat - INFO - Language routing: detected=invalid model=nova
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Processing query: 'Test...' in english (code: en)
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Raw query repr: 'Test'
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:15,275 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test'
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test'
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Net debug → original_query len=4, utf8_bytes=4
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Net debug → english_query len=4, utf8_bytes=4
2025-08-16 18:12:15,275 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:15,275 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:15,279 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:15,279 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:15,279 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:12:15,280 - src.models.climate_pipeline - INFO - Timing: cache=4.8ms
2025-08-16 18:12:15,280 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:12:15,280 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:12:15,280 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:12:15,280 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test'
2025-08-16 18:12:15,280 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test', norm='Test'
2025-08-16 18:12:15,860 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=580 status=OK request_id=231a2c2f-efa6-47b8-b3b7-1dbcdc441c43
2025-08-16 18:12:15,861 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a single word and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:12:15,861 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:12:15,861 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a single word and matches the expected language....'
2025-08-16 18:12:15,861 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:12:15,861 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:12:15,862 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382335272 error=Pipeline processing failed
2025-08-16 18:12:15,862 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382335272 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382335272'}}
2025-08-16 18:12:15,862 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.590s id=req_1755382335272 ip=127.0.0.1
INFO:     127.0.0.1:59920 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:12:15,866 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382335865 ip=127.0.0.1
INFO:     127.0.0.1:59927 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:12:27,555 - src.webui.api.routers.languages - INFO - Returning language support: command_a=22 nova=10
2025-08-16 18:12:27,556 - src.webui.api.main - INFO - REQUEST GET /api/v1/languages/supported status=200 time=0.007s id=req_1755382347550 ip=127.0.0.1
INFO:     127.0.0.1:60078 - "GET /api/v1/languages/supported HTTP/1.1" 200 OK
2025-08-16 18:12:27,561 - src.webui.api.main - INFO - REQUEST GET /api/v1/chat/test status=200 time=0.001s id=req_1755382347561 ip=127.0.0.1
INFO:     127.0.0.1:60080 - "GET /api/v1/chat/test HTTP/1.1" 200 OK
2025-08-16 18:12:28,569 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382348568 query_len=23 lang=en
2025-08-16 18:12:28,569 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:12:28,570 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:12:28,570 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:12:28,570 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:12:28,570 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:28,571 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:12:28,571 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:28,571 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:28,573 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:28,573 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:28,574 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:12:28,574 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382348568 time=0.005s model=nova faithfulness=0.950
2025-08-16 18:12:28,575 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.007s id=req_1755382348568 ip=127.0.0.1
INFO:     127.0.0.1:60090 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:29,583 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382349582 query_len=23 lang=en
2025-08-16 18:12:29,583 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:12:29,583 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:29,584 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:12:29,584 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:29,584 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:29,596 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:29,596 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:29,597 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:12:29,597 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382349582 time=0.014s model=nova faithfulness=0.950
2025-08-16 18:12:29,598 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.015s id=req_1755382349582 ip=127.0.0.1
INFO:     127.0.0.1:60101 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:30,108 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382350106 query_len=28 lang=es
2025-08-16 18:12:30,108 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:30,108 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:12:30,108 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 18:12:30,108 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:12:30,108 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 18:12:30,108 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 18:12:31,039 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=929 status=OK request_id=6682d727-4f4a-450f-9846-4bcb9a224d77
2025-08-16 18:12:31,039 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:12:31,039 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 18:12:31,039 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 18:12:31,039 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 18:12:31,039 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 18:12:31,039 - src.models.climate_pipeline - INFO - Net debug → english_query len=777, utf8_bytes=783
2025-08-16 18:12:31,039 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:31,039 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:31,041 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:31,041 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:31,041 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 18:12:31,042 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:31,043 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:31,043 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:31,044 - src.models.climate_pipeline - INFO - ✓ Cache hit via fuzzy match (score=0.95)
2025-08-16 18:12:31,044 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382350106 time=0.936s model=nova faithfulness=0.950
2025-08-16 18:12:31,044 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.938s id=req_1755382350106 ip=127.0.0.1
INFO:     127.0.0.1:60112 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:31,558 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382351555 query_len=39 lang=fr
2025-08-16 18:12:31,558 - src.webui.api.routers.chat - INFO - Language routing: detected=fr model=command_a
2025-08-16 18:12:31,558 - src.models.climate_pipeline - INFO - Processing query: 'Qu'est-ce que le changement climatique?...' in french (code: fr)
2025-08-16 18:12:31,558 - src.models.climate_pipeline - INFO - Raw query repr: "Qu'est-ce que le changement climatique?"
2025-08-16 18:12:31,558 - src.models.climate_pipeline - INFO - Router IN → language_name=french, language_code=fr
2025-08-16 18:12:31,558 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:31,558 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:12:31,559 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 18:12:31,559 - src.models.climate_pipeline - INFO - Router OUT → english_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:12:31,559 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Qu'est-ce que le changement climatique?'
2025-08-16 18:12:31,559 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 18:12:31,559 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:12:31,559 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 18:12:31,559 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:12:31,559 - src.models.query_routing - INFO - Translating query from french to English
2025-08-16 18:12:31,559 - src.models.query_routing - INFO - Router NET IN → query repr="Qu'est-ce que le changement climatique?"
2025-08-16 18:12:31,793 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 18:12:31,795 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:12:31,795 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?'
2025-08-16 18:12:31,795 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?'
2025-08-16 18:12:31,795 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?'
2025-08-16 18:12:31,795 - src.models.climate_pipeline - INFO - Net debug → original_query len=39, utf8_bytes=39
2025-08-16 18:12:31,795 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:12:31,795 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:31,795 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:31,797 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:31,797 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:31,797 - src.models.climate_pipeline - INFO - ✓ Cache hit for french - returning cached response
2025-08-16 18:12:31,798 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382351555 time=0.239s model=command_a faithfulness=0.950
2025-08-16 18:12:31,798 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.243s id=req_1755382351555 ip=127.0.0.1
INFO:     127.0.0.1:60124 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:12:33,314 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382353313 ip=127.0.0.1
INFO:     127.0.0.1:60145 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:12:33,317 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382353316 query_len=4 lang=invalid
2025-08-16 18:12:33,317 - src.webui.api.routers.chat - INFO - Language routing: detected=invalid model=nova
2025-08-16 18:12:33,317 - src.models.climate_pipeline - INFO - Processing query: 'Test...' in english (code: en)
2025-08-16 18:12:33,317 - src.models.climate_pipeline - INFO - Raw query repr: 'Test'
2025-08-16 18:12:33,317 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:12:33,318 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test'
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test'
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Net debug → original_query len=4, utf8_bytes=4
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Net debug → english_query len=4, utf8_bytes=4
2025-08-16 18:12:33,318 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:12:33,318 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:12:33,319 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:12:33,319 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:12:33,319 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:12:33,319 - src.models.climate_pipeline - INFO - Timing: cache=1.7ms
2025-08-16 18:12:33,319 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:12:33,320 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:12:33,320 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:12:33,320 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test'
2025-08-16 18:12:33,320 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test', norm='Test'
2025-08-16 18:12:33,988 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=668 status=OK request_id=031e10b7-4827-4637-a939-d6df0c5b9c9f
2025-08-16 18:12:33,988 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a single word and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:12:33,988 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:12:33,988 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a single word and matches the expected language....'
2025-08-16 18:12:33,988 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:12:33,988 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:12:33,989 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382353316 error=Pipeline processing failed
2025-08-16 18:12:33,989 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382353316 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382353316'}}
2025-08-16 18:12:33,989 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.672s id=req_1755382353316 ip=127.0.0.1
INFO:     127.0.0.1:60147 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:12:33,997 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382353997 ip=127.0.0.1
INFO:     127.0.0.1:60155 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:13:49,760 - src.webui.api.main - INFO - REQUEST GET /api/v1/invalid status=404 time=0.002s id=req_1755382429757 ip=127.0.0.1
INFO:     127.0.0.1:60885 - "GET /api/v1/invalid HTTP/1.1" 404 Not Found
2025-08-16 18:13:49,763 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382429762 ip=127.0.0.1
INFO:     127.0.0.1:60887 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:13:49,768 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.002s id=req_1755382429766 ip=127.0.0.1
INFO:     127.0.0.1:60889 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:13:49,782 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.011s id=req_1755382429771 ip=127.0.0.1
INFO:     127.0.0.1:60891 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:13:50,789 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382430788 query_len=27 lang=en
2025-08-16 18:13:50,790 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:13:50,790 - src.models.climate_pipeline - INFO - Processing query: 'What causes climate change?...' in english (code: en)
2025-08-16 18:13:50,790 - src.models.climate_pipeline - INFO - Raw query repr: 'What causes climate change?'
2025-08-16 18:13:50,790 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:13:50,790 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:13:50,791 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - Router OUT → english_query='What causes climate change?'
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What causes climate change?'
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - Net debug → original_query len=27, utf8_bytes=27
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - Net debug → english_query len=27, utf8_bytes=27
2025-08-16 18:13:50,791 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:13:50,791 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:13:50,793 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:13:50,793 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:13:50,793 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:13:50,794 - src.models.climate_pipeline - INFO - Timing: cache=3.7ms
2025-08-16 18:13:50,794 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:13:50,795 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:13:50,795 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:13:50,795 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='What causes climate change?'
2025-08-16 18:13:50,795 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='What causes climate change?', norm='What causes climate change?'
2025-08-16 18:13:51,375 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=579 status=OK request_id=264f17b9-ba7e-44cd-a455-aaad328b5baa
2025-08-16 18:13:51,375 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a direct question about climate change, which is on-topic.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What causes climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:13:51,375 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:13:51,375 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='What causes climate change?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is a direct question about climate change, which is on-topic....'
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What causes climate change?'
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - Timing: rewrite=580.8ms
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:13:51,375 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:13:51,375 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:13:51,375 - src.models.retrieval - INFO - Query embedding IN: query_len=27 chars, query_repr='What causes climate change?...'
2025-08-16 18:13:52,004 - src.models.retrieval - INFO - dep=query_embed op=encode ms=628 dense_dim=1024 sparse_tokens=5
2025-08-16 18:13:52,484 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=478 status=OK
2025-08-16 18:13:52,484 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=478 total_ms=478
2025-08-16 18:13:52,686 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=201 status=OK
2025-08-16 18:13:52,686 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:13:52,686 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=202 total_ms=202
2025-08-16 18:13:52,689 - src.models.retrieval - INFO - dep=mmr_embed used_index=8 used_cache=0 embedded=0 ms=0 n_docs=8 valid_vecs=8 q_embed_ms=0
2025-08-16 18:13:52,690 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=10727 n_docs=8
2025-08-16 18:13:52,835 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:13:52,838 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=148.0 status=OK
2025-08-16 18:13:52,839 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.265651971, 'rerank_score': 0.98780584, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.263777971, 'rerank_score': 0.98625773, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.283566, 'rerank_score': 0.97510713, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.249094114, 'rerank_score': 0.97029626, 'has_values': True}, {'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.274743378, 'rerank_score': 0.96995664, 'has_values': True}]
2025-08-16 18:13:52,839 - src.models.retrieval - INFO - q='What causes climate change?', base=8, kept_pre=8, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.91, delta=0.100, max_sim_pre=0.284, p50_sim_pre=0.264, p95_sim_pre=0.284, blocked_base=0, dropped_top2=[{'segment_id': '18', 'title': 'Adapting To Climate Change A Risk Based Guide For Local Governments', 'score': 0.90397453}, {'segment_id': '4', 'title': '12992 2021 Article 722', 'score': 0.85573065}]
2025-08-16 18:13:52,839 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:13:52,839 - src.models.climate_pipeline - INFO - Timing: retrieval=1464.1ms
2025-08-16 18:13:52,840 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:13:52,840 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:13:52,840 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:13:52,847 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:13:52,847 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:13:52,848 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:13:52,848 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:13:56,038 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3189 status=OK request_id=a5054769-8162-41e3-bdb7-8cdbd91c3ad0
2025-08-16 18:13:56,068 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:13:56,068 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:13:56,068 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:13:56,068 - src.models.climate_pipeline - INFO - Timing: generation=3228.6ms
2025-08-16 18:13:56,068 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:13:57,970 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1899 status=OK request_id=57d69471-40a5-4318-b839-3edfebd313ed
2025-08-16 18:13:57,972 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:13:57,973 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:13:57,973 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:13:57,973 - src.models.climate_pipeline - INFO - Timing: faithfulness=1904.3ms
2025-08-16 18:13:57,976 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:13:57,985 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:13:57,985 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:13:57,986 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:13:57,987 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.3 rewrite=580.8 guards=0.0 retrieval=1464.1 generation=3228.6 faithfulness=1904.3 translation=0.0 total=7182.4
2025-08-16 18:13:57,987 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 7.18s
2025-08-16 18:13:57,988 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382430788 time=7.198s model=nova faithfulness=0.950
2025-08-16 18:13:57,988 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=7.200s id=req_1755382430788 ip=127.0.0.1
INFO:     127.0.0.1:60901 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:13:59,008 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382439007 query_len=10 lang=en
2025-08-16 18:13:59,009 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Processing query: 'Quick test...' in english (code: en)
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Raw query repr: 'Quick test'
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:13:59,009 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Router OUT → english_query='Quick test'
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Quick test'
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Net debug → original_query len=10, utf8_bytes=10
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Net debug → english_query len=10, utf8_bytes=10
2025-08-16 18:13:59,009 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:13:59,009 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:13:59,013 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:13:59,013 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:13:59,014 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:13:59,014 - src.models.climate_pipeline - INFO - Timing: cache=5.3ms
2025-08-16 18:13:59,014 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:13:59,014 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:13:59,014 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:13:59,014 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Quick test'
2025-08-16 18:13:59,014 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Quick test', norm='Quick test'
2025-08-16 18:14:00,080 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1065 status=OK request_id=7bc5fe16-1f0f-4b1d-bb60-4546475b6abb
2025-08-16 18:14:00,080 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a short, generic question about using the chatbot.","language":"en","expected_language":"en","language_match":true,"classification":"instruction","rewrite_en":null,"ask_how_to_use":true,"how_it_works":"How It Works\nChoose Language from the left side panel: Select from 200+ 
2025-08-16 18:14:00,080 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:00,081 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Quick test...' expected_lang=en detected_lang=en classification=instruction language_match=True reason='User query is a short, generic question about using the chatbot....'
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='instruction', language_match='yes', canned=False
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - ✓ Query rewriting skipped (JSON) - no enhancement needed
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - Timing: rewrite=1066.6ms
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:14:00,081 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:14:00,081 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:14:00,081 - src.models.retrieval - INFO - Query embedding IN: query_len=10 chars, query_repr='Quick test...'
2025-08-16 18:14:01,328 - src.models.retrieval - INFO - dep=query_embed op=encode ms=1246 dense_dim=1024 sparse_tokens=2
2025-08-16 18:14:01,371 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=41 status=OK
2025-08-16 18:14:01,371 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=41 total_ms=41
2025-08-16 18:14:01,455 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=84 status=OK
2025-08-16 18:14:01,456 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:14:01,456 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=84 total_ms=84
2025-08-16 18:14:01,457 - src.models.retrieval - WARNING - Content too short after cleaning for document: ijerph-18-02547
2025-08-16 18:14:01,457 - src.models.retrieval - WARNING - Content too short after cleaning for document: ijerph-18-02547
2025-08-16 18:14:01,457 - src.models.retrieval - WARNING - Content too short after cleaning for document: Nature is infrastructure- How to include natural assets in asset management plans
2025-08-16 18:14:01,457 - src.models.retrieval - WARNING - Content too short after cleaning for document: Indigenous Rights and Sovereignty in National Climate Policies- A Systematic Analysis
2025-08-16 18:14:01,457 - src.models.retrieval - WARNING - Content too short after cleaning for document: ijerph-18-00040
2025-08-16 18:14:01,459 - src.models.retrieval - INFO - dep=mmr_embed used_index=3 used_cache=0 embedded=0 ms=0 n_docs=3 valid_vecs=3 q_embed_ms=0
2025-08-16 18:14:01,465 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=45 n_docs=3
2025-08-16 18:14:01,572 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:14:01,578 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=113.2 status=OK
2025-08-16 18:14:01,580 - src.models.retrieval - INFO - Query embedding IN: query_len=10 chars, query_repr='Quick test...'
2025-08-16 18:14:01,669 - src.models.retrieval - INFO - dep=query_embed op=encode ms=89 dense_dim=1024 sparse_tokens=2
2025-08-16 18:14:02,655 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=328 status=OK
2025-08-16 18:14:02,658 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:14:02,659 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=333 total_ms=333
2025-08-16 18:14:02,659 - src.models.retrieval - WARNING - Content too short after cleaning for document: Health of Canadians in Changing Climate Report
2025-08-16 18:14:02,659 - src.models.retrieval - WARNING - Content too short after cleaning for document: Canada in a Changing Climate National Issues Report
2025-08-16 18:14:02,659 - src.models.retrieval - WARNING - Content too short after cleaning for document: Home-Flood-Protection-Program-Report-1
2025-08-16 18:14:02,659 - src.models.retrieval - WARNING - Content too short after cleaning for document: HFPP-Interim-Report-Dec-2017-FINAL
2025-08-16 18:14:02,659 - src.models.retrieval - WARNING - Content too short after cleaning for document: Canada in a Changing Climate National Issues Report
2025-08-16 18:14:02,659 - src.models.retrieval - WARNING - Content too short after cleaning for document: Rexdale-SNAP-Action-Plan-Report-11-20-23-FA-2-2
2025-08-16 18:14:02,659 - src.models.retrieval - WARNING - Content too short after cleaning for document: TransformTO Net Zero Strategy A climate action Pathway to 2030 and beyond
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: Canada in a Changing Climate National Issues Report
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: TransformTO Net Zero Strategy A climate action Pathway to 2030 and beyond
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: CSA-Group-Research-Managing-Flooding-and-Erosion-at-the-Watershed-Scale
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: Canada in a Changing Climate National Issues Report
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: Canada in a Changing Climate National Issues Report
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: Health of Canadians in Changing Climate Report
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: The-Pocket-Action-Plan-Report-FINAL
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: Human Health in a Changing Climate- A Canadian Assessment of Vulnerabilities and Adaptive Capacity
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: IBC_Wetlands-Report-2018_FINAL
2025-08-16 18:14:02,660 - src.models.retrieval - WARNING - Content too short after cleaning for document: Rexdale-SNAP-Action-Plan-Report-11-20-23-FA-2-2
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Home-Flood-Protection-Program-Report-1
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: HFPP-Interim-Report-Dec-2017-FINAL
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: The-Pocket-Action-Plan-Report-FINAL
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Rexdale-SNAP-Action-Plan-Report-11-20-23-FA-2-2
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Home-Flood-Protection-Program-Report-1
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: HFPP-Interim-Report-Dec-2017-FINAL
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Rexdale-SNAP-Action-Plan-Report-11-20-23-FA-2-2
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Rexdale-SNAP-Action-Plan-Report-11-20-23-FA-2-2
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Rexdale-SNAP-Action-Plan-Report-11-20-23-FA-2-2
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Home-Flood-Protection-Program-Report-1
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Home-Flood-Protection-Program-Report-1
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Home-Flood-Protection-Program-Report-1
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Health of Canadians in Changing Climate Report
2025-08-16 18:14:02,661 - src.models.retrieval - WARNING - Content too short after cleaning for document: Canada in a Changing Climate National Issues Report
2025-08-16 18:14:02,680 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=31562 n_docs=34
2025-08-16 18:14:02,814 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:14:02,817 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=136.0 status=OK
2025-08-16 18:14:02,817 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Kgad001', 'pinecone_score': 0.0684281886, 'rerank_score': 0.031858854, 'has_values': True}, {'title': 'Kgad005', 'pinecone_score': 0.0960367918, 'rerank_score': 0.009859855, 'has_values': True}, {'title': 'Preventing Disaster Before It Strikes', 'pinecone_score': 0.0780711, 'rerank_score': 0.003197487, 'has_values': True}, {'title': 'Kgae014', 'pinecone_score': 0.0621224605, 'rerank_score': 0.0027149853, 'has_values': True}, {'title': 'Due North Facing The Costs Of Climate Change For Northern Infrastructure', 'pinecone_score': 0.211115271, 'rerank_score': 0.002631674, 'has_values': True}]
2025-08-16 18:14:02,817 - src.models.retrieval - INFO - q='Quick test', base=3, kept_pre=3, refill=0, final_before=0, final_after=5, hybrid_refill=5, floor=0.60, delta=0.100, max_sim_pre=0.211, p50_sim_pre=0.198, p95_sim_pre=0.211, blocked_base=0, dropped_top2=[{'segment_id': '3', 'title': 'Due North Facing The Costs Of Climate Change For Northern Infrastructure', 'score': 0.0026419468}, {'segment_id': '3', 'title': 'Guide For Integrating Climate Change Considerations Into Municipal Asset Managem', 'score': 0.00032503586}]
2025-08-16 18:14:02,819 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:14:02,819 - src.models.climate_pipeline - INFO - Timing: retrieval=2737.7ms
2025-08-16 18:14:02,819 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:14:02,819 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:14:02,819 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:02,821 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:02,821 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:02,821 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:14:02,822 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:14:04,023 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382444022 query_len=4 lang=en
2025-08-16 18:14:04,023 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:04,023 - src.models.climate_pipeline - INFO - Processing query: 'Test...' in english (code: en)
2025-08-16 18:14:04,023 - src.models.climate_pipeline - INFO - Raw query repr: 'Test'
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:04,024 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test'
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test'
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Net debug → original_query len=4, utf8_bytes=4
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Net debug → english_query len=4, utf8_bytes=4
2025-08-16 18:14:04,024 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:04,024 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:04,025 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:04,025 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:04,025 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:04,026 - src.models.climate_pipeline - INFO - Timing: cache=2.3ms
2025-08-16 18:14:04,026 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:04,026 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:04,026 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:04,026 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test'
2025-08-16 18:14:04,026 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test', norm='Test'
2025-08-16 18:14:04,635 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=608 status=OK request_id=2725a768-9f7b-465c-a867-f335ce5496a4
2025-08-16 18:14:04,636 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a single word and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:04,636 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:04,636 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a single word and matches the expected language....'
2025-08-16 18:14:04,636 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:14:04,636 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:14:04,637 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382444022 error=Pipeline processing failed
2025-08-16 18:14:04,637 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382444022 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382444022'}}
2025-08-16 18:14:04,637 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.615s id=req_1755382444022 ip=127.0.0.1
2025-08-16 18:14:05,030 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382445029 query_len=23 lang=en
2025-08-16 18:14:05,035 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:05,035 - src.models.climate_pipeline - INFO - Processing query: 'What is global warming?...' in english (code: en)
2025-08-16 18:14:05,035 - src.models.climate_pipeline - INFO - Raw query repr: 'What is global warming?'
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:05,036 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is global warming?'
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is global warming?'
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:14:05,036 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:05,036 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:05,037 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:05,037 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:05,037 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:05,037 - src.models.climate_pipeline - INFO - Timing: cache=1.5ms
2025-08-16 18:14:05,037 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:05,037 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:05,037 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:05,037 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='What is global warming?'
2025-08-16 18:14:05,038 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='What is global warming?', norm='What is global warming?'
2025-08-16 18:14:05,644 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=606 status=OK request_id=0f326e1b-332d-413e-a64b-fa3315640004
2025-08-16 18:14:05,644 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a standalone question about climate change.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What is global warming?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:05,644 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:05,644 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='What is global warming?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is a standalone question about climate change....'
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is global warming?'
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - Timing: rewrite=606.9ms
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:14:05,644 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:14:05,644 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:14:05,644 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is global warming?...'
2025-08-16 18:14:05,986 - src.models.retrieval - INFO - dep=query_embed op=encode ms=341 dense_dim=1024 sparse_tokens=6
2025-08-16 18:14:06,047 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3224 status=OK request_id=d68b51ef-520e-4f3f-a04d-dcbdc6e8b62a
2025-08-16 18:14:06,091 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=104 status=OK
2025-08-16 18:14:06,091 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=104 total_ms=104
2025-08-16 18:14:06,189 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=97 status=OK
2025-08-16 18:14:06,189 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:14:06,189 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=98 total_ms=98
2025-08-16 18:14:06,191 - src.models.retrieval - INFO - dep=mmr_embed used_index=8 used_cache=0 embedded=0 ms=0 n_docs=8 valid_vecs=8 q_embed_ms=0
2025-08-16 18:14:06,191 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=9990 n_docs=8
2025-08-16 18:14:06,194 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:14:06,194 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:14:06,194 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:14:06,194 - src.models.climate_pipeline - INFO - Timing: generation=3375.6ms
2025-08-16 18:14:06,194 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:14:06,305 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:14:06,309 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=116.9 status=OK
2025-08-16 18:14:06,309 - src.models.retrieval - INFO - Retained docs preview: [{'title': '1 S2.0 S1674927812500043 Main', 'pinecone_score': 0.280027092, 'rerank_score': 0.9970765, 'has_values': True}, {'title': 'Transformto Net Zero Framework Technical Report Parts 1 2', 'pinecone_score': 0.301853955, 'rerank_score': 0.7966091, 'has_values': True}, {'title': "Canada's Changing Climate Report 2019", 'pinecone_score': 0.272785783, 'rerank_score': 0.71393055, 'has_values': True}, {'title': 'Canada In A Changing Climate Synthesis Report', 'pinecone_score': 0.280521214, 'rerank_score': 0.6232622, 'has_values': True}, {'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'pinecone_score': 0.276860267, 'rerank_score': 0.36863297, 'has_values': True}]
2025-08-16 18:14:06,309 - src.models.retrieval - INFO - q='What is global warming?', base=8, kept_pre=8, refill=0, final_before=4, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.326, p50_sim_pre=0.280, p95_sim_pre=0.326, blocked_base=0, dropped_top2=[{'segment_id': '17', 'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'score': 0.36863297}, {'segment_id': '4', 'title': 'Kgad002', 'score': 0.2903768}]
2025-08-16 18:14:06,309 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:14:06,309 - src.models.climate_pipeline - INFO - Timing: retrieval=665.0ms
2025-08-16 18:14:06,309 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:14:06,310 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:14:06,310 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:06,311 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:06,311 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:06,312 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:14:06,312 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:14:07,499 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1304 status=OK request_id=ce1a6d39-0121-41bf-938b-bce46a4de436
2025-08-16 18:14:07,500 - src.models.hallucination_guard - INFO - Faithfulness score: 0.7
2025-08-16 18:14:07,500 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.700
2025-08-16 18:14:07,500 - src.models.climate_pipeline - INFO - ✓ Assessment: Faithful
2025-08-16 18:14:07,500 - src.models.climate_pipeline - INFO - Timing: faithfulness=1305.3ms
2025-08-16 18:14:07,500 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:07,501 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:07,501 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:07,502 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:14:07,503 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=1066.6 guards=0.0 retrieval=2737.7 generation=3375.6 faithfulness=1305.3 translation=0.0 total=8491.1
2025-08-16 18:14:07,504 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 8.49s
2025-08-16 18:14:07,504 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382439007 time=8.495s model=nova faithfulness=0.700
2025-08-16 18:14:07,504 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=8.497s id=req_1755382439007 ip=127.0.0.1
2025-08-16 18:14:08,833 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2520 status=OK request_id=2ffcb031-a598-45e3-bdf2-404bfa492f23
2025-08-16 18:14:08,834 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:14:08,834 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:14:08,834 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:14:08,834 - src.models.climate_pipeline - INFO - Timing: generation=2524.6ms
2025-08-16 18:14:08,834 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:14:10,353 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1518 status=OK request_id=a22175e1-ff02-4732-98f0-0f9bfa252ad2
2025-08-16 18:14:10,353 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:14:10,353 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:14:10,354 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:14:10,354 - src.models.climate_pipeline - INFO - Timing: faithfulness=1519.5ms
2025-08-16 18:14:10,354 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:10,355 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:10,355 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:10,356 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:14:10,356 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=606.9 guards=0.0 retrieval=665.0 generation=2524.6 faithfulness=1519.5 translation=0.0 total=5318.3
2025-08-16 18:14:10,356 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 5.32s
2025-08-16 18:14:10,356 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382445029 time=5.326s model=nova faithfulness=0.950
2025-08-16 18:14:10,357 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=5.327s id=req_1755382445029 ip=127.0.0.1
INFO:     127.0.0.1:61039 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:10,362 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382450359 query_len=25 lang=en
2025-08-16 18:14:10,363 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:14:10,364 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 18:14:10,364 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Processing query: 'What are the main causes?...' in english (code: en)
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Raw query repr: 'What are the main causes?'
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:10,364 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Router OUT → english_query='What are the main causes?'
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What are the main causes?'
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Net debug → original_query len=25, utf8_bytes=25
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 18:14:10,364 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:10,364 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:10,366 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:10,366 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:10,366 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:10,367 - src.models.climate_pipeline - INFO - Timing: cache=2.7ms
2025-08-16 18:14:10,367 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:10,367 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:14:10,367 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 18:14:10,367 - src.models.conversation_parser - INFO -   Message 1 (user): What is climate change?...
2025-08-16 18:14:10,367 - src.models.conversation_parser - INFO -   Message 2 (assistant): Climate change refers to long-term shifts in global or regional climate patterns....
2025-08-16 18:14:10,367 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=2
2025-08-16 18:14:10,367 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='What are the main causes?'
2025-08-16 18:14:10,367 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='What are the main causes?', norm='What are the main causes?'
2025-08-16 18:14:10,949 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=581 status=OK request_id=338293e5-6fd1-4d84-a74d-d1fd4ed3094b
2025-08-16 18:14:10,949 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a follow-up to the previous climate-related conversation.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What are the main causes of climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:10,949 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:10,949 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='What are the main causes?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is a follow-up to the previous climate-related conversation....'
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What are the main causes of climate change?'
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - Timing: rewrite=582.4ms
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:14:10,949 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:14:10,949 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:14:10,949 - src.models.retrieval - INFO - Query embedding IN: query_len=43 chars, query_repr='What are the main causes of climate change?...'
2025-08-16 18:14:11,566 - src.models.retrieval - INFO - dep=query_embed op=encode ms=616 dense_dim=1024 sparse_tokens=9
2025-08-16 18:14:11,607 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=40 status=OK
2025-08-16 18:14:11,607 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=40 total_ms=40
2025-08-16 18:14:11,861 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=252 status=OK
2025-08-16 18:14:11,861 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:14:11,861 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=253 total_ms=253
2025-08-16 18:14:11,866 - src.models.retrieval - INFO - dep=mmr_embed used_index=8 used_cache=0 embedded=0 ms=0 n_docs=8 valid_vecs=8 q_embed_ms=0
2025-08-16 18:14:11,867 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=10375 n_docs=8
2025-08-16 18:14:12,053 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:14:12,097 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=229.7 status=OK
2025-08-16 18:14:12,097 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.229477197, 'rerank_score': 0.87568074, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.25481236, 'rerank_score': 0.87147486, 'has_values': True}, {'title': '1 S2.0 S0362028x22057118 Main', 'pinecone_score': 0.227353394, 'rerank_score': 0.82544905, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.230635568, 'rerank_score': 0.799129, 'has_values': True}, {'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.242406741, 'rerank_score': 0.7468782, 'has_values': True}]
2025-08-16 18:14:12,097 - src.models.retrieval - INFO - q='What are the main causes of climate change?', base=8, kept_pre=8, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.255, p50_sim_pre=0.231, p95_sim_pre=0.255, blocked_base=0, dropped_top2=[{'segment_id': '4', 'title': '12992 2021 Article 722', 'score': 0.57104915}, {'segment_id': '81', 'title': 'Improving The Use Of Uncertain Climate Information In Decision Making A Behavior', 'score': 0.55724305}]
2025-08-16 18:14:12,097 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:14:12,097 - src.models.climate_pipeline - INFO - Timing: retrieval=1148.2ms
2025-08-16 18:14:12,097 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:14:12,098 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:14:12,098 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:12,101 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:12,101 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:12,102 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:14:12,102 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:14:15,137 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3034 status=OK request_id=c8ea6cff-ec23-4460-a54a-ac317504d2d7
2025-08-16 18:14:15,143 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:14:15,143 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:14:15,143 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:14:15,143 - src.models.climate_pipeline - INFO - Timing: generation=3045.6ms
2025-08-16 18:14:15,143 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:14:16,613 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1469 status=OK request_id=7c64e302-1816-4abf-8c03-5d47a941f2d7
2025-08-16 18:14:16,613 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:14:16,614 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:14:16,614 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:14:16,614 - src.models.climate_pipeline - INFO - Timing: faithfulness=1470.6ms
2025-08-16 18:14:16,614 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:16,615 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:16,615 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:16,616 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:14:16,616 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=582.4 guards=0.0 retrieval=1148.2 generation=3045.6 faithfulness=1470.6 translation=0.0 total=6249.9
2025-08-16 18:14:16,616 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 6.25s
2025-08-16 18:14:16,617 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382450359 time=6.255s model=nova faithfulness=0.950
2025-08-16 18:14:16,617 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=6.258s id=req_1755382450359 ip=127.0.0.1
INFO:     127.0.0.1:61090 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:16,630 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382456629 ip=127.0.0.1
INFO:     127.0.0.1:61158 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:14:17,651 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382457649 query_len=12 lang=en
2025-08-16 18:14:17,652 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Processing query: 'Test query 1...' in english (code: en)
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Raw query repr: 'Test query 1'
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:17,653 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test query 1'
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test query 1'
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:14:17,653 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:17,653 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:17,663 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:17,663 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:17,674 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:17,676 - src.models.climate_pipeline - INFO - Timing: cache=22.8ms
2025-08-16 18:14:17,676 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:17,676 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:17,676 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:17,676 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test query 1'
2025-08-16 18:14:17,676 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test query 1', norm='Test query 1'
2025-08-16 18:14:18,299 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=622 status=OK request_id=70019908-400a-4318-81a8-22357876151e
2025-08-16 18:14:18,299 - query_rewriter - INFO - Model raw (first 300): {"reason":"Initial query without context","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What is the impact of climate change on urban areas?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:18,299 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:18,300 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test query 1...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='Initial query without context...'
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is the impact of climate change on urban areas?'
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - Timing: rewrite=623.7ms
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:14:18,300 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:14:18,300 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:14:18,300 - src.models.retrieval - INFO - Query embedding IN: query_len=52 chars, query_repr='What is the impact of climate change on urban areas?...'
2025-08-16 18:14:19,104 - src.models.retrieval - INFO - dep=query_embed op=encode ms=804 dense_dim=1024 sparse_tokens=11
2025-08-16 18:14:19,153 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=47 status=OK
2025-08-16 18:14:19,153 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=48 total_ms=48
2025-08-16 18:14:19,360 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=206 status=OK
2025-08-16 18:14:19,360 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:14:19,360 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=207 total_ms=207
2025-08-16 18:14:19,364 - src.models.retrieval - INFO - dep=mmr_embed used_index=8 used_cache=0 embedded=0 ms=0 n_docs=8 valid_vecs=8 q_embed_ms=0
2025-08-16 18:14:19,365 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=11591 n_docs=8
2025-08-16 18:14:19,531 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:14:19,554 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=188.8 status=OK
2025-08-16 18:14:19,559 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'IPCC Ar6 Wgii Technicalsummary', 'pinecone_score': 0.258675367, 'rerank_score': 0.98780584, 'has_values': True}, {'title': 'Piis2542519621001352', 'pinecone_score': 0.266726315, 'rerank_score': 0.9874236, 'has_values': True}, {'title': 'Adapting To Climate Change An Introduction For Canadian Municipalities', 'pinecone_score': 0.248497903, 'rerank_score': 0.97640073, 'has_values': True}, {'title': '1 S2.0 S2667278223000767 Main', 'pinecone_score': 0.256623566, 'rerank_score': 0.96814114, 'has_values': True}, {'title': 'The Climate Atlas And Health – Using Climate Maps To Understand The Future Of He', 'pinecone_score': 0.269532263, 'rerank_score': 0.94407386, 'has_values': True}]
2025-08-16 18:14:19,562 - src.models.retrieval - INFO - q='What is the impact of climate change on urban areas?', base=8, kept_pre=8, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.81, delta=0.100, max_sim_pre=0.270, p50_sim_pre=0.257, p95_sim_pre=0.270, blocked_base=0, dropped_top2=[{'segment_id': '[16, 17, 18, 19, 20]', 'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'score': 0.7550956}, {'segment_id': '14', 'title': 'Adapting To Climate Change A Risk Based Guide For Local Governments', 'score': 0.42065907}]
2025-08-16 18:14:19,563 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:14:19,563 - src.models.climate_pipeline - INFO - Timing: retrieval=1262.9ms
2025-08-16 18:14:19,563 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:14:19,563 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:14:19,568 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:19,573 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:19,573 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:19,574 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:14:19,574 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:14:23,279 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3705 status=OK request_id=1f5ddd77-9ef4-40e0-b1ab-620ebfa77bcb
2025-08-16 18:14:23,282 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:14:23,282 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:14:23,283 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:14:23,283 - src.models.climate_pipeline - INFO - Timing: generation=3720.2ms
2025-08-16 18:14:23,283 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:14:24,614 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1325 status=OK request_id=df70197d-7d8a-432c-9126-58653c32335e
2025-08-16 18:14:24,614 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:14:24,614 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:14:24,614 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:14:24,614 - src.models.climate_pipeline - INFO - Timing: faithfulness=1331.3ms
2025-08-16 18:14:24,615 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:24,616 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:24,616 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:24,617 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:14:24,618 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.3 rewrite=623.7 guards=0.0 retrieval=1262.9 generation=3720.2 faithfulness=1331.3 translation=0.0 total=6962.0
2025-08-16 18:14:24,618 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 6.96s
2025-08-16 18:14:24,619 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382457649 time=6.967s model=nova faithfulness=0.950
2025-08-16 18:14:24,620 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=6.971s id=req_1755382457649 ip=127.0.0.1
INFO:     127.0.0.1:61170 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:25,145 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382465143 query_len=12 lang=en
2025-08-16 18:14:25,145 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:25,145 - src.models.climate_pipeline - INFO - Processing query: 'Test query 2...' in english (code: en)
2025-08-16 18:14:25,145 - src.models.climate_pipeline - INFO - Raw query repr: 'Test query 2'
2025-08-16 18:14:25,145 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:25,145 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:25,145 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test query 2'
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test query 2'
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:14:25,146 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:25,146 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:25,147 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:25,147 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:25,147 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:25,150 - src.models.climate_pipeline - INFO - Timing: cache=3.8ms
2025-08-16 18:14:25,150 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:25,150 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:25,150 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:25,150 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test query 2'
2025-08-16 18:14:25,150 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test query 2', norm='Test query 2'
2025-08-16 18:14:25,739 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=588 status=OK request_id=c33a33cf-7fdd-4c78-b6aa-bc57a5bc703c
2025-08-16 18:14:25,739 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in English and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:25,739 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:25,740 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test query 2...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is in English and matches the expected language....'
2025-08-16 18:14:25,740 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:14:25,740 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:14:25,740 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382465143 error=Pipeline processing failed
2025-08-16 18:14:25,740 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382465143 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382465143'}}
2025-08-16 18:14:25,741 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.598s id=req_1755382465143 ip=127.0.0.1
INFO:     127.0.0.1:61241 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:14:26,248 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382466247 query_len=12 lang=en
2025-08-16 18:14:26,248 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Processing query: 'Test query 3...' in english (code: en)
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Raw query repr: 'Test query 3'
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:26,249 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test query 3'
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test query 3'
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:14:26,249 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:26,249 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:26,255 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:26,255 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:26,255 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:26,256 - src.models.climate_pipeline - INFO - Timing: cache=7.2ms
2025-08-16 18:14:26,256 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:26,256 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:26,256 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:26,256 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test query 3'
2025-08-16 18:14:26,256 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test query 3', norm='Test query 3'
2025-08-16 18:14:26,851 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=594 status=OK request_id=f648e485-b938-4091-b396-30184338a3dd
2025-08-16 18:14:26,852 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in English and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:26,852 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:26,852 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test query 3...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is in English and matches the expected language....'
2025-08-16 18:14:26,852 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:14:26,852 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:14:26,852 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382466247 error=Pipeline processing failed
2025-08-16 18:14:26,852 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382466247 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382466247'}}
2025-08-16 18:14:26,853 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.605s id=req_1755382466247 ip=127.0.0.1
INFO:     127.0.0.1:61252 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:14:27,361 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.001s id=req_1755382467359 ip=127.0.0.1
INFO:     127.0.0.1:61268 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:14:27,569 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.000s id=req_1755382467569 ip=127.0.0.1
INFO:     127.0.0.1:61274 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:14:27,778 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.000s id=req_1755382467778 ip=127.0.0.1
INFO:     127.0.0.1:61276 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:14:47,959 - src.webui.api.main - INFO - REQUEST GET /api/v1/invalid status=404 time=0.008s id=req_1755382487951 ip=127.0.0.1
INFO:     127.0.0.1:61505 - "GET /api/v1/invalid HTTP/1.1" 404 Not Found
2025-08-16 18:14:47,964 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382487963 ip=127.0.0.1
INFO:     127.0.0.1:61507 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:14:47,968 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382487966 ip=127.0.0.1
INFO:     127.0.0.1:61509 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:14:47,975 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.002s id=req_1755382487973 ip=127.0.0.1
INFO:     127.0.0.1:61511 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:14:48,982 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382488981 query_len=27 lang=en
2025-08-16 18:14:48,982 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Processing query: 'What causes climate change?...' in english (code: en)
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Raw query repr: 'What causes climate change?'
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:48,983 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Router OUT → english_query='What causes climate change?'
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What causes climate change?'
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Net debug → original_query len=27, utf8_bytes=27
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Net debug → english_query len=27, utf8_bytes=27
2025-08-16 18:14:48,983 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:48,983 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:48,986 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:48,986 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:48,986 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:14:48,987 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382488981 time=0.005s model=nova faithfulness=0.950
2025-08-16 18:14:48,987 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.007s id=req_1755382488981 ip=127.0.0.1
INFO:     127.0.0.1:61521 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:49,999 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382489998 query_len=10 lang=en
2025-08-16 18:14:49,999 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:49,999 - src.models.climate_pipeline - INFO - Processing query: 'Quick test...' in english (code: en)
2025-08-16 18:14:49,999 - src.models.climate_pipeline - INFO - Raw query repr: 'Quick test'
2025-08-16 18:14:49,999 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:49,999 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:50,000 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - Router OUT → english_query='Quick test'
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Quick test'
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - Net debug → original_query len=10, utf8_bytes=10
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - Net debug → english_query len=10, utf8_bytes=10
2025-08-16 18:14:50,000 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:50,000 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:50,002 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:50,002 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:50,002 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:14:50,002 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382489998 time=0.003s model=nova faithfulness=0.700
2025-08-16 18:14:50,003 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.005s id=req_1755382489998 ip=127.0.0.1
INFO:     127.0.0.1:61532 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:50,007 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382490006 query_len=4 lang=en
2025-08-16 18:14:50,007 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Processing query: 'Test...' in english (code: en)
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Raw query repr: 'Test'
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:50,007 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test'
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test'
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Net debug → original_query len=4, utf8_bytes=4
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Net debug → english_query len=4, utf8_bytes=4
2025-08-16 18:14:50,007 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:50,007 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:50,009 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:50,009 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:50,009 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:50,015 - src.models.climate_pipeline - INFO - Timing: cache=7.1ms
2025-08-16 18:14:50,015 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:50,015 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:50,015 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:50,015 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test'
2025-08-16 18:14:50,015 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test', norm='Test'
2025-08-16 18:14:50,685 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=669 status=OK request_id=8f931c36-ab5d-4e76-9f77-9aa33a25d106
2025-08-16 18:14:50,685 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a single word and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:50,686 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:50,686 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a single word and matches the expected language....'
2025-08-16 18:14:50,686 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:14:50,686 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:14:50,687 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382490006 error=Pipeline processing failed
2025-08-16 18:14:50,687 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382490006 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382490006'}}
2025-08-16 18:14:50,687 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.681s id=req_1755382490006 ip=127.0.0.1
2025-08-16 18:14:51,012 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382491010 query_len=23 lang=en
2025-08-16 18:14:51,012 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:51,012 - src.models.climate_pipeline - INFO - Processing query: 'What is global warming?...' in english (code: en)
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Raw query repr: 'What is global warming?'
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:51,013 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is global warming?'
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is global warming?'
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:14:51,013 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:51,013 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:51,014 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:51,014 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:51,015 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:14:51,015 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382491010 time=0.003s model=nova faithfulness=0.950
2025-08-16 18:14:51,016 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.005s id=req_1755382491010 ip=127.0.0.1
INFO:     127.0.0.1:61546 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:51,020 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382491019 query_len=25 lang=en
2025-08-16 18:14:51,020 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:14:51,020 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 18:14:51,020 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:51,020 - src.models.climate_pipeline - INFO - Processing query: 'What are the main causes?...' in english (code: en)
2025-08-16 18:14:51,020 - src.models.climate_pipeline - INFO - Raw query repr: 'What are the main causes?'
2025-08-16 18:14:51,020 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:51,020 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:51,020 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - Router OUT → english_query='What are the main causes?'
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What are the main causes?'
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - Net debug → original_query len=25, utf8_bytes=25
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 18:14:51,021 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:51,021 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:51,028 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:51,028 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:51,030 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:14:51,030 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382491019 time=0.011s model=nova faithfulness=0.950
2025-08-16 18:14:51,031 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.012s id=req_1755382491019 ip=127.0.0.1
INFO:     127.0.0.1:61549 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:51,035 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382491034 ip=127.0.0.1
INFO:     127.0.0.1:61552 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:14:52,044 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382492043 query_len=12 lang=en
2025-08-16 18:14:52,044 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:52,044 - src.models.climate_pipeline - INFO - Processing query: 'Test query 1...' in english (code: en)
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Raw query repr: 'Test query 1'
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:52,045 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test query 1'
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test query 1'
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:14:52,045 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:52,045 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:52,047 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:52,047 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:52,047 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:14:52,048 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382492043 time=0.004s model=nova faithfulness=0.950
2025-08-16 18:14:52,048 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.004s id=req_1755382492043 ip=127.0.0.1
INFO:     127.0.0.1:61562 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:14:52,552 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382492550 query_len=12 lang=en
2025-08-16 18:14:52,552 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Processing query: 'Test query 2...' in english (code: en)
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Raw query repr: 'Test query 2'
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:52,552 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test query 2'
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test query 2'
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:14:52,552 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:52,552 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:52,565 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:52,565 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:52,565 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:52,566 - src.models.climate_pipeline - INFO - Timing: cache=13.6ms
2025-08-16 18:14:52,566 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:52,566 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:52,566 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:52,566 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test query 2'
2025-08-16 18:14:52,566 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test query 2', norm='Test query 2'
2025-08-16 18:14:53,194 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=626 status=OK request_id=d1e65efc-45db-4f25-a1a6-b0add799557b
2025-08-16 18:14:53,202 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in English and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:53,207 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:53,212 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test query 2...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is in English and matches the expected language....'
2025-08-16 18:14:53,212 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:14:53,212 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:14:53,213 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382492550 error=Pipeline processing failed
2025-08-16 18:14:53,213 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382492550 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382492550'}}
2025-08-16 18:14:53,214 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.663s id=req_1755382492550 ip=127.0.0.1
INFO:     127.0.0.1:61573 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:14:53,722 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382493720 query_len=12 lang=en
2025-08-16 18:14:53,722 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Processing query: 'Test query 3...' in english (code: en)
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Raw query repr: 'Test query 3'
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:14:53,722 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Router OUT → english_query='Test query 3'
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Test query 3'
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:14:53,722 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:14:53,722 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:14:53,723 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:14:53,723 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:14:53,724 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:14:53,724 - src.models.climate_pipeline - INFO - Timing: cache=1.7ms
2025-08-16 18:14:53,724 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:14:53,724 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:14:53,724 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:14:53,724 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Test query 3'
2025-08-16 18:14:53,724 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Test query 3', norm='Test query 3'
2025-08-16 18:14:54,214 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=489 status=OK request_id=8e62e50b-2299-440c-a292-c7711d0ab618
2025-08-16 18:14:54,214 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in English and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:14:54,214 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:14:54,214 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Test query 3...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is in English and matches the expected language....'
2025-08-16 18:14:54,214 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:14:54,214 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:14:54,214 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382493720 error=Pipeline processing failed
2025-08-16 18:14:54,214 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382493720 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382493720'}}
2025-08-16 18:14:54,214 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.494s id=req_1755382493720 ip=127.0.0.1
INFO:     127.0.0.1:61585 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:14:54,718 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.000s id=req_1755382494718 ip=127.0.0.1
INFO:     127.0.0.1:61599 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:14:54,927 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.000s id=req_1755382494927 ip=127.0.0.1
INFO:     127.0.0.1:61601 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:14:55,135 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.000s id=req_1755382495134 ip=127.0.0.1
INFO:     127.0.0.1:61603 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:16:33,683 - src.webui.api.routers.languages - INFO - Returning language support: command_a=22 nova=10
2025-08-16 18:16:33,684 - src.webui.api.main - INFO - REQUEST GET /api/v1/languages/supported status=200 time=0.003s id=req_1755382593681 ip=127.0.0.1
INFO:     127.0.0.1:62514 - "GET /api/v1/languages/supported HTTP/1.1" 200 OK
2025-08-16 18:16:33,689 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382593686 query_len=54 lang=en
2025-08-16 18:16:33,689 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change and why should I care about it?...' in english (code: en)
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change and why should I care about it?'
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:16:33,690 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change and why should I care about it?'
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change and why should I care about it?'
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Net debug → original_query len=54, utf8_bytes=54
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Net debug → english_query len=54, utf8_bytes=54
2025-08-16 18:16:33,690 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:16:33,690 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:33,693 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:33,693 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:33,694 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:16:33,695 - src.models.climate_pipeline - INFO - Timing: cache=4.6ms
2025-08-16 18:16:33,695 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:16:33,695 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:16:33,695 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:16:33,695 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='What is climate change and why should I care about it?'
2025-08-16 18:16:33,695 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='What is climate change and why should I care about it?', norm='What is climate change and why should I care about it?'
2025-08-16 18:16:34,579 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=883 status=OK request_id=4bd0b2ff-8224-4369-8da1-b3a269928427
2025-08-16 18:16:34,579 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in English and asks about climate change.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change and why should I care about it?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:16:34,579 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:16:34,579 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='What is climate change and why should I care about...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is in English and asks about climate change....'
2025-08-16 18:16:34,579 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:16:34,579 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change and why should I care about it?'
2025-08-16 18:16:34,579 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:16:34,580 - src.models.climate_pipeline - INFO - Timing: rewrite=884.8ms
2025-08-16 18:16:34,580 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:16:34,580 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:16:34,580 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:16:34,580 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:16:34,580 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:16:34,580 - src.models.retrieval - INFO - Query embedding IN: query_len=54 chars, query_repr='What is climate change and why should I care about it?...'
2025-08-16 18:16:35,202 - src.models.retrieval - INFO - dep=query_embed op=encode ms=622 dense_dim=1024 sparse_tokens=12
2025-08-16 18:16:36,239 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=1036 status=OK
2025-08-16 18:16:36,239 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=1036 total_ms=1036
2025-08-16 18:16:36,647 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=407 status=OK
2025-08-16 18:16:36,647 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:16:36,647 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=408 total_ms=408
2025-08-16 18:16:36,650 - src.models.retrieval - INFO - dep=mmr_embed used_index=4 used_cache=0 embedded=0 ms=0 n_docs=4 valid_vecs=4 q_embed_ms=0
2025-08-16 18:16:36,650 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=1875 n_docs=4
2025-08-16 18:16:36,812 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:16:36,815 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=164.4 status=OK
2025-08-16 18:16:36,816 - src.models.retrieval - INFO - Query embedding IN: query_len=54 chars, query_repr='What is climate change and why should I care about it?...'
2025-08-16 18:16:36,919 - src.models.retrieval - INFO - dep=query_embed op=encode ms=103 dense_dim=1024 sparse_tokens=12
2025-08-16 18:16:37,914 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=253 status=OK
2025-08-16 18:16:37,914 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:16:37,914 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=253 total_ms=253
2025-08-16 18:16:37,937 - src.models.retrieval - ERROR - Error in get_documents: list index out of range
2025-08-16 18:16:37,937 - src.models.climate_pipeline - ERROR - Document retrieval failed: list index out of range
2025-08-16 18:16:37,938 - src.models.climate_pipeline - INFO - Timing: retrieval=3358.6ms
2025-08-16 18:16:38,235 - src.models.climate_pipeline - INFO - Attempting Tavily fallback search (pipeline)
2025-08-16 18:16:38,549 - src.models.climate_pipeline - ERROR - Tavily fallback failed (pipeline): 'str' object has no attribute 'get'
2025-08-16 18:16:38,549 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:16:38,549 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:16:38,549 - src.models.gen_response_unified - WARNING - No documents provided for processing
2025-08-16 18:16:38,549 - src.models.gen_response_unified - ERROR - No documents and no conversation history available
2025-08-16 18:16:38,551 - src.models.gen_response_unified - ERROR - Error in nova response generation: No valid documents to process
2025-08-16 18:16:38,551 - src.models.climate_pipeline - ERROR - Response generation failed: No valid documents to process
2025-08-16 18:16:38,551 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382593686 error=Pipeline processing failed
2025-08-16 18:16:38,551 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382593686 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382593686'}}
2025-08-16 18:16:38,551 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=4.865s id=req_1755382593686 ip=127.0.0.1
INFO:     127.0.0.1:62516 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:16:38,556 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.001s id=req_1755382598555 ip=127.0.0.1
INFO:     127.0.0.1:62567 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 18:16:40,575 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382600574 query_len=23 lang=en
2025-08-16 18:16:40,579 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:16:40,581 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:16:40,582 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:16:40,582 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:16:40,582 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:16:40,582 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:16:40,582 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:16:40,583 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:16:40,583 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:16:40,583 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:16:40,583 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-16 18:16:40,583 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:16:40,583 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:16:40,583 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:16:40,584 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:40,588 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:40,588 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:40,589 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:16:40,589 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382600574 time=0.013s model=nova faithfulness=0.950
2025-08-16 18:16:40,589 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.015s id=req_1755382600574 ip=127.0.0.1
INFO:     127.0.0.1:62585 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:16:41,096 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382601095 query_len=25 lang=en
2025-08-16 18:16:41,097 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:16:41,097 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 18:16:41,097 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Processing query: 'What are the main causes?...' in english (code: en)
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Raw query repr: 'What are the main causes?'
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:16:41,097 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Router OUT → english_query='What are the main causes?'
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What are the main causes?'
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Net debug → original_query len=25, utf8_bytes=25
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 18:16:41,097 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:16:41,097 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:41,099 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:41,099 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:41,100 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:16:41,100 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382601095 time=0.004s model=nova faithfulness=0.950
2025-08-16 18:16:41,101 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.005s id=req_1755382601095 ip=127.0.0.1
INFO:     127.0.0.1:62596 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:16:41,610 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382601609 query_len=35 lang=en
2025-08-16 18:16:41,610 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 18:16:41,610 - src.webui.api.routers.chat - INFO - Parsed conversation history: 4 messages
2025-08-16 18:16:41,610 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Processing query: 'How does it affect the environment?...' in english (code: en)
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Raw query repr: 'How does it affect the environment?'
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:16:41,611 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Router OUT → english_query='How does it affect the environment?'
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Router OUT → processed_query='How does it affect the environment?'
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Net debug → original_query len=35, utf8_bytes=35
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Net debug → english_query len=35, utf8_bytes=35
2025-08-16 18:16:41,611 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:16:41,611 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:41,612 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:41,612 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:41,612 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:16:41,613 - src.models.climate_pipeline - INFO - Timing: cache=1.8ms
2025-08-16 18:16:41,613 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:16:41,613 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 18:16:41,613 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 18:16:41,613 - src.models.conversation_parser - INFO -   Message 1 (user): What is climate change?...
2025-08-16 18:16:41,613 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Understanding Climate Change

## What is Climate Change?

Climate change refers to a persistent, l...
2025-08-16 18:16:41,613 - src.models.conversation_parser - INFO -   Message 3 (user): What are the main causes?...
2025-08-16 18:16:41,613 - src.models.conversation_parser - INFO -   Message 4 (assistant): # Main Causes of Climate Change

## Overview

Climate change is a complex issue with multiple causes...
2025-08-16 18:16:41,613 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=4
2025-08-16 18:16:41,613 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='How does it affect the environment?'
2025-08-16 18:16:41,613 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='How does it affect the environment?', norm='How does it affect the environment?'
2025-08-16 18:16:42,379 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=765 status=OK request_id=feca423d-7e09-498d-8b61-802c31a6db02
2025-08-16 18:16:42,379 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about the effects of climate change on the environment, which is on-topic.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"How does climate change affect the environment?","ask_how_to_use":false,"how_it_works":null,"e
2025-08-16 18:16:42,379 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:16:42,379 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='How does it affect the environment?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about the effects of climate change on the environment, which is on-topic....'
2025-08-16 18:16:42,379 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:16:42,380 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='How does climate change affect the environment?'
2025-08-16 18:16:42,380 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:16:42,380 - src.models.climate_pipeline - INFO - Timing: rewrite=766.9ms
2025-08-16 18:16:42,380 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:16:42,380 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:16:42,380 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:16:42,380 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:16:42,380 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:16:42,380 - src.models.retrieval - INFO - Query embedding IN: query_len=47 chars, query_repr='How does climate change affect the environment?...'
2025-08-16 18:16:43,012 - src.models.retrieval - INFO - dep=query_embed op=encode ms=631 dense_dim=1024 sparse_tokens=8
2025-08-16 18:16:43,060 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=47 status=OK
2025-08-16 18:16:43,060 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=47 total_ms=47
2025-08-16 18:16:43,164 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=104 status=OK
2025-08-16 18:16:43,164 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:16:43,164 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=104 total_ms=104
2025-08-16 18:16:43,166 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:16:43,167 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=9077 n_docs=7
2025-08-16 18:16:43,299 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:16:43,301 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=134.2 status=OK
2025-08-16 18:16:43,302 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'National Adaptation Strategy For Canada Canada.ca', 'pinecone_score': 0.292985022, 'rerank_score': 0.9980276, 'has_values': True}, {'title': '1 S2.0 S2667278221000778 Main', 'pinecone_score': 0.256917, 'rerank_score': 0.9832145, 'has_values': True}, {'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'pinecone_score': 0.25887394, 'rerank_score': 0.98123896, 'has_values': True}, {'title': 'Nihms 984726', 'pinecone_score': 0.272472799, 'rerank_score': 0.90481883, 'has_values': True}, {'title': 'Government Of Canada Adaptation Action Plan Canada.ca', 'pinecone_score': 0.249464586, 'rerank_score': 0.83467656, 'has_values': True}]
2025-08-16 18:16:43,302 - src.models.retrieval - INFO - q='How does climate change affect the environment?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.293, p50_sim_pre=0.257, p95_sim_pre=0.293, blocked_base=1, dropped_top2=[{'segment_id': '[7, 8, 9, 10, 11, 12, 13, 14]', 'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'score': 0.30933657}, {'segment_id': '6', 'title': '1 S2.0 S0362028x22057118 Main', 'score': 0.1799625}]
2025-08-16 18:16:43,303 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:16:43,303 - src.models.climate_pipeline - INFO - Timing: retrieval=922.9ms
2025-08-16 18:16:43,303 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:16:43,303 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:16:43,303 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:43,318 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:43,318 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:43,319 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:16:43,319 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:16:43,583 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=263 status=OK request_id=89c78a0b-ebbd-421e-9330-f499db7f3018
2025-08-16 18:16:43,584 - src.models.gen_response_unified - INFO - Optimized conversation history for nova
2025-08-16 18:16:48,076 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4492 status=OK request_id=00010e70-fd0e-41d1-b4dc-8766983959a3
2025-08-16 18:16:48,080 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:16:48,080 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:16:48,081 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:16:48,081 - src.models.climate_pipeline - INFO - Timing: generation=4778.0ms
2025-08-16 18:16:48,081 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:16:49,561 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1479 status=OK request_id=e83aa279-b6eb-4635-b776-a5cc7e67a3ca
2025-08-16 18:16:49,562 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:16:49,562 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:16:49,562 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:16:49,562 - src.models.climate_pipeline - INFO - Timing: faithfulness=1481.0ms
2025-08-16 18:16:49,562 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:49,564 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:49,564 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:49,565 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:16:49,566 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=766.9 guards=0.0 retrieval=922.9 generation=4778.0 faithfulness=1481.0 translation=0.0 total=7951.2
2025-08-16 18:16:49,566 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 7.95s
2025-08-16 18:16:49,566 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382601609 time=7.956s model=nova faithfulness=0.950
2025-08-16 18:16:49,567 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=7.958s id=req_1755382601609 ip=127.0.0.1
INFO:     127.0.0.1:62599 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:16:50,086 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382610084 query_len=21 lang=en
2025-08-16 18:16:50,086 - src.models.conversation_parser - INFO - Parsed 6 messages from conversation history
2025-08-16 18:16:50,086 - src.webui.api.routers.chat - INFO - Parsed conversation history: 6 messages
2025-08-16 18:16:50,086 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:16:50,086 - src.models.climate_pipeline - INFO - Processing query: 'What solutions exist?...' in english (code: en)
2025-08-16 18:16:50,086 - src.models.climate_pipeline - INFO - Raw query repr: 'What solutions exist?'
2025-08-16 18:16:50,086 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:16:50,086 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:16:50,087 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - Router OUT → english_query='What solutions exist?'
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What solutions exist?'
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - Net debug → original_query len=21, utf8_bytes=21
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - Net debug → english_query len=21, utf8_bytes=21
2025-08-16 18:16:50,087 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:16:50,087 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:50,088 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:50,088 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:50,088 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:16:50,089 - src.models.climate_pipeline - INFO - Timing: cache=2.2ms
2025-08-16 18:16:50,089 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO - Parsed 6 messages from conversation history
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO -   Message 1 (user): What is climate change?...
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Understanding Climate Change

## What is Climate Change?

Climate change refers to a persistent, l...
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO -   Message 3 (user): What are the main causes?...
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO -   Message 4 (assistant): # Main Causes of Climate Change

## Overview

Climate change is a complex issue with multiple causes...
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO -   Message 5 (user): How does it affect the environment?...
2025-08-16 18:16:50,089 - src.models.conversation_parser - INFO -   Message 6 (assistant): # How Does Climate Change Affect the Environment?

## Overview

Climate change impacts the environme...
2025-08-16 18:16:50,089 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=6
2025-08-16 18:16:50,089 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='What solutions exist?'
2025-08-16 18:16:50,089 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='What solutions exist?', norm='What solutions exist?'
2025-08-16 18:16:50,840 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=750 status=OK request_id=c590a01f-9762-4d32-86b3-e7831ec5e67b
2025-08-16 18:16:50,841 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a direct follow-up to the previous conversation about climate change impacts.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What solutions exist to mitigate the effects of climate change?","ask_how_to_use":false,"ho
2025-08-16 18:16:50,841 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:16:50,841 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='What solutions exist?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is a direct follow-up to the previous conversation about climate change impacts....'
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What solutions exist to mitigate the effects of climate change?'
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - Timing: rewrite=752.1ms
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:16:50,841 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:16:50,841 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:16:50,841 - src.models.retrieval - INFO - Query embedding IN: query_len=63 chars, query_repr='What solutions exist to mitigate the effects of climate change?...'
2025-08-16 18:16:51,515 - src.models.retrieval - INFO - dep=query_embed op=encode ms=673 dense_dim=1024 sparse_tokens=13
2025-08-16 18:16:51,555 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=39 status=OK
2025-08-16 18:16:51,555 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=39 total_ms=39
2025-08-16 18:16:51,710 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=154 status=OK
2025-08-16 18:16:51,710 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:16:51,710 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=154 total_ms=154
2025-08-16 18:16:51,712 - src.models.retrieval - INFO - dep=mmr_embed used_index=8 used_cache=0 embedded=0 ms=0 n_docs=8 valid_vecs=8 q_embed_ms=0
2025-08-16 18:16:51,713 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=11920 n_docs=8
2025-08-16 18:16:52,039 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:16:52,042 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=329.6 status=OK
2025-08-16 18:16:52,043 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Piis2542519621001352', 'pinecone_score': 0.256989509, 'rerank_score': 0.9735945, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.297824502, 'rerank_score': 0.92290026, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.255312413, 'rerank_score': 0.74576885, 'has_values': True}, {'title': '1 S2.0 S0362028x22057118 Main', 'pinecone_score': 0.279517174, 'rerank_score': 0.695338, 'has_values': True}, {'title': 'Climate Change And Water Quality In The Great Lakes Basin', 'pinecone_score': 0.25166446, 'rerank_score': 0.28417853, 'has_values': True}]
2025-08-16 18:16:52,043 - src.models.retrieval - INFO - q='What solutions exist to mitigate the effects of climate chan', base=8, kept_pre=8, refill=0, final_before=4, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.298, p50_sim_pre=0.263, p95_sim_pre=0.298, blocked_base=0, dropped_top2=[{'segment_id': '315', 'title': 'Climate Change And Water Quality In The Great Lakes Basin', 'score': 0.28417853}, {'segment_id': '21', 'title': '11356 2022 Article 19718', 'score': 0.28170192}]
2025-08-16 18:16:52,043 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:16:52,043 - src.models.climate_pipeline - INFO - Timing: retrieval=1201.8ms
2025-08-16 18:16:52,043 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:16:52,043 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:16:52,043 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:52,045 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:52,045 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:52,045 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:16:52,045 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:16:52,775 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=729 status=OK request_id=2ccf0960-fb7e-4050-b485-49adca17ab58
2025-08-16 18:16:52,776 - src.models.gen_response_unified - INFO - Optimized conversation history for nova
2025-08-16 18:16:57,597 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4820 status=OK request_id=883df069-aea5-4247-8f79-a9a0d83ff1f7
2025-08-16 18:16:57,601 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:16:57,601 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:16:57,602 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:16:57,602 - src.models.climate_pipeline - INFO - Timing: generation=5558.7ms
2025-08-16 18:16:57,602 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:16:59,904 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2300 status=OK request_id=47313f6e-d2db-4920-baf5-6b0d4f8d438d
2025-08-16 18:16:59,904 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 18:16:59,905 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 18:16:59,905 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:16:59,905 - src.models.climate_pipeline - INFO - Timing: faithfulness=2302.7ms
2025-08-16 18:16:59,905 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:16:59,907 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:16:59,907 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:16:59,907 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:16:59,908 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=752.1 guards=0.0 retrieval=1201.8 generation=5558.7 faithfulness=2302.7 translation=0.0 total=9818.3
2025-08-16 18:16:59,908 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 9.82s
2025-08-16 18:16:59,909 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382610084 time=9.823s model=nova faithfulness=0.900
2025-08-16 18:16:59,910 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=9.826s id=req_1755382610084 ip=127.0.0.1
INFO:     127.0.0.1:62683 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:17:02,454 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382622447 query_len=23 lang=en
2025-08-16 18:17:02,455 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:02,458 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:17:02,458 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:17:02,458 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:02,458 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:02,459 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - Timing: routing=1.1ms
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:17:02,459 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:02,459 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:02,462 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:02,462 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:02,470 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:17:02,471 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382622447 time=0.018s model=nova faithfulness=0.950
2025-08-16 18:17:02,472 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.025s id=req_1755382622447 ip=127.0.0.1
INFO:     127.0.0.1:62792 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:17:02,477 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382622476 query_len=35 lang=es
2025-08-16 18:17:02,478 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:17:02,478 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 18:17:02,478 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Processing query: '¿Cuáles son las principales causas?...' in spanish (code: es)
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Raw query repr: '¿Cuáles son las principales causas?'
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:02,478 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Cuáles son las principales causas?'
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Cuáles son las principales causas?'
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:17:02,478 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 18:17:02,478 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 18:17:02,478 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 18:17:02,478 - src.models.query_routing - INFO - Router NET IN → query repr='¿Cuáles son las principales causas?'
2025-08-16 18:17:02,752 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=273 status=OK request_id=0bf55f17-e211-4d25-8701-8d9e52f5c408
2025-08-16 18:17:02,756 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:17:02,786 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What are the main causes?'
2025-08-16 18:17:02,786 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are the main causes?'
2025-08-16 18:17:02,786 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are the main causes?'
2025-08-16 18:17:02,786 - src.models.climate_pipeline - INFO - Net debug → original_query len=35, utf8_bytes=37
2025-08-16 18:17:02,786 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 18:17:02,786 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:02,794 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:02,840 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:02,840 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:02,841 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 18:17:02,852 - src.models.climate_pipeline - INFO - Timing: cache=65.6ms
2025-08-16 18:17:02,853 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:02,853 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:17:02,853 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 18:17:02,853 - src.models.conversation_parser - INFO -   Message 1 (user): What is climate change?...
2025-08-16 18:17:02,853 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Understanding Climate Change

## What is Climate Change?

Climate change refers to a persistent, l...
2025-08-16 18:17:02,853 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=2
2025-08-16 18:17:02,853 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='¿Cuáles son las principales causas?'
2025-08-16 18:17:02,857 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='¿Cuáles son las principales causas?', norm='¿Cuáles son las principales causas?'
2025-08-16 18:17:03,462 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=601 status=OK request_id=730f611e-a2b7-43fc-8550-1de827848703
2025-08-16 18:17:03,462 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and related to climate change causes.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"What are the main causes of climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:17:03,462 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:03,463 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='¿Cuáles son las principales causas?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and related to climate change causes....'
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What are the main causes of climate change?'
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - Timing: rewrite=610.3ms
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:17:03,463 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:17:03,463 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:17:03,463 - src.models.retrieval - INFO - Query embedding IN: query_len=43 chars, query_repr='What are the main causes of climate change?...'
2025-08-16 18:17:04,131 - src.models.retrieval - INFO - dep=query_embed op=encode ms=668 dense_dim=1024 sparse_tokens=9
2025-08-16 18:17:04,270 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=138 status=OK
2025-08-16 18:17:04,271 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=138 total_ms=138
2025-08-16 18:17:04,647 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=376 status=OK
2025-08-16 18:17:04,647 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:17:04,647 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=376 total_ms=376
2025-08-16 18:17:04,649 - src.models.retrieval - INFO - dep=mmr_embed used_index=8 used_cache=0 embedded=0 ms=0 n_docs=8 valid_vecs=8 q_embed_ms=0
2025-08-16 18:17:04,650 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=10375 n_docs=8
2025-08-16 18:17:04,886 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:17:04,899 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=249.2 status=OK
2025-08-16 18:17:04,900 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.229477197, 'rerank_score': 0.87568074, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.25481236, 'rerank_score': 0.87147486, 'has_values': True}, {'title': '1 S2.0 S0362028x22057118 Main', 'pinecone_score': 0.227353394, 'rerank_score': 0.82544905, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.230635568, 'rerank_score': 0.799129, 'has_values': True}, {'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.242406741, 'rerank_score': 0.7468782, 'has_values': True}]
2025-08-16 18:17:04,900 - src.models.retrieval - INFO - q='What are the main causes of climate change?', base=8, kept_pre=8, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.255, p50_sim_pre=0.231, p95_sim_pre=0.255, blocked_base=0, dropped_top2=[{'segment_id': '4', 'title': '12992 2021 Article 722', 'score': 0.57104915}, {'segment_id': '81', 'title': 'Improving The Use Of Uncertain Climate Information In Decision Making A Behavior', 'score': 0.55724305}]
2025-08-16 18:17:04,900 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:17:04,900 - src.models.climate_pipeline - INFO - Timing: retrieval=1437.1ms
2025-08-16 18:17:04,900 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:17:04,900 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:17:04,900 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:04,905 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:04,905 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:04,908 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 18:17:04,908 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:17:04,908 - src.models.climate_pipeline - INFO - Timing: generation=8.0ms
2025-08-16 18:17:04,908 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:17:06,096 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1186 status=OK request_id=77d603e8-880d-494e-b309-2be9ed32da74
2025-08-16 18:17:06,097 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:17:06,097 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:17:06,097 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:17:06,097 - src.models.climate_pipeline - INFO - Timing: faithfulness=1188.4ms
2025-08-16 18:17:06,097 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 18:17:09,357 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3259 status=OK request_id=4984c11e-f769-4daf-8020-a9bc8689d74b
2025-08-16 18:17:09,357 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 18:17:09,358 - src.models.climate_pipeline - INFO - Timing: translation=3260.7ms
2025-08-16 18:17:09,358 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:09,360 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:09,360 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:09,361 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 18:17:09,362 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 18:17:09,363 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=610.3 guards=0.0 retrieval=1437.1 generation=8.0 faithfulness=1188.4 translation=3260.7 total=6879.8
2025-08-16 18:17:09,363 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 6.88s
2025-08-16 18:17:09,363 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382622476 time=6.886s model=nova faithfulness=0.950
2025-08-16 18:17:09,364 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=6.888s id=req_1755382622476 ip=127.0.0.1
INFO:     127.0.0.1:62795 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:17:09,380 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382629378 query_len=27 lang=fr
2025-08-16 18:17:09,380 - src.webui.api.routers.chat - INFO - Language routing: detected=fr model=command_a
2025-08-16 18:17:09,380 - src.models.climate_pipeline - INFO - Processing query: 'Quelles sont les solutions?...' in french (code: fr)
2025-08-16 18:17:09,380 - src.models.climate_pipeline - INFO - Raw query repr: 'Quelles sont les solutions?'
2025-08-16 18:17:09,380 - src.models.climate_pipeline - INFO - Router IN → language_name=french, language_code=fr
2025-08-16 18:17:09,380 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:09,380 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:17:09,380 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 18:17:09,380 - src.models.climate_pipeline - INFO - Router OUT → english_query='Quelles sont les solutions?'
2025-08-16 18:17:09,381 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Quelles sont les solutions?'
2025-08-16 18:17:09,381 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 18:17:09,381 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:17:09,381 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 18:17:09,381 - src.models.query_routing - INFO - Language: french (fr) → Model: Command-A
2025-08-16 18:17:09,381 - src.models.query_routing - INFO - Translating query from french to English
2025-08-16 18:17:09,381 - src.models.query_routing - INFO - Router NET IN → query repr='Quelles sont les solutions?'
2025-08-16 18:17:09,633 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 18:17:09,635 - src.models.query_routing - INFO - Translation successful
2025-08-16 18:17:09,635 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What are the solutions?'
2025-08-16 18:17:09,635 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are the solutions?'
2025-08-16 18:17:09,635 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are the solutions?'
2025-08-16 18:17:09,635 - src.models.climate_pipeline - INFO - Net debug → original_query len=27, utf8_bytes=27
2025-08-16 18:17:09,635 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:17:09,635 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:09,636 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:09,638 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:09,638 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:09,638 - src.models.climate_pipeline - INFO - Cache miss for french query
2025-08-16 18:17:09,639 - src.models.climate_pipeline - INFO - Timing: cache=3.7ms
2025-08-16 18:17:09,639 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:09,639 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:09,640 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=fr, history_len=0
2025-08-16 18:17:09,640 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Quelles sont les solutions?'
2025-08-16 18:17:09,640 - query_rewriter - INFO - Rewriter NET IN → expected_lang=fr, user_query repr='Quelles sont les solutions?', norm='Quelles sont les solutions?'
2025-08-16 18:17:10,233 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=592 status=OK request_id=4c9d83ea-56b8-47d3-a446-d32184012745
2025-08-16 18:17:10,234 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in French and asks about climate solutions.","language":"fr","expected_language":"fr","language_match":true,"classification":"on-topic","rewrite_en":"What are the solutions?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:17:10,234 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:10,234 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Quelles sont les solutions?...' expected_lang=fr detected_lang=fr classification=on-topic language_match=True reason='User query is in French and asks about climate solutions....'
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='fr', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What are the solutions?'
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - Timing: rewrite=594.6ms
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:17:10,234 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:17:10,234 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:17:10,234 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What are the solutions?...'
2025-08-16 18:17:10,854 - src.models.retrieval - INFO - dep=query_embed op=encode ms=619 dense_dim=1024 sparse_tokens=5
2025-08-16 18:17:10,915 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=60 status=OK
2025-08-16 18:17:10,915 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=60 total_ms=60
2025-08-16 18:17:11,022 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=106 status=OK
2025-08-16 18:17:11,022 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:17:11,022 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=107 total_ms=107
2025-08-16 18:17:11,023 - src.models.retrieval - INFO - dep=mmr_embed used_index=3 used_cache=0 embedded=0 ms=0 n_docs=3 valid_vecs=3 q_embed_ms=0
2025-08-16 18:17:11,025 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=2329 n_docs=3
2025-08-16 18:17:11,180 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:17:11,183 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=157.0 status=OK
2025-08-16 18:17:11,184 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What are the solutions?...'
2025-08-16 18:17:11,258 - src.models.retrieval - INFO - dep=query_embed op=encode ms=74 dense_dim=1024 sparse_tokens=5
2025-08-16 18:17:12,112 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=320 status=OK
2025-08-16 18:17:12,112 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:17:12,112 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=320 total_ms=320
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: ijerph-18-00040
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278223000950-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: Forest Adaptation Resources- climate change tools and approaches for land managers. 2nd edition
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: ijerph-18-02547
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: Nature is infrastructure- How to include natural assets in asset management plans
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: Climate Change and Water Quality in the Great Lakes Basin
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: Indigenous Rights and Sovereignty in National Climate Policies- A Systematic Analysis
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: Indigenous Rights and Sovereignty in National Climate Policies- A Systematic Analysis
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: PHN-38-321
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: ijerph-18-02547
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: Indigenous Rights and Sovereignty in National Climate Policies- A Systematic Analysis
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: Indigenous Rights and Sovereignty in National Climate Policies- A Systematic Analysis
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,113 - src.models.retrieval - WARNING - Content too short after cleaning for document: 1-s2.0-S2667278222000050-main
2025-08-16 18:17:12,115 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=41539 n_docs=33
2025-08-16 18:17:12,289 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:17:12,292 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=177.4 status=OK
2025-08-16 18:17:12,293 - src.models.retrieval - INFO - Retained docs preview: [{'title': '51 2012 0089', 'pinecone_score': 0.0761526, 'rerank_score': 0.7132319, 'has_values': True}, {'title': 'Connecting Climate Change And Health – A Guidebook Of Health And Climate Change ', 'pinecone_score': 0.070159547, 'rerank_score': 0.61520344, 'has_values': True}, {'title': 'Uow Icca 2022 10 Nature On The Balance Sheet', 'pinecone_score': 0.0874749944, 'rerank_score': 0.27776673, 'has_values': True}, {'title': 'Kgac007', 'pinecone_score': 0.074599959, 'rerank_score': 0.24944726, 'has_values': True}, {'title': 'Transformto Net Zero Framework Technical Report Part 3', 'pinecone_score': 0.0738271773, 'rerank_score': 0.20402452, 'has_values': True}]
2025-08-16 18:17:12,293 - src.models.retrieval - INFO - q='What are the solutions?', base=3, kept_pre=3, refill=0, final_before=0, final_after=5, hybrid_refill=5, floor=0.60, delta=0.100, max_sim_pre=0.227, p50_sim_pre=0.196, p95_sim_pre=0.227, blocked_base=0, dropped_top2=[{'segment_id': '18', 'title': 'Piis2542519621001352', 'score': 0.123365626}, {'segment_id': '1', 'title': 'Natural And Nature Based Climate Change Adaptation Community Of Practice', 'score': 0.001867566}]
2025-08-16 18:17:12,294 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:17:12,294 - src.models.climate_pipeline - INFO - Timing: retrieval=2059.9ms
2025-08-16 18:17:12,294 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Command-A)
2025-08-16 18:17:12,294 - src.models.gen_response_unified - INFO - Starting cohere response generation
2025-08-16 18:17:12,294 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:12,297 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:12,297 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:12,297 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:17:12,297 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for cohere
2025-08-16 18:17:20,100 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 18:17:20,115 - src.models.gen_response_unified - INFO - cohere response cached successfully
2025-08-16 18:17:20,115 - src.models.gen_response_unified - INFO - cohere response generation complete
2025-08-16 18:17:20,115 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:17:20,115 - src.models.climate_pipeline - INFO - Timing: generation=7820.8ms
2025-08-16 18:17:20,115 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:17:22,580 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2464 status=OK request_id=f8aee9fe-92f8-49a4-876d-cddd10369dda
2025-08-16 18:17:22,582 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:17:22,583 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:17:22,583 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:17:22,583 - src.models.climate_pipeline - INFO - Timing: faithfulness=2467.7ms
2025-08-16 18:17:22,583 - src.models.climate_pipeline - INFO - Step 8: Translating response to french (code=fr)
2025-08-16 18:17:28,839 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=6255 status=OK request_id=519056f9-37ce-42f0-88b0-7923a00239c2
2025-08-16 18:17:28,866 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to french
2025-08-16 18:17:28,867 - src.models.climate_pipeline - INFO - Timing: translation=6284.0ms
2025-08-16 18:17:28,868 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:28,871 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:28,871 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:28,872 - src.models.climate_pipeline - INFO - ✓ Response cached in french
2025-08-16 18:17:28,873 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 18:17:28,875 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=594.6 guards=0.0 retrieval=2059.9 generation=7820.8 faithfulness=2467.7 translation=6284.0 total=19487.1
2025-08-16 18:17:28,875 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 19.49s
2025-08-16 18:17:28,876 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382629378 time=19.496s model=command_a faithfulness=0.950
2025-08-16 18:17:28,878 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=19.499s id=req_1755382629378 ip=127.0.0.1
INFO:     127.0.0.1:62876 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:17:30,972 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382650970 query_len=35 lang=en
2025-08-16 18:17:30,972 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:30,972 - src.models.climate_pipeline - INFO - Processing query: 'Quick climate facts for mobile user...' in english (code: en)
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Raw query repr: 'Quick climate facts for mobile user'
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:30,973 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Router OUT → english_query='Quick climate facts for mobile user'
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Quick climate facts for mobile user'
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Net debug → original_query len=35, utf8_bytes=35
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Net debug → english_query len=35, utf8_bytes=35
2025-08-16 18:17:30,973 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:30,973 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:30,974 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:30,974 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:30,975 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:30,975 - src.models.climate_pipeline - INFO - Timing: cache=2.4ms
2025-08-16 18:17:30,975 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:30,975 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:30,976 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:30,976 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Quick climate facts for mobile user'
2025-08-16 18:17:30,976 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Quick climate facts for mobile user', norm='Quick climate facts for mobile user'
2025-08-16 18:17:31,573 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=596 status=OK request_id=8f2a8226-3904-4472-921b-8c557d40bc9a
2025-08-16 18:17:31,574 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a request for climate information.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What are some quick climate facts for mobile users?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:17:31,574 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:31,574 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Quick climate facts for mobile user...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is a request for climate information....'
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What are some quick climate facts for mobile users?'
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - Timing: rewrite=598.4ms
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:17:31,574 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:17:31,574 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:17:31,574 - src.models.retrieval - INFO - Query embedding IN: query_len=51 chars, query_repr='What are some quick climate facts for mobile users?...'
2025-08-16 18:17:32,296 - src.models.retrieval - INFO - dep=query_embed op=encode ms=722 dense_dim=1024 sparse_tokens=11
2025-08-16 18:17:32,332 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=34 status=OK
2025-08-16 18:17:32,332 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=35 total_ms=35
2025-08-16 18:17:32,415 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=82 status=OK
2025-08-16 18:17:32,415 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:17:32,415 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=82 total_ms=82
2025-08-16 18:17:32,419 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:17:32,420 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8208 n_docs=7
2025-08-16 18:17:32,558 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:17:32,568 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=148.0 status=OK
2025-08-16 18:17:32,570 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Climate Change Factsheet', 'pinecone_score': 0.198585168, 'rerank_score': 0.032836955, 'has_values': True}, {'title': 'Uow Icca 2022 04 Irreversible Extreme Heat', 'pinecone_score': 0.194791615, 'rerank_score': 0.03234433, 'has_values': True}, {'title': 'Adaptation Framework By Up North Climate', 'pinecone_score': 0.207563952, 'rerank_score': 0.016914913, 'has_values': True}, {'title': '1 S2.0 S2667278224000233 Main', 'pinecone_score': 0.226878151, 'rerank_score': 0.015784562, 'has_values': True}, {'title': 'A Guidebook On Climate Scenarios Using Climate Information To Guide Adaptation R', 'pinecone_score': 0.201825067, 'rerank_score': 0.0012497094, 'has_values': True}]
2025-08-16 18:17:32,570 - src.models.retrieval - INFO - q='What are some quick climate facts for mobile users?', base=7, kept_pre=7, refill=0, final_before=0, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.227, p50_sim_pre=0.201, p95_sim_pre=0.227, blocked_base=0, dropped_top2=[{'segment_id': '10', 'title': 'Climate Change Factsheet', 'score': 0.032836955}, {'segment_id': '71', 'title': 'Uow Icca 2022 04 Irreversible Extreme Heat', 'score': 0.03234433}]
2025-08-16 18:17:32,570 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:17:32,570 - src.models.climate_pipeline - INFO - Timing: retrieval=996.1ms
2025-08-16 18:17:32,570 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:17:32,570 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:17:32,570 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:32,572 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:32,572 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:32,575 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:17:32,575 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:17:35,755 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3180 status=OK request_id=f3f5c13b-e093-4270-a7f1-6dc472943fcc
2025-08-16 18:17:35,760 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:17:35,760 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:17:35,761 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:17:35,761 - src.models.climate_pipeline - INFO - Timing: generation=3190.6ms
2025-08-16 18:17:35,761 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:17:37,801 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2039 status=OK request_id=40880dd6-dc1c-4284-b8b1-c6992427b69b
2025-08-16 18:17:37,802 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:17:37,802 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:17:37,802 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:17:37,802 - src.models.climate_pipeline - INFO - Timing: faithfulness=2041.2ms
2025-08-16 18:17:37,802 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:37,804 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:37,804 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:37,805 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:17:37,806 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.3 rewrite=598.4 guards=0.0 retrieval=996.1 generation=3190.6 faithfulness=2041.2 translation=0.0 total=6829.6
2025-08-16 18:17:37,806 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 6.83s
2025-08-16 18:17:37,806 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382650970 time=6.834s model=nova faithfulness=0.950
2025-08-16 18:17:37,806 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=6.836s id=req_1755382650970 ip=127.0.0.1
INFO:     127.0.0.1:63083 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:17:37,813 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382657811 query_len=12 lang=en
2025-08-16 18:17:37,813 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:37,813 - src.models.climate_pipeline - INFO - Processing query: 'Touch test 1...' in english (code: en)
2025-08-16 18:17:37,813 - src.models.climate_pipeline - INFO - Raw query repr: 'Touch test 1'
2025-08-16 18:17:37,813 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:37,813 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:37,813 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - Router OUT → english_query='Touch test 1'
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Touch test 1'
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:17:37,814 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:37,814 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:37,815 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:37,815 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:37,816 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:37,817 - src.models.climate_pipeline - INFO - Timing: cache=3.6ms
2025-08-16 18:17:37,817 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:37,817 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:37,817 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:37,817 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Touch test 1'
2025-08-16 18:17:37,817 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Touch test 1', norm='Touch test 1'
2025-08-16 18:17:39,008 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1190 status=OK request_id=8438b18c-6e07-469d-9d5a-a514092ac67c
2025-08-16 18:17:39,008 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a short, generic follow-up and recent conversation is not available, so it is treated as an instruction.","language":"en","expected_language":"en","language_match":true,"classification":"instruction","rewrite_en":null,"ask_how_to_use":true,"how_it_works":"How It Works\nChoos
2025-08-16 18:17:39,008 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:39,009 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Touch test 1...' expected_lang=en detected_lang=en classification=instruction language_match=True reason='User query is a short, generic follow-up and recent conversation is not available, so it is treated ...'
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='instruction', language_match='yes', canned=False
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - ✓ Query rewriting skipped (JSON) - no enhancement needed
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - Timing: rewrite=1191.3ms
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:17:39,009 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:17:39,009 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:17:39,009 - src.models.retrieval - INFO - Query embedding IN: query_len=12 chars, query_repr='Touch test 1...'
2025-08-16 18:17:40,380 - src.models.retrieval - INFO - dep=query_embed op=encode ms=1371 dense_dim=1024 sparse_tokens=3
2025-08-16 18:17:40,416 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=35 status=OK
2025-08-16 18:17:40,416 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=35 total_ms=35
2025-08-16 18:17:40,488 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=72 status=OK
2025-08-16 18:17:40,489 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:17:40,489 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=72 total_ms=72
2025-08-16 18:17:40,489 - src.models.retrieval - WARNING - Content too short after cleaning for document: ehp.1104093
2025-08-16 18:17:40,489 - src.models.retrieval - WARNING - Content too short after cleaning for document: Dtsch_Arztebl_Int-120_117
2025-08-16 18:17:40,489 - src.models.retrieval - INFO - dep=mmr_embed used_index=2 used_cache=0 embedded=0 ms=0 n_docs=2 valid_vecs=2 q_embed_ms=0
2025-08-16 18:17:40,490 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=48 n_docs=2
2025-08-16 18:17:40,604 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:17:40,605 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=115.2 status=OK
2025-08-16 18:17:40,606 - src.models.retrieval - INFO - Query embedding IN: query_len=12 chars, query_repr='Touch test 1...'
2025-08-16 18:17:40,679 - src.models.retrieval - INFO - dep=query_embed op=encode ms=73 dense_dim=1024 sparse_tokens=3
2025-08-16 18:17:41,291 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=216 status=OK
2025-08-16 18:17:41,292 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:17:41,292 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=216 total_ms=216
2025-08-16 18:17:41,292 - src.models.retrieval - WARNING - Content too short after cleaning for document: ehp.1104093
2025-08-16 18:17:41,292 - src.models.retrieval - WARNING - Content too short after cleaning for document: Dtsch_Arztebl_Int-120_117
2025-08-16 18:17:41,292 - src.models.retrieval - WARNING - Content too short after cleaning for document: Tip of the Iceberg – Navigating the Known and Unknown Costs of Climate Change for Canada
2025-08-16 18:17:41,292 - src.models.retrieval - WARNING - Content too short after cleaning for document: Intact-Centre-Climate-Change-and-the-Preparedness-of-Canadian-Provinces-and-Yukon-Oct-2016
2025-08-16 18:17:41,292 - src.models.retrieval - WARNING - Content too short after cleaning for document: Intact-Centre-Climate-Change-and-the-Preparedness-of-Canadian-Provinces-and-Yukon-Oct-2016
2025-08-16 18:17:41,295 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=37035 n_docs=46
2025-08-16 18:17:41,451 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:17:41,469 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=173.2 status=OK
2025-08-16 18:17:41,470 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Guide For Cities On Health Oriented Planning And Use Of Urban Green Spaces', 'pinecone_score': 0.234701544, 'rerank_score': 0.00036400868, 'has_values': True}, {'title': 'Preventing Disaster Before It Strikes', 'pinecone_score': 0.065182589, 'rerank_score': 0.0022518474, 'has_values': True}, {'title': 'Due North Facing The Costs Of Climate Change For Northern Infrastructure', 'pinecone_score': 0.196930721, 'rerank_score': 0.001012286, 'has_values': True}, {'title': 'Kgad005', 'pinecone_score': 0.0801823735, 'rerank_score': 0.00039666123, 'has_values': True}, {'title': 'Phn 38 321', 'pinecone_score': 0.21543622, 'rerank_score': 0.00030534892, 'has_values': True}]
2025-08-16 18:17:41,470 - src.models.retrieval - INFO - q='Touch test 1', base=2, kept_pre=2, refill=0, final_before=0, final_after=5, hybrid_refill=5, floor=0.60, delta=0.100, max_sim_pre=0.235, p50_sim_pre=0.223, p95_sim_pre=0.235, blocked_base=0, dropped_top2=[{'segment_id': '4', 'title': 'Guide For Cities On Health Oriented Planning And Use Of Urban Green Spaces', 'score': 0.00036400868}, {'segment_id': '40', 'title': 'Ijerph 18 04486', 'score': 5.0250615e-05}]
2025-08-16 18:17:41,472 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:17:41,472 - src.models.climate_pipeline - INFO - Timing: retrieval=2463.2ms
2025-08-16 18:17:41,472 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:17:41,472 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:17:41,473 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:41,476 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:41,476 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:41,477 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:17:41,477 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:17:44,318 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2841 status=OK request_id=7038840b-4e80-44cd-a372-914758c6dc9a
2025-08-16 18:17:44,320 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:17:44,320 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:17:44,320 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:17:44,320 - src.models.climate_pipeline - INFO - Timing: generation=2847.6ms
2025-08-16 18:17:44,320 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:17:45,324 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1003 status=OK request_id=ebf45eb8-5e7d-4685-ab43-7e4f6f787330
2025-08-16 18:17:45,324 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 18:17:45,324 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 18:17:45,324 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:17:45,324 - src.models.climate_pipeline - INFO - Timing: faithfulness=1004.2ms
2025-08-16 18:17:45,324 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:45,326 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:45,326 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:45,327 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:17:45,327 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=1191.3 guards=0.0 retrieval=2463.2 generation=2847.6 faithfulness=1004.2 translation=0.0 total=7510.6
2025-08-16 18:17:45,328 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 7.51s
2025-08-16 18:17:45,328 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382657811 time=7.515s model=nova faithfulness=0.900
2025-08-16 18:17:45,328 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=7.517s id=req_1755382657811 ip=127.0.0.1
INFO:     127.0.0.1:63146 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:17:45,644 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382665642 query_len=12 lang=en
2025-08-16 18:17:45,644 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Processing query: 'Touch test 2...' in english (code: en)
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Raw query repr: 'Touch test 2'
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:45,645 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Router OUT → english_query='Touch test 2'
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Touch test 2'
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:17:45,645 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:45,645 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:45,647 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:45,647 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:45,647 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:45,648 - src.models.climate_pipeline - INFO - Timing: cache=2.6ms
2025-08-16 18:17:45,648 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:45,648 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:45,648 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:45,648 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Touch test 2'
2025-08-16 18:17:45,648 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Touch test 2', norm='Touch test 2'
2025-08-16 18:17:46,346 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=697 status=OK request_id=81e8eac7-eae4-47a7-9005-968943669602
2025-08-16 18:17:46,346 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a short, generic follow-up and recent conversation is not available, so it is off-topic.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:17:46,347 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:46,347 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Touch test 2...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a short, generic follow-up and recent conversation is not available, so it is off-topi...'
2025-08-16 18:17:46,347 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:17:46,347 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:17:46,347 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382665642 error=Pipeline processing failed
2025-08-16 18:17:46,347 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382665642 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382665642'}}
2025-08-16 18:17:46,347 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.705s id=req_1755382665642 ip=127.0.0.1
INFO:     127.0.0.1:63220 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:17:46,655 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382666654 query_len=12 lang=en
2025-08-16 18:17:46,656 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Processing query: 'Touch test 3...' in english (code: en)
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Raw query repr: 'Touch test 3'
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:46,656 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Router OUT → english_query='Touch test 3'
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Touch test 3'
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Net debug → original_query len=12, utf8_bytes=12
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Net debug → english_query len=12, utf8_bytes=12
2025-08-16 18:17:46,656 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:46,656 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:46,661 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:46,661 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:46,662 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:46,662 - src.models.climate_pipeline - INFO - Timing: cache=5.9ms
2025-08-16 18:17:46,662 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:46,662 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:46,662 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:46,662 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Touch test 3'
2025-08-16 18:17:46,662 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Touch test 3', norm='Touch test 3'
2025-08-16 18:17:47,355 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=692 status=OK request_id=d5b20e64-15ec-43d3-b89f-e8d689cc8f3b
2025-08-16 18:17:47,356 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a short, generic follow-up and the recent conversation is about climate topics.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Are you sure about the effects of climate change?","ask_how_to_use":false,"how_it_works":
2025-08-16 18:17:47,356 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:47,356 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Touch test 3...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is a short, generic follow-up and the recent conversation is about climate topics....'
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Are you sure about the effects of climate change?'
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - Timing: rewrite=693.7ms
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:17:47,356 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:17:47,356 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:17:47,356 - src.models.retrieval - INFO - Query embedding IN: query_len=49 chars, query_repr='Are you sure about the effects of climate change?...'
2025-08-16 18:17:47,949 - src.models.retrieval - INFO - dep=query_embed op=encode ms=592 dense_dim=1024 sparse_tokens=10
2025-08-16 18:17:47,986 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=36 status=OK
2025-08-16 18:17:47,986 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=37 total_ms=37
2025-08-16 18:17:48,065 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=78 status=OK
2025-08-16 18:17:48,065 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:17:48,065 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=78 total_ms=78
2025-08-16 18:17:48,067 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:17:48,068 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=7413 n_docs=7
2025-08-16 18:17:48,195 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:17:48,199 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=131.4 status=OK
2025-08-16 18:17:48,200 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Canada In A Changing Climate National Issues Report', 'pinecone_score': 0.244251937, 'rerank_score': 0.39210403, 'has_values': True}, {'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'pinecone_score': 0.251125574, 'rerank_score': 0.28646857, 'has_values': True}, {'title': 'Connecting Climate Change And Health – A Guidebook Of Health And Climate Change ', 'pinecone_score': 0.241775304, 'rerank_score': 0.19790912, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.241810799, 'rerank_score': 0.1526628, 'has_values': True}, {'title': '1 S2.0 S2667278223000172 Main', 'pinecone_score': 0.264424205, 'rerank_score': 0.11357959, 'has_values': True}]
2025-08-16 18:17:48,200 - src.models.retrieval - INFO - q='Are you sure about the effects of climate change?', base=7, kept_pre=7, refill=0, final_before=0, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.274, p50_sim_pre=0.245, p95_sim_pre=0.274, blocked_base=0, dropped_top2=[{'segment_id': '15', 'title': 'Canada In A Changing Climate National Issues Report', 'score': 0.39210403}, {'segment_id': '17', 'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'score': 0.28646857}]
2025-08-16 18:17:48,200 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:17:48,200 - src.models.climate_pipeline - INFO - Timing: retrieval=844.3ms
2025-08-16 18:17:48,200 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:17:48,201 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:17:48,201 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:48,202 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:48,202 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:48,203 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:17:48,203 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:17:53,501 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=5297 status=OK request_id=dadc30f9-f8bb-4861-8c14-8bcf853704d5
2025-08-16 18:17:53,502 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:17:53,502 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:17:53,502 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:17:53,502 - src.models.climate_pipeline - INFO - Timing: generation=5301.6ms
2025-08-16 18:17:53,502 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:17:56,160 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2657 status=OK request_id=390e3bec-a97b-48f9-a8d8-3abdc966e38e
2025-08-16 18:17:56,161 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:17:56,162 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:17:56,162 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:17:56,162 - src.models.climate_pipeline - INFO - Timing: faithfulness=2659.4ms
2025-08-16 18:17:56,162 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:56,163 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:56,163 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:56,164 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:17:56,164 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=693.7 guards=0.0 retrieval=844.3 generation=5301.6 faithfulness=2659.4 translation=0.0 total=9505.8
2025-08-16 18:17:56,164 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 9.51s
2025-08-16 18:17:56,165 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755382666654 time=9.509s model=nova faithfulness=0.950
2025-08-16 18:17:56,165 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=9.512s id=req_1755382666654 ip=127.0.0.1
INFO:     127.0.0.1:63231 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:17:58,487 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382678485 query_len=17 lang=en
2025-08-16 18:17:58,487 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:58,487 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382678485 query_len=17 lang=en
2025-08-16 18:17:58,487 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:58,488 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382678485 query_len=17 lang=en
2025-08-16 18:17:58,488 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Processing query: 'Load test query 0...' in english (code: en)
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Raw query repr: 'Load test query 0'
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:58,488 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Router OUT → english_query='Load test query 0'
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Load test query 0'
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Net debug → original_query len=17, utf8_bytes=17
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Net debug → english_query len=17, utf8_bytes=17
2025-08-16 18:17:58,488 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:58,488 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:58,491 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:58,491 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Processing query: 'Load test query 1...' in english (code: en)
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Raw query repr: 'Load test query 1'
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:58,491 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Router OUT → english_query='Load test query 1'
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Load test query 1'
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Net debug → original_query len=17, utf8_bytes=17
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Net debug → english_query len=17, utf8_bytes=17
2025-08-16 18:17:58,491 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:58,491 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:58,493 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:58,493 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:58,493 - src.models.climate_pipeline - INFO - Processing query: 'Load test query 2...' in english (code: en)
2025-08-16 18:17:58,493 - src.models.climate_pipeline - INFO - Raw query repr: 'Load test query 2'
2025-08-16 18:17:58,493 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:58,493 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:58,493 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - Router OUT → english_query='Load test query 2'
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Load test query 2'
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - Net debug → original_query len=17, utf8_bytes=17
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - Net debug → english_query len=17, utf8_bytes=17
2025-08-16 18:17:58,494 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:58,494 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:58,498 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:58,498 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:58,498 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:58,499 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:58,499 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:58,500 - src.models.climate_pipeline - INFO - Timing: cache=11.2ms
2025-08-16 18:17:58,500 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:58,500 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:58,500 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:58,500 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Load test query 0'
2025-08-16 18:17:58,500 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Load test query 0', norm='Load test query 0'
2025-08-16 18:17:58,503 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382678499 query_len=17 lang=en
2025-08-16 18:17:58,503 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:58,503 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755382678499 query_len=17 lang=en
2025-08-16 18:17:58,503 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:17:58,503 - src.models.climate_pipeline - INFO - Timing: cache=12.1ms
2025-08-16 18:17:58,503 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:58,503 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:58,503 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:58,503 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Load test query 1'
2025-08-16 18:17:58,503 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Load test query 1', norm='Load test query 1'
2025-08-16 18:17:58,504 - src.models.climate_pipeline - INFO - Processing query: 'Load test query 3...' in english (code: en)
2025-08-16 18:17:58,504 - src.models.climate_pipeline - INFO - Raw query repr: 'Load test query 3'
2025-08-16 18:17:58,504 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:58,504 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:58,504 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - Router OUT → english_query='Load test query 3'
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Load test query 3'
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - Net debug → original_query len=17, utf8_bytes=17
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - Net debug → english_query len=17, utf8_bytes=17
2025-08-16 18:17:58,505 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:58,505 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:58,508 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:58,508 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:58,509 - src.models.climate_pipeline - INFO - Timing: cache=14.8ms
2025-08-16 18:17:58,509 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:58,509 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:58,509 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:58,509 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Load test query 2'
2025-08-16 18:17:58,509 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Load test query 2', norm='Load test query 2'
2025-08-16 18:17:58,509 - src.models.climate_pipeline - INFO - Processing query: 'Load test query 4...' in english (code: en)
2025-08-16 18:17:58,509 - src.models.climate_pipeline - INFO - Raw query repr: 'Load test query 4'
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:17:58,510 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Router OUT → english_query='Load test query 4'
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Load test query 4'
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Net debug → original_query len=17, utf8_bytes=17
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Net debug → english_query len=17, utf8_bytes=17
2025-08-16 18:17:58,510 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:17:58,510 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:17:58,513 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:17:58,513 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:17:58,513 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:58,513 - src.models.climate_pipeline - INFO - Timing: cache=8.6ms
2025-08-16 18:17:58,513 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:58,513 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:58,513 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:58,513 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Load test query 3'
2025-08-16 18:17:58,513 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Load test query 3', norm='Load test query 3'
2025-08-16 18:17:58,514 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:17:58,514 - src.models.climate_pipeline - INFO - Timing: cache=4.7ms
2025-08-16 18:17:58,514 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:17:58,514 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:17:58,514 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:17:58,515 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Load test query 4'
2025-08-16 18:17:58,515 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Load test query 4', norm='Load test query 4'
2025-08-16 18:17:59,153 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=652 status=OK request_id=221a8609-81ca-417e-9711-547bbc15dc64
2025-08-16 18:17:59,153 - query_rewriter - INFO - Model raw (first 300): ```json
{
  "reason": "User query is a load test and does not contain any meaningful content.",
  "language": "unknown",
  "expected_language": "en",
  "language_match": false,
  "classification": "off-topic",
  "rewrite_en": null,
  "ask_how_to_use": false,
  "how_it_works": null,
  "error": null
}
2025-08-16 18:17:59,153 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:59,373 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=220 status=OK request_id=c689029e-3317-4c74-91d9-adb2115c4d01
2025-08-16 18:17:59,374 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Load test query 0...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a load test and does not contain any meaningful content....'
2025-08-16 18:17:59,374 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:17:59,374 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:17:59,375 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382678485 error=Pipeline processing failed
2025-08-16 18:17:59,375 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382678485 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382678485'}}
2025-08-16 18:17:59,375 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.890s id=req_1755382678485 ip=127.0.0.1
INFO:     127.0.0.1:63339 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:17:59,526 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1012 status=OK request_id=3fe872c8-a122-4bf5-9b48-487fc936d41b
2025-08-16 18:17:59,526 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is not in English but appears to be a test query.","language":"unknown","expected_language":"en","language_match":false,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:17:59,526 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:59,562 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1058 status=OK request_id=672e065b-c65e-4488-bc1b-2cbf6879eec3
2025-08-16 18:17:59,562 - query_rewriter - INFO - Model raw (first 300): ```json
{
  "reason": "User query is a test phrase and does not contain any climate-related terms or context.",
  "language": "en",
  "expected_language": "en",
  "language_match": true,
  "classification": "off-topic",
  "rewrite_en": null,
  "ask_how_to_use": false,
  "how_it_works": null,
  "erro
2025-08-16 18:17:59,562 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:59,563 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Load test query 1...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a test phrase and does not contain any climate-related terms or context....'
2025-08-16 18:17:59,563 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:17:59,563 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:17:59,563 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382678485 error=Pipeline processing failed
2025-08-16 18:17:59,563 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382678485 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382678485'}}
2025-08-16 18:17:59,564 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=1.079s id=req_1755382678485 ip=127.0.0.1
INFO:     127.0.0.1:63340 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:17:59,629 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1113 status=OK request_id=46136e9d-8d24-4a6d-a06e-6426ca786fac
2025-08-16 18:17:59,629 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a command to load test, not a valid query.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:17:59,629 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:59,629 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Load test query 4...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a command to load test, not a valid query....'
2025-08-16 18:17:59,629 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:17:59,629 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:17:59,629 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382678499 error=Pipeline processing failed
2025-08-16 18:17:59,629 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382678499 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382678499'}}
2025-08-16 18:17:59,629 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=1.130s id=req_1755382678499 ip=127.0.0.1
INFO:     127.0.0.1:63344 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:17:59,660 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1151 status=OK request_id=23dc60fc-f3b5-4501-99ae-6506af690f0e
2025-08-16 18:17:59,660 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a test and does not contain any meaningful content related to climate or any other topic.","language":"en","expected_language":"en","language_match":true,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:17:59,660 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:17:59,660 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Load test query 2...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is a test and does not contain any meaningful content related to climate or any other top...'
2025-08-16 18:17:59,661 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:17:59,661 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:17:59,661 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382678485 error=Pipeline processing failed
2025-08-16 18:17:59,661 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382678485 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382678485'}}
2025-08-16 18:17:59,661 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=1.176s id=req_1755382678485 ip=127.0.0.1
INFO:     127.0.0.1:63341 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:17:59,751 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=224 status=OK request_id=2590ead7-897c-4416-aead-ce45de49bed3
2025-08-16 18:17:59,752 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Load test query 3...' expected_lang=en detected_lang=en classification=off-topic language_match=True reason='User query is not in English but appears to be a test query....'
2025-08-16 18:17:59,752 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-16 18:17:59,752 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:17:59,752 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755382678499 error=Pipeline processing failed
2025-08-16 18:17:59,752 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755382678499 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755382678499'}}
2025-08-16 18:17:59,753 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=1.253s id=req_1755382678499 ip=127.0.0.1
INFO:     127.0.0.1:63345 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:41:16,409 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.087s id=req_1755384076306 ip=127.0.0.1
INFO:     127.0.0.1:60748 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:41:16,840 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755384076512 query_len=31 lang=en
2025-08-16 18:41:16,842 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:41:16,898 - src.models.climate_pipeline - INFO - Processing query: 'Que son los cambios climaticos?...' in english (code: en)
2025-08-16 18:41:16,963 - src.models.climate_pipeline - INFO - Raw query repr: 'Que son los cambios climaticos?'
2025-08-16 18:41:16,968 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:41:16,971 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:41:16,977 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:41:16,986 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:41:16,987 - src.models.climate_pipeline - INFO - Router OUT → english_query='Que son los cambios climaticos?'
2025-08-16 18:41:16,987 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Que son los cambios climaticos?'
2025-08-16 18:41:16,987 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:41:16,988 - src.models.climate_pipeline - INFO - Timing: routing=15.6ms
2025-08-16 18:41:16,988 - src.models.climate_pipeline - INFO - Net debug → original_query len=31, utf8_bytes=31
2025-08-16 18:41:16,988 - src.models.climate_pipeline - INFO - Net debug → english_query len=31, utf8_bytes=31
2025-08-16 18:41:16,988 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:41:17,026 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:41:17,435 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:41:17,438 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:41:17,586 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:41:17,836 - src.models.climate_pipeline - INFO - Timing: cache=847.6ms
2025-08-16 18:41:17,836 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:41:17,845 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:41:17,845 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:41:17,845 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Que son los cambios climaticos?'
2025-08-16 18:41:17,914 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Que son los cambios climaticos?', norm='Que son los cambios climaticos?'
2025-08-16 18:41:18,880 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=921 status=OK request_id=2306805e-320e-4200-bf0b-d459579eb25b
2025-08-16 18:41:18,905 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, not English.","language":"es","expected_language":"en","language_match":false,"classification":"on-topic","rewrite_en":"What are climate changes?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:41:18,908 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:41:18,908 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Que son los cambios climaticos?...' expected_lang=en detected_lang=es classification=on-topic language_match=False reason='User query is in Spanish, not English....'
2025-08-16 18:41:18,908 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='no', canned=False
2025-08-16 18:41:18,909 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What are climate changes?'
2025-08-16 18:41:18,909 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 18:41:18,961 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755384076512 error=Pipeline processing failed
2025-08-16 18:41:18,968 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755384076512 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755384076512'}}
2025-08-16 18:41:18,977 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=2.464s id=req_1755384076512 ip=127.0.0.1
INFO:     127.0.0.1:60748 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 18:48:18,637 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.033s id=req_1755384498603 ip=127.0.0.1
INFO:     127.0.0.1:65062 - "GET /health HTTP/1.1" 200 OK
2025-08-16 18:50:25,443 - src.webui.api.main - INFO - REQUEST GET /health/ready status=200 time=0.019s id=req_1755384625424 ip=127.0.0.1
INFO:     127.0.0.1:50033 - "GET /health/ready HTTP/1.1" 200 OK
2025-08-16 18:50:30,600 - src.webui.api.routers.languages - INFO - Returning language support: command_a=22 nova=10
2025-08-16 18:50:30,634 - src.webui.api.main - INFO - REQUEST GET /api/v1/languages/supported status=200 time=0.060s id=req_1755384630573 ip=127.0.0.1
INFO:     127.0.0.1:50102 - "GET /api/v1/languages/supported HTTP/1.1" 200 OK
2025-08-16 18:52:40,101 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.009s id=req_1755384760091 ip=127.0.0.1
INFO:     127.0.0.1:51408 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:52:40,145 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755384760123 query_len=5 lang=en
2025-08-16 18:52:40,147 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:52:40,164 - src.models.climate_pipeline - INFO - Processing query: 'Hello...' in english (code: en)
2025-08-16 18:52:40,164 - src.models.climate_pipeline - INFO - Raw query repr: 'Hello'
2025-08-16 18:52:40,164 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:52:40,165 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:52:40,166 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hello'
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hello'
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - Timing: routing=1.3ms
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - Net debug → original_query len=5, utf8_bytes=5
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - Net debug → english_query len=5, utf8_bytes=5
2025-08-16 18:52:40,166 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:52:40,177 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:52:40,378 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:52:40,378 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:52:40,400 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:52:40,508 - src.models.climate_pipeline - INFO - Timing: cache=341.1ms
2025-08-16 18:52:40,508 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:52:40,508 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 18:52:40,509 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 18:52:40,509 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hello'
2025-08-16 18:52:40,511 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Hello', norm='Hello'
2025-08-16 18:52:41,152 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=633 status=OK request_id=eb8d8b03-3075-4bed-83f1-6cf953deb9ad
2025-08-16 18:52:41,153 - query_rewriter - INFO - Model raw (first 300): {"reason":"User greeting","language":"en","expected_language":"en","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:52:41,153 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:52:41,153 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hello...' expected_lang=en detected_lang=en classification=greeting language_match=True reason='User greeting...'
2025-08-16 18:52:41,153 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='greeting', language_match='yes', canned=True
2025-08-16 18:52:41,153 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 18:52:41,153 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 18:52:41,156 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755384760123 time=1.019s model=nova faithfulness=1.000
2025-08-16 18:52:41,158 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.034s id=req_1755384760123 ip=127.0.0.1
INFO:     127.0.0.1:51410 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:53:10,978 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/feedback/submit status=200 time=0.002s id=req_1755384790976 ip=127.0.0.1
INFO:     127.0.0.1:51704 - "OPTIONS /api/v1/feedback/submit HTTP/1.1" 200 OK
2025-08-16 18:53:11,042 - src.webui.api.routers.feedback - INFO - Submitting feedback: id=fb_35e65e7446d8 type=thumbs_up categories=1 message_id=assistant_1755384761160_xcfxnsyjk
2025-08-16 18:53:11,075 - src.webui.api.routers.feedback - INFO - Feedback stored successfully: id=fb_35e65e7446d8
2025-08-16 18:53:11,076 - src.webui.api.main - INFO - REQUEST POST /api/v1/feedback/submit status=200 time=0.083s id=req_1755384790993 ip=127.0.0.1
INFO:     127.0.0.1:51704 - "POST /api/v1/feedback/submit HTTP/1.1" 200 OK
2025-08-16 18:53:33,651 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755384813645 query_len=23 lang=en
2025-08-16 18:53:33,654 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:53:33,654 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 18:53:33,654 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:53:33,655 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:53:33,655 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:53:33,656 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:53:33,659 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:53:33,659 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:53:33,667 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:53:33,669 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:53:33,669 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:53:33,669 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:53:33,670 - src.models.climate_pipeline - INFO - Timing: routing=10.4ms
2025-08-16 18:53:33,670 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:53:33,670 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:53:33,670 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:53:33,670 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:53:33,682 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:53:33,682 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:53:33,690 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 18:53:33,704 - src.models.climate_pipeline - INFO - Timing: cache=33.9ms
2025-08-16 18:53:33,704 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 18:53:33,704 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 18:53:33,704 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 18:53:33,704 - src.models.conversation_parser - INFO -   Message 1 (user): Hello...
2025-08-16 18:53:33,704 - src.models.conversation_parser - INFO -   Message 2 (assistant): Hello, I am your multilingual climate chatbot. I can answer climate questions in any language. What ...
2025-08-16 18:53:33,704 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=2
2025-08-16 18:53:33,704 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='What is climate change?'
2025-08-16 18:53:33,704 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='What is climate change?', norm='What is climate change?'
2025-08-16 18:53:34,473 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=768 status=OK request_id=bf176d16-af22-4e46-8115-4c847e98dbad
2025-08-16 18:53:34,474 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a straightforward question about climate change.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 18:53:34,474 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 18:53:34,474 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='What is climate change?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is a straightforward question about climate change....'
2025-08-16 18:53:34,474 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 18:53:34,474 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 18:53:34,474 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 18:53:34,475 - src.models.climate_pipeline - INFO - Timing: rewrite=770.7ms
2025-08-16 18:53:34,475 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 18:53:34,475 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 18:53:34,475 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 18:53:34,475 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 18:53:34,475 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 18:53:34,475 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 18:53:39,381 - src.models.retrieval - INFO - dep=query_embed op=encode ms=4905 dense_dim=1024 sparse_tokens=5
2025-08-16 18:53:40,067 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=681 status=OK
2025-08-16 18:53:40,067 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=682 total_ms=682
2025-08-16 18:53:40,279 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=211 status=OK
2025-08-16 18:53:40,279 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 18:53:40,279 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=211 total_ms=211
2025-08-16 18:53:40,303 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=2 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 18:53:40,325 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 18:53:40,614 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 18:53:40,624 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=298.5 status=OK
2025-08-16 18:53:40,640 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 18:53:40,641 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 18:53:40,642 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 18:53:40,642 - src.models.climate_pipeline - INFO - Timing: retrieval=6167.0ms
2025-08-16 18:53:40,642 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 18:53:40,643 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 18:53:40,643 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:53:40,647 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:53:40,647 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:53:40,649 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 18:53:40,649 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 18:53:43,581 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2931 status=OK request_id=64e2f10c-1e15-4e2f-afdb-02a85c362781
2025-08-16 18:53:43,587 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 18:53:43,587 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 18:53:43,588 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 18:53:43,588 - src.models.climate_pipeline - INFO - Timing: generation=2945.4ms
2025-08-16 18:53:43,588 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 18:53:45,040 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1450 status=OK request_id=c9c9b2c1-e6f5-48b7-9a86-a2f6c3d3c7e8
2025-08-16 18:53:45,042 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 18:53:45,042 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 18:53:45,042 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 18:53:45,042 - src.models.climate_pipeline - INFO - Timing: faithfulness=1454.3ms
2025-08-16 18:53:45,043 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:53:45,044 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:53:45,044 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:53:45,045 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 18:53:45,047 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=10.4 rewrite=770.7 guards=0.0 retrieval=6167.0 generation=2945.4 faithfulness=1454.3 translation=0.0 total=11387.0
2025-08-16 18:53:45,047 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 11.39s
2025-08-16 18:53:45,048 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755384813645 time=11.397s model=nova faithfulness=0.950
2025-08-16 18:53:45,051 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=11.406s id=req_1755384813645 ip=127.0.0.1
INFO:     127.0.0.1:51919 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:54:07,124 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755384847120 query_len=23 lang=en
2025-08-16 18:54:07,124 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:54:07,125 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:54:07,125 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:54:07,125 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:54:07,125 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:54:07,126 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - Timing: routing=0.6ms
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:54:07,126 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:54:07,126 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:54:07,135 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:54:07,136 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:54:07,136 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:54:07,137 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755384847120 time=0.013s model=nova faithfulness=0.950
2025-08-16 18:54:07,137 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.017s id=req_1755384847120 ip=127.0.0.1
INFO:     127.0.0.1:52262 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 18:57:57,014 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385077008 query_len=23 lang=en
2025-08-16 18:57:57,015 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Processing query: 'What is climate change?...' in english (code: en)
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Raw query repr: 'What is climate change?'
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 18:57:57,017 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Router OUT → english_query='What is climate change?'
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Router OUT → processed_query='What is climate change?'
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-16 18:57:57,017 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 18:57:57,017 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 18:57:57,024 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 18:57:57,024 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 18:57:57,025 - src.models.climate_pipeline - INFO - ✓ Cache hit for english - returning cached response
2025-08-16 18:57:57,026 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385077008 time=0.012s model=nova faithfulness=0.950
2025-08-16 18:57:57,027 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.020s id=req_1755385077008 ip=127.0.0.1
INFO:     127.0.0.1:54461 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:01:38,355 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385298348 query_len=36 lang=en
2025-08-16 19:01:38,359 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:01:38,362 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-16 19:01:38,362 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-16 19:01:38,362 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:01:38,362 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:01:38,363 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - Router OUT → english_query='Why is summer so hot now in Toronto?'
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Why is summer so hot now in Toronto?'
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - Net debug → original_query len=36, utf8_bytes=36
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - Net debug → english_query len=36, utf8_bytes=36
2025-08-16 19:01:38,363 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:01:38,364 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:01:38,367 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:01:38,368 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:01:38,370 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:01:38,383 - src.models.climate_pipeline - INFO - Timing: cache=19.4ms
2025-08-16 19:01:38,383 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:01:38,384 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:01:38,384 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:01:38,384 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Why is summer so hot now in Toronto?'
2025-08-16 19:01:38,387 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Why is summer so hot now in Toronto?', norm='Why is summer so hot now in Toronto?'
2025-08-16 19:01:39,176 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=788 status=OK request_id=a0d08f25-036d-4c21-8c13-2feb5e7c370d
2025-08-16 19:01:39,177 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is directly about climate change impacts in a specific location.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Why is summer so hot now in Toronto?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:01:39,177 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:01:39,177 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Why is summer so hot now in Toronto?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is directly about climate change impacts in a specific location....'
2025-08-16 19:01:39,177 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-16 19:01:39,177 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Why is summer so hot now in Toronto?'
2025-08-16 19:01:39,177 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 19:01:39,177 - src.models.climate_pipeline - INFO - Timing: rewrite=793.7ms
2025-08-16 19:01:39,177 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 19:01:39,177 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 19:01:39,177 - src.models.climate_pipeline - INFO - Timing: guards=0.2ms
2025-08-16 19:01:39,178 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 19:01:39,178 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 19:01:39,178 - src.models.retrieval - INFO - Query embedding IN: query_len=36 chars, query_repr='Why is summer so hot now in Toronto?...'
2025-08-16 19:01:43,062 - src.models.retrieval - INFO - dep=query_embed op=encode ms=3884 dense_dim=1024 sparse_tokens=9
2025-08-16 19:01:43,685 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=619 status=OK
2025-08-16 19:01:43,686 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=620 total_ms=620
2025-08-16 19:01:43,883 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=196 status=OK
2025-08-16 19:01:43,883 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 19:01:43,883 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=197 total_ms=197
2025-08-16 19:01:43,890 - src.models.retrieval - INFO - dep=mmr_embed used_index=6 used_cache=0 embedded=0 ms=0 n_docs=6 valid_vecs=6 q_embed_ms=0
2025-08-16 19:01:43,891 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=7335 n_docs=6
2025-08-16 19:01:44,192 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 19:01:44,200 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=308.2 status=OK
2025-08-16 19:01:44,204 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Guide And Workbook For Municipal Climate Adaptation', 'pinecone_score': 0.345578611, 'rerank_score': 0.9335521, 'has_values': True}, {'title': 'Toronto First Resilience Strategy', 'pinecone_score': 0.34152326, 'rerank_score': 0.85776806, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.297280401, 'rerank_score': 0.6614857, 'has_values': True}, {'title': 'The Climate Atlas And Health – Using Climate Maps To Understand The Future Of He', 'pinecone_score': 0.296605885, 'rerank_score': 0.22815649, 'has_values': True}, {'title': 'Heatwaves And Our Health – A Special Report On Climate Change In Canada', 'pinecone_score': 0.299585462, 'rerank_score': 0.1989965, 'has_values': True}]
2025-08-16 19:01:44,204 - src.models.retrieval - INFO - q='Why is summer so hot now in Toronto?', base=6, kept_pre=6, refill=0, final_before=3, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.346, p50_sim_pre=0.300, p95_sim_pre=0.346, blocked_base=0, dropped_top2=[{'segment_id': '33', 'title': 'The Climate Atlas And Health – Using Climate Maps To Understand The Future Of He', 'score': 0.22815649}, {'segment_id': '24', 'title': 'Heatwaves And Our Health – A Special Report On Climate Change In Canada', 'score': 0.1989965}]
2025-08-16 19:01:44,204 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 19:01:44,204 - src.models.climate_pipeline - INFO - Timing: retrieval=5026.4ms
2025-08-16 19:01:44,204 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 19:01:44,204 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 19:01:44,205 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:01:44,208 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:01:44,208 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:01:44,209 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 19:01:44,209 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 19:01:47,606 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3396 status=OK request_id=70312648-568e-4cd8-b646-cf210c655ae2
2025-08-16 19:01:47,614 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 19:01:47,614 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 19:01:47,614 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 19:01:47,614 - src.models.climate_pipeline - INFO - Timing: generation=3409.7ms
2025-08-16 19:01:47,614 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 19:01:48,994 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1379 status=OK request_id=8fe4fdd2-7969-43d7-9894-3f372861ba5d
2025-08-16 19:01:49,003 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 19:01:49,004 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 19:01:49,004 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 19:01:49,004 - src.models.climate_pipeline - INFO - Timing: faithfulness=1390.3ms
2025-08-16 19:01:49,004 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:01:49,011 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:01:49,011 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:01:49,017 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-16 19:01:49,018 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.3 rewrite=793.7 guards=0.2 retrieval=5026.4 generation=3409.7 faithfulness=1390.3 translation=0.0 total=10642.7
2025-08-16 19:01:49,018 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 10.64s
2025-08-16 19:01:49,018 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385298348 time=10.664s model=nova faithfulness=0.950
2025-08-16 19:01:49,020 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=10.672s id=req_1755385298348 ip=127.0.0.1
INFO:     127.0.0.1:56642 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:02:42,168 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.005s id=req_1755385362162 ip=127.0.0.1
INFO:     127.0.0.1:57248 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:02:42,182 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385362172 query_len=9 lang=en
2025-08-16 19:02:42,186 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:02:42,186 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:02:42,186 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:02:42,190 - src.models.climate_pipeline - INFO - Processing query: 'thank you...' in english (code: en)
2025-08-16 19:02:42,190 - src.models.climate_pipeline - INFO - Raw query repr: 'thank you'
2025-08-16 19:02:42,190 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:02:42,190 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:02:42,191 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - Router OUT → english_query='thank you'
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - Router OUT → processed_query='thank you'
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - Timing: routing=0.9ms
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - Net debug → original_query len=9, utf8_bytes=9
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - Net debug → english_query len=9, utf8_bytes=9
2025-08-16 19:02:42,191 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:02:42,192 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:02:42,211 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:02:42,211 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:02:42,211 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:02:42,227 - src.models.climate_pipeline - INFO - Timing: cache=35.6ms
2025-08-16 19:02:42,227 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:02:42,227 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:02:42,227 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:02:42,227 - src.models.conversation_parser - INFO -   Message 1 (user): Why is summer so hot now in Toronto?...
2025-08-16 19:02:42,227 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Why is Summer So Hot Now in Toronto?

## Understanding the Heat

Toronto is experiencing hotter su...
2025-08-16 19:02:42,227 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=2
2025-08-16 19:02:42,227 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='thank you'
2025-08-16 19:02:42,227 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='thank you', norm='thank you'
2025-08-16 19:02:42,760 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=532 status=OK request_id=79efdccb-d21f-43c9-8fd7-1762fa85714e
2025-08-16 19:02:42,761 - query_rewriter - INFO - Model raw (first 300): {"reason":"User expressed gratitude.","language":"en","expected_language":"en","language_match":true,"classification":"thanks","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:02:42,761 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:02:42,761 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='thank you...' expected_lang=en detected_lang=en classification=thanks language_match=True reason='User expressed gratitude....'
2025-08-16 19:02:42,761 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='thanks', language_match='yes', canned=True
2025-08-16 19:02:42,761 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:02:42,761 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:02:42,762 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385362172 time=0.580s model=nova faithfulness=1.000
2025-08-16 19:02:42,763 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.590s id=req_1755385362172 ip=127.0.0.1
INFO:     127.0.0.1:57248 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:02:49,074 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385369070 query_len=7 lang=en
2025-08-16 19:02:49,075 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 19:02:49,075 - src.webui.api.routers.chat - INFO - Parsed conversation history: 4 messages
2025-08-16 19:02:49,075 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Processing query: 'goodbye...' in english (code: en)
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Raw query repr: 'goodbye'
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:02:49,076 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Router OUT → english_query='goodbye'
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Router OUT → processed_query='goodbye'
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Net debug → original_query len=7, utf8_bytes=7
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Net debug → english_query len=7, utf8_bytes=7
2025-08-16 19:02:49,076 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:02:49,077 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:02:49,079 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:02:49,079 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:02:49,080 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:02:49,081 - src.models.climate_pipeline - INFO - Timing: cache=4.6ms
2025-08-16 19:02:49,081 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:02:49,081 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 19:02:49,081 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:02:49,081 - src.models.conversation_parser - INFO -   Message 1 (user): Why is summer so hot now in Toronto?...
2025-08-16 19:02:49,081 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Why is Summer So Hot Now in Toronto?

## Understanding the Heat

Toronto is experiencing hotter su...
2025-08-16 19:02:49,081 - src.models.conversation_parser - INFO -   Message 3 (user): thank you...
2025-08-16 19:02:49,081 - src.models.conversation_parser - INFO -   Message 4 (assistant): You're welcome. If you have more climate questions, I am here to help....
2025-08-16 19:02:49,081 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=4
2025-08-16 19:02:49,081 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='goodbye'
2025-08-16 19:02:49,082 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='goodbye', norm='goodbye'
2025-08-16 19:02:49,618 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=535 status=OK request_id=134bde68-e987-4136-96fa-61c0deac9113
2025-08-16 19:02:49,618 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a standard goodbye phrase in English.","language":"en","expected_language":"en","language_match":true,"classification":"goodbye","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:02:49,619 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:02:49,619 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='goodbye...' expected_lang=en detected_lang=en classification=goodbye language_match=True reason='User query is a standard goodbye phrase in English....'
2025-08-16 19:02:49,619 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='goodbye', language_match='yes', canned=True
2025-08-16 19:02:49,619 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:02:49,619 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:02:49,620 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385369070 time=0.546s model=nova faithfulness=1.000
2025-08-16 19:02:49,620 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.550s id=req_1755385369070 ip=127.0.0.1
INFO:     127.0.0.1:57313 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:03:07,588 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385387584 query_len=25 lang=en
2025-08-16 19:03:07,589 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:03:07,591 - src.models.climate_pipeline - INFO - Processing query: 'Im in a climate emergency...' in english (code: en)
2025-08-16 19:03:07,591 - src.models.climate_pipeline - INFO - Raw query repr: 'Im in a climate emergency'
2025-08-16 19:03:07,591 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:03:07,591 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:03:07,592 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - Router OUT → english_query='Im in a climate emergency'
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Im in a climate emergency'
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - Net debug → original_query len=25, utf8_bytes=25
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 19:03:07,592 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:03:07,593 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:03:07,603 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:03:07,604 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:03:07,605 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:03:07,609 - src.models.climate_pipeline - INFO - Timing: cache=16.3ms
2025-08-16 19:03:07,609 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:03:07,609 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:03:07,609 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:03:07,609 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Im in a climate emergency'
2025-08-16 19:03:07,609 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Im in a climate emergency', norm='Im in a climate emergency'
2025-08-16 19:03:08,258 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=647 status=OK request_id=fd696b75-123a-4933-81ca-2997a332d9e1
2025-08-16 19:03:08,259 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query contains climate-related terms and expresses urgency.","language":"en","expected_language":"en","language_match":true,"classification":"emergency","rewrite_en":"I'm in a climate emergency.","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:03:08,259 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:03:08,259 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Im in a climate emergency...' expected_lang=en detected_lang=en classification=emergency language_match=True reason='User query contains climate-related terms and expresses urgency....'
2025-08-16 19:03:08,259 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='emergency', language_match='yes', canned=True
2025-08-16 19:03:08,259 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:03:08,260 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:03:08,260 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385387584 time=0.673s model=nova faithfulness=1.000
2025-08-16 19:03:08,261 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.677s id=req_1755385387584 ip=127.0.0.1
INFO:     127.0.0.1:57486 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:04:31,476 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385471467 query_len=25 lang=en
2025-08-16 19:04:31,478 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:04:31,478 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:04:31,478 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:04:31,480 - src.models.climate_pipeline - INFO - Processing query: 'Im in a climate emergency...' in english (code: en)
2025-08-16 19:04:31,480 - src.models.climate_pipeline - INFO - Raw query repr: 'Im in a climate emergency'
2025-08-16 19:04:31,480 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:04:31,480 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:04:31,480 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:04:31,480 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:04:31,480 - src.models.climate_pipeline - INFO - Router OUT → english_query='Im in a climate emergency'
2025-08-16 19:04:31,481 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Im in a climate emergency'
2025-08-16 19:04:31,481 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:04:31,481 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-16 19:04:31,481 - src.models.climate_pipeline - INFO - Net debug → original_query len=25, utf8_bytes=25
2025-08-16 19:04:31,481 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 19:04:31,481 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:04:31,481 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:04:31,501 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:04:31,501 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:04:31,504 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:04:31,512 - src.models.climate_pipeline - INFO - Timing: cache=31.7ms
2025-08-16 19:04:31,512 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:04:31,513 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:04:31,513 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:04:31,513 - src.models.conversation_parser - INFO -   Message 1 (user): Im in a climate emergency...
2025-08-16 19:04:31,513 - src.models.conversation_parser - INFO -   Message 2 (assistant): If this is an emergency, please contact local authorities immediately (for example, 911 in Canada or...
2025-08-16 19:04:31,513 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=2
2025-08-16 19:04:31,513 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Im in a climate emergency'
2025-08-16 19:04:31,514 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Im in a climate emergency', norm='Im in a climate emergency'
2025-08-16 19:04:32,305 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=788 status=OK request_id=ca19f197-874e-4285-b1c9-bc952db1d930
2025-08-16 19:04:32,306 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about a climate emergency and matches the expected language.","language":"en","expected_language":"en","language_match":true,"classification":"emergency","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:04:32,306 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:04:32,306 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Im in a climate emergency...' expected_lang=en detected_lang=en classification=emergency language_match=True reason='User query is about a climate emergency and matches the expected language....'
2025-08-16 19:04:32,306 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='emergency', language_match='yes', canned=True
2025-08-16 19:04:32,306 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:04:32,306 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:04:32,308 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385471467 time=0.833s model=nova faithfulness=1.000
2025-08-16 19:04:32,318 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.850s id=req_1755385471467 ip=127.0.0.1
INFO:     127.0.0.1:58273 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:05:56,490 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385556475 query_len=13 lang=en
2025-08-16 19:05:56,491 - src.models.conversation_parser - INFO - Parsed 3 messages from conversation history
2025-08-16 19:05:56,491 - src.webui.api.routers.chat - INFO - Parsed conversation history: 3 messages
2025-08-16 19:05:56,491 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Processing query: 'Hola como vas...' in english (code: en)
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Raw query repr: 'Hola como vas'
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:05:56,492 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hola como vas'
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hola como vas'
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:05:56,492 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 19:05:56,493 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=13
2025-08-16 19:05:56,493 - src.models.climate_pipeline - INFO - Net debug → english_query len=13, utf8_bytes=13
2025-08-16 19:05:56,493 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:05:56,493 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:05:56,495 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:05:56,495 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:05:56,495 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:05:56,497 - src.models.climate_pipeline - INFO - Timing: cache=4.3ms
2025-08-16 19:05:56,497 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:05:56,497 - src.models.conversation_parser - INFO - Parsed 3 messages from conversation history
2025-08-16 19:05:56,497 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:05:56,497 - src.models.conversation_parser - INFO -   Message 1 (user): Im in a climate emergency...
2025-08-16 19:05:56,497 - src.models.conversation_parser - INFO -   Message 2 (user): Im in a climate emergency...
2025-08-16 19:05:56,497 - src.models.conversation_parser - INFO -   Message 3 (assistant): If this is an emergency, please contact local authorities immediately (for example, 911 in Canada or...
2025-08-16 19:05:56,497 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=3
2025-08-16 19:05:56,497 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hola como vas'
2025-08-16 19:05:56,497 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Hola como vas', norm='Hola como vas'
2025-08-16 19:05:57,046 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=548 status=OK request_id=62dc7ab5-5746-46c3-9682-35c3bd8581c4
2025-08-16 19:05:57,046 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, but conversation context is in English.","language":"es","expected_language":"en","language_match":false,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:05:57,046 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:05:57,256 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=208 status=OK request_id=baf99c01-cbf8-4862-a18c-df2d0b2f6907
2025-08-16 19:05:57,256 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hola como vas...' expected_lang=en detected_lang=es classification=off-topic language_match=False reason='User query is in Spanish, but conversation context is in English....'
2025-08-16 19:05:57,256 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='off-topic', language_match='no', canned=False
2025-08-16 19:05:57,256 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:05:57,256 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:05:57,256 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755385556475 error=Pipeline processing failed
2025-08-16 19:05:57,257 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755385556475 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755385556475'}}
2025-08-16 19:05:57,258 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.783s id=req_1755385556475 ip=127.0.0.1
INFO:     127.0.0.1:59062 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:06:33,440 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385593428 query_len=13 lang=en
2025-08-16 19:06:33,441 - src.models.conversation_parser - INFO - Parsed 5 messages from conversation history
2025-08-16 19:06:33,442 - src.webui.api.routers.chat - INFO - Parsed conversation history: 5 messages
2025-08-16 19:06:33,442 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:06:33,445 - src.models.climate_pipeline - INFO - Processing query: 'hola como vas...' in english (code: en)
2025-08-16 19:06:33,445 - src.models.climate_pipeline - INFO - Raw query repr: 'hola como vas'
2025-08-16 19:06:33,445 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:06:33,446 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:06:33,446 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:06:33,446 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:06:33,446 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola como vas'
2025-08-16 19:06:33,446 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola como vas'
2025-08-16 19:06:33,446 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:06:33,450 - src.models.climate_pipeline - INFO - Timing: routing=4.0ms
2025-08-16 19:06:33,450 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=13
2025-08-16 19:06:33,450 - src.models.climate_pipeline - INFO - Net debug → english_query len=13, utf8_bytes=13
2025-08-16 19:06:33,450 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:06:33,450 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:06:33,503 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:06:33,503 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:06:33,504 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:06:33,506 - src.models.climate_pipeline - INFO - Timing: cache=56.1ms
2025-08-16 19:06:33,506 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:06:33,506 - src.models.conversation_parser - INFO - Parsed 5 messages from conversation history
2025-08-16 19:06:33,506 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:06:33,506 - src.models.conversation_parser - INFO -   Message 1 (user): Im in a climate emergency...
2025-08-16 19:06:33,506 - src.models.conversation_parser - INFO -   Message 2 (user): Im in a climate emergency...
2025-08-16 19:06:33,506 - src.models.conversation_parser - INFO -   Message 3 (assistant): If this is an emergency, please contact local authorities immediately (for example, 911 in Canada or...
2025-08-16 19:06:33,506 - src.models.conversation_parser - INFO -   Message 4 (user): Hola como vas...
2025-08-16 19:06:33,506 - src.models.conversation_parser - INFO -   Message 5 (assistant): I'm sorry, I encountered an error while processing your request. Please try again or contact support...
2025-08-16 19:06:33,506 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=5
2025-08-16 19:06:33,506 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola como vas'
2025-08-16 19:06:33,506 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='hola como vas', norm='hola como vas'
2025-08-16 19:06:34,044 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=537 status=OK request_id=6dce66bb-19a0-4180-97b5-2a8ac677a2b5
2025-08-16 19:06:34,044 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, not English as expected.","language":"es","expected_language":"en","language_match":false,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:06:34,044 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:06:34,044 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola como vas...' expected_lang=en detected_lang=es classification=greeting language_match=False reason='User query is in Spanish, not English as expected....'
2025-08-16 19:06:34,045 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='no', canned=True
2025-08-16 19:06:34,045 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:06:34,045 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:06:34,045 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755385593428 error=Pipeline processing failed
2025-08-16 19:06:34,045 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755385593428 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755385593428'}}
2025-08-16 19:06:34,045 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.618s id=req_1755385593428 ip=127.0.0.1
INFO:     127.0.0.1:59421 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:06:45,260 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385605117 query_len=13 lang=en
2025-08-16 19:06:45,319 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:06:45,323 - src.models.climate_pipeline - INFO - Processing query: 'Hola como vas...' in english (code: en)
2025-08-16 19:06:45,323 - src.models.climate_pipeline - INFO - Raw query repr: 'Hola como vas'
2025-08-16 19:06:45,323 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:06:45,323 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:06:45,324 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:06:45,325 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:06:45,325 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hola como vas'
2025-08-16 19:06:45,325 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hola como vas'
2025-08-16 19:06:45,325 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:06:45,325 - src.models.climate_pipeline - INFO - Timing: routing=1.7ms
2025-08-16 19:06:45,326 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=13
2025-08-16 19:06:45,326 - src.models.climate_pipeline - INFO - Net debug → english_query len=13, utf8_bytes=13
2025-08-16 19:06:45,326 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:06:45,327 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:06:45,341 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:06:45,341 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:06:45,341 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:06:45,343 - src.models.climate_pipeline - INFO - Timing: cache=16.8ms
2025-08-16 19:06:45,343 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:06:45,343 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:06:45,343 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:06:45,343 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hola como vas'
2025-08-16 19:06:45,343 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Hola como vas', norm='Hola como vas'
2025-08-16 19:06:46,106 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=762 status=OK request_id=1c02f039-529e-42c6-8539-38cf74548bd6
2025-08-16 19:06:46,109 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, not English.","language":"es","expected_language":"en","language_match":false,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:06:46,109 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:06:46,374 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=245 status=OK request_id=143b9496-1e30-475b-b721-d7698b39cdce
2025-08-16 19:06:46,375 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hola como vas...' expected_lang=en detected_lang=es classification=off-topic language_match=False reason='User query is in Spanish, not English....'
2025-08-16 19:06:46,379 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='off-topic', language_match='no', canned=False
2025-08-16 19:06:46,379 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:06:46,382 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:06:46,486 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755385605117 error=Pipeline processing failed
2025-08-16 19:06:46,487 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755385605117 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755385605117'}}
2025-08-16 19:06:46,490 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=1.373s id=req_1755385605117 ip=127.0.0.1
INFO:     127.0.0.1:59550 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:11:16,764 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385876757 query_len=28 lang=es
2025-08-16 19:11:16,765 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:11:16,766 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-16 19:11:16,766 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:11:16,766 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:11:16,766 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:11:16,766 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 19:11:17,682 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=915 status=OK request_id=5641d6b0-bc46-4076-97c0-b0e654578d45
2025-08-16 19:11:17,682 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:11:17,683 - src.models.query_routing - INFO - Router NET OUT → english_query repr='What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 19:11:17,683 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 19:11:17,683 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always existed, the term "climate change" spe'
2025-08-16 19:11:17,683 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 19:11:17,683 - src.models.climate_pipeline - INFO - Net debug → english_query len=798, utf8_bytes=804
2025-08-16 19:11:17,683 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:11:17,684 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:11:17,687 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:11:17,687 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:11:17,688 - src.models.climate_pipeline - INFO - ✓ Cache hit for spanish - returning cached response
2025-08-16 19:11:17,689 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385876757 time=0.926s model=nova faithfulness=0.950
2025-08-16 19:11:17,692 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.934s id=req_1755385876757 ip=127.0.0.1
INFO:     127.0.0.1:62329 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:13:02,278 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.001s id=req_1755385982276 ip=127.0.0.1
INFO:     127.0.0.1:63422 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:13:02,297 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385982292 query_len=13 lang=en
2025-08-16 19:13:02,297 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Processing query: 'Hola como vas...' in english (code: en)
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Raw query repr: 'Hola como vas'
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:13:02,299 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hola como vas'
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hola como vas'
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:13:02,299 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-16 19:13:02,300 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=13
2025-08-16 19:13:02,300 - src.models.climate_pipeline - INFO - Net debug → english_query len=13, utf8_bytes=13
2025-08-16 19:13:02,300 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:13:02,300 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:13:02,303 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:13:02,306 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:13:02,307 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:13:02,311 - src.models.climate_pipeline - INFO - Timing: cache=11.0ms
2025-08-16 19:13:02,311 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:13:02,311 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:13:02,311 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:13:02,311 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hola como vas'
2025-08-16 19:13:02,312 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Hola como vas', norm='Hola como vas'
2025-08-16 19:13:02,869 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=556 status=OK request_id=afe48bd1-f3ac-4571-be60-40fbde5eca71
2025-08-16 19:13:02,871 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, not English.","language":"es","expected_language":"en","language_match":false,"classification":"off-topic","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:13:02,872 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:13:03,082 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=210 status=OK request_id=34331eec-fb49-49ae-9a4f-e5da778ba4c8
2025-08-16 19:13:03,083 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hola como vas...' expected_lang=en detected_lang=es classification=off-topic language_match=False reason='User query is in Spanish, not English....'
2025-08-16 19:13:03,083 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='off-topic', language_match='no', canned=False
2025-08-16 19:13:03,083 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:13:03,083 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:13:03,084 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755385982292 error=Pipeline processing failed
2025-08-16 19:13:03,084 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755385982292 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755385982292'}}
2025-08-16 19:13:03,085 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.792s id=req_1755385982292 ip=127.0.0.1
INFO:     127.0.0.1:63425 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:13:13,133 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755385993033 query_len=13 lang=es
2025-08-16 19:13:13,137 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:13:13,137 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:13:13,137 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:13:13,147 - src.models.climate_pipeline - INFO - Processing query: 'hola como vas...' in spanish (code: es)
2025-08-16 19:13:13,148 - src.models.climate_pipeline - INFO - Raw query repr: 'hola como vas'
2025-08-16 19:13:13,148 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:13:13,148 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:13:13,148 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:13:13,163 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:13:13,163 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola como vas'
2025-08-16 19:13:13,182 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola como vas'
2025-08-16 19:13:13,182 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:13:13,183 - src.models.climate_pipeline - INFO - Timing: routing=34.9ms
2025-08-16 19:13:13,183 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:13:13,183 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:13:13,184 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:13:13,184 - src.models.query_routing - INFO - Router NET IN → query repr='hola como vas'
2025-08-16 19:13:13,433 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=249 status=OK request_id=00704772-d7bd-4f87-963e-7c2e6ba4d677
2025-08-16 19:13:13,446 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:13:13,447 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello, how are you doing.'
2025-08-16 19:13:13,447 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello, how are you doing.'
2025-08-16 19:13:13,447 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello, how are you doing.'
2025-08-16 19:13:13,447 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=13
2025-08-16 19:13:13,447 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 19:13:13,447 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:13:13,447 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:13:13,467 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:13:13,467 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:13:13,470 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:13:13,508 - src.models.climate_pipeline - INFO - Timing: cache=60.8ms
2025-08-16 19:13:13,508 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:13:13,508 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:13:13,508 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:13:13,508 - src.models.conversation_parser - INFO -   Message 1 (user): Hola como vas...
2025-08-16 19:13:13,508 - src.models.conversation_parser - INFO -   Message 2 (assistant): I'm sorry, I encountered an error while processing your request. Please try again or contact support...
2025-08-16 19:13:13,508 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=2
2025-08-16 19:13:13,508 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola como vas'
2025-08-16 19:13:13,508 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='hola como vas', norm='hola como vas'
2025-08-16 19:13:14,089 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=580 status=OK request_id=5e7c13ed-7f38-4c74-a4b8-b2e1cb299edf
2025-08-16 19:13:14,090 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and matches the expected language.","language":"es","expected_language":"es","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:13:14,090 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:13:14,090 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola como vas...' expected_lang=es detected_lang=es classification=greeting language_match=True reason='User query is in Spanish and matches the expected language....'
2025-08-16 19:13:14,090 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='yes', canned=True
2025-08-16 19:13:14,090 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:13:14,090 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:13:14,373 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=281 status=OK request_id=7483e515-5f86-4199-8758-e315d864dce8
2025-08-16 19:13:14,373 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:13:14,374 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755385993033 time=1.241s model=nova faithfulness=1.000
2025-08-16 19:13:14,375 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.341s id=req_1755385993033 ip=127.0.0.1
INFO:     127.0.0.1:63536 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:14:18,440 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386058436 query_len=28 lang=es
2025-08-16 19:14:18,441 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:14:18,442 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-16 19:14:18,442 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:14:18,442 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:14:18,443 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:14:18,443 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 19:14:19,367 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=924 status=OK request_id=9ff8c8bf-a332-4f5a-93e7-8a6c382f95fc
2025-08-16 19:14:19,367 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:14:19,367 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history"
2025-08-16 19:14:19,367 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 19:14:19,367 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 19:14:19,367 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 19:14:19,367 - src.models.climate_pipeline - INFO - Net debug → english_query len=609, utf8_bytes=609
2025-08-16 19:14:19,367 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:14:19,367 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:14:19,374 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:14:19,374 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:14:19,374 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:14:19,376 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:14:19,380 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:14:19,380 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:14:19,380 - src.models.climate_pipeline - INFO - Timing: cache=13.1ms
2025-08-16 19:14:19,380 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:14:19,380 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:14:19,380 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 19:14:19,380 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='¿Qué es el cambio climático?'
2025-08-16 19:14:19,381 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='¿Qué es el cambio climático?', norm='¿Qué es el cambio climático?'
2025-08-16 19:14:20,083 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=701 status=OK request_id=490ca58f-0855-4d6f-b6a7-43ba5ff15bf2
2025-08-16 19:14:20,084 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and asks about climate change.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"What is climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:14:20,084 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:14:20,084 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='¿Qué es el cambio climático?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and asks about climate change....'
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What is climate change?'
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - Timing: rewrite=703.7ms
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 19:14:20,084 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 19:14:20,084 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 19:14:20,084 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='What is climate change?...'
2025-08-16 19:14:23,145 - src.models.retrieval - INFO - dep=query_embed op=encode ms=3060 dense_dim=1024 sparse_tokens=5
2025-08-16 19:14:23,775 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=625 status=OK
2025-08-16 19:14:23,775 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=626 total_ms=626
2025-08-16 19:14:23,962 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=184 status=OK
2025-08-16 19:14:23,963 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 19:14:23,963 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=187 total_ms=187
2025-08-16 19:14:23,966 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 19:14:23,967 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8944 n_docs=7
2025-08-16 19:14:24,226 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 19:14:24,233 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=265.1 status=OK
2025-08-16 19:14:24,238 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.280184954, 'rerank_score': 0.9995272, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.26793474, 'rerank_score': 0.99945575, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.271402389, 'rerank_score': 0.9993881, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.274087071, 'rerank_score': 0.99843913, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.270209789, 'rerank_score': 0.9980354, 'has_values': True}]
2025-08-16 19:14:24,238 - src.models.retrieval - INFO - q='What is climate change?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.95, delta=0.100, max_sim_pre=0.280, p50_sim_pre=0.271, p95_sim_pre=0.280, blocked_base=0, dropped_top2=[]
2025-08-16 19:14:24,238 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 19:14:24,238 - src.models.climate_pipeline - INFO - Timing: retrieval=4153.9ms
2025-08-16 19:14:24,238 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 19:14:24,238 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 19:14:24,239 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:14:24,240 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:14:24,241 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:14:24,243 - src.models.gen_response_unified - INFO - Cache hit for nova - returning cached response
2025-08-16 19:14:24,243 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 19:14:24,243 - src.models.climate_pipeline - INFO - Timing: generation=5.2ms
2025-08-16 19:14:24,243 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 19:14:25,973 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1728 status=OK request_id=73bb5e2b-c0e2-4c86-8680-761c3aeeaa3b
2025-08-16 19:14:25,974 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 19:14:25,975 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 19:14:25,975 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 19:14:25,975 - src.models.climate_pipeline - INFO - Timing: faithfulness=1731.4ms
2025-08-16 19:14:25,975 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 19:14:28,614 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2638 status=OK request_id=0d327004-be32-4977-b7a4-2df7cd6e11dd
2025-08-16 19:14:28,615 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 19:14:28,615 - src.models.climate_pipeline - INFO - Timing: translation=2640.1ms
2025-08-16 19:14:28,616 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:14:28,624 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:14:28,624 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:14:28,634 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 19:14:28,635 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 19:14:28,636 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.4 rewrite=703.7 guards=0.0 retrieval=4153.9 generation=5.2 faithfulness=1731.4 translation=2640.1 total=10173.3
2025-08-16 19:14:28,636 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 10.17s
2025-08-16 19:14:28,637 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386058436 time=10.197s model=nova faithfulness=0.900
2025-08-16 19:14:28,638 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=10.202s id=req_1755386058436 ip=127.0.0.1
INFO:     127.0.0.1:64260 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:14:39,964 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=422 time=0.008s id=req_1755386079955 ip=127.0.0.1
INFO:     127.0.0.1:64496 - "POST /api/v1/chat/query HTTP/1.1" 422 Unprocessable Entity
2025-08-16 19:15:37,210 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386137197 query_len=16 lang=es
2025-08-16 19:15:37,214 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:15:37,216 - src.models.climate_pipeline - INFO - Processing query: 'Hola como estas?...' in spanish (code: es)
2025-08-16 19:15:37,216 - src.models.climate_pipeline - INFO - Raw query repr: 'Hola como estas?'
2025-08-16 19:15:37,216 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:15:37,216 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:15:37,216 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:15:37,216 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:15:37,217 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hola como estas?'
2025-08-16 19:15:37,217 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hola como estas?'
2025-08-16 19:15:37,217 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:15:37,217 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 19:15:37,217 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:15:37,217 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:15:37,217 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:15:37,217 - src.models.query_routing - INFO - Router NET IN → query repr='Hola como estas?'
2025-08-16 19:15:37,419 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=201 status=OK request_id=93a14db7-12da-4de6-8762-d5fc7940b9a3
2025-08-16 19:15:37,419 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:15:37,419 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello, how are you?'
2025-08-16 19:15:37,420 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello, how are you?'
2025-08-16 19:15:37,420 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello, how are you?'
2025-08-16 19:15:37,420 - src.models.climate_pipeline - INFO - Net debug → original_query len=16, utf8_bytes=16
2025-08-16 19:15:37,420 - src.models.climate_pipeline - INFO - Net debug → english_query len=19, utf8_bytes=19
2025-08-16 19:15:37,420 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:15:37,420 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:15:37,423 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:15:37,423 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:15:37,427 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:15:37,434 - src.models.climate_pipeline - INFO - Timing: cache=14.5ms
2025-08-16 19:15:37,434 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:15:37,435 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:15:37,435 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 19:15:37,435 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hola como estas?'
2025-08-16 19:15:37,436 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='Hola como estas?', norm='Hola como estas?'
2025-08-16 19:15:38,145 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=709 status=OK request_id=23d5d948-ff79-45df-929e-80c3ac4ffebf
2025-08-16 19:15:38,146 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, matching the expected language.","language":"es","expected_language":"es","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:15:38,146 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:15:38,146 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hola como estas?...' expected_lang=es detected_lang=es classification=greeting language_match=True reason='User query is in Spanish, matching the expected language....'
2025-08-16 19:15:38,146 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='yes', canned=True
2025-08-16 19:15:38,146 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:15:38,146 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:15:38,433 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=286 status=OK request_id=3580e044-83dc-4ae4-afc1-30ca96d60827
2025-08-16 19:15:38,434 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:15:38,435 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386137197 time=1.227s model=nova faithfulness=1.000
2025-08-16 19:15:38,436 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.239s id=req_1755386137197 ip=127.0.0.1
INFO:     127.0.0.1:65226 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:15:59,949 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386159918 query_len=31 lang=es
2025-08-16 19:15:59,952 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:15:59,952 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:15:59,952 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:15:59,962 - src.models.climate_pipeline - INFO - Processing query: 'que son los cambios climaticos?...' in spanish (code: es)
2025-08-16 19:15:59,963 - src.models.climate_pipeline - INFO - Raw query repr: 'que son los cambios climaticos?'
2025-08-16 19:15:59,963 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:15:59,963 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:15:59,964 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:15:59,964 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:15:59,964 - src.models.climate_pipeline - INFO - Router OUT → english_query='que son los cambios climaticos?'
2025-08-16 19:15:59,964 - src.models.climate_pipeline - INFO - Router OUT → processed_query='que son los cambios climaticos?'
2025-08-16 19:15:59,964 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:15:59,964 - src.models.climate_pipeline - INFO - Timing: routing=0.5ms
2025-08-16 19:15:59,964 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:15:59,964 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:15:59,964 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:15:59,964 - src.models.query_routing - INFO - Router NET IN → query repr='que son los cambios climaticos?'
2025-08-16 19:16:00,538 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=573 status=OK request_id=8bb5d1a0-f02a-4802-ac87-74109f60aceb
2025-08-16 19:16:00,538 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:16:00,538 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What are climate changes?\n\nClimate changes refer to significant variations in the Earth's climate over time, encompassing changes in temperature, precipitation, wind patterns, and other atmospheric co"
2025-08-16 19:16:00,538 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What are climate changes?

Climate changes refer to significant variations in the Earth's climate over time, encompassing changes in temperature, precipitation, wind patterns, and other atmospheric co'
2025-08-16 19:16:00,538 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What are climate changes?

Climate changes refer to significant variations in the Earth's climate over time, encompassing changes in temperature, precipitation, wind patterns, and other atmospheric co'
2025-08-16 19:16:00,538 - src.models.climate_pipeline - INFO - Net debug → original_query len=31, utf8_bytes=31
2025-08-16 19:16:00,538 - src.models.climate_pipeline - INFO - Net debug → english_query len=507, utf8_bytes=507
2025-08-16 19:16:00,538 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:16:00,538 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:16:00,542 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:16:00,542 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:16:00,543 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:16:00,584 - src.models.climate_pipeline - INFO - Timing: cache=45.5ms
2025-08-16 19:16:00,584 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:16:00,584 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:16:00,584 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:16:00,584 - src.models.conversation_parser - INFO -   Message 1 (user): Hola como estas?...
2025-08-16 19:16:00,584 - src.models.conversation_parser - INFO -   Message 2 (assistant): Hola, soy su chatbot climático multilingüe. Puedo responder preguntas sobre el clima en cualquier id...
2025-08-16 19:16:00,584 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=2
2025-08-16 19:16:00,584 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='que son los cambios climaticos?'
2025-08-16 19:16:00,586 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='que son los cambios climaticos?', norm='que son los cambios climaticos?'
2025-08-16 19:16:01,174 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=584 status=OK request_id=b30a8b4e-c9b5-4e67-b702-952cb825cbe9
2025-08-16 19:16:01,174 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and related to climate change.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"What are climate changes?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:16:01,175 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:16:01,175 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='que son los cambios climaticos?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and related to climate change....'
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='What are climate changes?'
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - Timing: rewrite=590.9ms
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 19:16:01,175 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 19:16:01,175 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 19:16:01,175 - src.models.retrieval - INFO - Query embedding IN: query_len=25 chars, query_repr='What are climate changes?...'
2025-08-16 19:16:03,637 - src.models.retrieval - INFO - dep=query_embed op=encode ms=2461 dense_dim=1024 sparse_tokens=5
2025-08-16 19:16:04,059 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=412 status=OK
2025-08-16 19:16:04,059 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=412 total_ms=412
2025-08-16 19:16:04,222 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=162 status=OK
2025-08-16 19:16:04,222 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 19:16:04,222 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=162 total_ms=162
2025-08-16 19:16:04,226 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 19:16:04,227 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=9389 n_docs=7
2025-08-16 19:16:04,359 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 19:16:04,362 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=134.9 status=OK
2025-08-16 19:16:04,364 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.251038074, 'rerank_score': 0.9986904, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.228502974, 'rerank_score': 0.9981541, 'has_values': True}, {'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'pinecone_score': 0.234236374, 'rerank_score': 0.99808073, 'has_values': True}, {'title': '11356 2022 Article 19718', 'pinecone_score': 0.234831899, 'rerank_score': 0.9956176, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.252884656, 'rerank_score': 0.99341017, 'has_values': True}]
2025-08-16 19:16:04,364 - src.models.retrieval - INFO - q='What are climate changes?', base=7, kept_pre=7, refill=0, final_before=5, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.253, p50_sim_pre=0.234, p95_sim_pre=0.253, blocked_base=0, dropped_top2=[{'segment_id': '18', 'title': 'Adapting To Climate Change A Risk Based Guide For Local Governments', 'score': 0.25423113}, {'segment_id': '386', 'title': "Canada's Changing Climate Report 2019", 'score': 0.25256836}]
2025-08-16 19:16:04,364 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 19:16:04,364 - src.models.climate_pipeline - INFO - Timing: retrieval=3189.2ms
2025-08-16 19:16:04,364 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 19:16:04,364 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 19:16:04,365 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:16:04,368 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:16:04,368 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:16:04,369 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 19:16:04,369 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 19:16:07,023 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2653 status=OK request_id=3d3d62db-d2c3-4e18-8d9a-c43dbf4cd331
2025-08-16 19:16:07,026 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 19:16:07,026 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 19:16:07,026 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 19:16:07,026 - src.models.climate_pipeline - INFO - Timing: generation=2661.9ms
2025-08-16 19:16:07,026 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 19:16:08,203 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1176 status=OK request_id=d102c01d-d8d8-4073-91c1-9d1e9a0c4a9a
2025-08-16 19:16:08,204 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 19:16:08,204 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 19:16:08,204 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 19:16:08,204 - src.models.climate_pipeline - INFO - Timing: faithfulness=1177.5ms
2025-08-16 19:16:08,204 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 19:16:11,188 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2984 status=OK request_id=d1d27b60-fb61-414a-b8ff-7277d4065407
2025-08-16 19:16:11,189 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 19:16:11,189 - src.models.climate_pipeline - INFO - Timing: translation=2985.7ms
2025-08-16 19:16:11,190 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:16:11,191 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:16:11,192 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:16:11,215 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 19:16:11,219 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 19:16:11,271 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.5 rewrite=590.9 guards=0.0 retrieval=3189.2 generation=2661.9 faithfulness=1177.5 translation=2985.7 total=11227.1
2025-08-16 19:16:11,271 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 11.23s
2025-08-16 19:16:11,276 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386159918 time=11.327s model=nova faithfulness=0.950
2025-08-16 19:16:11,278 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=11.361s id=req_1755386159918 ip=127.0.0.1
INFO:     127.0.0.1:65503 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:16:45,682 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386205556 query_len=16 lang=en
2025-08-16 19:16:45,683 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:16:45,703 - src.models.climate_pipeline - INFO - Processing query: 'hola como estas?...' in english (code: en)
2025-08-16 19:16:45,704 - src.models.climate_pipeline - INFO - Raw query repr: 'hola como estas?'
2025-08-16 19:16:45,704 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:16:45,704 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:16:45,705 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola como estas?'
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola como estas?'
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - Timing: routing=1.1ms
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - Net debug → original_query len=16, utf8_bytes=16
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - Net debug → english_query len=16, utf8_bytes=16
2025-08-16 19:16:45,705 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:16:45,706 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:16:45,715 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:16:45,716 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:16:45,719 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:16:45,728 - src.models.climate_pipeline - INFO - Timing: cache=22.7ms
2025-08-16 19:16:45,728 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:16:45,729 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:16:45,729 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:16:45,729 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola como estas?'
2025-08-16 19:16:45,729 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='hola como estas?', norm='hola como estas?'
2025-08-16 19:16:46,329 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=599 status=OK request_id=7941713d-2382-4393-9d6b-f043d9b1f265
2025-08-16 19:16:46,330 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, not English.","language":"es","expected_language":"en","language_match":false,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:16:46,330 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:16:46,330 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola como estas?...' expected_lang=en detected_lang=es classification=greeting language_match=False reason='User query is in Spanish, not English....'
2025-08-16 19:16:46,330 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='no', canned=True
2025-08-16 19:16:46,330 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:16:46,330 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:16:46,332 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755386205556 error=Pipeline processing failed
2025-08-16 19:16:46,332 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755386205556 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755386205556'}}
2025-08-16 19:16:46,333 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.777s id=req_1755386205556 ip=127.0.0.1
INFO:     127.0.0.1:49609 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:17:06,159 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386226157 query_len=16 lang=es
2025-08-16 19:17:06,160 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:17:06,160 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:17:06,160 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:17:06,161 - src.models.climate_pipeline - INFO - Processing query: 'hola como estas?...' in spanish (code: es)
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Raw query repr: 'hola como estas?'
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:17:06,162 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola como estas?'
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola como estas?'
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-16 19:17:06,162 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:17:06,162 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:17:06,162 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:17:06,162 - src.models.query_routing - INFO - Router NET IN → query repr='hola como estas?'
2025-08-16 19:17:06,377 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=214 status=OK request_id=9532d01e-bb03-43fd-a37c-1ee1a97c965d
2025-08-16 19:17:06,381 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:17:06,381 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello, how are you?'
2025-08-16 19:17:06,381 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello, how are you?'
2025-08-16 19:17:06,381 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello, how are you?'
2025-08-16 19:17:06,381 - src.models.climate_pipeline - INFO - Net debug → original_query len=16, utf8_bytes=16
2025-08-16 19:17:06,381 - src.models.climate_pipeline - INFO - Net debug → english_query len=19, utf8_bytes=19
2025-08-16 19:17:06,381 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:17:06,382 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:17:06,384 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:17:06,384 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:17:06,384 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:17:06,408 - src.models.climate_pipeline - INFO - Timing: cache=26.3ms
2025-08-16 19:17:06,408 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:17:06,408 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:17:06,408 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:17:06,408 - src.models.conversation_parser - INFO -   Message 1 (user): hola como estas?...
2025-08-16 19:17:06,408 - src.models.conversation_parser - INFO -   Message 2 (assistant): I'm sorry, I encountered an error while processing your request. Please try again or contact support...
2025-08-16 19:17:06,408 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=2
2025-08-16 19:17:06,408 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola como estas?'
2025-08-16 19:17:06,408 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='hola como estas?', norm='hola como estas?'
2025-08-16 19:17:07,002 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=593 status=OK request_id=66de0101-de9a-439c-a416-06438e23cc20
2025-08-16 19:17:07,002 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and matches the expected language.","language":"es","expected_language":"es","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:17:07,002 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:17:07,002 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola como estas?...' expected_lang=es detected_lang=es classification=greeting language_match=True reason='User query is in Spanish and matches the expected language....'
2025-08-16 19:17:07,003 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='yes', canned=True
2025-08-16 19:17:07,003 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:17:07,003 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:17:07,283 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=279 status=OK request_id=eb2a25bd-2308-4928-9774-5abb30bb128f
2025-08-16 19:17:07,283 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:17:07,284 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386226157 time=1.124s model=nova faithfulness=1.000
2025-08-16 19:17:07,284 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.127s id=req_1755386226157 ip=127.0.0.1
INFO:     127.0.0.1:49814 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:20:34,333 - src.webui.api.routers.languages - INFO - Language validation: query_len=13 detected=en model=nova confidence=0.500
2025-08-16 19:20:34,335 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.025s id=req_1755386434310 ip=127.0.0.1
INFO:     127.0.0.1:52106 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:20:39,711 - src.webui.api.routers.languages - INFO - Language validation: query_len=60 detected=es model=nova confidence=0.800
2025-08-16 19:20:39,711 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.001s id=req_1755386439710 ip=127.0.0.1
INFO:     127.0.0.1:52178 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:22:13,412 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.001s id=req_1755386533411 ip=127.0.0.1
INFO:     127.0.0.1:53105 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:22:13,420 - src.webui.api.routers.languages - INFO - Language validation: query_len=16 detected=en model=nova confidence=0.500
2025-08-16 19:22:13,421 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.006s id=req_1755386533415 ip=127.0.0.1
INFO:     127.0.0.1:53105 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:22:13,451 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386533448 query_len=16 lang=en
2025-08-16 19:22:13,451 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Processing query: 'Hola como estas?...' in english (code: en)
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Raw query repr: 'Hola como estas?'
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:22:13,453 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hola como estas?'
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hola como estas?'
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Net debug → original_query len=16, utf8_bytes=16
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Net debug → english_query len=16, utf8_bytes=16
2025-08-16 19:22:13,453 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:22:13,454 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:22:13,478 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:22:13,478 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:22:13,479 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:22:13,489 - src.models.climate_pipeline - INFO - Timing: cache=35.6ms
2025-08-16 19:22:13,489 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:22:13,489 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:22:13,489 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:22:13,489 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hola como estas?'
2025-08-16 19:22:13,490 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Hola como estas?', norm='Hola como estas?'
2025-08-16 19:22:14,103 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=599 status=OK request_id=9af6e0f6-0083-443e-b5aa-f7624bedcca2
2025-08-16 19:22:14,104 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, not English.","language":"es","expected_language":"en","language_match":false,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:22:14,104 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:22:14,104 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hola como estas?...' expected_lang=en detected_lang=es classification=greeting language_match=False reason='User query is in Spanish, not English....'
2025-08-16 19:22:14,104 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='no', canned=True
2025-08-16 19:22:14,104 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:22:14,104 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:22:14,105 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755386533448 error=Pipeline processing failed
2025-08-16 19:22:14,105 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755386533448 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755386533448'}}
2025-08-16 19:22:14,105 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.657s id=req_1755386533448 ip=127.0.0.1
INFO:     127.0.0.1:53105 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:22:38,123 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386558120 query_len=15 lang=es
2025-08-16 19:22:38,124 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:22:38,124 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:22:38,124 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:22:38,125 - src.models.climate_pipeline - INFO - Processing query: 'hola como estas...' in spanish (code: es)
2025-08-16 19:22:38,125 - src.models.climate_pipeline - INFO - Raw query repr: 'hola como estas'
2025-08-16 19:22:38,125 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:22:38,126 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:22:38,126 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:22:38,126 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:22:38,126 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola como estas'
2025-08-16 19:22:38,126 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola como estas'
2025-08-16 19:22:38,126 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:22:38,126 - src.models.climate_pipeline - INFO - Timing: routing=0.5ms
2025-08-16 19:22:38,126 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:22:38,126 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:22:38,126 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:22:38,126 - src.models.query_routing - INFO - Router NET IN → query repr='hola como estas'
2025-08-16 19:22:38,357 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=230 status=OK request_id=87cef577-51d2-4786-a017-8bfe094cb61a
2025-08-16 19:22:38,359 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:22:38,359 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello, how are you\n\nTranslation:\nHello, how are you'
2025-08-16 19:22:38,359 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello, how are you

Translation:
Hello, how are you'
2025-08-16 19:22:38,359 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello, how are you

Translation:
Hello, how are you'
2025-08-16 19:22:38,359 - src.models.climate_pipeline - INFO - Net debug → original_query len=15, utf8_bytes=15
2025-08-16 19:22:38,359 - src.models.climate_pipeline - INFO - Net debug → english_query len=51, utf8_bytes=51
2025-08-16 19:22:38,359 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:22:38,359 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:22:38,362 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:22:38,362 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:22:38,362 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:22:38,363 - src.models.climate_pipeline - INFO - Timing: cache=4.2ms
2025-08-16 19:22:38,364 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:22:38,364 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:22:38,364 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:22:38,364 - src.models.conversation_parser - INFO -   Message 1 (user): Hola como estas?...
2025-08-16 19:22:38,364 - src.models.conversation_parser - INFO -   Message 2 (assistant): I'm sorry, I encountered an error while processing your request. Please try again or contact support...
2025-08-16 19:22:38,364 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=2
2025-08-16 19:22:38,364 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola como estas'
2025-08-16 19:22:38,364 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='hola como estas', norm='hola como estas'
2025-08-16 19:22:38,910 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=545 status=OK request_id=777dd6d5-b5f8-4373-935e-0c7f99d24873
2025-08-16 19:22:38,910 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and matches the expected language.","language":"es","expected_language":"es","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:22:38,911 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:22:38,911 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola como estas...' expected_lang=es detected_lang=es classification=greeting language_match=True reason='User query is in Spanish and matches the expected language....'
2025-08-16 19:22:38,911 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='yes', canned=True
2025-08-16 19:22:38,911 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:22:38,911 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:22:39,231 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=319 status=OK request_id=bc5accc4-d988-4be8-a3a5-04af01833342
2025-08-16 19:22:39,235 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:22:39,236 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386558120 time=1.113s model=nova faithfulness=1.000
2025-08-16 19:22:39,237 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.117s id=req_1755386558120 ip=127.0.0.1
INFO:     127.0.0.1:53339 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:23:42,750 - src.webui.api.routers.languages - INFO - Language validation: query_len=28 detected=es model=nova confidence=0.800
2025-08-16 19:23:42,757 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.034s id=req_1755386622723 ip=127.0.0.1
INFO:     127.0.0.1:53971 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:23:42,773 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.001s id=req_1755386622772 ip=127.0.0.1
INFO:     127.0.0.1:53971 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:23:42,814 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386622796 query_len=28 lang=es
2025-08-16 19:23:42,814 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:23:42,815 - src.models.climate_pipeline - INFO - Processing query: '¿Qué es el cambio climático?...' in spanish (code: es)
2025-08-16 19:23:42,815 - src.models.climate_pipeline - INFO - Raw query repr: '¿Qué es el cambio climático?'
2025-08-16 19:23:42,815 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:23:42,815 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:23:42,816 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:23:42,816 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:23:42,816 - src.models.climate_pipeline - INFO - Router OUT → english_query='¿Qué es el cambio climático?'
2025-08-16 19:23:42,816 - src.models.climate_pipeline - INFO - Router OUT → processed_query='¿Qué es el cambio climático?'
2025-08-16 19:23:42,816 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:23:42,816 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-16 19:23:42,816 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:23:42,816 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:23:42,816 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:23:42,816 - src.models.query_routing - INFO - Router NET IN → query repr='¿Qué es el cambio climático?'
2025-08-16 19:23:43,632 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=815 status=OK request_id=11d3a8f7-e4ec-445a-94d5-3f0452215746
2025-08-16 19:23:43,649 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:23:43,649 - src.models.query_routing - INFO - Router NET OUT → english_query repr="What is climate change?\n\nClimate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history"
2025-08-16 19:23:43,649 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 19:23:43,650 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='What is climate change?

Climate change refers to significant changes in global temperatures and weather patterns over time. While climate variability has always been a natural part of Earth's history'
2025-08-16 19:23:43,650 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=31
2025-08-16 19:23:43,650 - src.models.climate_pipeline - INFO - Net debug → english_query len=609, utf8_bytes=609
2025-08-16 19:23:43,650 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:23:43,650 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:23:43,658 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:23:43,658 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:23:43,661 - src.models.climate_pipeline - INFO - ✓ Cache hit for spanish - returning cached response
2025-08-16 19:23:43,661 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386622796 time=0.848s model=nova faithfulness=0.900
2025-08-16 19:23:43,663 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.867s id=req_1755386622796 ip=127.0.0.1
INFO:     127.0.0.1:53974 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:24:00,101 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386640097 query_len=15 lang=es
2025-08-16 19:24:00,101 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:24:00,101 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:24:00,102 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:24:00,102 - src.models.climate_pipeline - INFO - Processing query: 'hola como estas...' in spanish (code: es)
2025-08-16 19:24:00,102 - src.models.climate_pipeline - INFO - Raw query repr: 'hola como estas'
2025-08-16 19:24:00,102 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:24:00,102 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:24:00,103 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:24:00,103 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:24:00,103 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola como estas'
2025-08-16 19:24:00,103 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola como estas'
2025-08-16 19:24:00,103 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:24:00,103 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 19:24:00,103 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:24:00,103 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:24:00,103 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:24:00,103 - src.models.query_routing - INFO - Router NET IN → query repr='hola como estas'
2025-08-16 19:24:00,554 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=450 status=OK request_id=8bfc08b4-f6d9-4c7c-b23c-8fc09f82934c
2025-08-16 19:24:00,554 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:24:00,554 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello, how are you\n\nTranslation:\nHello, how are you'
2025-08-16 19:24:00,554 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello, how are you

Translation:
Hello, how are you'
2025-08-16 19:24:00,554 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello, how are you

Translation:
Hello, how are you'
2025-08-16 19:24:00,554 - src.models.climate_pipeline - INFO - Net debug → original_query len=15, utf8_bytes=15
2025-08-16 19:24:00,554 - src.models.climate_pipeline - INFO - Net debug → english_query len=51, utf8_bytes=51
2025-08-16 19:24:00,554 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:24:00,555 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:24:00,561 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:24:00,561 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:24:00,561 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:24:00,562 - src.models.climate_pipeline - INFO - Timing: cache=7.8ms
2025-08-16 19:24:00,562 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:24:00,562 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:24:00,562 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:24:00,562 - src.models.conversation_parser - INFO -   Message 1 (user): ¿Qué es el cambio climático?...
2025-08-16 19:24:00,562 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Comprensión del Cambio Climático

## ¿Qué es el Cambio Climático?

El cambio climático se refiere ...
2025-08-16 19:24:00,562 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=2
2025-08-16 19:24:00,562 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola como estas'
2025-08-16 19:24:00,563 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='hola como estas', norm='hola como estas'
2025-08-16 19:24:01,173 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=609 status=OK request_id=098d345a-3e04-4620-a28f-69813be696b9
2025-08-16 19:24:01,173 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a greeting in Spanish.","language":"es","expected_language":"es","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:24:01,174 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:24:01,174 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola como estas...' expected_lang=es detected_lang=es classification=greeting language_match=True reason='User query is a greeting in Spanish....'
2025-08-16 19:24:01,174 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='yes', canned=True
2025-08-16 19:24:01,174 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:24:01,174 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:24:01,539 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=364 status=OK request_id=2c97cf28-4a8a-437a-84ee-e151d143ae71
2025-08-16 19:24:01,539 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:24:01,540 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386640097 time=1.439s model=nova faithfulness=1.000
2025-08-16 19:24:01,541 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.444s id=req_1755386640097 ip=127.0.0.1
INFO:     127.0.0.1:54134 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:24:07,535 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386647528 query_len=11 lang=es
2025-08-16 19:24:07,539 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 19:24:07,539 - src.webui.api.routers.chat - INFO - Parsed conversation history: 4 messages
2025-08-16 19:24:07,539 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:24:07,542 - src.models.climate_pipeline - INFO - Processing query: 'estas bien?...' in spanish (code: es)
2025-08-16 19:24:07,544 - src.models.climate_pipeline - INFO - Raw query repr: 'estas bien?'
2025-08-16 19:24:07,544 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:24:07,544 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:24:07,545 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:24:07,545 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:24:07,545 - src.models.climate_pipeline - INFO - Router OUT → english_query='estas bien?'
2025-08-16 19:24:07,545 - src.models.climate_pipeline - INFO - Router OUT → processed_query='estas bien?'
2025-08-16 19:24:07,546 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:24:07,546 - src.models.climate_pipeline - INFO - Timing: routing=1.1ms
2025-08-16 19:24:07,546 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:24:07,546 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:24:07,546 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:24:07,546 - src.models.query_routing - INFO - Router NET IN → query repr='estas bien?'
2025-08-16 19:24:07,753 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=206 status=OK request_id=f41860de-8175-48a7-95bc-62fd46c9a1a8
2025-08-16 19:24:07,753 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:24:07,753 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Are you well?'
2025-08-16 19:24:07,753 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Are you well?'
2025-08-16 19:24:07,753 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Are you well?'
2025-08-16 19:24:07,753 - src.models.climate_pipeline - INFO - Net debug → original_query len=11, utf8_bytes=11
2025-08-16 19:24:07,753 - src.models.climate_pipeline - INFO - Net debug → english_query len=13, utf8_bytes=13
2025-08-16 19:24:07,753 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:24:07,754 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:24:07,756 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:24:07,756 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:24:07,756 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:24:07,758 - src.models.climate_pipeline - INFO - Timing: cache=4.4ms
2025-08-16 19:24:07,758 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:24:07,758 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 19:24:07,758 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:24:07,758 - src.models.conversation_parser - INFO -   Message 1 (user): ¿Qué es el cambio climático?...
2025-08-16 19:24:07,758 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Comprensión del Cambio Climático

## ¿Qué es el Cambio Climático?

El cambio climático se refiere ...
2025-08-16 19:24:07,758 - src.models.conversation_parser - INFO -   Message 3 (user): hola como estas...
2025-08-16 19:24:07,758 - src.models.conversation_parser - INFO -   Message 4 (assistant): Hola, soy su chatbot climático multilingüe. Puedo responder preguntas sobre el clima en cualquier id...
2025-08-16 19:24:07,758 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=4
2025-08-16 19:24:07,758 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='estas bien?'
2025-08-16 19:24:07,759 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='estas bien?', norm='estas bien?'
2025-08-16 19:24:08,629 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=869 status=OK request_id=ce2b818d-8184-4a13-84b8-aa575a610278
2025-08-16 19:24:08,630 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a short follow-up to the last conversation which was climate-related.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"Are you sure about the effects of climate change?","ask_how_to_use":false,"how_it_works":null,"erro
2025-08-16 19:24:08,630 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:24:08,630 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='estas bien?...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is a short follow-up to the last conversation which was climate-related....'
2025-08-16 19:24:08,630 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 19:24:08,630 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Are you sure about the effects of climate change?'
2025-08-16 19:24:08,630 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 19:24:08,630 - src.models.climate_pipeline - INFO - Timing: rewrite=872.4ms
2025-08-16 19:24:08,631 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 19:24:08,631 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 19:24:08,631 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-16 19:24:08,631 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 19:24:08,631 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 19:24:08,631 - src.models.retrieval - INFO - Query embedding IN: query_len=49 chars, query_repr='Are you sure about the effects of climate change?...'
2025-08-16 19:24:12,925 - src.models.retrieval - INFO - dep=query_embed op=encode ms=4293 dense_dim=1024 sparse_tokens=10
2025-08-16 19:24:13,351 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=420 status=OK
2025-08-16 19:24:13,351 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=421 total_ms=421
2025-08-16 19:24:13,511 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=159 status=OK
2025-08-16 19:24:13,511 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 19:24:13,511 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=160 total_ms=160
2025-08-16 19:24:13,517 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-16 19:24:13,519 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=7413 n_docs=7
2025-08-16 19:24:13,754 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 19:24:13,769 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=249.8 status=OK
2025-08-16 19:24:13,775 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Canada In A Changing Climate National Issues Report', 'pinecone_score': 0.244251937, 'rerank_score': 0.39210403, 'has_values': True}, {'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'pinecone_score': 0.251125574, 'rerank_score': 0.28646857, 'has_values': True}, {'title': 'Connecting Climate Change And Health – A Guidebook Of Health And Climate Change ', 'pinecone_score': 0.241775304, 'rerank_score': 0.19790912, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.241810799, 'rerank_score': 0.1526628, 'has_values': True}, {'title': '1 S2.0 S2667278223000172 Main', 'pinecone_score': 0.264424205, 'rerank_score': 0.11357959, 'has_values': True}]
2025-08-16 19:24:13,775 - src.models.retrieval - INFO - q='Are you sure about the effects of climate change?', base=7, kept_pre=7, refill=0, final_before=0, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.274, p50_sim_pre=0.245, p95_sim_pre=0.274, blocked_base=0, dropped_top2=[{'segment_id': '15', 'title': 'Canada In A Changing Climate National Issues Report', 'score': 0.39210403}, {'segment_id': '17', 'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'score': 0.28646857}]
2025-08-16 19:24:13,776 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 19:24:13,776 - src.models.climate_pipeline - INFO - Timing: retrieval=5144.7ms
2025-08-16 19:24:13,776 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 19:24:13,776 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 19:24:13,777 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:24:13,780 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:24:13,780 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:24:13,783 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 19:24:13,783 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 19:24:14,024 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=240 status=OK request_id=cdfced14-c4aa-4c27-876b-b9a6eeccc733
2025-08-16 19:24:14,025 - src.models.gen_response_unified - INFO - Optimized conversation history for nova
2025-08-16 19:24:17,210 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3184 status=OK request_id=1c6975da-168d-407b-a536-37f3fa066e93
2025-08-16 19:24:17,225 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 19:24:17,226 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 19:24:17,226 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 19:24:17,226 - src.models.climate_pipeline - INFO - Timing: generation=3450.2ms
2025-08-16 19:24:17,226 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 19:24:18,843 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1615 status=OK request_id=5862108c-e207-4b15-b30d-cc1d6c3e2ada
2025-08-16 19:24:18,844 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-16 19:24:18,844 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-16 19:24:18,844 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 19:24:18,844 - src.models.climate_pipeline - INFO - Timing: faithfulness=1618.0ms
2025-08-16 19:24:18,844 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 19:24:22,105 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3259 status=OK request_id=a4033b53-344a-43ba-b1fa-fd490e5b23e4
2025-08-16 19:24:22,107 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 19:24:22,107 - src.models.climate_pipeline - INFO - Timing: translation=3262.9ms
2025-08-16 19:24:22,108 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:24:22,111 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:24:22,111 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:24:22,114 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 19:24:22,115 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 19:24:22,120 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=1.1 rewrite=872.4 guards=0.1 retrieval=5144.7 generation=3450.2 faithfulness=1618.0 translation=3262.9 total=14565.6
2025-08-16 19:24:22,121 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 14.57s
2025-08-16 19:24:22,122 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386647528 time=14.587s model=nova faithfulness=0.950
2025-08-16 19:24:22,128 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=14.599s id=req_1755386647528 ip=127.0.0.1
INFO:     127.0.0.1:54215 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:24:56,932 - src.webui.api.routers.languages - INFO - Language validation: query_len=16 detected=en model=nova confidence=0.500
2025-08-16 19:24:56,934 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.005s id=req_1755386696928 ip=127.0.0.1
INFO:     127.0.0.1:54727 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:24:56,981 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386696977 query_len=16 lang=en
2025-08-16 19:24:56,981 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Processing query: 'hola como estas?...' in english (code: en)
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Raw query repr: 'hola como estas?'
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:24:56,982 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola como estas?'
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola como estas?'
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Net debug → original_query len=16, utf8_bytes=16
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Net debug → english_query len=16, utf8_bytes=16
2025-08-16 19:24:56,982 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:24:56,982 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:24:56,987 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:24:56,987 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:24:56,988 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:24:56,989 - src.models.climate_pipeline - INFO - Timing: cache=6.9ms
2025-08-16 19:24:56,989 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:24:56,989 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:24:56,989 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:24:56,989 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola como estas?'
2025-08-16 19:24:56,989 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='hola como estas?', norm='hola como estas?'
2025-08-16 19:24:57,560 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=570 status=OK request_id=e33a25a1-229a-48db-93ae-512cf12ff4f8
2025-08-16 19:24:57,561 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish, not English.","language":"es","expected_language":"en","language_match":false,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:24:57,561 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:24:57,561 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola como estas?...' expected_lang=en detected_lang=es classification=greeting language_match=False reason='User query is in Spanish, not English....'
2025-08-16 19:24:57,561 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='no', canned=True
2025-08-16 19:24:57,561 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:24:57,561 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:24:57,562 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755386696977 error=Pipeline processing failed
2025-08-16 19:24:57,562 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755386696977 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755386696977'}}
2025-08-16 19:24:57,562 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.585s id=req_1755386696977 ip=127.0.0.1
INFO:     127.0.0.1:54727 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:25:43,417 - src.webui.api.routers.languages - INFO - Language validation: query_len=8 detected=en model=nova confidence=0.500
2025-08-16 19:25:43,421 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.013s id=req_1755386743408 ip=127.0.0.1
INFO:     127.0.0.1:55172 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:25:43,457 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386743448 query_len=8 lang=en
2025-08-16 19:25:43,457 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Processing query: 'gracias!...' in english (code: en)
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Raw query repr: 'gracias!'
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:25:43,459 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Router OUT → english_query='gracias!'
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Router OUT → processed_query='gracias!'
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Net debug → original_query len=8, utf8_bytes=8
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Net debug → english_query len=8, utf8_bytes=8
2025-08-16 19:25:43,459 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:25:43,460 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:25:43,474 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:25:43,474 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:25:43,475 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:25:43,478 - src.models.climate_pipeline - INFO - Timing: cache=18.3ms
2025-08-16 19:25:43,478 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:25:43,478 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:25:43,478 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:25:43,478 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='gracias!'
2025-08-16 19:25:43,478 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='gracias!', norm='gracias!'
2025-08-16 19:25:44,058 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=579 status=OK request_id=3473b298-e3ad-4982-bd2d-52f7d14a0fb2
2025-08-16 19:25:44,059 - query_rewriter - INFO - Model raw (first 300): {"reason":"User expressed gratitude in Spanish.","language":"es","expected_language":"en","language_match":false,"classification":"thanks","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:25:44,059 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:25:44,059 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='gracias!...' expected_lang=en detected_lang=es classification=thanks language_match=False reason='User expressed gratitude in Spanish....'
2025-08-16 19:25:44,059 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='thanks', language_match='no', canned=True
2025-08-16 19:25:44,059 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:25:44,059 - src.models.climate_pipeline - WARNING - Language mismatch detected by query rewriter: query is in Spanish but English was selected
2025-08-16 19:25:44,060 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755386743448 error=Pipeline processing failed
2025-08-16 19:25:44,060 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755386743448 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': 'Pipeline processing failed', 'retryable': True, 'request_id': 'req_1755386743448'}}
2025-08-16 19:25:44,060 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=0.612s id=req_1755386743448 ip=127.0.0.1
INFO:     127.0.0.1:55172 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-16 19:25:59,939 - src.webui.api.routers.languages - INFO - Language validation: query_len=56 detected=es model=nova confidence=0.800
2025-08-16 19:25:59,940 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.003s id=req_1755386759936 ip=127.0.0.1
INFO:     127.0.0.1:55356 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:25:59,991 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755386759976 query_len=56 lang=es
2025-08-16 19:25:59,991 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Processing query: 'porque es importante aprender de los cambios climaticos?...' in spanish (code: es)
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Raw query repr: 'porque es importante aprender de los cambios climaticos?'
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:25:59,999 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Router OUT → english_query='porque es importante aprender de los cambios climaticos?'
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Router OUT → processed_query='porque es importante aprender de los cambios climaticos?'
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:25:59,999 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 19:26:00,000 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:26:00,000 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:26:00,000 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:26:00,000 - src.models.query_routing - INFO - Router NET IN → query repr='porque es importante aprender de los cambios climaticos?'
2025-08-16 19:26:01,369 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1369 status=OK request_id=3336e7ae-4f42-4990-bda6-a637d50765d8
2025-08-16 19:26:01,370 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:26:01,370 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Why is it important to learn about climate change?\n\nUnderstanding the dynamics of climate change is crucial for several reasons. Firstly, climate change poses significant risks to human health, liveli'
2025-08-16 19:26:01,370 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Why is it important to learn about climate change?

Understanding the dynamics of climate change is crucial for several reasons. Firstly, climate change poses significant risks to human health, liveli'
2025-08-16 19:26:01,373 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Why is it important to learn about climate change?

Understanding the dynamics of climate change is crucial for several reasons. Firstly, climate change poses significant risks to human health, liveli'
2025-08-16 19:26:01,373 - src.models.climate_pipeline - INFO - Net debug → original_query len=56, utf8_bytes=56
2025-08-16 19:26:01,373 - src.models.climate_pipeline - INFO - Net debug → english_query len=1500, utf8_bytes=1500
2025-08-16 19:26:01,373 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:26:01,373 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:26:01,376 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:26:01,376 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:26:01,377 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:26:01,379 - src.models.climate_pipeline - INFO - Timing: cache=5.9ms
2025-08-16 19:26:01,379 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:26:01,379 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:26:01,379 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 19:26:01,379 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='porque es importante aprender de los cambios climaticos?'
2025-08-16 19:26:01,379 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='porque es importante aprender de los cambios climaticos?', norm='porque es importante aprender de los cambios climaticos?'
2025-08-16 19:26:01,946 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=565 status=OK request_id=fa558d9c-bba1-4ca4-95cf-0b4c648c34a4
2025-08-16 19:26:01,947 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and related to climate change.","language":"es","expected_language":"es","language_match":true,"classification":"on-topic","rewrite_en":"Why is it important to learn about climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:26:01,947 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:26:01,947 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='porque es importante aprender de los cambios clima...' expected_lang=es detected_lang=es classification=on-topic language_match=True reason='User query is in Spanish and related to climate change....'
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='on-topic', language_match='yes', canned=False
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Why is it important to learn about climate change?'
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - Timing: rewrite=567.8ms
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-16 19:26:01,947 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-16 19:26:01,947 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-16 19:26:01,947 - src.models.retrieval - INFO - Query embedding IN: query_len=50 chars, query_repr='Why is it important to learn about climate change?...'
2025-08-16 19:26:02,845 - src.models.retrieval - INFO - dep=query_embed op=encode ms=897 dense_dim=1024 sparse_tokens=10
2025-08-16 19:26:03,161 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=315 status=OK
2025-08-16 19:26:03,162 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=315 total_ms=315
2025-08-16 19:26:03,349 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=187 status=OK
2025-08-16 19:26:03,349 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 19:26:03,350 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=187 total_ms=187
2025-08-16 19:26:03,352 - src.models.retrieval - INFO - dep=mmr_embed used_index=2 used_cache=0 embedded=0 ms=0 n_docs=2 valid_vecs=2 q_embed_ms=0
2025-08-16 19:26:03,353 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=2239 n_docs=2
2025-08-16 19:26:03,475 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 19:26:03,479 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=126.2 status=OK
2025-08-16 19:26:03,482 - src.models.retrieval - INFO - Query embedding IN: query_len=50 chars, query_repr='Why is it important to learn about climate change?...'
2025-08-16 19:26:03,566 - src.models.retrieval - INFO - dep=query_embed op=encode ms=84 dense_dim=1024 sparse_tokens=10
2025-08-16 19:26:04,264 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=241 status=OK
2025-08-16 19:26:04,264 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-16 19:26:04,264 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=242 total_ms=242
2025-08-16 19:26:04,271 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=56992 n_docs=44
2025-08-16 19:26:04,468 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-16 19:26:04,473 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=201.2 status=OK
2025-08-16 19:26:04,474 - src.models.retrieval - INFO - Retained docs preview: [{'title': '1 S2.0 S2667278221000183 Main', 'pinecone_score': 0.241901249, 'rerank_score': 0.9965837, 'has_values': True}, {'title': 'Kgae015', 'pinecone_score': 0.232621983, 'rerank_score': 0.99343574, 'has_values': True}, {'title': 'Annurev Publhealth 090419 102409', 'pinecone_score': 0.22299622, 'rerank_score': 0.9856076, 'has_values': True}, {'title': 'A Guidebook On Climate Scenarios Using Climate Information To Guide Adaptation R', 'pinecone_score': 0.237352073, 'rerank_score': 0.9765801, 'has_values': True}, {'title': "Canada's Changing Climate Report 2019", 'pinecone_score': 0.221198633, 'rerank_score': 0.97409195, 'has_values': True}]
2025-08-16 19:26:04,474 - src.models.retrieval - INFO - q='Why is it important to learn about climate change?', base=2, kept_pre=2, refill=0, final_before=1, final_after=5, hybrid_refill=4, floor=0.68, delta=0.100, max_sim_pre=0.242, p50_sim_pre=0.241, p95_sim_pre=0.242, blocked_base=4, dropped_top2=[{'segment_id': '37', 'title': 'Adaptation Framework By Up North Climate', 'score': 0.6423203}]
2025-08-16 19:26:04,477 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-16 19:26:04,477 - src.models.climate_pipeline - INFO - Timing: retrieval=2530.0ms
2025-08-16 19:26:04,477 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-16 19:26:04,477 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-16 19:26:04,477 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:26:04,479 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:26:04,480 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:26:04,481 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-16 19:26:04,481 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-16 19:26:07,925 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3443 status=OK request_id=520be9a4-75de-4684-9c32-6b89a06257a9
2025-08-16 19:26:07,929 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-16 19:26:07,929 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-16 19:26:07,929 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-16 19:26:07,929 - src.models.climate_pipeline - INFO - Timing: generation=3451.9ms
2025-08-16 19:26:07,929 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-16 19:26:09,148 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1218 status=OK request_id=feb338b0-1739-4cb3-b742-ab0e7e1e4768
2025-08-16 19:26:09,149 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-16 19:26:09,149 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-16 19:26:09,149 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-16 19:26:09,149 - src.models.climate_pipeline - INFO - Timing: faithfulness=1219.7ms
2025-08-16 19:26:09,149 - src.models.climate_pipeline - INFO - Step 8: Translating response to spanish (code=es)
2025-08-16 19:26:12,429 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3280 status=OK request_id=a8bf30aa-6282-41ee-9d97-204b6c8a1c84
2025-08-16 19:26:12,430 - src.models.climate_pipeline - INFO - ✓ Response translated successfully to spanish
2025-08-16 19:26:12,430 - src.models.climate_pipeline - INFO - Timing: translation=3280.8ms
2025-08-16 19:26:12,430 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:26:12,433 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:26:12,433 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:26:12,433 - src.models.climate_pipeline - INFO - ✓ Response cached in spanish
2025-08-16 19:26:12,436 - src.models.climate_pipeline - INFO - ✓ English version also cached
2025-08-16 19:26:12,437 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.2 rewrite=567.8 guards=0.0 retrieval=2530.0 generation=3451.9 faithfulness=1219.7 translation=3280.8 total=12430.6
2025-08-16 19:26:12,437 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 12.43s
2025-08-16 19:26:12,438 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755386759976 time=12.447s model=nova faithfulness=0.900
2025-08-16 19:26:12,441 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=12.464s id=req_1755386759976 ip=127.0.0.1
INFO:     127.0.0.1:55356 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:27:08,461 - src.webui.api.routers.languages - INFO - Language validation: query_len=15 detected=en model=nova confidence=0.500
2025-08-16 19:27:08,464 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.010s id=req_1755386828454 ip=127.0.0.1
INFO:     127.0.0.1:56050 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:27:08,532 - src.webui.api.routers.languages - INFO - Language validation: query_len=7 detected=en model=nova confidence=0.500
2025-08-16 19:27:08,533 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.003s id=req_1755386828530 ip=127.0.0.1
INFO:     127.0.0.1:56052 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:27:08,550 - src.webui.api.routers.languages - INFO - Language validation: query_len=9 detected=en model=nova confidence=0.500
2025-08-16 19:27:08,551 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.001s id=req_1755386828550 ip=127.0.0.1
INFO:     127.0.0.1:56054 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:27:08,565 - src.webui.api.routers.languages - INFO - Language validation: query_len=11 detected=en model=nova confidence=0.500
2025-08-16 19:27:08,565 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.001s id=req_1755386828564 ip=127.0.0.1
INFO:     127.0.0.1:56056 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:31:00,922 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387060913 query_len=2 lang=zh
2025-08-16 19:31:00,925 - src.webui.api.routers.chat - INFO - Language routing: detected=zh model=command_a
2025-08-16 19:31:00,928 - src.models.climate_pipeline - INFO - Processing query: '你好...' in chinese (code: zh)
2025-08-16 19:31:00,929 - src.models.climate_pipeline - INFO - Raw query repr: '你好'
2025-08-16 19:31:00,930 - src.models.climate_pipeline - INFO - Router IN → language_name=chinese, language_code=zh
2025-08-16 19:31:00,930 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:31:00,930 - src.models.query_routing - INFO - Language: chinese (zh) → Model: Command-A
2025-08-16 19:31:00,930 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 19:31:00,931 - src.models.climate_pipeline - INFO - Router OUT → english_query='你好'
2025-08-16 19:31:00,931 - src.models.climate_pipeline - INFO - Router OUT → processed_query='你好'
2025-08-16 19:31:00,931 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 19:31:00,931 - src.models.climate_pipeline - INFO - Timing: routing=1.4ms
2025-08-16 19:31:00,931 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 19:31:00,932 - src.models.query_routing - INFO - Language: chinese (zh) → Model: Command-A
2025-08-16 19:31:00,932 - src.models.query_routing - INFO - Translating query from chinese to English
2025-08-16 19:31:00,932 - src.models.query_routing - INFO - Router NET IN → query repr='你好'
2025-08-16 19:31:01,683 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 19:31:01,706 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:31:01,706 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello.'
2025-08-16 19:31:01,706 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello.'
2025-08-16 19:31:01,706 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello.'
2025-08-16 19:31:01,706 - src.models.climate_pipeline - INFO - Net debug → original_query len=2, utf8_bytes=6
2025-08-16 19:31:01,706 - src.models.climate_pipeline - INFO - Net debug → english_query len=6, utf8_bytes=6
2025-08-16 19:31:01,706 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:31:01,706 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:31:01,764 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:31:01,764 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:31:01,765 - src.models.climate_pipeline - INFO - Cache miss for chinese query
2025-08-16 19:31:01,768 - src.models.climate_pipeline - INFO - Timing: cache=61.6ms
2025-08-16 19:31:01,768 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:31:01,768 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:31:01,768 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=zh, history_len=0
2025-08-16 19:31:01,768 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='你好'
2025-08-16 19:31:01,769 - query_rewriter - INFO - Rewriter NET IN → expected_lang=zh, user_query repr='你好', norm='你好'
2025-08-16 19:31:02,342 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=572 status=OK request_id=c9868b80-b208-47b0-8098-335361cc90c4
2025-08-16 19:31:02,342 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a greeting in Chinese.","language":"zh","expected_language":"zh","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:31:02,342 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:31:02,343 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='你好...' expected_lang=zh detected_lang=zh classification=greeting language_match=True reason='User query is a greeting in Chinese....'
2025-08-16 19:31:02,343 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='zh', classification='greeting', language_match='yes', canned=True
2025-08-16 19:31:02,343 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:31:02,343 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:31:02,745 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=401 status=OK request_id=f3e518f3-8cc0-4524-ad84-06fb20c1197d
2025-08-16 19:31:02,746 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:31:02,752 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387060913 time=1.830s model=command_a faithfulness=1.000
2025-08-16 19:31:02,807 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.893s id=req_1755387060913 ip=127.0.0.1
INFO:     127.0.0.1:58452 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:31:10,391 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387070386 query_len=2 lang=zh
2025-08-16 19:31:10,392 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:31:10,392 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:31:10,393 - src.webui.api.routers.chat - INFO - Language routing: detected=zh model=command_a
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Processing query: '谢谢...' in chinese (code: zh)
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Raw query repr: '谢谢'
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Router IN → language_name=chinese, language_code=zh
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:31:10,395 - src.models.query_routing - INFO - Language: chinese (zh) → Model: Command-A
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Router OUT → model=Command-A, support=command_a, needs_translation=True
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Router OUT → english_query='谢谢'
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Router OUT → processed_query='谢谢'
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - ✓ Routed to Command-A model
2025-08-16 19:31:10,395 - src.models.climate_pipeline - INFO - Timing: routing=0.5ms
2025-08-16 19:31:10,396 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Command-A
2025-08-16 19:31:10,396 - src.models.query_routing - INFO - Language: chinese (zh) → Model: Command-A
2025-08-16 19:31:10,396 - src.models.query_routing - INFO - Translating query from chinese to English
2025-08-16 19:31:10,396 - src.models.query_routing - INFO - Router NET IN → query repr='谢谢'
2025-08-16 19:31:10,625 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/chat "HTTP/1.1 200 OK"
2025-08-16 19:31:10,628 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:31:10,628 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Thank you.'
2025-08-16 19:31:10,628 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Thank you.'
2025-08-16 19:31:10,628 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Thank you.'
2025-08-16 19:31:10,628 - src.models.climate_pipeline - INFO - Net debug → original_query len=2, utf8_bytes=6
2025-08-16 19:31:10,628 - src.models.climate_pipeline - INFO - Net debug → english_query len=10, utf8_bytes=10
2025-08-16 19:31:10,628 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:31:10,628 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:31:10,634 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:31:10,635 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:31:10,635 - src.models.climate_pipeline - INFO - Cache miss for chinese query
2025-08-16 19:31:10,683 - src.models.climate_pipeline - INFO - Timing: cache=54.7ms
2025-08-16 19:31:10,683 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:31:10,683 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:31:10,683 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:31:10,684 - src.models.conversation_parser - INFO -   Message 1 (user): 你好...
2025-08-16 19:31:10,684 - src.models.conversation_parser - INFO -   Message 2 (assistant): 您好，我是您的多语言气候聊天机器人。我可以用任何语言回答有关气候的问题。您想了解什么？...
2025-08-16 19:31:10,684 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=zh, history_len=2
2025-08-16 19:31:10,684 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='谢谢'
2025-08-16 19:31:10,685 - query_rewriter - INFO - Rewriter NET IN → expected_lang=zh, user_query repr='谢谢', norm='谢谢'
2025-08-16 19:31:11,231 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=545 status=OK request_id=9ce0e759-ae4b-43f3-8416-9cb37bab73ea
2025-08-16 19:31:11,232 - query_rewriter - INFO - Model raw (first 300): {"reason":"User expressed gratitude in Chinese.","language":"zh","expected_language":"zh","language_match":true,"classification":"thanks","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:31:11,232 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:31:11,232 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='谢谢...' expected_lang=zh detected_lang=zh classification=thanks language_match=True reason='User expressed gratitude in Chinese....'
2025-08-16 19:31:11,232 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='zh', classification='thanks', language_match='yes', canned=True
2025-08-16 19:31:11,232 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:31:11,232 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:31:11,535 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=302 status=OK request_id=4ca6dc22-61eb-433c-a8d1-80da9b6c3031
2025-08-16 19:31:11,536 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:31:11,537 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387070386 time=1.145s model=command_a faithfulness=1.000
2025-08-16 19:31:11,537 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.151s id=req_1755387070386 ip=127.0.0.1
INFO:     127.0.0.1:58552 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:32:44,586 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387164581 query_len=13 lang=es
2025-08-16 19:32:44,587 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:32:44,588 - src.models.climate_pipeline - INFO - Processing query: 'Hola como vas...' in spanish (code: es)
2025-08-16 19:32:44,588 - src.models.climate_pipeline - INFO - Raw query repr: 'Hola como vas'
2025-08-16 19:32:44,588 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:32:44,589 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:32:44,589 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:32:44,589 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:32:44,589 - src.models.climate_pipeline - INFO - Router OUT → english_query='Hola como vas'
2025-08-16 19:32:44,589 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Hola como vas'
2025-08-16 19:32:44,589 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:32:44,589 - src.models.climate_pipeline - INFO - Timing: routing=0.7ms
2025-08-16 19:32:44,589 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:32:44,589 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:32:44,589 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:32:44,589 - src.models.query_routing - INFO - Router NET IN → query repr='Hola como vas'
2025-08-16 19:32:44,809 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=218 status=OK request_id=82e74445-3426-43a4-a2c6-e658d3a29180
2025-08-16 19:32:44,809 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:32:44,809 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello, how are you doing.'
2025-08-16 19:32:44,809 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello, how are you doing.'
2025-08-16 19:32:44,809 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello, how are you doing.'
2025-08-16 19:32:44,809 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=13
2025-08-16 19:32:44,809 - src.models.climate_pipeline - INFO - Net debug → english_query len=25, utf8_bytes=25
2025-08-16 19:32:44,809 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:32:44,809 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:32:44,814 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:32:44,814 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:32:44,815 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:32:44,821 - src.models.climate_pipeline - INFO - Timing: cache=11.8ms
2025-08-16 19:32:44,821 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:32:44,821 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:32:44,821 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=0
2025-08-16 19:32:44,821 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Hola como vas'
2025-08-16 19:32:44,822 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='Hola como vas', norm='Hola como vas'
2025-08-16 19:32:45,426 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=602 status=OK request_id=8fb19958-d842-434a-9774-8e5d91f30ed6
2025-08-16 19:32:45,427 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is in Spanish and matches the expected language.","language":"es","expected_language":"es","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:32:45,428 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:32:45,428 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Hola como vas...' expected_lang=es detected_lang=es classification=greeting language_match=True reason='User query is in Spanish and matches the expected language....'
2025-08-16 19:32:45,429 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='yes', canned=True
2025-08-16 19:32:45,429 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:32:45,429 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:32:45,730 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=300 status=OK request_id=0da38b5a-1a9f-41f4-94db-b67599cb87cc
2025-08-16 19:32:45,731 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:32:45,732 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387164581 time=1.145s model=nova faithfulness=1.000
2025-08-16 19:32:45,732 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.151s id=req_1755387164581 ip=127.0.0.1
INFO:     127.0.0.1:59485 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:40:27,784 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.007s id=req_1755387627776 ip=127.0.0.1
INFO:     127.0.0.1:64008 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:40:27,802 - src.webui.api.routers.languages - INFO - Language validation: query_len=8 detected=en model=nova confidence=0.500
2025-08-16 19:40:27,807 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.014s id=req_1755387627793 ip=127.0.0.1
INFO:     127.0.0.1:64014 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:40:27,814 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.000s id=req_1755387627814 ip=127.0.0.1
INFO:     127.0.0.1:64014 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:40:27,819 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387627816 query_len=8 lang=en
2025-08-16 19:40:27,819 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Processing query: 'holissss...' in english (code: en)
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Raw query repr: 'holissss'
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:40:27,821 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Router OUT → english_query='holissss'
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Router OUT → processed_query='holissss'
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Timing: routing=0.2ms
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Net debug → original_query len=8, utf8_bytes=8
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Net debug → english_query len=8, utf8_bytes=8
2025-08-16 19:40:27,821 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:40:27,824 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:40:27,833 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:40:27,833 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:40:27,836 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:40:27,843 - src.models.climate_pipeline - INFO - Timing: cache=22.1ms
2025-08-16 19:40:27,843 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:40:27,844 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:40:27,844 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:40:27,844 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='holissss'
2025-08-16 19:40:27,845 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='holissss', norm='holissss'
2025-08-16 19:40:28,406 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=560 status=OK request_id=7ad58b44-bbad-407e-95ab-733bf5695245
2025-08-16 19:40:28,407 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a greeting in English.","language":"en","expected_language":"en","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:40:28,407 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:40:28,407 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='holissss...' expected_lang=en detected_lang=en classification=greeting language_match=True reason='User query is a greeting in English....'
2025-08-16 19:40:28,408 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='greeting', language_match='yes', canned=True
2025-08-16 19:40:28,408 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:40:28,408 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:40:28,409 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387627816 time=0.590s model=nova faithfulness=1.000
2025-08-16 19:40:28,409 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.593s id=req_1755387627816 ip=127.0.0.1
INFO:     127.0.0.1:64014 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:40:40,486 - src.webui.api.routers.languages - INFO - Language validation: query_len=3 detected=en model=nova confidence=0.500
2025-08-16 19:40:40,487 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.003s id=req_1755387640484 ip=127.0.0.1
INFO:     127.0.0.1:64130 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:40:40,518 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387640511 query_len=3 lang=en
2025-08-16 19:40:40,520 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:40:40,521 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-16 19:40:40,521 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Processing query: 'hoa...' in english (code: en)
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Raw query repr: 'hoa'
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:40:40,526 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Router OUT → english_query='hoa'
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hoa'
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Net debug → original_query len=3, utf8_bytes=3
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Net debug → english_query len=3, utf8_bytes=3
2025-08-16 19:40:40,526 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:40:40,527 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:40:40,530 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:40:40,530 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:40:40,532 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:40:40,539 - src.models.climate_pipeline - INFO - Timing: cache=12.4ms
2025-08-16 19:40:40,539 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:40:40,539 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-16 19:40:40,539 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:40:40,539 - src.models.conversation_parser - INFO -   Message 1 (user): holissss...
2025-08-16 19:40:40,539 - src.models.conversation_parser - INFO -   Message 2 (assistant): Hello, I am your multilingual climate chatbot. I can answer climate questions in any language. What ...
2025-08-16 19:40:40,539 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=2
2025-08-16 19:40:40,539 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hoa'
2025-08-16 19:40:40,541 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='hoa', norm='hoa'
2025-08-16 19:40:41,118 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=575 status=OK request_id=40f87533-557e-4248-be84-6c04cff5fc26
2025-08-16 19:40:41,119 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a short, generic greeting in English.","language":"en","expected_language":"en","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:40:41,119 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:40:41,120 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hoa...' expected_lang=en detected_lang=en classification=greeting language_match=True reason='User query is a short, generic greeting in English....'
2025-08-16 19:40:41,120 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='greeting', language_match='yes', canned=True
2025-08-16 19:40:41,120 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:40:41,120 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:40:41,121 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387640511 time=0.603s model=nova faithfulness=1.000
2025-08-16 19:40:41,121 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.610s id=req_1755387640511 ip=127.0.0.1
INFO:     127.0.0.1:64130 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:40:47,777 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387647769 query_len=4 lang=es
2025-08-16 19:40:47,780 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 19:40:47,780 - src.webui.api.routers.chat - INFO - Parsed conversation history: 4 messages
2025-08-16 19:40:47,780 - src.webui.api.routers.chat - INFO - Language routing: detected=es model=nova
2025-08-16 19:40:47,781 - src.models.climate_pipeline - INFO - Processing query: 'hola...' in spanish (code: es)
2025-08-16 19:40:47,781 - src.models.climate_pipeline - INFO - Raw query repr: 'hola'
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - Router IN → language_name=spanish, language_code=es
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:40:47,782 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=True
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - Router OUT → english_query='hola'
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - Router OUT → processed_query='hola'
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 19:40:47,782 - src.models.climate_pipeline - INFO - Routing requires translation → provider=Nova
2025-08-16 19:40:47,782 - src.models.query_routing - INFO - Language: spanish (es) → Model: Nova
2025-08-16 19:40:47,782 - src.models.query_routing - INFO - Translating query from spanish to English
2025-08-16 19:40:47,782 - src.models.query_routing - INFO - Router NET IN → query repr='hola'
2025-08-16 19:40:48,245 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=463 status=OK request_id=fba30e9d-67dd-4009-8d92-f797f2019137
2025-08-16 19:40:48,246 - src.models.query_routing - INFO - Translation successful
2025-08-16 19:40:48,246 - src.models.query_routing - INFO - Router NET OUT → english_query repr='Hello\n\n---\n\nNote: The provided text "hola" is a simple greeting and does not contain any climate-specific terminology. Therefore, it remains unchanged in the translation. If you have a more complex te'
2025-08-16 19:40:48,247 - src.models.climate_pipeline - INFO - Router RERUN OUT → english_query='Hello

---

Note: The provided text "hola" is a simple greeting and does not contain any climate-specific terminology. Therefore, it remains unchanged in the translation. If you have a more complex te'
2025-08-16 19:40:48,247 - src.models.climate_pipeline - INFO - Router RERUN OUT → processed_query='Hello

---

Note: The provided text "hola" is a simple greeting and does not contain any climate-specific terminology. Therefore, it remains unchanged in the translation. If you have a more complex te'
2025-08-16 19:40:48,247 - src.models.climate_pipeline - INFO - Net debug → original_query len=4, utf8_bytes=4
2025-08-16 19:40:48,247 - src.models.climate_pipeline - INFO - Net debug → english_query len=294, utf8_bytes=294
2025-08-16 19:40:48,247 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:40:48,247 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:40:48,254 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:40:48,254 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:40:48,255 - src.models.climate_pipeline - INFO - Cache miss for spanish query
2025-08-16 19:40:48,256 - src.models.climate_pipeline - INFO - Timing: cache=9.7ms
2025-08-16 19:40:48,256 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:40:48,257 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-16 19:40:48,257 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-16 19:40:48,257 - src.models.conversation_parser - INFO -   Message 1 (user): holissss...
2025-08-16 19:40:48,257 - src.models.conversation_parser - INFO -   Message 2 (assistant): Hello, I am your multilingual climate chatbot. I can answer climate questions in any language. What ...
2025-08-16 19:40:48,257 - src.models.conversation_parser - INFO -   Message 3 (user): hoa...
2025-08-16 19:40:48,257 - src.models.conversation_parser - INFO -   Message 4 (assistant): Hello, I am your multilingual climate chatbot. I can answer climate questions in any language. What ...
2025-08-16 19:40:48,257 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=es, history_len=4
2025-08-16 19:40:48,257 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='hola'
2025-08-16 19:40:48,257 - query_rewriter - INFO - Rewriter NET IN → expected_lang=es, user_query repr='hola', norm='hola'
2025-08-16 19:40:48,738 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=481 status=OK request_id=6b1ade27-5411-4721-90eb-4c982b0f1b43
2025-08-16 19:40:48,739 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is a greeting in Spanish.","language":"es","expected_language":"es","language_match":true,"classification":"greeting","rewrite_en":null,"ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-16 19:40:48,739 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:40:48,739 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='hola...' expected_lang=es detected_lang=es classification=greeting language_match=True reason='User query is a greeting in Spanish....'
2025-08-16 19:40:48,739 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='es', classification='greeting', language_match='yes', canned=True
2025-08-16 19:40:48,739 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:40:48,739 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:40:49,037 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=297 status=OK request_id=e2203578-f319-4a36-b53c-fca36087edf2
2025-08-16 19:40:49,038 - src.models.climate_pipeline - INFO - ✓ Canned response translated to selected language
2025-08-16 19:40:49,039 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387647769 time=1.262s model=nova faithfulness=1.000
2025-08-16 19:40:49,040 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=1.271s id=req_1755387647769 ip=127.0.0.1
INFO:     127.0.0.1:64204 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:44:20,175 - src.webui.api.routers.languages - INFO - Language validation: query_len=51 detected=en model=nova confidence=0.800
2025-08-16 19:44:20,177 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.015s id=req_1755387860162 ip=127.0.0.1
INFO:     127.0.0.1:50085 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:44:20,182 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387860180 query_len=51 lang=en
2025-08-16 19:44:20,182 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:44:20,187 - src.models.climate_pipeline - INFO - Processing query: 'Theres flooding emergency in rexdale what can I do?...' in english (code: en)
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Raw query repr: 'Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:44:20,188 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Router OUT → english_query='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Net debug → original_query len=51, utf8_bytes=51
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Net debug → english_query len=51, utf8_bytes=51
2025-08-16 19:44:20,188 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:44:20,189 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:44:20,205 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:44:20,205 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:44:20,206 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:44:20,207 - src.models.climate_pipeline - INFO - Timing: cache=18.5ms
2025-08-16 19:44:20,207 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:44:20,207 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:44:20,207 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:44:20,207 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:20,207 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Theres flooding emergency in rexdale what can I do?', norm='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:20,940 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=731 status=OK request_id=ad7825ec-69c0-47bb-88f0-393e72d2350a
2025-08-16 19:44:20,940 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about a flooding emergency and asks for help, which is on-topic for climate-related queries.","language":"en","expected_language":"en","language_match":true,"classification":"emergency","rewrite_en":"There's a flooding emergency in Rexdale, what can I do?","ask_how_to_use":f
2025-08-16 19:44:20,940 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:44:20,940 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Theres flooding emergency in rexdale what can I do...' expected_lang=en detected_lang=en classification=emergency language_match=True reason='User query is about a flooding emergency and asks for help, which is on-topic for climate-related qu...'
2025-08-16 19:44:20,940 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='emergency', language_match='yes', canned=True
2025-08-16 19:44:20,940 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:44:20,941 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:44:20,941 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387860180 time=0.759s model=nova faithfulness=1.000
2025-08-16 19:44:20,941 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.761s id=req_1755387860180 ip=127.0.0.1
INFO:     127.0.0.1:50085 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-16 19:44:40,538 - src.webui.api.routers.languages - INFO - Language validation: query_len=51 detected=en model=nova confidence=0.800
2025-08-16 19:44:40,539 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.003s id=req_1755387880535 ip=127.0.0.1
INFO:     127.0.0.1:50288 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-16 19:44:40,577 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755387880575 query_len=51 lang=en
2025-08-16 19:44:40,577 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Processing query: 'Theres flooding emergency in rexdale what can I do?...' in english (code: en)
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Raw query repr: 'Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-16 19:44:40,578 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Router OUT → english_query='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-16 19:44:40,578 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-16 19:44:40,579 - src.models.climate_pipeline - INFO - Net debug → original_query len=51, utf8_bytes=51
2025-08-16 19:44:40,579 - src.models.climate_pipeline - INFO - Net debug → english_query len=51, utf8_bytes=51
2025-08-16 19:44:40,579 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-16 19:44:40,579 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:44:40,582 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:44:40,582 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:44:40,582 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-16 19:44:40,592 - src.models.climate_pipeline - INFO - Timing: cache=13.2ms
2025-08-16 19:44:40,592 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-16 19:44:40,592 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-16 19:44:40,592 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-16 19:44:40,592 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:40,592 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Theres flooding emergency in rexdale what can I do?', norm='Theres flooding emergency in rexdale what can I do?'
2025-08-16 19:44:41,266 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=673 status=OK request_id=6bce15a1-3526-4e53-a0e6-a29bf5be49ff
2025-08-16 19:44:41,266 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about a flooding emergency and asks for help, which is on-topic for climate-related queries.","language":"en","expected_language":"en","language_match":true,"classification":"emergency","rewrite_en":"There's a flooding emergency in Rexdale, what can I do?","ask_how_to_use":f
2025-08-16 19:44:41,266 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-16 19:44:41,266 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Theres flooding emergency in rexdale what can I do...' expected_lang=en detected_lang=en classification=emergency language_match=True reason='User query is about a flooding emergency and asks for help, which is on-topic for climate-related qu...'
2025-08-16 19:44:41,266 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='emergency', language_match='yes', canned=True
2025-08-16 19:44:41,266 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-16 19:44:41,266 - src.models.climate_pipeline - INFO - ✓ Canned intent detected by query rewriter (JSON); preparing canned response
2025-08-16 19:44:41,267 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755387880575 time=0.690s model=nova faithfulness=1.000
2025-08-16 19:44:41,267 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=0.692s id=req_1755387880575 ip=127.0.0.1
INFO:     127.0.0.1:50288 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-16 19:45:09,532 - src.webui.api.main - INFO - 🧹 Cleaning up pipeline...
2025-08-16 19:45:09,533 - src.models.climate_pipeline - INFO - ✓ Nova model client closed
2025-08-16 19:45:09,534 - src.models.climate_pipeline - INFO - ✓ Cohere client closed
2025-08-16 19:45:09,535 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-16 19:45:09,546 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-16 19:45:09,546 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-16 19:45:09,548 - src.models.redis_cache - INFO - Redis connection closed
2025-08-16 19:45:09,548 - src.models.climate_pipeline - INFO - ✓ Redis client closed
2025-08-16 19:45:09,548 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-16 19:45:09,548 - src.webui.api.main - INFO - ✅ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [60108]
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/multiprocessing/resource_tracker.py:254: UserWarning: resource_tracker: There appear to be 1 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
