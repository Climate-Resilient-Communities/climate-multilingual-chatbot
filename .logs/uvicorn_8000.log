2025-08-17 13:54:01,340 - datasets - INFO - PyTorch version 2.6.0 available.
INFO:     Started server process [29492]
INFO:     Waiting for application startup.
2025-08-17 13:54:02,536 - src.webui.api.main - INFO - 🚀 Starting Climate Chatbot API...
2025-08-17 13:54:02,536 - src.webui.api.main - INFO - Initializing pipeline components...
2025-08-17 13:54:02,589 - src.models.nova_flow - INFO - ✓ Bedrock client initialized
2025-08-17 13:54:02,612 - src.models.cohere_flow - INFO - ✓ Cohere client initialized
2025-08-17 13:54:02,613 - src.models.gen_response_unified - INFO - ✓ Unified Response Generator initialized
2025-08-17 13:54:02,613 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:54:02,614 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:54:02,614 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:54:02,665 - src.models.nova_flow - INFO - ✓ Bedrock client initialized
2025-08-17 13:54:02,683 - src.models.cohere_flow - INFO - ✓ Cohere client initialized
Fetching 30 files:   0%|          | 0/30 [00:00<?, ?it/s]Fetching 30 files: 100%|██████████| 30/30 [00:00<00:00, 12290.40it/s]
2025-08-17 13:54:03,832 - FlagEmbedding.finetune.embedder.encoder_only.m3.runner - INFO - loading existing colbert_linear and sparse_linear---------
2025-08-17 13:54:03,835 - src.models.climate_pipeline - INFO - ✓ Embedding model initialized with fast tokenizer
2025-08-17 13:54:03,835 - src.models.climate_pipeline - INFO - Init: embeddings model ready in 1.15s
2025-08-17 13:54:03,836 - pinecone_plugin_interface.logging - INFO - Discovering subpackages in _NamespacePath(['/Users/luis_ticas/Documents/GitHub/climate-multilingual-chatbot/.venv/lib/python3.12/site-packages/pinecone_plugins'])
2025-08-17 13:54:03,836 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.assistant
2025-08-17 13:54:03,863 - pinecone_plugin_interface.logging - INFO - Looking for plugins in pinecone_plugins.inference
2025-08-17 13:54:03,871 - pinecone_plugin_interface.logging - INFO - Installing plugin assistant into Pinecone
2025-08-17 13:54:03,871 - pinecone_plugin_interface.logging - INFO - Installing plugin inference into Pinecone
2025-08-17 13:54:03,871 - src.models.climate_pipeline - INFO - Pinecone: initialized using v5 client
2025-08-17 13:54:04,180 - src.models.climate_pipeline - INFO - Init: pinecone index ready in 0.35s
2025-08-17 13:54:04,204 - src.models.climate_pipeline - INFO - Init: cohere client ready in 0.02s
2025-08-17 13:54:04,204 - src.models.climate_pipeline - INFO - ✓ Climate Query Pipeline initialized (eager heavy-init)
2025-08-17 13:54:04,204 - src.webui.api.main - INFO - ✅ Climate pipeline initialized (prewarming in background)
2025-08-17 13:54:04,204 - src.webui.api.main - INFO - ✅ Conversation parser initialized
2025-08-17 13:54:04,204 - src.webui.api.main - INFO - ✅ Language router initialized
2025-08-17 13:54:04,204 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:54:04,206 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:54:04,206 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:54:04,206 - src.webui.api.main - INFO - ✅ Redis cache initialized
2025-08-17 13:54:04,206 - src.webui.api.main - INFO - 🎉 All components initialized successfully!
2025-08-17 13:54:04,206 - src.webui.api.main - INFO - 🔥 Starting background pipeline prewarming...
2025-08-17 13:54:04,206 - src.models.climate_pipeline - INFO - Prewarm: starting heavy component initialization
2025-08-17 13:54:04,206 - src.models.climate_pipeline - INFO - Prewarm: embeddings ready in 0.00s
2025-08-17 13:54:04,206 - src.models.climate_pipeline - INFO - Prewarming embed model...
You're using a XLMRobertaTokenizerFast tokenizer. Please note that with a fast tokenizer, using the `__call__` method is faster than using a method to encode the text followed by a call to the `pad` method to get a padded encoding.
2025-08-17 13:54:07,027 - src.models.climate_pipeline - INFO - Prewarm encode took 2821ms
2025-08-17 13:54:07,081 - src.models.climate_pipeline - INFO - Second prewarm took 54ms
2025-08-17 13:54:07,081 - src.models.climate_pipeline - INFO - Prewarm: pinecone ready in 0.00s
2025-08-17 13:54:07,081 - src.models.climate_pipeline - INFO - Prewarm: cohere client ready in 0.00s
2025-08-17 13:54:07,081 - src.models.climate_pipeline - INFO - Prewarm complete in 2.88s
2025-08-17 13:54:07,081 - src.webui.api.main - INFO - ✅ Background prewarming completed
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-08-17 13:54:09,100 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.001s id=req_1755453249099 ip=127.0.0.1
INFO:     127.0.0.1:52825 - "GET /health HTTP/1.1" 200 OK
2025-08-17 13:55:40,504 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.001s id=req_1755453340503 ip=127.0.0.1
INFO:     127.0.0.1:52885 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 13:55:40,512 - src.webui.api.routers.languages - INFO - Language validation: query_len=36 detected=en model=nova confidence=0.800
2025-08-17 13:55:40,512 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.005s id=req_1755453340507 ip=127.0.0.1
INFO:     127.0.0.1:52885 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 13:55:40,532 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.000s id=req_1755453340531 ip=127.0.0.1
INFO:     127.0.0.1:52885 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 13:55:40,539 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755453340535 query_len=36 lang=en
2025-08-17 13:55:40,539 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - ✓ Language map loaded from languages.json: 187 names → 183 codes (e.g., belarusian→be)
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 13:55:40,741 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Router OUT → english_query='Why is summer so hot now in Toronto?'
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Why is summer so hot now in Toronto?'
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Net debug → original_query len=36, utf8_bytes=36
2025-08-17 13:55:40,741 - src.models.climate_pipeline - INFO - Net debug → english_query len=36, utf8_bytes=36
2025-08-17 13:55:40,742 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 13:55:40,742 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:55:40,743 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:55:40,743 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:55:40,744 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 13:55:40,746 - src.models.climate_pipeline - INFO - Timing: cache=4.5ms
2025-08-17 13:55:40,746 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 13:55:40,746 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-17 13:55:40,746 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-17 13:55:40,746 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Why is summer so hot now in Toronto?'
2025-08-17 13:55:40,746 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Why is summer so hot now in Toronto?', norm='Why is summer so hot now in Toronto?'
2025-08-17 13:55:41,741 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=994 status=OK request_id=8bf1ed4a-22c3-4fb8-8b6e-66e17f9b1efc
2025-08-17 13:55:41,742 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about climate impacts in a specific location.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Why is summer so hot now in Toronto?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-17 13:55:41,742 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 13:55:41,742 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='Why is summer so hot now in Toronto?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about climate impacts in a specific location....'
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Why is summer so hot now in Toronto?'
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - Timing: rewrite=996.5ms
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - Timing: guards=0.0ms
2025-08-17 13:55:41,743 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 13:55:41,743 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 13:55:41,743 - src.models.retrieval - INFO - Query embedding IN: query_len=36 chars, query_repr='Why is summer so hot now in Toronto?...'
2025-08-17 13:55:42,309 - src.models.retrieval - INFO - dep=query_embed op=encode ms=566 dense_dim=1024 sparse_tokens=9
2025-08-17 13:55:42,636 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=326 status=OK
2025-08-17 13:55:42,637 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=327 total_ms=327
2025-08-17 13:55:42,833 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=195 status=OK
2025-08-17 13:55:42,833 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 13:55:42,833 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=196 total_ms=196
2025-08-17 13:55:42,840 - src.models.retrieval - INFO - dep=mmr_embed used_index=6 used_cache=0 embedded=0 ms=0 n_docs=6 valid_vecs=6 q_embed_ms=0
2025-08-17 13:55:42,841 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=7335 n_docs=6
2025-08-17 13:55:43,146 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 13:55:43,150 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=308.9 status=OK
2025-08-17 13:55:43,154 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Guide And Workbook For Municipal Climate Adaptation', 'pinecone_score': 0.345578611, 'rerank_score': 0.9335521, 'has_values': True}, {'title': 'Toronto First Resilience Strategy', 'pinecone_score': 0.34152326, 'rerank_score': 0.85776806, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.297280401, 'rerank_score': 0.6614857, 'has_values': True}, {'title': 'The Climate Atlas And Health – Using Climate Maps To Understand The Future Of He', 'pinecone_score': 0.296605885, 'rerank_score': 0.22815649, 'has_values': True}, {'title': 'Heatwaves And Our Health – A Special Report On Climate Change In Canada', 'pinecone_score': 0.299585462, 'rerank_score': 0.1989965, 'has_values': True}]
2025-08-17 13:55:43,154 - src.models.retrieval - INFO - q='Why is summer so hot now in Toronto?', base=6, kept_pre=6, refill=0, final_before=3, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.346, p50_sim_pre=0.300, p95_sim_pre=0.346, blocked_base=0, dropped_top2=[{'segment_id': '33', 'title': 'The Climate Atlas And Health – Using Climate Maps To Understand The Future Of He', 'score': 0.22815649}, {'segment_id': '24', 'title': 'Heatwaves And Our Health – A Special Report On Climate Change In Canada', 'score': 0.1989965}]
2025-08-17 13:55:43,155 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-17 13:55:43,155 - src.models.climate_pipeline - INFO - Timing: retrieval=1411.8ms
2025-08-17 13:55:43,155 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 13:55:43,155 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 13:55:43,155 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:55:43,157 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:55:43,157 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:55:43,158 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 13:55:43,158 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 13:55:47,474 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4315 status=OK request_id=a004e721-f01e-4e28-a2dc-78e20912c281
2025-08-17 13:55:47,477 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 13:55:47,477 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 13:55:47,477 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-17 13:55:47,477 - src.models.climate_pipeline - INFO - Timing: generation=4322.4ms
2025-08-17 13:55:47,477 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 13:55:49,314 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1835 status=OK request_id=a00bcec0-d462-4789-b936-19c33c0e397e
2025-08-17 13:55:49,316 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-17 13:55:49,317 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-17 13:55:49,317 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-17 13:55:49,317 - src.models.climate_pipeline - INFO - Timing: faithfulness=1839.7ms
2025-08-17 13:55:49,317 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:55:49,320 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:55:49,320 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:55:49,321 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-17 13:55:49,325 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=996.5 guards=0.0 retrieval=1411.8 generation=4322.4 faithfulness=1839.7 translation=0.0 total=8576.2
2025-08-17 13:55:49,325 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 8.58s
2025-08-17 13:55:49,326 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755453340535 time=8.787s model=nova faithfulness=0.950
2025-08-17 13:55:49,327 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=8.791s id=req_1755453340535 ip=127.0.0.1
INFO:     127.0.0.1:52885 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 13:56:04,451 - src.webui.api.routers.languages - INFO - Language validation: query_len=13 detected=en model=nova confidence=0.500
2025-08-17 13:56:04,452 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.002s id=req_1755453364450 ip=127.0.0.1
INFO:     127.0.0.1:52906 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 13:56:04,517 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755453364511 query_len=13 lang=en
2025-08-17 13:56:04,518 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 13:56:04,518 - src.webui.api.routers.chat - INFO - Parsed conversation history: 2 messages
2025-08-17 13:56:04,518 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Processing query: 'are you sure?...' in english (code: en)
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Raw query repr: 'are you sure?'
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 13:56:04,518 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Router OUT → english_query='are you sure?'
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Router OUT → processed_query='are you sure?'
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Net debug → original_query len=13, utf8_bytes=13
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Net debug → english_query len=13, utf8_bytes=13
2025-08-17 13:56:04,518 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 13:56:04,518 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:56:04,520 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:56:04,520 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:56:04,520 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 13:56:04,521 - src.models.climate_pipeline - INFO - Timing: cache=2.5ms
2025-08-17 13:56:04,521 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 13:56:04,521 - src.models.conversation_parser - INFO - Parsed 2 messages from conversation history
2025-08-17 13:56:04,521 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 13:56:04,521 - src.models.conversation_parser - INFO -   Message 1 (user): Why is summer so hot now in Toronto?...
2025-08-17 13:56:04,521 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Why is Summer So Hot Now in Toronto?

## Understanding the Heat

Toronto is experiencing hotter su...
2025-08-17 13:56:04,521 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=2
2025-08-17 13:56:04,521 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='are you sure?'
2025-08-17 13:56:04,521 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='are you sure?', norm='are you sure?'
2025-08-17 13:56:05,187 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=665 status=OK request_id=200e5336-1814-4f0b-a684-16a60255421a
2025-08-17 13:56:05,189 - query_rewriter - INFO - Model raw (first 300): {"reason":"Based on the conversation history, the user is discussing climate-related topics.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Are you sure about the effects of climate change?","ask_how_to_use":false,"how_it_works":null,"error"
2025-08-17 13:56:05,189 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 13:56:05,189 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='are you sure?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='Based on the conversation history, the user is discussing climate-related topics....'
2025-08-17 13:56:05,189 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 13:56:05,189 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Are you sure about the effects of climate change?'
2025-08-17 13:56:05,190 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-17 13:56:05,190 - src.models.climate_pipeline - INFO - Timing: rewrite=668.9ms
2025-08-17 13:56:05,190 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 13:56:05,190 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-17 13:56:05,190 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-17 13:56:05,190 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 13:56:05,190 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 13:56:05,190 - src.models.retrieval - INFO - Query embedding IN: query_len=49 chars, query_repr='Are you sure about the effects of climate change?...'
2025-08-17 13:56:05,327 - src.models.retrieval - INFO - dep=query_embed op=encode ms=137 dense_dim=1024 sparse_tokens=10
2025-08-17 13:56:05,361 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=33 status=OK
2025-08-17 13:56:05,361 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=33 total_ms=33
2025-08-17 13:56:05,438 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=77 status=OK
2025-08-17 13:56:05,438 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 13:56:05,438 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=77 total_ms=77
2025-08-17 13:56:05,440 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-17 13:56:05,440 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=7413 n_docs=7
2025-08-17 13:56:05,567 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 13:56:05,571 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=130.7 status=OK
2025-08-17 13:56:05,572 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Canada In A Changing Climate National Issues Report', 'pinecone_score': 0.244251937, 'rerank_score': 0.39210403, 'has_values': True}, {'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'pinecone_score': 0.251125574, 'rerank_score': 0.28646857, 'has_values': True}, {'title': 'Connecting Climate Change And Health – A Guidebook Of Health And Climate Change ', 'pinecone_score': 0.241775304, 'rerank_score': 0.19790912, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.241810799, 'rerank_score': 0.1526628, 'has_values': True}, {'title': '1 S2.0 S2667278223000172 Main', 'pinecone_score': 0.264424205, 'rerank_score': 0.11357959, 'has_values': True}]
2025-08-17 13:56:05,572 - src.models.retrieval - INFO - q='Are you sure about the effects of climate change?', base=7, kept_pre=7, refill=0, final_before=0, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.274, p50_sim_pre=0.245, p95_sim_pre=0.274, blocked_base=0, dropped_top2=[{'segment_id': '15', 'title': 'Canada In A Changing Climate National Issues Report', 'score': 0.39210403}, {'segment_id': '17', 'title': 'Human Health In A Changing Climate A Canadian Assessment Of Vulnerabilities And ', 'score': 0.28646857}]
2025-08-17 13:56:05,572 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-17 13:56:05,572 - src.models.climate_pipeline - INFO - Timing: retrieval=382.3ms
2025-08-17 13:56:05,572 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 13:56:05,573 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 13:56:05,573 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:56:05,574 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:56:05,574 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:56:05,575 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 13:56:05,575 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 13:56:10,411 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=4835 status=OK request_id=d690b7a0-c199-4652-b439-80256e3ba9dd
2025-08-17 13:56:10,412 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 13:56:10,412 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 13:56:10,412 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-17 13:56:10,412 - src.models.climate_pipeline - INFO - Timing: generation=4839.9ms
2025-08-17 13:56:10,412 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 13:56:13,072 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2658 status=OK request_id=c1bd547b-b14d-4936-a92f-951661ef3d61
2025-08-17 13:56:13,072 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-17 13:56:13,073 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-17 13:56:13,073 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-17 13:56:13,073 - src.models.climate_pipeline - INFO - Timing: faithfulness=2660.4ms
2025-08-17 13:56:13,073 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:56:13,075 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:56:13,075 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:56:13,076 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-17 13:56:13,077 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=668.9 guards=0.1 retrieval=382.3 generation=4839.9 faithfulness=2660.4 translation=0.0 total=8555.0
2025-08-17 13:56:13,077 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 8.55s
2025-08-17 13:56:13,077 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 13:56:13,849 - src.webui.api.utils.link_validator - INFO - Replaced broken link with root domain: https://www.toronto.ca/home/covid-19/covid-19-latest-city-of-toronto-news/heat-alerts-and-response/ -> https://www.toronto.ca
2025-08-17 13:56:13,849 - src.webui.api.utils.link_validator - INFO - Fixed 1 inline links: 0 Google Drive, 1 broken
2025-08-17 13:56:13,849 - src.webui.api.routers.chat - INFO - Fixed 1 broken inline links in response
2025-08-17 13:56:13,849 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755453364511 time=8.560s model=nova faithfulness=0.950
2025-08-17 13:56:13,850 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=9.339s id=req_1755453364511 ip=127.0.0.1
INFO:     127.0.0.1:52906 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 13:58:38,382 - src.webui.api.routers.languages - INFO - Language validation: query_len=28 detected=en model=nova confidence=0.500
2025-08-17 13:58:38,383 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.004s id=req_1755453518379 ip=127.0.0.1
INFO:     127.0.0.1:52994 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 13:58:38,455 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755453518451 query_len=28 lang=en
2025-08-17 13:58:38,456 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-17 13:58:38,456 - src.webui.api.routers.chat - INFO - Parsed conversation history: 4 messages
2025-08-17 13:58:38,456 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Processing query: 'is climate change even real?...' in english (code: en)
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Raw query repr: 'is climate change even real?'
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 13:58:38,457 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Router OUT → english_query='is climate change even real?'
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Router OUT → processed_query='is climate change even real?'
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Timing: routing=0.1ms
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Net debug → original_query len=28, utf8_bytes=28
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Net debug → english_query len=28, utf8_bytes=28
2025-08-17 13:58:38,457 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 13:58:38,457 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:58:38,459 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:58:38,459 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:58:38,460 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 13:58:38,460 - src.models.climate_pipeline - INFO - Timing: cache=2.8ms
2025-08-17 13:58:38,460 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 13:58:38,460 - src.models.conversation_parser - INFO - Parsed 4 messages from conversation history
2025-08-17 13:58:38,460 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 13:58:38,460 - src.models.conversation_parser - INFO -   Message 1 (user): Why is summer so hot now in Toronto?...
2025-08-17 13:58:38,460 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Why is Summer So Hot Now in Toronto?

## Understanding the Heat

Toronto is experiencing hotter su...
2025-08-17 13:58:38,460 - src.models.conversation_parser - INFO -   Message 3 (user): are you sure?...
2025-08-17 13:58:38,460 - src.models.conversation_parser - INFO -   Message 4 (assistant): # Are You Sure About the Effects of Climate Change?

## The Science is Clear

The evidence for clima...
2025-08-17 13:58:38,460 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=4
2025-08-17 13:58:38,460 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='is climate change even real?'
2025-08-17 13:58:38,460 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='is climate change even real?', norm='is climate change even real?'
2025-08-17 13:58:39,196 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=733 status=OK request_id=2764f90f-7d0f-4d79-93df-3922029c598b
2025-08-17 13:58:39,196 - query_rewriter - INFO - Model raw (first 300): {"reason":"The query contains climate-related terms and is a follow-up to the previous conversation about climate change.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Is climate change real?","ask_how_to_use":false,"how_it_works":null,"err
2025-08-17 13:58:39,197 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 13:58:39,197 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='is climate change even real?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='The query contains climate-related terms and is a follow-up to the previous conversation about clima...'
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Is climate change real?'
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - Timing: rewrite=736.9ms
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-17 13:58:39,197 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 13:58:39,197 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 13:58:39,197 - src.models.retrieval - INFO - Query embedding IN: query_len=23 chars, query_repr='Is climate change real?...'
2025-08-17 13:58:39,774 - src.models.retrieval - INFO - dep=query_embed op=encode ms=577 dense_dim=1024 sparse_tokens=5
2025-08-17 13:58:40,088 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=312 status=OK
2025-08-17 13:58:40,088 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=312 total_ms=312
2025-08-17 13:58:40,254 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=165 status=OK
2025-08-17 13:58:40,254 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 13:58:40,254 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=166 total_ms=166
2025-08-17 13:58:40,257 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-17 13:58:40,257 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=9227 n_docs=7
2025-08-17 13:58:40,397 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 13:58:40,403 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=145.5 status=OK
2025-08-17 13:58:40,404 - src.models.retrieval - INFO - Retained docs preview: [{'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.248932242, 'rerank_score': 0.8784186, 'has_values': True}, {'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.249658227, 'rerank_score': 0.8709269, 'has_values': True}, {'title': 'Health Of Canadians In Changing Climate Report', 'pinecone_score': 0.24813877, 'rerank_score': 0.77321637, 'has_values': True}, {'title': 'Transformto Net Zero Framework Technical Report Parts 1 2', 'pinecone_score': 0.239534318, 'rerank_score': 0.70659554, 'has_values': True}, {'title': 'Canada In A Changing Climate National Issues Report', 'pinecone_score': 0.240755513, 'rerank_score': 0.1859472, 'has_values': True}]
2025-08-17 13:58:40,404 - src.models.retrieval - INFO - q='Is climate change real?', base=7, kept_pre=7, refill=0, final_before=4, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.261, p50_sim_pre=0.248, p95_sim_pre=0.261, blocked_base=1, dropped_top2=[{'segment_id': '15', 'title': 'Canada In A Changing Climate National Issues Report', 'score': 0.1859472}, {'segment_id': '[16, 17, 18, 19, 20]', 'title': 'Planning To Be A Part Of My Region! Grade 9 Lesson Plans Designed For Students I', 'score': 0.075858176}]
2025-08-17 13:58:40,405 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-17 13:58:40,405 - src.models.climate_pipeline - INFO - Timing: retrieval=1207.5ms
2025-08-17 13:58:40,405 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 13:58:40,405 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 13:58:40,405 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:58:40,408 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:58:40,408 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:58:40,409 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 13:58:40,409 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 13:58:40,731 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=322 status=OK request_id=9ad002b6-12e8-487d-870f-8806a3e5b17b
2025-08-17 13:58:40,732 - src.models.gen_response_unified - INFO - Optimized conversation history for nova
2025-08-17 13:58:43,321 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=2588 status=OK request_id=142c3dc7-640c-4439-be2b-908ebae3c742
2025-08-17 13:58:43,342 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 13:58:43,342 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 13:58:43,343 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-17 13:58:43,343 - src.models.climate_pipeline - INFO - Timing: generation=2937.9ms
2025-08-17 13:58:43,343 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 13:58:45,136 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1793 status=OK request_id=05509e40-2ef8-4b17-bcde-cace6c46362d
2025-08-17 13:58:45,137 - src.models.hallucination_guard - INFO - Faithfulness score: 0.95
2025-08-17 13:58:45,137 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.950
2025-08-17 13:58:45,137 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-17 13:58:45,137 - src.models.climate_pipeline - INFO - Timing: faithfulness=1794.0ms
2025-08-17 13:58:45,137 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:58:45,138 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:58:45,138 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:58:45,138 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-17 13:58:45,139 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.1 rewrite=736.9 guards=0.1 retrieval=1207.5 generation=2937.9 faithfulness=1794.0 translation=0.0 total=6680.1
2025-08-17 13:58:45,139 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 6.68s
2025-08-17 13:58:45,139 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 13:58:45,365 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755453518451 time=6.684s model=nova faithfulness=0.950
2025-08-17 13:58:45,365 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=6.914s id=req_1755453518451 ip=127.0.0.1
INFO:     127.0.0.1:52994 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 13:59:49,229 - src.webui.api.routers.languages - INFO - Language validation: query_len=67 detected=en model=nova confidence=0.800
2025-08-17 13:59:49,230 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.003s id=req_1755453589227 ip=127.0.0.1
INFO:     127.0.0.1:53044 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 13:59:49,287 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755453589284 query_len=67 lang=en
2025-08-17 13:59:49,287 - src.models.conversation_parser - INFO - Parsed 6 messages from conversation history
2025-08-17 13:59:49,287 - src.webui.api.routers.chat - INFO - Parsed conversation history: 6 messages
2025-08-17 13:59:49,287 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Processing query: 'i want real number and facts to tell me that climate change is real...' in english (code: en)
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Raw query repr: 'i want real number and facts to tell me that climate change is real'
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 13:59:49,288 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Router OUT → english_query='i want real number and facts to tell me that climate change is real'
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Router OUT → processed_query='i want real number and facts to tell me that climate change is real'
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Timing: routing=0.4ms
2025-08-17 13:59:49,288 - src.models.climate_pipeline - INFO - Net debug → original_query len=67, utf8_bytes=67
2025-08-17 13:59:49,289 - src.models.climate_pipeline - INFO - Net debug → english_query len=67, utf8_bytes=67
2025-08-17 13:59:49,289 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 13:59:49,289 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:59:49,291 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:59:49,291 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:59:49,291 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 13:59:49,291 - src.models.climate_pipeline - INFO - Timing: cache=2.8ms
2025-08-17 13:59:49,291 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 13:59:49,291 - src.models.conversation_parser - INFO - Parsed 6 messages from conversation history
2025-08-17 13:59:49,292 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 13:59:49,292 - src.models.conversation_parser - INFO -   Message 1 (user): Why is summer so hot now in Toronto?...
2025-08-17 13:59:49,292 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Why is Summer So Hot Now in Toronto?

## Understanding the Heat

Toronto is experiencing hotter su...
2025-08-17 13:59:49,292 - src.models.conversation_parser - INFO -   Message 3 (user): are you sure?...
2025-08-17 13:59:49,292 - src.models.conversation_parser - INFO -   Message 4 (assistant): # Are You Sure About the Effects of Climate Change?

## The Science is Clear

The evidence for clima...
2025-08-17 13:59:49,292 - src.models.conversation_parser - INFO -   Message 5 (user): is climate change even real?...
2025-08-17 13:59:49,292 - src.models.conversation_parser - INFO -   Message 6 (assistant): # Are You Sure About the Effects of Climate Change?

## The Science is Clear

The evidence for clima...
2025-08-17 13:59:49,292 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=6
2025-08-17 13:59:49,292 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='i want real number and facts to tell me that climate change is real'
2025-08-17 13:59:49,292 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='i want real number and facts to tell me that climate change is real', norm='i want real number and facts to tell me that climate change is real'
2025-08-17 13:59:50,067 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=775 status=OK request_id=6a3ffa0a-cb42-4df0-afcc-c9cb13badac8
2025-08-17 13:59:50,068 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is asking for factual evidence to support the reality of climate change.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Can you provide real numbers and facts to show that climate change is real?","ask_how_to_use":false
2025-08-17 13:59:50,068 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 13:59:50,069 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='i want real number and facts to tell me that clima...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is asking for factual evidence to support the reality of climate change....'
2025-08-17 13:59:50,069 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 13:59:50,069 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Can you provide real numbers and facts to show that climate change is real?'
2025-08-17 13:59:50,069 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-17 13:59:50,069 - src.models.climate_pipeline - INFO - Timing: rewrite=777.3ms
2025-08-17 13:59:50,069 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 13:59:50,070 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-17 13:59:50,070 - src.models.climate_pipeline - INFO - Timing: guards=0.4ms
2025-08-17 13:59:50,070 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 13:59:50,070 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 13:59:50,070 - src.models.retrieval - INFO - Query embedding IN: query_len=75 chars, query_repr='Can you provide real numbers and facts to show that climate change is real?...'
2025-08-17 13:59:50,700 - src.models.retrieval - INFO - dep=query_embed op=encode ms=629 dense_dim=1024 sparse_tokens=15
2025-08-17 13:59:50,934 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=233 status=OK
2025-08-17 13:59:50,934 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=233 total_ms=233
2025-08-17 13:59:51,085 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=150 status=OK
2025-08-17 13:59:51,085 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 13:59:51,085 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=150 total_ms=150
2025-08-17 13:59:51,087 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-17 13:59:51,088 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=8798 n_docs=7
2025-08-17 13:59:51,211 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 13:59:51,215 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=127.0 status=OK
2025-08-17 13:59:51,215 - src.models.retrieval - INFO - Retained docs preview: [{'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'pinecone_score': 0.26869452, 'rerank_score': 0.030675802, 'has_values': True}, {'title': 'Transformto Net Zero Framework Technical Report Parts 1 2', 'pinecone_score': 0.250996679, 'rerank_score': 0.027480694, 'has_values': True}, {'title': '1 S2.0 S2667278224000233 Main', 'pinecone_score': 0.272301286, 'rerank_score': 0.02199022, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.277800351, 'rerank_score': 0.021368887, 'has_values': True}, {'title': 'Canadian Communities’ Guidebook For Adaptation To Climate Change Including An Ap', 'pinecone_score': 0.249406725, 'rerank_score': 0.0031850608, 'has_values': True}]
2025-08-17 13:59:51,215 - src.models.retrieval - INFO - q='Can you provide real numbers and facts to show that climate ', base=7, kept_pre=7, refill=0, final_before=0, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.278, p50_sim_pre=0.263, p95_sim_pre=0.278, blocked_base=1, dropped_top2=[{'segment_id': '15', 'title': "Report For Action Toronto's Climate Change Readiness Updates Oncommitments And A", 'score': 0.030675802}, {'segment_id': '29', 'title': 'Transformto Net Zero Framework Technical Report Parts 1 2', 'score': 0.027480694}]
2025-08-17 13:59:51,215 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-17 13:59:51,215 - src.models.climate_pipeline - INFO - Timing: retrieval=1145.1ms
2025-08-17 13:59:51,215 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 13:59:51,216 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 13:59:51,216 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:59:51,217 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:59:51,217 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:59:51,217 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 13:59:51,217 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 13:59:51,543 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=325 status=OK request_id=df67ba88-6b12-4e8f-a3e7-504271e7ee11
2025-08-17 13:59:51,543 - src.models.gen_response_unified - INFO - Optimized conversation history for nova
2025-08-17 13:59:55,385 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3841 status=OK request_id=ca5da50f-805a-4106-bfaf-c4038c39629b
2025-08-17 13:59:55,387 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 13:59:55,387 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 13:59:55,387 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-17 13:59:55,388 - src.models.climate_pipeline - INFO - Timing: generation=4172.0ms
2025-08-17 13:59:55,388 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 13:59:57,206 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1818 status=OK request_id=8f34869d-a1e6-4817-b141-35e56e769b46
2025-08-17 13:59:57,207 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 13:59:57,208 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-17 13:59:57,208 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-17 13:59:57,208 - src.models.climate_pipeline - INFO - Timing: faithfulness=1820.3ms
2025-08-17 13:59:57,208 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 13:59:57,210 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 13:59:57,210 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 13:59:57,211 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-17 13:59:57,212 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.4 rewrite=777.3 guards=0.4 retrieval=1145.1 generation=4172.0 faithfulness=1820.3 translation=0.0 total=7920.2
2025-08-17 13:59:57,212 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 7.92s
2025-08-17 13:59:57,213 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 13:59:57,213 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755453589284 time=7.926s model=nova faithfulness=0.900
2025-08-17 13:59:57,213 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=7.929s id=req_1755453589284 ip=127.0.0.1
INFO:     127.0.0.1:53044 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 14:00:19,437 - src.webui.api.routers.languages - INFO - Language validation: query_len=23 detected=en model=nova confidence=0.800
2025-08-17 14:00:19,438 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.003s id=req_1755453619436 ip=127.0.0.1
INFO:     127.0.0.1:53086 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 14:00:19,528 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755453619527 query_len=23 lang=en
2025-08-17 14:00:19,529 - src.models.conversation_parser - INFO - Parsed 8 messages from conversation history
2025-08-17 14:00:19,529 - src.webui.api.routers.chat - INFO - Parsed conversation history: 8 messages
2025-08-17 14:00:19,529 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 14:00:19,529 - src.models.climate_pipeline - INFO - Processing query: 'is the icecaps melting?...' in english (code: en)
2025-08-17 14:00:19,529 - src.models.climate_pipeline - INFO - Raw query repr: 'is the icecaps melting?'
2025-08-17 14:00:19,529 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-17 14:00:19,529 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 14:00:19,529 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - Router OUT → english_query='is the icecaps melting?'
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - Router OUT → processed_query='is the icecaps melting?'
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - Net debug → original_query len=23, utf8_bytes=23
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - Net debug → english_query len=23, utf8_bytes=23
2025-08-17 14:00:19,530 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 14:00:19,530 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 14:00:19,531 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 14:00:19,532 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 14:00:19,532 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 14:00:19,534 - src.models.climate_pipeline - INFO - Timing: cache=4.1ms
2025-08-17 14:00:19,534 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO - Parsed 8 messages from conversation history
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO - Formatted conversation history for query rewriter:
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO -   Message 1 (user): Why is summer so hot now in Toronto?...
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO -   Message 2 (assistant): # Why is Summer So Hot Now in Toronto?

## Understanding the Heat

Toronto is experiencing hotter su...
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO -   Message 3 (user): are you sure?...
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO -   Message 4 (assistant): # Are You Sure About the Effects of Climate Change?

## The Science is Clear

The evidence for clima...
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO -   Message 5 (user): is climate change even real?...
2025-08-17 14:00:19,534 - src.models.conversation_parser - INFO -   Message 6 (assistant): # Are You Sure About the Effects of Climate Change?

## The Science is Clear

The evidence for clima...
2025-08-17 14:00:19,535 - src.models.conversation_parser - INFO -   Message 7 (user): i want real number and facts to tell me that climate change is real...
2025-08-17 14:00:19,535 - src.models.conversation_parser - INFO -   Message 8 (assistant): # Are You Sure About the Effects of Climate Change?

## The Science is Clear

The evidence for clima...
2025-08-17 14:00:19,535 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=8
2025-08-17 14:00:19,535 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='is the icecaps melting?'
2025-08-17 14:00:19,535 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='is the icecaps melting?', norm='is the icecaps melting?'
2025-08-17 14:00:20,270 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=734 status=OK request_id=3b9b89d4-4d5f-49b9-b2af-ff95331a1945
2025-08-17 14:00:20,270 - query_rewriter - INFO - Model raw (first 300): {"reason":"User query is about climate change impacts.","language":"en","expected_language":"en","language_match":true,"classification":"on-topic","rewrite_en":"Are the ice caps melting due to climate change?","ask_how_to_use":false,"how_it_works":null,"error":null}
2025-08-17 14:00:20,270 - query_rewriter - INFO - Rewriter NET OUT → json keys=['ask_how_to_use', 'classification', 'error', 'expected_language', 'how_it_works', 'language', 'language_match', 'reason', 'rewrite_en']
2025-08-17 14:00:20,270 - query_rewriter - INFO - 🔍 CLASSIFICATION_DEBUG: query='is the icecaps melting?...' expected_lang=en detected_lang=en classification=on-topic language_match=True reason='User query is about climate change impacts....'
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='on-topic', language_match='yes', canned=False
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='Are the ice caps melting due to climate change?'
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - ✓ Query rewritten (JSON) for better retrieval
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - Timing: rewrite=736.6ms
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - Step 4: Input Guards
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - ✓ Input guards passed
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - Timing: guards=0.1ms
2025-08-17 14:00:20,271 - src.models.climate_pipeline - INFO - Step 5: Document Retrieval
2025-08-17 14:00:20,271 - src.models.retrieval - INFO - 🔄 Pre-computing query embeddings to avoid redundant encode() calls
2025-08-17 14:00:20,271 - src.models.retrieval - INFO - Query embedding IN: query_len=47 chars, query_repr='Are the ice caps melting due to climate change?...'
2025-08-17 14:00:20,423 - src.models.retrieval - INFO - dep=query_embed op=encode ms=152 dense_dim=1024 sparse_tokens=13
2025-08-17 14:00:20,462 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=38 status=OK
2025-08-17 14:00:20,462 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=38 total_ms=38
2025-08-17 14:00:20,530 - src.models.retrieval - INFO - dep=pinecone host=unknown op=query ms=67 status=OK
2025-08-17 14:00:20,530 - src.models.retrieval - INFO - pinecone.match type=<class 'pinecone.core.openapi.data.model.scored_vector.ScoredVector'> attrs_have_values=True has_values=True
2025-08-17 14:00:20,530 - src.models.retrieval - INFO - dep=hybrid_search embed_ms=0 query_ms=67 total_ms=67
2025-08-17 14:00:20,531 - src.models.retrieval - INFO - dep=mmr_embed used_index=7 used_cache=0 embedded=0 ms=0 n_docs=7 valid_vecs=7 q_embed_ms=0
2025-08-17 14:00:20,532 - src.models.rerank - INFO - dep=cohere_rerank payload_chars=9826 n_docs=7
2025-08-17 14:00:21,806 - httpx - INFO - HTTP Request: POST https://api.cohere.com/v1/rerank "HTTP/1.1 200 OK"
2025-08-17 14:00:21,811 - src.models.rerank - INFO - dep=cohere_rerank host=api.cohere.com op=rerank ms=1279.3 status=OK
2025-08-17 14:00:21,816 - src.models.retrieval - INFO - Retained docs preview: [{'title': "Canada's Changing Climate Report 2019", 'pinecone_score': 0.254950643, 'rerank_score': 0.86647177, 'has_values': True}, {'title': 'Warren 2011 The Role Of Interactions In A World Implementing Adaptation And Miti', 'pinecone_score': 0.24684304, 'rerank_score': 0.82018155, 'has_values': True}, {'title': 'Adapting To Climate Change A Risk Based Guide For Local Governments', 'pinecone_score': 0.251735151, 'rerank_score': 0.6673645, 'has_values': True}, {'title': 'Climate Change Impact & Adaptation Infosheets', 'pinecone_score': 0.274483889, 'rerank_score': 0.56391835, 'has_values': True}, {'title': 'Climate Change 2021 Summary For All', 'pinecone_score': 0.269473493, 'rerank_score': 0.4267396, 'has_values': True}]
2025-08-17 14:00:21,816 - src.models.retrieval - INFO - q='Are the ice caps melting due to climate change?', base=7, kept_pre=7, refill=0, final_before=3, final_after=5, hybrid_refill=0, floor=0.60, delta=0.100, max_sim_pre=0.274, p50_sim_pre=0.255, p95_sim_pre=0.274, blocked_base=0, dropped_top2=[{'segment_id': '[39, 40, 41, 42, 43]', 'title': 'Climate Change Impact & Adaptation Infosheets', 'score': 0.56391835}, {'segment_id': '21', 'title': 'Climate Change 2021 Summary For All', 'score': 0.4267396}]
2025-08-17 14:00:21,817 - src.models.climate_pipeline - INFO - ✓ Retrieved 5 documents
2025-08-17 14:00:21,817 - src.models.climate_pipeline - INFO - Timing: retrieval=1545.7ms
2025-08-17 14:00:21,817 - src.models.climate_pipeline - INFO - Step 6: Response Generation (Nova)
2025-08-17 14:00:21,822 - src.models.gen_response_unified - INFO - Starting nova response generation
2025-08-17 14:00:21,823 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 14:00:21,829 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 14:00:21,829 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 14:00:21,830 - src.models.gen_response_unified - INFO - Successfully processed 5 documents
2025-08-17 14:00:21,830 - src.models.gen_response_unified - INFO - Successfully processed 5 documents for nova
2025-08-17 14:00:22,127 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=296 status=OK request_id=4c2cad6b-b4cb-4a96-b2f8-fe0d84d37735
2025-08-17 14:00:22,127 - src.models.gen_response_unified - INFO - Optimized conversation history for nova
2025-08-17 14:00:26,010 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=3882 status=OK request_id=460bc9bf-6b57-4599-bbbe-bf7c5a515383
2025-08-17 14:00:26,011 - src.models.gen_response_unified - INFO - nova response cached successfully
2025-08-17 14:00:26,011 - src.models.gen_response_unified - INFO - nova response generation complete
2025-08-17 14:00:26,011 - src.models.climate_pipeline - INFO - ✓ Response generated successfully in English
2025-08-17 14:00:26,011 - src.models.climate_pipeline - INFO - Timing: generation=4194.3ms
2025-08-17 14:00:26,011 - src.models.climate_pipeline - INFO - Step 7: Quality Validation
2025-08-17 14:00:27,332 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=1320 status=OK request_id=0a3fb3b2-6151-48c9-82f0-07ef5d5cf715
2025-08-17 14:00:27,333 - src.models.hallucination_guard - INFO - Faithfulness score: 0.9
2025-08-17 14:00:27,334 - src.models.climate_pipeline - INFO - ✓ Faithfulness score: 0.900
2025-08-17 14:00:27,334 - src.models.climate_pipeline - INFO - ✓ Assessment: Highly Faithful
2025-08-17 14:00:27,334 - src.models.climate_pipeline - INFO - Timing: faithfulness=1322.4ms
2025-08-17 14:00:27,334 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 14:00:27,337 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 14:00:27,337 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 14:00:27,338 - src.models.climate_pipeline - INFO - ✓ Response cached in english
2025-08-17 14:00:27,342 - src.models.climate_pipeline - INFO - Timing summary (ms): routing=0.3 rewrite=736.6 guards=0.1 retrieval=1545.7 generation=4194.3 faithfulness=1322.4 translation=0.0 total=7804.7
2025-08-17 14:00:27,343 - src.models.climate_pipeline - INFO - ✓ Query processed successfully in 7.80s
2025-08-17 14:00:27,343 - src.webui.api.utils.link_validator - INFO - Validating 1 inline links in LLM response
2025-08-17 14:00:27,343 - src.webui.api.routers.chat - INFO - Query processed successfully: id=req_1755453619527 time=7.815s model=nova faithfulness=0.900
2025-08-17 14:00:27,344 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=200 time=7.817s id=req_1755453619527 ip=127.0.0.1
INFO:     127.0.0.1:53086 - "POST /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 22:29:28,767 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/languages/validate status=200 time=0.001s id=req_1755484168765 ip=127.0.0.1
INFO:     127.0.0.1:64584 - "OPTIONS /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 22:29:28,783 - src.webui.api.routers.languages - INFO - Language validation: query_len=36 detected=en model=nova confidence=0.800
2025-08-17 22:29:28,784 - src.webui.api.main - INFO - REQUEST POST /api/v1/languages/validate status=200 time=0.008s id=req_1755484168776 ip=127.0.0.1
INFO:     127.0.0.1:64584 - "POST /api/v1/languages/validate HTTP/1.1" 200 OK
2025-08-17 22:29:28,798 - src.webui.api.main - INFO - REQUEST OPTIONS /api/v1/chat/query status=200 time=0.000s id=req_1755484168798 ip=127.0.0.1
INFO:     127.0.0.1:64584 - "OPTIONS /api/v1/chat/query HTTP/1.1" 200 OK
2025-08-17 22:29:28,803 - src.webui.api.routers.chat - INFO - Processing chat query: id=req_1755484168801 query_len=36 lang=en
2025-08-17 22:29:28,803 - src.webui.api.routers.chat - INFO - Language routing: detected=en model=nova
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Processing query: 'Why is summer so hot now in Toronto?...' in english (code: en)
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Raw query repr: 'Why is summer so hot now in Toronto?'
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Router IN → language_name=english, language_code=en
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Step 1: Query Routing
2025-08-17 22:29:28,804 - src.models.query_routing - INFO - Language: english (en) → Model: Nova
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Router OUT → model=Nova, support=nova, needs_translation=False
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Router OUT → english_query='Why is summer so hot now in Toronto?'
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Router OUT → processed_query='Why is summer so hot now in Toronto?'
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - ✓ Routed to Nova model
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Timing: routing=0.3ms
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Net debug → original_query len=36, utf8_bytes=36
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Net debug → english_query len=36, utf8_bytes=36
2025-08-17 22:29:28,804 - src.models.climate_pipeline - INFO - Step 2: Cache Check
2025-08-17 22:29:28,807 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 22:29:28,813 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 22:29:28,813 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 22:29:28,814 - src.models.climate_pipeline - INFO - Cache miss for english query
2025-08-17 22:29:28,817 - src.models.climate_pipeline - INFO - Timing: cache=12.9ms
2025-08-17 22:29:28,817 - src.models.climate_pipeline - INFO - Step 3: Query Rewriting
2025-08-17 22:29:28,817 - src.models.conversation_parser - INFO - No conversation history to format
2025-08-17 22:29:28,817 - src.models.climate_pipeline - INFO - Rewriter IN → expected_lang=en, history_len=0
2025-08-17 22:29:28,817 - src.models.climate_pipeline - INFO - Rewriter IN → original_query='Why is summer so hot now in Toronto?'
2025-08-17 22:29:28,818 - query_rewriter - INFO - Rewriter NET IN → expected_lang=en, user_query repr='Why is summer so hot now in Toronto?', norm='Why is summer so hot now in Toronto?'
2025-08-17 22:29:30,819 - query_rewriter - WARNING - REWRITER_TIMEOUT_2S → using original query fallback
2025-08-17 22:29:30,820 - src.models.climate_pipeline - INFO - Rewriter OUT → detected_lang='en', classification='off-topic', language_match='yes', canned=False
2025-08-17 22:29:30,820 - src.models.climate_pipeline - INFO - Rewriter OUT → rewrite_en='None'
2025-08-17 22:29:30,822 - src.webui.api.routers.chat - ERROR - Pipeline error: id=req_1755484168801 error=I'm a climate change assistant and can only help with questions about climate, environment, and sustainability. Please ask me about topics like climate change causes, effects, or solutions.
2025-08-17 22:29:30,822 - src.webui.api.routers.chat - ERROR - Pipeline processing failed: id=req_1755484168801 error=500: {'error': {'code': 'PIPELINE_ERROR', 'type': 'processing_error', 'message': "I'm a climate change assistant and can only help with questions about climate, environment, and sustainability. Please ask me about topics like climate change causes, effects, or solutions.", 'retryable': True, 'request_id': 'req_1755484168801'}}
2025-08-17 22:29:30,822 - src.webui.api.main - INFO - REQUEST POST /api/v1/chat/query status=500 time=2.021s id=req_1755484168801 ip=127.0.0.1
INFO:     127.0.0.1:64584 - "POST /api/v1/chat/query HTTP/1.1" 500 Internal Server Error
2025-08-17 22:29:48,029 - src.models.nova_flow - INFO - dep=bedrock host=bedrock.us-east-1.amazonaws.com op=invoke_model ms=19210 status=OK request_id=3c3d7da8-853e-4c0e-a87d-c952ad7a4574
2025-08-17 22:29:54,608 - src.webui.api.main - INFO - REQUEST GET /health status=200 time=0.000s id=req_1755484194608 ip=127.0.0.1
INFO:     127.0.0.1:64599 - "GET /health HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-08-17 23:00:43,094 - src.webui.api.main - INFO - 🧹 Cleaning up pipeline...
2025-08-17 23:00:43,097 - src.models.climate_pipeline - INFO - ✓ Nova model client closed
2025-08-17 23:00:43,097 - src.models.climate_pipeline - INFO - ✓ Cohere client closed
2025-08-17 23:00:43,099 - src.models.redis_cache - INFO - Initializing Redis connection to localhost:6379 (SSL: False)
2025-08-17 23:00:43,112 - src.models.redis_cache - INFO - ✓ Redis connection test successful to localhost
2025-08-17 23:00:43,112 - src.models.redis_cache - INFO - ✓ Redis cache initialized for localhost
2025-08-17 23:00:43,117 - src.models.redis_cache - INFO - Redis connection closed
2025-08-17 23:00:43,118 - src.models.climate_pipeline - INFO - ✓ Redis client closed
2025-08-17 23:00:43,118 - src.models.climate_pipeline - INFO - Pipeline cleanup completed successfully
2025-08-17 23:00:43,118 - src.webui.api.main - INFO - ✅ Cleanup completed
INFO:     Application shutdown complete.
INFO:     Finished server process [29492]
/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/multiprocessing/resource_tracker.py:254: UserWarning: resource_tracker: There appear to be 1 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
